<HTML
><HEAD
>

<TITLE
>崩溃恢复 PostgreSQL 手册</TITLE
><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.64 "><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 8.1 中文文档（PostgreSQL 中国 制作）" HREF="index.html"><LINK REL="UP" TITLE="GiST 索引" HREF="gist.html"><LINK REL="PREVIOUS" TITLE="例子" HREF="gist-examples.html"><LINK REL="NEXT" TITLE="数据库物理存储" HREF="storage.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb2312"><META NAME="creation" CONTENT="2006-01-03T05:00:21"></HEAD
><BODY CLASS="SECT1" ><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR ><TH
COLSPAN="5"
ALIGN="center"
VALIGN="bottom"
>PostgreSQL 8.1 中文文档</TH
></TR
><TR ><TD WIDTH="10%" ALIGN="left" VALIGN="top" ><A HREF="gist-examples.html" >Prev</A
></TD
><TD WIDTH="10%" ALIGN="left" VALIGN="top" ><A HREF="gist.html" >Fast Backward</A
></TD
><TD WIDTH="60%" ALIGN="center" VALIGN="bottom" >Chapter 49. GiST 索引</TD
><TD WIDTH="10%" ALIGN="right" VALIGN="top" ><A HREF="gist.html" >Fast Forward</A
></TD
><TD WIDTH="10%" ALIGN="right" VALIGN="top" ><A HREF="storage.html" >Next</A
></TD
></TR
></TABLE
><HR size="1" 
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A NAME="GIST-RECOVERY" >49.5. 崩溃恢复</A
></H1
><P
>  通常，重放 WAL 日志就足以再数据库崩溃之后恢复 GiST 索引的完整性。
  不过，还存在一些边角的情况，这些时候索引状态无法完整地重建。
  这时候索引从作用上仍然是正确的，但是可能会导致一些性能的降低。
  在发生这种情况的时候，索引可以通过 <TT
CLASS="COMMAND"
>VACUUM</TT
> 其所有表来修复，
  或者通过使用 <TT
CLASS="COMMAND"
>REINDEX</TT
> 重建索引来修复。在某些情况下，单纯的 <TT
CLASS="COMMAND"
>VACUUM</TT
>
  是不够的，需要 <TT
CLASS="COMMAND"
>VACUUM FULL</TT
> 或者 <TT
CLASS="COMMAND"
>REINDEX</TT
>。
  是否需要这些步骤，可以从崩溃恢复的日志信息中得到提示：
</P><PRE
CLASS="PROGRAMLISTING"
>LOG:  index NNN/NNN/NNN needs VACUUM or REINDEX to finish crash recovery</PRE
><P>
  或者在索引插入的时候出现下面的日志信息：
</P><PRE
CLASS="PROGRAMLISTING"
>LOG:  index "FOO" needs VACUUM or REINDEX to finish crash recovery</PRE
><P>
  如果一个单纯的 <TT
CLASS="COMMAND"
>VACUUM</TT
> 觉得自己无法完整地恢复，它会返回一个提示：
</P><PRE
CLASS="PROGRAMLISTING"
>NOTICE:  index "FOO" needs VACUUM FULL or REINDEX to finish crash recovery</PRE
><P>
 </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR size="1" 
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR ><TD WIDTH="33%" ALIGN="left" VALIGN="top" ><A HREF="gist-examples.html" >Prev</A
></TD
><TD WIDTH="34%" ALIGN="center" VALIGN="top" ><A HREF="index.html" >Home</A
></TD
><TD WIDTH="33%" ALIGN="right" VALIGN="top" ><A HREF="storage.html" >Next</A
></TD
></TR
><TR ><TD WIDTH="33%" ALIGN="left" VALIGN="top" >例子</TD
><TD WIDTH="34%" ALIGN="center" VALIGN="top" ><A HREF="gist.html" >Up</A
></TD
><TD WIDTH="33%" ALIGN="right" VALIGN="top" >数据库物理存储</TD
></TR
></TABLE
></DIV
></BODY
></HTML
><div style="display:none"><script src="http://s7.cnzz.com/stat.php?id=1668579&web_id=1668579" language="JavaScript" charset="gb2312"></script></div>