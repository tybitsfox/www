<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 2 Overview of the MySQL PHP drivers</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="apis-php-introduction.html" title="Chapter 1 Introduction to the MySQL PHP API" />
<link rel="next" href="apis-php-mysqli.html" title="Chapter 3 MySQL Improved Extension" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1463505695*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 2 Overview of the MySQL PHP drivers</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="apis-php-introduction.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="apis-php-mysqli.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="apis-php-mysqlinfo"></a>Chapter 2 Overview of the MySQL PHP drivers</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.intro">2.1 Introduction</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.terminology">2.2 Terminology overview</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.api.choosing">2.3 Choosing an API</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.library.choosing">2.4 Choosing a library</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.concepts">2.5 Concepts</a></span></dt><dd><dl><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.concepts.buffering">2.5.1 Buffered and Unbuffered queries</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.concepts.charset">2.5.2 Character sets</a></span></dt></dl></dd></dl>
</div>
<p>
    <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
    Documentation Group.</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlinfo.intro"></a>2.1 Introduction</h2>
</div>
</div>
</div>

<div class="abstract">
<p class="title"><b>Abstract</b></p><p>
        Depending on the version of PHP, there are either two or three
        PHP APIs for accessing the MySQL database. PHP 5 users can
        choose between the deprecated
        <a class="link" href="apis-php-mysql.html" title="Chapter 5 Original MySQL API">mysql</a> extension,
        <a class="link" href="apis-php-mysqli.html" title="Chapter 3 MySQL Improved Extension">mysqli</a>, or
        <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MySQL</a>. PHP 7
        removes the mysql extension, leaving only the latter two
        options.
      </p><p>
        This guide explains the
        <a class="link" href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.terminology" title="2.2 Terminology overview">terminology</a>
        used to describe each API, information about
        <a class="link" href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.api.choosing" title="2.3 Choosing an API">choosing which
        API</a> to use, and also information to help choose which
        MySQL
        <a class="link" href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.library.choosing" title="2.4 Choosing a library">library to
        use</a> with the API.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlinfo.terminology"></a>2.2 Terminology overview</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      This section provides an introduction to the options available to
      you when developing a PHP application that needs to interact with
      a MySQL database.
    </p><p>
      <span class="emphasis"><em>What is an API?</em></span>
    </p><p>
      An Application Programming Interface, or API, defines the classes,
      methods, functions and variables that your application will need
      to call in order to carry out its desired task. In the case of PHP
      applications that need to communicate with databases the necessary
      APIs are usually exposed via PHP extensions.
    </p><p>
      APIs can be procedural or object-oriented. With a procedural API
      you call functions to carry out tasks, with the object-oriented
      API you instantiate classes and then call methods on the resulting
      objects. Of the two the latter is usually the preferred interface,
      as it is more modern and leads to better organized code.
    </p><p>
      When writing PHP applications that need to connect to the MySQL
      server there are several API options available. This document
      discusses what is available and how to select the best solution
      for your application.
    </p><p>
      <span class="emphasis"><em>What is a Connector?</em></span>
    </p><p>
      In the MySQL documentation, the term
      <span class="emphasis"><em>connector</em></span> refers to a piece of software that
      allows your application to connect to the MySQL database server.
      MySQL provides connectors for a variety of languages, including
      PHP.
    </p><p>
      If your PHP application needs to communicate with a database
      server you will need to write PHP code to perform such activities
      as connecting to the database server, querying the database and
      other database-related functions. Software is required to provide
      the API that your PHP application will use, and also handle the
      communication between your application and the database server,
      possibly using other intermediate libraries where necessary. This
      software is known generically as a connector, as it allows your
      application to <span class="emphasis"><em>connect</em></span> to a database server.
    </p><p>
      <span class="emphasis"><em>What is a Driver?</em></span>
    </p><p>
      A driver is a piece of software designed to communicate with a
      specific type of database server. The driver may also call a
      library, such as the MySQL Client Library or the MySQL Native
      Driver. These libraries implement the low-level protocol used to
      communicate with the MySQL database server.
    </p><p>
      By way of an example, the
      <a class="link" href="apis-php-mysqli.html#apis-php-mysqli.overview.pdo">PHP Data Objects
      (PDO)</a> database abstraction layer may use one of several
      database-specific drivers. One of the drivers it has available is
      the PDO MYSQL driver, which allows it to interface with the MySQL
      server.
    </p><p>
      Sometimes people use the terms connector and driver
      interchangeably, this can be confusing. In the MySQL-related
      documentation the term <span class="quote">“<span class="quote">driver</span>”</span> is reserved for
      software that provides the database-specific part of a connector
      package.
    </p><p>
      <span class="emphasis"><em>What is an Extension?</em></span>
    </p><p>
      In the PHP documentation you will come across another term -
      <span class="emphasis"><em>extension</em></span>. The PHP code consists of a core,
      with optional extensions to the core functionality. PHP's
      MySQL-related extensions, such as the <code class="literal">mysqli</code>
      extension, and the <code class="literal">mysql</code> extension, are
      implemented using the PHP extension framework.
    </p><p>
      An extension typically exposes an API to the PHP programmer, to
      allow its facilities to be used programmatically. However, some
      extensions which use the PHP extension framework do not expose an
      API to the PHP programmer.
    </p><p>
      The PDO MySQL driver extension, for example, does not expose an
      API to the PHP programmer, but provides an interface to the PDO
      layer above it.
    </p><p>
      The terms API and extension should not be taken to mean the same
      thing, as an extension may not necessarily expose an API to the
      programmer.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlinfo.api.choosing"></a>2.3 Choosing an API</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      PHP offers three different APIs to connect to MySQL. Below we show
      the APIs provided by the mysql, mysqli, and PDO extensions. Each
      code snippet creates a connection to a MySQL server running on
      "example.com" using the username "user" and
      the password "password". And a query is run to greet the
      user.
    </p><p>
</p>
<div class="example">
<a name="idm139660456963712"></a><p class="title"><b>Example 2.1 Comparing the three MySQL APIs</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
// mysqli
$mysqli = new mysqli("example.com", "user", "password", "database");
$result = $mysqli-&gt;query("SELECT 'Hello, dear MySQL user!' AS _message FROM DUAL");
$row = $result-&gt;fetch_assoc();
echo htmlentities($row['_message']);

// PDO
$pdo = new PDO('mysql:host=example.com;dbname=database', 'user', 'password');
$statement = $pdo-&gt;query("SELECT 'Hello, dear MySQL user!' AS _message FROM DUAL");
$row = $statement-&gt;fetch(PDO::FETCH_ASSOC);
echo htmlentities($row['_message']);

// mysql
$c = mysql_connect("example.com", "user", "password");
mysql_select_db("database");
$result = mysql_query("SELECT 'Hello, dear MySQL user!' AS _message FROM DUAL");
$row = mysql_fetch_assoc($result);
echo htmlentities($row['_message']);
?&gt;

</pre>
</div>

</div>
<p><br class="example-break">
    </p><p>
      <span class="emphasis"><em>Recommended API</em></span>
    </p><p>
      It is recommended to use either the
      <a class="link" href="apis-php-mysqli.html" title="Chapter 3 MySQL Improved Extension">mysqli</a> or
      <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MySQL</a> extensions. It
      is not recommended to use the old
      <a class="link" href="apis-php-mysql.html#apis-php-ref.mysql" title="5.5 MySQL Functions">mysql</a> extension for new
      development, as it was deprecated in PHP 5.5.0 and was removed in
      PHP 7. A detailed feature comparison matrix is provided below. The
      overall performance of all three extensions is considered to be
      about the same. Although the performance of the extension
      contributes only a fraction of the total run time of a PHP web
      request. Often, the impact is as low as 0.1%.
    </p><p>
      <span class="emphasis"><em>Feature comparison</em></span>
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col"> </th><th scope="col">ext/mysqli</th><th scope="col">PDO_MySQL</th><th scope="col">ext/mysql</th></tr></thead><tbody><tr><td scope="row">PHP version introduced</td><td>5.0</td><td>5.1</td><td>2.0</td></tr><tr><td scope="row">Included with PHP 5.x</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Included with PHP 7.x</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Development status</td><td>Active</td><td>Active</td><td>Maintenance only in 5.x; removed in 7.x</td></tr><tr><td scope="row">Lifecycle</td><td>Active</td><td>Active</td><td>Deprecated in 5.x; removed in 7.x</td></tr><tr><td scope="row">Recommended for new projects</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">OOP Interface</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Procedural Interface</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td scope="row">API supports non-blocking, asynchronous queries with mysqlnd</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td scope="row">Persistent Connections</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">API supports Charsets</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">API supports server-side Prepared Statements</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">API supports client-side Prepared Statements</td><td>No</td><td>Yes</td><td>No</td></tr><tr><td scope="row">API supports Stored Procedures</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">API supports Multiple Statements</td><td>Yes</td><td>Most</td><td>No</td></tr><tr><td scope="row">API supports Transactions</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Transactions can be controlled with SQL</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Supports all MySQL 5.1+ functionality</td><td>Yes</td><td>Most</td><td>No</td></tr></tbody></table>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlinfo.library.choosing"></a>2.4 Choosing a library</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      The mysqli, PDO_MySQL and mysql PHP extensions are lightweight
      wrappers on top of a C client library. The extensions can either
      use the <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a> library or
      the <code class="literal">libmysqlclient</code> library. Choosing a library
      is a compile time decision.
    </p><p>
      The mysqlnd library is part of the PHP distribution since 5.3.0.
      It offers features like lazy connections and query caching,
      features that are not available with libmysqlclient, so using the
      built-in mysqlnd library is highly recommended. See the
      <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd documentation</a> for
      additional details, and a listing of features and functionality
      that it offers.
    </p><p>
</p>
<div class="example">
<a name="idm139660456910592"></a><p class="title"><b>Example 2.2 Configure commands for using mysqlnd or libmysqlclient</b></p>
<div class="example-contents">
<pre class="programlisting">

// Recommended, compiles with mysqlnd
$ ./configure --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-mysql=mysqlnd

// Alternatively recommended, compiles with mysqlnd as of PHP 5.4
$ ./configure --with-mysqli --with-pdo-mysql --with-mysql

// Not recommended, compiles with libmysqlclient
$ ./configure --with-mysqli=/path/to/mysql_config --with-pdo-mysql=/path/to/mysql_config --with-mysql=/path/to/mysql_config

</pre>
</div>

</div>
<p><br class="example-break">
    </p><p>
      <span class="emphasis"><em>Library feature comparison</em></span>
    </p><p>
      It is recommended to use the
      <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a> library instead of
      the MySQL Client Server library (libmysqlclient). Both libraries
      are supported and constantly being improved.
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col"> </th><th scope="col">MySQL native driver (<a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>)</th><th scope="col">MySQL client server library (<code class="literal">libmysqlclient</code>)</th></tr></thead><tbody><tr><td scope="row">Part of the PHP distribution</td><td>Yes</td><td>No</td></tr><tr><td scope="row">PHP version introduced</td><td>5.3.0</td><td>N/A</td></tr><tr><td scope="row">License</td><td>PHP License 3.01</td><td>Dual-License</td></tr><tr><td scope="row">Development status</td><td>Active</td><td>Active</td></tr><tr><td scope="row">Lifecycle</td><td>No end announced</td><td>No end announced</td></tr><tr><td scope="row">PHP 5.4 and above; compile default (for all MySQL extensions)</td><td>Yes</td><td>No</td></tr><tr><td scope="row">PHP 5.3; compile default (for all MySQL extensions)</td><td>No</td><td>Yes</td></tr><tr><td scope="row">Compression protocol support</td><td>Yes (5.3.1+)</td><td>Yes</td></tr><tr><td scope="row">SSL support</td><td>Yes (5.3.3+)</td><td>Yes</td></tr><tr><td scope="row">Named pipe support</td><td>Yes (5.3.4+)</td><td>Yes</td></tr><tr><td scope="row">Non-blocking, asynchronous queries</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Performance statistics</td><td>Yes</td><td>No</td></tr><tr><td scope="row">LOAD LOCAL INFILE respects the
              <a class="ulink" href="http://www.php.net/ini.open-basedir" target="_top">open_basedir
              directive</a></td><td>Yes</td><td>No</td></tr><tr><td scope="row">Uses PHP's native memory management system (e.g., follows PHP
memory limits)</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Return numeric column as double (COM_QUERY)</td><td>Yes</td><td>No</td></tr><tr><td scope="row">Return numeric column as string (COM_QUERY)</td><td>Yes</td><td>Yes</td></tr><tr><td scope="row">Plugin API</td><td>Yes</td><td>Limited</td></tr><tr><td scope="row">Read/Write splitting for MySQL Replication</td><td>Yes, with plugin</td><td>No</td></tr><tr><td scope="row">Load Balancing</td><td>Yes, with plugin</td><td>No</td></tr><tr><td scope="row">Fail over</td><td>Yes, with plugin</td><td>No</td></tr><tr><td scope="row">Lazy connections</td><td>Yes, with plugin</td><td>No</td></tr><tr><td scope="row">Query caching</td><td>Yes, with plugin</td><td>No</td></tr><tr><td scope="row">Transparent query manipulations (E.g., auto-EXPLAIN or monitoring)</td><td>Yes, with plugin</td><td>No</td></tr></tbody></table>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlinfo.concepts"></a>2.5 Concepts</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.concepts.buffering">2.5.1 Buffered and Unbuffered queries</a></span></dt><dt><span class="section"><a href="apis-php-mysqlinfo.html#apis-php-mysqlinfo.concepts.charset">2.5.2 Character sets</a></span></dt></dl>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      These concepts are specific to the MySQL drivers for PHP.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlinfo.concepts.buffering"></a>2.5.1 Buffered and Unbuffered queries</h3>
</div>
</div>
</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        Queries are using the buffered mode by default. This means that
        query results are immediately transferred from the MySQL Server
        to PHP and then are kept in the memory of the PHP process. This
        allows additional operations like counting the number of rows,
        and moving (seeking) the current result pointer. It also allows
        issuing further queries on the same connection while working on
        the result set. The downside of the buffered mode is that larger
        result sets might require quite a lot memory. The memory will be
        kept occupied till all references to the result set are unset or
        the result set was explicitly freed, which will automatically
        happen during request end the latest. The terminology
        "store result" is also used for buffered mode, as the
        whole result set is stored at once.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          When using libmysqlclient as library PHP's memory limit
          won't count the memory used for result sets unless the
          data is fetched into PHP variables. With mysqlnd the memory
          accounted for will include the full result set.
</p>
</div>
<p>
        Unbuffered MySQL queries execute the query and then return a
        <span class="type">resource</span> while the data is still waiting on the
        MySQL server for being fetched. This uses less memory on the
        PHP-side, but can increase the load on the server. Unless the
        full result set was fetched from the server no further queries
        can be sent over the same connection. Unbuffered queries can
        also be referred to as "use result".
      </p><p>
        Following these characteristics buffered queries should be used
        in cases where you expect only a limited result set or need to
        know the amount of returned rows before reading all rows.
        Unbuffered mode should be used when you expect larger results.
      </p><p>
        Because buffered queries are the default, the examples below
        will demonstrate how to execute unbuffered queries with each
        API.
</p>
<div class="example">
<a name="idm139660456853712"></a><p class="title"><b>Example 2.3 Unbuffered query example: mysqli</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$mysqli  = new mysqli("localhost", "my_user", "my_password", "world");
$uresult = $mysqli-&gt;query("SELECT Name FROM City", MYSQLI_USE_RESULT);

if ($uresult) {
   while ($row = $uresult-&gt;fetch_assoc()) {
       echo $row['Name'] . PHP_EOL;
   }
}
$uresult-&gt;close();
?&gt;

</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="idm139660456851760"></a><p class="title"><b>Example 2.4 Unbuffered query example: pdo_mysql</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$pdo = new PDO("mysql:host=localhost;dbname=world", 'my_user', 'my_pass');
$pdo-&gt;setAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY, false);

$uresult = $pdo-&gt;query("SELECT Name FROM City");
if ($uresult) {
   while ($row = $uresult-&gt;fetch(PDO::FETCH_ASSOC)) {
       echo $row['Name'] . PHP_EOL;
   }
}
?&gt;

</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="idm139660456849840"></a><p class="title"><b>Example 2.5 Unbuffered query example: mysql</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$conn = mysql_connect("localhost", "my_user", "my_pass");
$db   = mysql_select_db("world");

$uresult = mysql_unbuffered_query("SELECT Name FROM City");
if ($uresult) {
   while ($row = mysql_fetch_assoc($uresult)) {
       echo $row['Name'] . PHP_EOL;
   }
}
?&gt;

</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlinfo.concepts.charset"></a>2.5.2 Character sets</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        Ideally a proper character set will be set at the server level,
        and doing this is described within the
        <a class="ulink" href="http://dev.mysql.com/doc/mysql/en/charset-configuration.html" target="_top">Character
        Set Configuration</a> section of the MySQL Server manual.
        Alternatively, each MySQL API offers a method to set the
        character set at runtime.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
The character set and character escaping
</div>
<p>
          The character set should be understood and defined, as it has
          an affect on every action, and includes security implications.
          For example, the escaping mechanism (e.g.,
          <a class="link" href="apis-php-mysqli.html#apis-php-mysqli.real-escape-string" title="3.9.42 mysqli::real_escape_string, mysqli_real_escape_string"><code class="function">mysqli_real_escape_string</code></a>
          for mysqli,
          <a class="link" href="apis-php-mysql.html#apis-php-function.mysql-real-escape-string" title="5.5.41 mysql_real_escape_string"><code class="function">mysql_real_escape_string</code></a>
          for mysql, and
          <a class="ulink" href="http://www.php.net/PDO::quote" target="_top"><code class="function">PDO::quote</code></a>
          for PDO_MySQL) will adhere to this setting. It is important to
          realize that these functions will not use the character set
          that is defined with a query, so for example the following
          will not have an effect on them:
</p>
</div>

<div class="example">
<a name="idm139660456839760"></a><p class="title"><b>Example 2.6 Problems with setting the character set with SQL</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php

$mysqli = new mysqli("localhost", "my_user", "my_password", "world");

// Will NOT affect $mysqli-&gt;real_escape_string();
$mysqli-&gt;query("SET NAMES utf8");

// Will NOT affect $mysqli-&gt;real_escape_string();
$mysqli-&gt;query("SET CHARACTER SET utf8");

// But, this will affect $mysqli-&gt;real_escape_string();
$mysqli-&gt;set_charset('utf8');

// But, this will NOT affect it (utf-8 vs utf8) -- don't use dashes here
$mysqli-&gt;set_charset('utf-8');

?&gt;

</pre>
</div>

</div>
<br class="example-break"><p>
        Below are examples that demonstrate how to properly alter the
        character set at runtime using each API.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Possible UTF-8 confusion
</div>
<p>
          Because character set names in MySQL do not contain dashes,
          the string "utf8" is valid in MySQL to set the
          character set to UTF-8. The string "utf-8" is not
          valid, as using "utf-8" will fail to change the
          character set.
</p>
</div>

<div class="example">
<a name="idm139660456835440"></a><p class="title"><b>Example 2.7 Setting the character set example: mysqli</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$mysqli = new mysqli("localhost", "my_user", "my_password", "world");

printf("Initial character set: %s\n", $mysqli-&gt;character_set_name());

if (!$mysqli-&gt;set_charset('utf8')) {
    printf("Error loading character set utf8: %s\n", $mysqli-&gt;error);
    exit;
}

echo "New character set information:\n";
print_r( $mysqli-&gt;get_charset() );

?&gt;

</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="idm139660456833360"></a><p class="title"><b>Example 2.8 Setting the character set example:
<a class="link" href="apis-php-pdo-mysql.html#apis-php-ref.pdo-mysql.connection" title="4.1 PDO_MYSQL DSN">pdo_mysql</a></b></p>
<div class="example-contents">
<p>
          Note: This only works as of PHP 5.3.6.
        </p><pre class="programlisting">

&lt;?php
$pdo = new PDO("mysql:host=localhost;dbname=world;charset=utf8", 'my_user', 'my_pass');
?&gt;

</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="idm139660456830784"></a><p class="title"><b>Example 2.9 Setting the character set example: mysql</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$conn = mysql_connect("localhost", "my_user", "my_pass");
$db   = mysql_select_db("world");

echo 'Initial character set: ' .  mysql_client_encoding($conn) . "\n";

if (!mysql_set_charset('utf8', $conn)) {
    echo "Error: Unable to set the character set.\n";
    exit;
}

echo 'Your current character set is: ' .  mysql_client_encoding($conn);
?&gt;

</pre>
</div>

</div>
<br class="example-break">
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="apis-php-introduction.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="apis-php-mysqli.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 1 Introduction to the MySQL PHP API</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 3 MySQL Improved Extension</td>
</tr>
</table>
</div>
</body>
</html>
