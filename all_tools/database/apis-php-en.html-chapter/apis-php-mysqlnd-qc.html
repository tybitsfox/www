<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 8 Mysqlnd query result cache plugin</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="apis-php-mysqlnd-ms.html" title="Chapter 7 Mysqlnd replication and load balancing plugin" />
<link rel="next" href="apis-php-mysqlnd-uh.html" title="Chapter 9 Mysqlnd user handler plugin" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1463505695*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 8 Mysqlnd query result cache plugin</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="apis-php-mysqlnd-ms.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="apis-php-mysqlnd-uh.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="apis-php-mysqlnd-qc"></a>Chapter 8 Mysqlnd query result cache plugin</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.key-features">8.1 Key Features</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.limitations">8.2 Limitations</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.name">8.3 On the name</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart">8.4 Quickstart and Examples</a></span></dt><dd><dl><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.concepts">8.4.1 Architecture and Concepts</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.configuration">8.4.2 Setup</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.caching">8.4.3 Caching queries</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.per-query-ttl">8.4.4 Setting the TTL</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.pattern-based-caching">8.4.5 Pattern based caching</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.slam-defense">8.4.6 Slam defense</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.cache-candidates">8.4.7 Finding cache candidates</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.cache-efficiency">8.4.8 Measuring cache efficiency</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.set-user-handlers">8.4.9 Beyond TTL: user-defined storage</a></span></dt></dl></dd><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.setup">8.5 Installing/Configuring</a></span></dt><dd><dl><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.requirements">8.5.1 Requirements</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.installation">8.5.2 Installation</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration">8.5.3 Runtime Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.constants">8.6 Predefined Constants</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-ref.mysqlnd-qc">8.7 mysqlnd_qc Functions</a></span></dt><dd><dl><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-clear-cache">8.7.1 <code class="literal">mysqlnd_qc_clear_cache</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-available-handlers">8.7.2 <code class="literal">mysqlnd_qc_get_available_handlers</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info">8.7.3 <code class="literal">mysqlnd_qc_get_cache_info</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats">8.7.4 <code class="literal">mysqlnd_qc_get_core_stats</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log">8.7.5 <code class="literal">mysqlnd_qc_get_normalized_query_trace_log</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-query-trace-log">8.7.6 <code class="literal">mysqlnd_qc_get_query_trace_log</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition">8.7.7 <code class="literal">mysqlnd_qc_set_cache_condition</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-is-select">8.7.8 <code class="literal">mysqlnd_qc_set_is_select</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-storage-handler">8.7.9 <code class="literal">mysqlnd_qc_set_storage_handler</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-user-handlers">8.7.10 <code class="literal">mysqlnd_qc_set_user_handlers</code></a></span></dt></dl></dd><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes">8.8 Change History</a></span></dt><dd><dl><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-two">8.8.1 PECL/mysqlnd_qc 1.2 series</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-one">8.8.2 PECL/mysqlnd_qc 1.1 series</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-o">8.8.3 PECL/mysqlnd_qc 1.0 series</a></span></dt></dl></dd></dl>
</div>
<p>
    <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
    Documentation Group.</a>
  </p><p>
    The mysqlnd query result cache plugin adds easy to use client-side
    query caching to all PHP MySQL extensions using
    <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>.
  </p><p>
    As of version PHP 5.3.3 the MySQL native driver for PHP (
    <code class="literal">mysqlnd</code>) features an internal plugin C API. C
    plugins, such as the query cache plugin, can extend the
    functionality of <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>.
  </p><p>
    Mysqlnd plugins such as the query cache plugin operate transparent
    from a user perspective. The cache plugin supports all PHP
    applications and all PHP MySQL extensions (
    <a class="link" href="apis-php-mysqli.html#apis-php-ref.mysqli" title="3.15 Aliases and deprecated Mysqli Functions">mysqli</a>,
    <a class="link" href="apis-php-mysql.html#apis-php-ref.mysql" title="5.5 MySQL Functions">mysql</a>,
    <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MYSQL</a>). It does not
    change existing APIs.
  </p><p>
    No significant application changes are required to cache a query.
    The cache has two operation modes. It will either cache all queries
    (not recommended) or only those queries marked with a certain SQL
    hint (recommended).
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.key-features"></a>8.1 Key Features</h2>
</div>
</div>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Transparent and therefore easy to use
          </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  supports all PHP MySQL extensions
                </p></li><li class="listitem"><p>
                  no API changes
                </p></li><li class="listitem"><p>
                  very little application changes required
</p></li></ul>
</div>
<p>
          </p></li><li class="listitem"><p>
            Flexible invalidation strategy
          </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Time-to-Live (TTL)
                </p></li><li class="listitem"><p>
                  user-defined
</p></li></ul>
</div>
<p>
          </p></li><li class="listitem"><p>
            Storage with different scope and life-span
          </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Default (Hash, process memory)
                </p></li><li class="listitem"><p>
                  <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a>
                </p></li><li class="listitem"><p>
                  MEMCACHE
                </p></li><li class="listitem"><p>
                  sqlite
                </p></li><li class="listitem"><p>
                  user-defined
</p></li></ul>
</div>
<p>
          </p></li><li class="listitem"><p>
            Built-in slam defense to prevent cache stampeding.
</p></li></ul>
</div>
<p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.limitations"></a>8.2 Limitations</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      The current 1.0.1 release of PECL mysqlnd_qc does not support PHP
      5.4. Version 1.1.0-alpha lifts this limitation.
    </p><p>
      Prepared statements and unbuffered queries are fully supported.
      Thus, the plugin is capable of caching all statements issued with
      <code class="literal">mysqli</code> or <code class="literal">PDO_MySQL</code>, which
      are the only two PHP MySQL APIs to offer prepared statement
      support.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.name"></a>8.3 On the name</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      The shortcut <code class="literal">mysqlnd_qc</code> stands for
      <code class="literal">mysqlnd query cache plugin</code>. The name was chosen
      for a quick-and-dirty proof-of-concept. In the beginning the
      developers did not expect to continue using the code base.
      Sometimes PECL/mysqlnd_qc has also been called
      <code class="literal">client-side query result set cache</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.quickstart"></a>8.4 Quickstart and Examples</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.concepts">8.4.1 Architecture and Concepts</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.configuration">8.4.2 Setup</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.quickstart.caching">8.4.3 Caching queries</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.per-query-ttl">8.4.4 Setting the TTL</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.pattern-based-caching">8.4.5 Pattern based caching</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.slam-defense">8.4.6 Slam defense</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.cache-candidates">8.4.7 Finding cache candidates</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.cache-efficiency">8.4.8 Measuring cache efficiency</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.set-user-handlers">8.4.9 Beyond TTL: user-defined storage</a></span></dt></dl>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      The mysqlnd query cache plugin is easy to use. This quickstart
      will demo typical use-cases, and provide practical advice on
      getting started.
    </p><p>
      It is strongly recommended to read the reference sections in
      addition to the quickstart. It is safe to begin with the
      quickstart. However, before using the plugin in mission critical
      environments we urge you to read additionally the background
      information from the reference sections.
    </p><p>
      Most of the examples use the
      <a class="link" href="apis-php-mysqli.html#apis-php-ref.mysqli" title="3.15 Aliases and deprecated Mysqli Functions">mysqli</a> extension
      because it is the most feature complete PHP MySQL extension.
      However, the plugin can be used with any PHP MySQL extension that
      is using the <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>
      library.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.quickstart.concepts"></a>8.4.1 Architecture and Concepts</h3>
</div>
</div>
</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        The query cache plugin is implemented as a PHP extension. It is
        written in C and operates under the hood of PHP. During the
        startup of the PHP interpreter, it gets registered as a
        <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a> plugin to
        replace selected mysqlnd C methods. Hereby, it can change the
        behaviour of any PHP MySQL extension
        (<a class="link" href="apis-php-mysqli.html#apis-php-ref.mysqli" title="3.15 Aliases and deprecated Mysqli Functions">mysqli</a>,
        <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MYSQL</a>,
        <a class="link" href="apis-php-mysql.html#apis-php-ref.mysql" title="5.5 MySQL Functions">mysql</a>) compiled to use
        the mysqlnd library without changing the extensions API. This
        makes the plugin compatible with each and every PHP MySQL
        application. Because existing APIs are not changed, it is almost
        transparent to use. Please, see the
        <a class="link" href="apis-php-mysqlnd.html#apis-php-mysqlnd.plugin" title="6.9 MySQL Native Driver Plugin API">mysqlnd plugin API
        description</a> for a discussion of the advantages of the
        plugin architecture and a comparison with proxy based solutions.
      </p><p>
        <span class="emphasis"><em>Transparent to use</em></span>
      </p><p>
        At PHP run time PECL/mysqlnd_qc can proxy queries send from PHP
        (<a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>) to the MySQL
        server. It then inspects the statement string to find whether it
        shall cache its results. If so, result set is cached using a
        storage handler and further executions of the statement are
        served from the cache for a user-defined period. The Time to
        Live (TTL) of the cache entry can either be set globally or on a
        per statement basis.
      </p><p>
        A statement is either cached if the plugin is instructed to
        cache all statements globally using a or, if the query string
        starts with the SQL hint (<code class="literal">/*qc=on*/</code>). The
        plugin is capable of caching any query issued by calling
        appropriate API calls of any of the existing PHP MySQL
        extensions.
      </p><p>
        <span class="emphasis"><em>Flexible storage: various storage handler</em></span>
      </p><p>
        Various storage handler are supported to offer different scopes
        for cache entries. Different scopes allow for different degrees
        in sharing cache entries among clients.
      </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">default</code> (built-in): process memory,
              scope: process, one or more web requests depending on PHP
              deployment model used
            </p></li><li class="listitem"><p>
              <code class="literal">APC</code>: shared memory, scope: single
              server, multiple web requests
            </p></li><li class="listitem"><p>
              <code class="literal">SQLite</code>: memory or file, scope: single
              server, multiple web requests
            </p></li><li class="listitem"><p>
              <code class="literal">MEMCACHE</code>: main memory, scope: single or
              multiple server, multiple web requests
            </p></li><li class="listitem"><p>
              <code class="literal">user</code> (built-in): user-defined - any,
              scope: user-defined - any
</p></li></ul>
</div>
<p>
      </p><p>
        Support for the <code class="literal">APC</code>,
        <code class="literal">SQLite</code> and <code class="literal"> MEMCACHE</code>
        storage handler has to be enabled at compile time. The <code class="literal">
        default</code> and <code class="literal">user</code> handler are
        built-in. It is possible to switch between compiled-in storage
        handlers on a per query basis at run time. However, it is
        recommended to pick one storage handler and use it for all cache
        entries.
      </p><p>
        <span class="emphasis"><em>Built-in slam defense to avoid overloading</em></span>
      </p><p>
        To avoid overload situations the cache plugin has a built-in
        slam defense mechanism. If a popular cache entries expires many
        clients using the cache entries will try to refresh the cache
        entry. For the duration of the refresh many clients may access
        the database server concurrently. In the worst case, the
        database server becomes overloaded and it takes more and more
        time to refresh the cache entry, which in turn lets more and
        more clients try to refresh the cache entry. To prevent this
        from happening the plugin has a slam defense mechanism. If slam
        defense is enabled and the plugin detects an expired cache entry
        it extends the life time of the cache entry before it refreshes
        the cache entry. This way other concurrent accesses to the
        expired cache entry are still served from the cache for a
        certain time. The other concurrent accesses to not trigger a
        concurrent refresh. Ideally, the cache entry gets refreshed by
        the client which extended the cache entries lifespan before
        other clients try to refresh the cache and potentially cause an
        overload situation.
      </p><p>
        <span class="emphasis"><em>Unique approach to caching</em></span>
      </p><p>
        PECL/mysqlnd_qc has a unique approach to caching result sets
        that is superior to application based cache solutions.
        Application based solutions first fetch a result set into PHP
        variables. Then, the PHP variables are serialized for storage in
        a persistent cache, and then unserialized when fetching. The
        mysqlnd query cache stores the raw wire protocol data sent from
        MySQL to PHP in its cache and replays it, if still valid, on a
        cache hit. This way, it saves an extra serialization step for a
        cache put that all application based solutions have to do. It
        can store the raw wire protocol data in the cache without having
        to serialize into a PHP variable first and deserializing the PHP
        variable for storing in the cache again.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.quickstart.configuration"></a>8.4.2 Setup</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        The plugin is implemented as a PHP extension. See also the
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.installation" title="8.5.2 Installation">installation
        instructions</a> to install the
        <a class="ulink" href="http://pecl.php.net/package/mysqlnd_qc" target="_top">PECL/mysqlnd_qc</a>
        extension.
      </p><p>
        Compile or configure the PHP MySQL extension
        (<a class="link" href="apis-php-mysqli.html#apis-php-ref.mysqli" title="3.15 Aliases and deprecated Mysqli Functions">mysqli</a>,
        <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MYSQL</a>,
        <a class="link" href="apis-php-mysql.html#apis-php-ref.mysql" title="5.5 MySQL Functions">mysql</a>) that you plan
        to use with support for the
        <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a> library.
        PECL/mysqlnd_qc is a plugin for the mysqlnd library. To use the
        plugin with any of the existing PHP MySQL extensions (APIs), the
        extension has to use the mysqlnd library.
      </p><p>
        Then, load the extension into PHP and activate the plugin in the
        PHP configuration file using the PHP configuration directive
        named
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.enable-qc">mysqlnd_qc.enable_qc</a>.
      </p><p>
</p>
<div class="example">
<a name="idm139660443151152"></a><p class="title"><b>Example 8.1 Enabling the plugin (php.ini)</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1

</pre>
</div>

</div>
<p><br class="example-break">
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.quickstart.caching"></a>8.4.3 Caching queries</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        There are four ways to trigger caching of a query.

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Use of SQL hints on a per query basis</li><li class="listitem">
      User supplied callbacks to decide on a per query basis, for example, using <a class="ulink" href="http://www.php.net/mysqlnd_qc_is_select" target="_top"><code class="function">mysqlnd_qc_is_select</code></a>

            </li><li class="listitem"><a class="ulink" href="http://www.php.net/mysqlnd_set_cache_condition" target="_top"><code class="function">mysqlnd_set_cache_condition</code></a> for rule based automatic per query decisions
     </li><li class="listitem"><code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default = 1</a></code>
      to cache all queries blindly
</li></ul>
</div>
<p>
      </p><p>
        Use of SQL hints and
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default
        = 1</a></code> are explained below. Please, refer to the
        function reference on
        <a class="ulink" href="http://www.php.net/mysqlnd_qc_is_select" target="_top"><code class="function">mysqlnd_qc_is_select</code></a>
        for a description of using a callback and,
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
        on how to set rules for automatic caching.
      </p><p>
        A SQL hint is a SQL standards compliant comment. As a SQL
        comment it is ignored by the database. A statement is considered
        eligible for caching if it either begins with the SQL hint
        enabling caching or it is a <code class="literal">SELECT</code> statement.
      </p><p>
        An individual query which shall be cached must begin with the
        SQL hint <code class="literal">/*qc=on*/</code>. It is recommended to use
        the PHP constant
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.constants" title="8.6 Predefined Constants">MYSQLND_QC_ENABLE_SWITCH</a></code>
        instead of using the string value.
      </p><p>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              not eligible for caching and not cached: <code class="literal">INSERT
              INTO test(id) VALUES (1)</code>
            </p></li><li class="listitem"><p>
              not eligible for caching and not cached: <code class="literal">SHOW
              ENGINES</code>
            </p></li><li class="listitem"><p>
              eligible for caching but uncached: <code class="literal">SELECT id FROM
              test</code>
            </p></li><li class="listitem"><p>
              eligible for caching and cached: <code class="literal">/*qc=on*/SELECT
              id FROM test</code>
</p></li></ul>
</div>
<p>
      </p><p>
        The examples <code class="literal">SELECT</code> statement string is
        prefixed with the
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.constants" title="8.6 Predefined Constants">MYSQLND_QC_ENABLE_SWITCH</a></code>
        SQL hint to enable caching of the statement. The SQL hint must
        be given at the very beginning of the statement string to enable
        caching.
      </p><p>
</p>
<div class="example">
<a name="idm139660443121120"></a><p class="title"><b>Example 8.2 Using the <code class="literal">MYSQLND_QC_ENABLE_SWITCH</code> SQL hint</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1

    </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

/* Will be cached because of the SQL hint */
$start = microtime(true);
$res   = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 1");

var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

printf("Total time uncached query: %.6fs\n", microtime(true) - $start);

/* Cache hit */
$start = microtime(true);
$res   = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 1");

var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

printf("Total time cached query: %.6fs\n", microtime(true) - $start);
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(1) {
  ["id"]=&gt;
  string(1) "1"
}
Total time uncached query: 0.000740s
array(1) {
  ["id"]=&gt;
  string(1) "1"
}
Total time cached query: 0.000098s

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        If nothing else is configured, as it is the case in the
        quickstart example, the plugin will use the built-in
        <code class="literal">default</code> storage handler. The
        <code class="literal">default</code> storage handler uses process memory
        to hold a cache entry. Depending on the PHP deployment model, a
        PHP process may serve one or more web requests. Please, consult
        the web server manual for details. Details make no difference
        for the examples given in the quickstart.
      </p><p>
        The query cache plugin will cache all queries regardless if the
        query string begins with the SQL hint which enables caching or
        not, if the PHP configuration directive
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default</a></code>
        is set to <code class="literal">1</code>. The setting
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default</a></code>
        is evaluated by the core of the query cache plugins. Neither the
        built-in nor user-defined storage handler can overrule the
        setting.
      </p><p>
        The SQL hint <code class="literal">/*qc=off*/</code> can be used to
        disable caching of individual queries if
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default
        = 1</a></code> It is recommended to use the PHP constant
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.constants" title="8.6 Predefined Constants">MYSQLND_QC_DISABLE_SWITCH</a></code>
        instead of using the string value.
      </p><p>
</p>
<div class="example">
<a name="idm139660443105488"></a><p class="title"><b>Example 8.3 Using the <code class="literal">MYSQLND_QC_DISABLE_SWITCH</code> SQL hint</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.cache_by_default=1

    </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

/* Will be cached although no SQL hint is present because of mysqlnd_qc.cache_by_default = 1*/
$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

$mysqli-&gt;query("DELETE FROM test WHERE id = 1");

/* Cache hit - no automatic invalidation and still valid! */
$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* Cache miss - query must not be cached because of the SQL hint */
$res = $mysqli-&gt;query("/*" . MYSQLND_QC_DISABLE_SWITCH . "*/SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();
?&gt;

    </pre><p>
            The above examples will output:
          </p><pre class="screen">

array(1) {
  ["id"]=&gt;
  string(1) "1"
}
array(1) {
  ["id"]=&gt;
  string(1) "1"
}
NULL

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        PECL/mysqlnd_qc forbids caching of statements for which at least
        one column from the statements result set shows no table name in
        its meta data by default. This is usually the case for columns
        originating from SQL functions such as <code class="literal">NOW()</code>
        or <code class="literal">LAST_INSERT_ID()</code>. The policy aims to
        prevent pitfalls if caching by default is used.
      </p><p>
</p>
<div class="example">
<a name="idm139660443096896"></a><p class="title"><b>Example 8.4 Example showing which type of statements are not cached</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.cache_by_default=1

    </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1)");

for ($i = 0; $i &lt; 3; $i++) {

    $start = microtime(true);

    /* Note: statement will not be cached because of NOW() use */
    $res = $mysqli-&gt;query("SELECT id, NOW() AS _time FROM test");
    $row = $res-&gt;fetch_assoc();

    /* dump results */
    var_dump($row);

    printf("Total time: %.6fs\n", microtime(true) - $start);

    /* pause one second */
    sleep(1);
}
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:43:10"
}
Total time: 0.000540s
array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:43:11"
}
Total time: 0.000555s
array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:43:12"
}
Total time: 0.000549s

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        It is possible to enable caching for all statements including
        those which has columns in their result set for which MySQL
        reports no table, such as the statement from the example. Set
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-no-table"><code class="literal">mysqlnd_qc.cache_no_table
        = 1</code></a> to enable caching of such statements.
        Please, note the difference in the measured times for the above
        and below examples.
      </p><p>
</p>
<div class="example">
<a name="idm139660443089904"></a><p class="title"><b>Example 8.5 Enabling caching for all statements using the
<code class="literal">mysqlnd_qc.cache_no_table</code> ini setting</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.cache_by_default=1
mysqlnd_qc.cache_no_table=1

    </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1)");

for ($i = 0; $i &lt; 3; $i++) {

    $start = microtime(true);

    /* Note: statement will not be cached because of NOW() use */
    $res = $mysqli-&gt;query("SELECT id, NOW() AS _time FROM test");
    $row = $res-&gt;fetch_assoc();

    /* dump results */
    var_dump($row);

    printf("Total time: %.6fs\n", microtime(true) - $start);

    /* pause one second */
    sleep(1);
}
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:47:45"
}
Total time: 0.000546s
array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:47:45"
}
Total time: 0.000187s
array(2) {
  ["id"]=&gt;
  string(1) "1"
  ["_time"]=&gt;
  string(19) "2012-01-11 15:47:45"
}
Total time: 0.000167s

</pre>
</div>

</div>
<p><br class="example-break">
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Although
          <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-no-table"><code class="literal">mysqlnd_qc.cache_no_table
          = 1</code></a> has been created for use with
          <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.cache_by_default
          = 1</a></code> it is bound it. The plugin will evaluate
          the
          <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-no-table"><code class="literal">mysqlnd_qc.cache_no_table</code></a>
          whenever a query is to be cached, no matter whether caching
          has been enabled using a SQL hint or any other measure.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.per-query-ttl"></a>8.4.4 Setting the TTL</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        The default invalidation strategy of the query cache plugin is
        Time to Live (<code class="literal">TTL</code>). The built-in storage
        handlers will use the default <code class="literal">TTL</code> defined by
        the PHP configuration value
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">mysqlnd_qc.ttl</a></code>
        unless the query string contains a hint for setting a different
        <code class="literal">TTL</code>. The <code class="literal">TTL</code> is specified
        in seconds. By default cache entries expire after
        <code class="literal">30</code> seconds
      </p><p>
        The example sets <code class="literal">mysqlnd_qc.ttl=3</code> to cache
        statements for three seconds by default. Every second it updates
        a database table record to hold the current time and executes a
        <code class="literal">SELECT</code> statement to fetch the record from the
        database. The <code class="literal">SELECT</code> statement is cached for
        three seconds because it is prefixed with the SQL hint enabling
        caching. The output verifies that the query results are taken
        from the cache for the duration of three seconds before they are
        refreshed.
      </p><p>
</p>
<div class="example">
<a name="idm139660443068336"></a><p class="title"><b>Example 8.6 Setting the TTL with the <code class="literal">mysqlnd_qc.ttl</code> ini setting</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.ttl=3

    </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id VARCHAR(255))");

for ($i = 0; $i &lt; 7; $i++) {

    /* update DB row  */
    if (!$mysqli-&gt;query("DELETE FROM test") ||
        !$mysqli-&gt;query("INSERT INTO test(id) VALUES (NOW())"))
      /* Of course, a real-life script should do better error handling */
      die(sprintf("[%d] %s\n", $mysqli-&gt;errno, $mysqli-&gt;error));

    /* select latest row but cache results */
    $query  = "/*" . MYSQLND_QC_ENABLE_SWITCH . "*/";
    $query .= "SELECT id AS _time FROM test";
    if (!($res = $mysqli-&gt;query($query)) ||
        !($row = $res-&gt;fetch_assoc()))
    {
      printf("[%d] %s\n", $mysqli-&gt;errno, $mysqli-&gt;error);
    }
    $res-&gt;free();
    printf("Wall time %s - DB row time %s\n", date("H:i:s"), $row['_time']);

    /* pause one second */
    sleep(1);
}
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

Wall time 14:55:59 - DB row time 2012-01-11 14:55:59
Wall time 14:56:00 - DB row time 2012-01-11 14:55:59
Wall time 14:56:01 - DB row time 2012-01-11 14:55:59
Wall time 14:56:02 - DB row time 2012-01-11 14:56:02
Wall time 14:56:03 - DB row time 2012-01-11 14:56:02
Wall time 14:56:04 - DB row time 2012-01-11 14:56:02
Wall time 14:56:05 - DB row time 2012-01-11 14:56:05

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        As can be seen from the example, any <code class="literal">TTL</code>
        based cache can serve stale data. Cache entries are not
        automatically invalidated, if underlying data changes.
        Applications using the default <code class="literal">TTL</code>
        invalidation strategy must be able to work correctly with stale
        data.
      </p><p>
        A user-defined cache storage handler can implement any
        invalidation strategy to work around this limitation.
      </p><p>
        The default <code class="literal">TTL</code> can be overruled using the
        SQL hint <code class="literal">/*qc_tt=seconds*/</code>. The SQL hint must
        be appear immediately after the SQL hint which enables caching.
        It is recommended to use the PHP constant
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.constants" title="8.6 Predefined Constants">MYSQLND_QC_TTL_SWITCH</a></code>
        instead of using the string value.
      </p><p>
</p>
<div class="example">
<a name="idm139660443055840"></a><p class="title"><b>Example 8.7 Setting TTL with SQL hints</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
$start = microtime(true);

/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

printf("Default TTL\t: %d seconds\n", ini_get("mysqlnd_qc.ttl"));

/* Will be cached for 2 seconds */
$sql = sprintf("/*%s*//*%s%d*/SELECT id FROM test WHERE id = 1", MYSQLND_QC_ENABLE_SWITCH, MYSQLND_QC_TTL_SWITCH, 2);
$res = $mysqli-&gt;query($sql);

var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

$mysqli-&gt;query("DELETE FROM test WHERE id = 1");
sleep(1);

/* Cache hit - no automatic invalidation and still valid! */
$res = $mysqli-&gt;query($sql);
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

sleep(2);

/* Cache miss - cache entry has expired */
$res = $mysqli-&gt;query($sql);
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

printf("Script runtime\t: %d seconds\n", microtime(true) - $start);
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

Default TTL     : 30 seconds
array(1) {
  ["id"]=&gt;
  string(1) "1"
}
array(1) {
  ["id"]=&gt;
  string(1) "1"
}
NULL
Script runtime  : 3 seconds

</pre>
</div>

</div>
<p><br class="example-break">
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.pattern-based-caching"></a>8.4.5 Pattern based caching</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        An application has three options for telling PECL/mysqlnd_qc
        whether a particular statement shall be used. The most basic
        approach is to cache all statements by setting
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">
        mysqlnd_qc.cache_by_default = 1</a></code>. This approach
        is often of little practical value. But it enables users to make
        a quick estimation about the maximum performance gains from
        caching. An application designed to use a cache may be able to
        prefix selected statements with the appropriate SQL hints.
        However, altering an applications source code may not always be
        possible or desired, for example, to avoid problems with
        software updates. Therefore, PECL/mysqlnd_qc allows setting a
        callback which decides if a query is to be cached.
      </p><p>
        The callback is installed with the
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-is-select" title="8.7.8 mysqlnd_qc_set_is_select"><code class="function">mysqlnd_qc_set_is_select</code></a>
        function. The callback is given the statement string of every
        statement inspected by the plugin. Then, the callback can decide
        whether to cache the function. The callback is supposed to
        return <code class="constant">FALSE</code> if the statement shall not be
        cached. A return value of <code class="constant">TRUE</code> makes the
        plugin try to add the statement into the cache. The cache entry
        will be given the default TTL
        (<code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">
        mysqlnd_qc.ttl</a></code>). If the callback returns a
        numerical value it is used as the TTL instead of the global
        default.
      </p><p>
</p>
<div class="example">
<a name="idm139660443041584"></a><p class="title"><b>Example 8.8 Setting a callback with
<a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-is-select" title="8.7.8 mysqlnd_qc_set_is_select"><code class="function">mysqlnd_qc_set_is_select</code></a></b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_statistics=1

    </pre><pre class="programlisting">

&lt;?php
/* callback which decides if query is cached */
function is_select($query) {
    static $patterns = array(
      /* true - use default from mysqlnd_qc.ttl */
      "@SELECT\s+.*\s+FROM\s+test@ismU" =&gt; true,
      /* 3 - use TTL = 3 seconds */
      "@SELECT\s+.*\s+FROM\s+news@ismU" =&gt; 3
    );

    /* check if query does match pattern */
    foreach ($patterns as $pattern =&gt; $ttl) {
        if (preg_match($pattern, $query)) {
            printf("is_select(%45s): cache\n", $query);
            return $ttl;
        }
    }
    printf("is_select(%45s): do not cache\n", $query);
    return false;
}
/* install callback */
mysqlnd_qc_set_is_select("is_select");

/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* cache put */
$mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
/* cache hit */
$mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
/* cache put */
$mysqli-&gt;query("SELECT * FROM test");

$stats = mysqlnd_qc_get_core_stats();
printf("Cache put: %d\n", $stats['cache_put']);
printf("Cache hit: %d\n", $stats['cache_hit']);
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

is_select(                    DROP TABLE IF EXISTS test): do not cache
is_select(                    CREATE TABLE test(id INT)): do not cache
is_select(    INSERT INTO test(id) VALUES (1), (2), (3)): do not cache
is_select(             SELECT id FROM test WHERE id = 1): cache
is_select(             SELECT id FROM test WHERE id = 1): cache
is_select(                           SELECT * FROM test): cache
Cache put: 2
Cache hit: 1

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        The examples callback tests if a statement string matches a
        pattern. If this is the case, it either returns
        <code class="constant">TRUE</code> to cache the statement using the
        global default TTL or an alternative TTL.
      </p><p>
        To minimize application changes the callback can put into and
        registered in an auto prepend file.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.slam-defense"></a>8.4.6 Slam defense</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        A badly designed cache can do more harm than good. In the worst
        case a cache can increase database server load instead of
        minimizing it. An overload situation can occur if a highly
        shared cache entry expires (cache stampeding).
      </p><p>
        Cache entries are shared and reused to a different degree
        depending on the storage used. The default storage handler
        stores cache entries in process memory. Thus, a cache entry can
        be reused for the life-span of a process. Other PHP processes
        cannot access it. If Memcache is used, a cache entry can be
        shared among multiple PHP processes and even among multiple
        machines, depending on the set up being used.
      </p><p>
        If a highly shared cache entry stored, for example, in Memcache
        expires, many clients gets a cache miss. Many client requests
        can no longer be served from the cache but try to run the
        underlying query on the database server. Until the cache entry
        is refreshed, more and more clients contact the database server.
        In the worst case, a total lost of service is the result.
      </p><p>
        The overload can be avoided using a storage handler which limits
        the reuse of cache entries to few clients. Then, at the average,
        its likely that only a limited number of clients will try to
        refresh a cache entry concurrently.
      </p><p>
        Additionally, the built-in slam defense mechanism can and should
        be used. If slam defense is activated an expired cache entry is
        given an extended life time. The first client getting a cache
        miss for the expired cache entry tries to refresh the cache
        entry within the extended life time. All other clients
        requesting the cache entry are temporarily served from the cache
        although the original <code class="literal">TTL</code> of the cache entry
        has expired. The other clients will not experience a cache miss
        before the extended life time is over.
      </p><p>
</p>
<div class="example">
<a name="idm139660443025376"></a><p class="title"><b>Example 8.9 Enabling the slam defense mechanism</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.slam_defense=1
mysqlnd_qc.slam_defense_ttl=1

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        The slam defense mechanism is enabled with the PHP configuration
        directive
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.slam-defense"><code class="literal">mysqlnd_qc.slam_defense</code></a>.
        The extended life time of a cache entry is set with
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.slam-defense-ttl"><code class="literal">mysqlnd_qc.slam_defense_ttl</code></a>.
      </p><p>
        The function
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>
        returns an array of statistics. The statistics
        <code class="literal">slam_stale_refresh</code> and
        <code class="literal">slam_stale_hit</code> are incremented if slam
        defense takes place.
      </p><p>
        It is not possible to give a one-fits-all recommendation on the
        slam defense configuration. Users are advised to monitor and
        test their setup and derive settings accordingly.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.cache-candidates"></a>8.4.7 Finding cache candidates</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        A statement should be considered for caching if it is executed
        often and has a long run time. Cache candidates are found by
        creating a list of statements sorted by the product of the
        number of executions multiplied by the statements run time. The
        function
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-query-trace-log" title="8.7.6 mysqlnd_qc_get_query_trace_log"><code class="function">mysqlnd_qc_get_query_trace_log</code></a>
        returns a query log which help with the task.
      </p><p>
        Collecting a query trace is a slow operation. Thus, it is
        disabled by default. The PHP configuration directive
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-query-trace"><code class="literal">mysqlnd_qc.collect_query_trace</code></a>
        is used to enable it. The functions trace contains one entry for
        every query issued before the function is called.
      </p><p>
</p>
<div class="example">
<a name="idm139660443009040"></a><p class="title"><b>Example 8.10 Collecting a query trace</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_query_trace=1

    </pre><pre class="programlisting">

&lt;?php
/* connect to MySQL */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");

/* dummy queries to fill the query trace */
for ($i = 0; $i &lt; 2; $i++) {
    $res = $mysqli-&gt;query("SELECT 1 AS _one FROM DUAL");
    $res-&gt;free();
}

/* dump trace */
var_dump(mysqlnd_qc_get_query_trace_log());
?&gt;

    </pre><p>
            The above examples will output:
          </p><pre class="screen">

array(2) {
  [0]=&gt;
  array(8) {
    ["query"]=&gt;
    string(26) "SELECT 1 AS _one FROM DUAL"
    ["origin"]=&gt;
    string(102) "#0 qc.php(7): mysqli-&gt;query('SELECT 1 AS _on...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(25)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [1]=&gt;
  array(8) {
    ["query"]=&gt;
    string(26) "SELECT 1 AS _one FROM DUAL"
    ["origin"]=&gt;
    string(102) "#0 qc.php(7): mysqli-&gt;query('SELECT 1 AS _on...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(8)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
}

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        Assorted information is given in the trace. Among them timings
        and the origin of the query call. The origin property holds a
        code backtrace to identify the source of the query. The depth of
        the backtrace can be limited with the PHP configuration
        directive
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.query-trace-bt-depth"><code class="literal">mysqlnd_qc.query_trace_bt_depth</code></a>.
        The default depth is <code class="literal">3</code>.
      </p><p>
</p>
<div class="example">
<a name="idm139660443000400"></a><p class="title"><b>Example 8.11 Setting the backtrace depth with the
            <code class="literal">mysqlnd_qc.query_trace_bt_depth</code> ini
setting</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_query_trace=1

    </pre><pre class="programlisting">

&lt;?php
/* connect to MySQL */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* dummy queries to fill the query trace */
for ($i = 0; $i &lt; 3; $i++) {
    $res = $mysqli-&gt;query("SELECT id FROM test WHERE id = " . $mysqli-&gt;real_escape_string($i));
    $res-&gt;free();
}

$trace = mysqlnd_qc_get_query_trace_log();
$summary = array();
foreach ($trace as $entry) {
    if (!isset($summary[$entry['query']])) {
        $summary[$entry['query']] = array(
            "executions" =&gt; 1,
            "time"       =&gt; $entry['run_time'] + $entry['store_time'],
        );
    } else {
        $summary[$entry['query']]['executions']++;
        $summary[$entry['query']]['time'] += $entry['run_time'] + $entry['store_time'];
    }
}

foreach ($summary as $query =&gt; $details) {
    printf("%45s: %5dms (%dx)\n",
    $query, $details['time'], $details['executions']);
}
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

                    DROP TABLE IF EXISTS test:     0ms (1x)
                    CREATE TABLE test(id INT):     0ms (1x)
    INSERT INTO test(id) VALUES (1), (2), (3):     0ms (1x)
             SELECT id FROM test WHERE id = 0:    25ms (1x)
             SELECT id FROM test WHERE id = 1:    10ms (1x)
             SELECT id FROM test WHERE id = 2:     9ms (1x)

</pre>
</div>

</div>
<p><br class="example-break">
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.cache-efficiency"></a>8.4.8 Measuring cache efficiency</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        PECL/mysqlnd_qc offers three ways to measure the cache
        efficiency. The function
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log" title="8.7.5 mysqlnd_qc_get_normalized_query_trace_log"><code class="function">mysqlnd_qc_get_normalized_query_trace_log</code></a>
        returns statistics aggregated by the normalized query string,
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>
        gives storage handler specific information which includes a list
        of all cached items, depending on the storage handler.
        Additionally, the core of PECL/mysqlnd_qc collects high-level
        summary statistics aggregated per PHP process. The high-level
        statistics are returned by
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>.
      </p><p>
        The functions
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log" title="8.7.5 mysqlnd_qc_get_normalized_query_trace_log"><code class="function">mysqlnd_qc_get_normalized_query_trace_log</code></a>
        and
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>
        will not collect data unless data collection has been enabled
        through their corresponding PHP configuration directives. Data
        collection is disabled by default for performance
        considerations. It is configurable with the
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.time-statistics">mysqlnd_qc.time_statistics</a>
        option, which determines if timing information should be
        collected. Collection of time statistics is enabled by default
        but only performed if data collection as such has been enabled.
        Recording time statistics causes extra system calls. In most
        cases, the benefit of the monitoring outweighs any potential
        performance penalty of the additional system calls.
      </p><p>
</p>
<div class="example">
<a name="idm139660442980896"></a><p class="title"><b>Example 8.12 Collecting statistics data with the
<code class="literal">mysqlnd_qc.time_statistics</code> ini setting</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_statistics=1

    </pre><pre class="programlisting">

&lt;?php
/* connect to MySQL */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* dummy queries */
for ($i = 1; $i &lt;= 4; $i++) {
    $query = sprintf("/*%s*/SELECT id FROM test WHERE id = %d", MYSQLND_QC_ENABLE_SWITCH, $i % 2);
    $res   = $mysqli-&gt;query($query);
    
    $res-&gt;free();
}

var_dump(mysqlnd_qc_get_core_stats());
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(26) {
  ["cache_hit"]=&gt;
  string(1) "2"
  ["cache_miss"]=&gt;
  string(1) "2"
  ["cache_put"]=&gt;
  string(1) "2"
  ["query_should_cache"]=&gt;
  string(1) "4"
  ["query_should_not_cache"]=&gt;
  string(1) "3"
  ["query_not_cached"]=&gt;
  string(1) "3"
  ["query_could_cache"]=&gt;
  string(1) "4"
  ["query_found_in_cache"]=&gt;
  string(1) "2"
  ["query_uncached_other"]=&gt;
  string(1) "0"
  ["query_uncached_no_table"]=&gt;
  string(1) "0"
  ["query_uncached_no_result"]=&gt;
  string(1) "0"
  ["query_uncached_use_result"]=&gt;
  string(1) "0"
  ["query_aggr_run_time_cache_hit"]=&gt;
  string(2) "28"
  ["query_aggr_run_time_cache_put"]=&gt;
  string(3) "900"
  ["query_aggr_run_time_total"]=&gt;
  string(3) "928"
  ["query_aggr_store_time_cache_hit"]=&gt;
  string(2) "14"
  ["query_aggr_store_time_cache_put"]=&gt;
  string(2) "40"
  ["query_aggr_store_time_total"]=&gt;
  string(2) "54"
  ["receive_bytes_recorded"]=&gt;
  string(3) "136"
  ["receive_bytes_replayed"]=&gt;
  string(3) "136"
  ["send_bytes_recorded"]=&gt;
  string(2) "84"
  ["send_bytes_replayed"]=&gt;
  string(2) "84"
  ["slam_stale_refresh"]=&gt;
  string(1) "0"
  ["slam_stale_hit"]=&gt;
  string(1) "0"
  ["request_counter"]=&gt;
  int(1)
  ["process_hash"]=&gt;
  int(1929695233)
}

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        For a quick overview, call
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>.
        It delivers cache usage, cache timing and traffic related
        statistics. Values are aggregated on a per process basis for all
        queries issued by any PHP MySQL API call.
      </p><p>
        Some storage handler, such as the default handler, can report
        cache entries, statistics related to the entries and meta data
        for the underlying query through the
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>
        function. Please note, that the information returned depends on
        the storage handler. Values are aggregated on a per process
        basis.
      </p><p>
</p>
<div class="example">
<a name="idm139660442969632"></a><p class="title"><b>Example 8.13 Example
            <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>
usage</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1

    </pre><pre class="programlisting">

&lt;?php
/* connect to MySQL */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* dummy queries to fill the query trace */
for ($i = 1; $i &lt;= 4; $i++) {
    $query = sprintf("/*%s*/SELECT id FROM test WHERE id = %d", MYSQLND_QC_ENABLE_SWITCH, $i % 2);
    $res   = $mysqli-&gt;query($query);
  
    $res-&gt;free();
}

var_dump(mysqlnd_qc_get_cache_info());
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(4) {
  ["num_entries"]=&gt;
  int(2)
  ["handler"]=&gt;
  string(7) "default"
  ["handler_version"]=&gt;
  string(5) "1.0.0"
  ["data"]=&gt;
  array(2) {
    ["Localhost via UNIX socket
3306
root
test|/*qc=on*/SELECT id FROM test WHERE id = 1"]=&gt;
    array(2) {
      ["statistics"]=&gt;
      array(11) {
        ["rows"]=&gt;
        int(1)
        ["stored_size"]=&gt;
        int(71)
        ["cache_hits"]=&gt;
        int(1)
        ["run_time"]=&gt;
        int(391)
        ["store_time"]=&gt;
        int(27)
        ["min_run_time"]=&gt;
        int(16)
        ["max_run_time"]=&gt;
        int(16)
        ["min_store_time"]=&gt;
        int(8)
        ["max_store_time"]=&gt;
        int(8)
        ["avg_run_time"]=&gt;
        int(8)
        ["avg_store_time"]=&gt;
        int(4)
      }
      ["metadata"]=&gt;
      array(1) {
        [0]=&gt;
        array(8) {
          ["name"]=&gt;
          string(2) "id"
          ["orig_name"]=&gt;
          string(2) "id"
          ["table"]=&gt;
          string(4) "test"
          ["orig_table"]=&gt;
          string(4) "test"
          ["db"]=&gt;
          string(4) "test"
          ["max_length"]=&gt;
          int(1)
          ["length"]=&gt;
          int(11)
          ["type"]=&gt;
          int(3)
        }
      }
    }
    ["Localhost via UNIX socket
3306
root
test|/*qc=on*/SELECT id FROM test WHERE id = 0"]=&gt;
    array(2) {
      ["statistics"]=&gt;
      array(11) {
        ["rows"]=&gt;
        int(0)
        ["stored_size"]=&gt;
        int(65)
        ["cache_hits"]=&gt;
        int(1)
        ["run_time"]=&gt;
        int(299)
        ["store_time"]=&gt;
        int(13)
        ["min_run_time"]=&gt;
        int(11)
        ["max_run_time"]=&gt;
        int(11)
        ["min_store_time"]=&gt;
        int(6)
        ["max_store_time"]=&gt;
        int(6)
        ["avg_run_time"]=&gt;
        int(5)
        ["avg_store_time"]=&gt;
        int(3)
      }
      ["metadata"]=&gt;
      array(1) {
        [0]=&gt;
        array(8) {
          ["name"]=&gt;
          string(2) "id"
          ["orig_name"]=&gt;
          string(2) "id"
          ["table"]=&gt;
          string(4) "test"
          ["orig_table"]=&gt;
          string(4) "test"
          ["db"]=&gt;
          string(4) "test"
          ["max_length"]=&gt;
          int(0)
          ["length"]=&gt;
          int(11)
          ["type"]=&gt;
          int(3)
        }
      }
    }
  }
}

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        It is possible to further break down the granularity of
        statistics to the level of the normalized statement string. The
        normalized statement string is the statements string with all
        parameters replaced with question marks. For example, the two
        statements <code class="literal">SELECT id FROM test WHERE id = 0</code>
        and <code class="literal">SELECT id FROM test WHERE id = 1</code> are
        normalized into <code class="literal">SELECT id FROM test WHERE id =
        ?</code>. Their both statistics are aggregated into one entry
        for <code class="literal">SELECT id FROM test WHERE id = ?</code>.
      </p><p>
</p>
<div class="example">
<a name="idm139660442957344"></a><p class="title"><b>Example 8.14 Example
            <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log" title="8.7.5 mysqlnd_qc_get_normalized_query_trace_log"><code class="function">mysqlnd_qc_get_normalized_query_trace_log</code></a>
usage</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.enable_qc=1
mysqlnd_qc.collect_normalized_query_trace=1

    </pre><pre class="programlisting">

&lt;?php
/* connect to MySQL */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* dummy queries to fill the query trace */
for ($i = 1; $i &lt;= 4; $i++) {
    $query = sprintf("/*%s*/SELECT id FROM test WHERE id = %d", MYSQLND_QC_ENABLE_SWITCH, $i % 2);
    $res   = $mysqli-&gt;query($query);
  
    $res-&gt;free();
}

var_dump(mysqlnd_qc_get_normalized_query_trace_log());
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

array(4) {
  [0]=&gt;
  array(9) {
    ["query"]=&gt;
    string(25) "DROP TABLE IF EXISTS test"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [1]=&gt;
  array(9) {
    ["query"]=&gt;
    string(27) "CREATE TABLE test (id INT )"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [2]=&gt;
  array(9) {
    ["query"]=&gt;
    string(46) "INSERT INTO test (id ) VALUES (? ), (? ), (? )"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [3]=&gt;
  array(9) {
    ["query"]=&gt;
    string(31) "SELECT id FROM test WHERE id =?"
    ["occurences"]=&gt;
    int(4)
    ["eligible_for_caching"]=&gt;
    bool(true)
    ["avg_run_time"]=&gt;
    int(179)
    ["min_run_time"]=&gt;
    int(11)
    ["max_run_time"]=&gt;
    int(393)
    ["avg_store_time"]=&gt;
    int(12)
    ["min_store_time"]=&gt;
    int(7)
    ["max_store_time"]=&gt;
    int(25)
  }
}

</pre>
</div>

</div>
<p><br class="example-break">
      </p><p>
        The source distribution of PECL/mysqlnd_qc contains a directory
        <code class="literal">web/</code> in which web based monitoring scripts
        can be found which give an example how to write a cache monitor.
        Please, follow the instructions given in the source.
      </p><p>
        Since PECL/mysqlnd_qc 1.1.0 it is possible to write statistics
        into a log file. Please, see
        <code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-statistics-log-file">
        mysqlnd_qc.collect_statistics_log_file</a></code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.set-user-handlers"></a>8.4.9 Beyond TTL: user-defined storage</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        The query cache plugin supports the use of user-defined storage
        handler. User-defined storage handler can use arbitrarily
        complex invalidation algorithms and support arbitrary storage
        media.
      </p><p>
        All user-defined storage handlers have to provide a certain
        interface. The functions of the user-defined storage handler
        will be called by the core of the cache plugin. The necessary
        interface consists of seven public functions. Both procedural
        and object oriented user-defined storage handler must implement
        the same set of functions.
      </p><p>
</p>
<div class="example">
<a name="idm139660442942576"></a><p class="title"><b>Example 8.15 Using a user-defined storage handler</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
/* Enable default caching of all statements */
ini_set("mysqlnd_qc.cache_by_default", 1);

/* Procedural user defined storage handler functions */

$__cache = array();

function get_hash($host_info, $port, $user, $db, $query) {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    return md5(sprintf("%s%s%s%s%s", $host_info, $port, $user, $db, $query));
}

function find_query_in_cache($key) {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    if (isset($__cache[$key])) {
        $tmp = $__cache[$key];
        if ($tmp["valid_until"] &lt; time()) {
            unset($__cache[$key]);
            $ret = NULL;
        } else {
            $ret = $__cache[$key]["data"];
        }
    } else {
        $ret = NULL;
    }

    return $ret;
}

function return_to_cache($key) {
    /*
     Called on cache hit after cached data has been processed,
     may be used for reference counting
    */
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());
}

function add_query_to_cache_if_not_exists($key, $data, $ttl, $run_time, $store_time, $row_count) {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    $__cache[$key] = array(
        "data"               =&gt; $data,
        "row_count"          =&gt; $row_count,
        "valid_until"        =&gt; time() + $ttl,
        "hits"               =&gt; 0,
        "run_time"           =&gt; $run_time,
        "store_time"         =&gt; $store_time,
        "cached_run_times"   =&gt; array(),
        "cached_store_times" =&gt; array(),
    );

    return TRUE;
}

function query_is_select($query) {
    printf("\t%s('%s'): ", __FUNCTION__, $query);

    $ret = FALSE;
    if (stristr($query, "SELECT") !== FALSE) {
        /* cache for 5 seconds */
        $ret = 5;
    }

    printf("%s\n", (FALSE === $ret) ? "FALSE" : $ret);
    return $ret;
}

function update_query_run_time_stats($key, $run_time, $store_time) {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    if (isset($__cache[$key])) {
        $__cache[$key]['hits']++;
        $__cache[$key]["cached_run_times"][] = $run_time;
        $__cache[$key]["cached_store_times"][] = $store_time;
    }
}

function get_stats($key = NULL) {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    if ($key &amp;&amp; isset($__cache[$key])) {
        $stats = $__cache[$key];
    } else {
        $stats = array();
        foreach ($__cache as $key =&gt; $details) {
            $stats[$key] = array(
               'hits'              =&gt; $details['hits'],
               'bytes'             =&gt; strlen($details['data']),
               'uncached_run_time' =&gt; $details['run_time'],
               'cached_run_time'   =&gt; (count($details['cached_run_times']))
                                      ? array_sum($details['cached_run_times']) / count($details['cached_run_times'])
                                      : 0,
            );
        }
    }

    return $stats;
}

function clear_cache() {
    global $__cache;
    printf("\t%s(%d)\n", __FUNCTION__, func_num_args());

    $__cache = array();
    return TRUE;
}

/* Install procedural user-defined storage handler */
if (!mysqlnd_qc_set_user_handlers("get_hash", "find_query_in_cache",
    "return_to_cache", "add_query_to_cache_if_not_exists",
    "query_is_select", "update_query_run_time_stats", "get_stats", "clear_cache")) {
  
        printf("Failed to install user-defined storage handler\n");
}


/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

printf("\nCache put/cache miss\n");

$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* Delete record to verify we get our data from the cache */
$mysqli-&gt;query("DELETE FROM test WHERE id = 1");

printf("\nCache hit\n");

$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

printf("\nDisplay cache statistics\n");
var_dump(mysqlnd_qc_get_cache_info());

printf("\nFlushing cache, cache put/cache miss");
var_dump(mysqlnd_qc_clear_cache());

$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();
?&gt;

    </pre><p>
            The above examples will output something similar to:
          </p><pre class="screen">

        query_is_select('DROP TABLE IF EXISTS test'): FALSE
        query_is_select('CREATE TABLE test(id INT)'): FALSE
        query_is_select('INSERT INTO test(id) VALUES (1), (2)'): FALSE

Cache put/cache miss
        query_is_select('SELECT id FROM test WHERE id = 1'): 5
        get_hash(5)
        find_query_in_cache(1)
        add_query_to_cache_if_not_exists(6)
array(1) {
  ["id"]=&gt;
  string(1) "1"
}
        query_is_select('DELETE FROM test WHERE id = 1'): FALSE

Cache hit
        query_is_select('SELECT id FROM test WHERE id = 1'): 5
        get_hash(5)
        find_query_in_cache(1)
        return_to_cache(1)
        update_query_run_time_stats(3)
array(1) {
  ["id"]=&gt;
  string(1) "1"
}

Display cache statistics
        get_stats(0)
array(4) {
  ["num_entries"]=&gt;
  int(1)
  ["handler"]=&gt;
  string(4) "user"
  ["handler_version"]=&gt;
  string(5) "1.0.0"
  ["data"]=&gt;
  array(1) {
    ["18683c177dc89bb352b29965d112fdaa"]=&gt;
    array(4) {
      ["hits"]=&gt;
      int(1)
      ["bytes"]=&gt;
      int(71)
      ["uncached_run_time"]=&gt;
      int(398)
      ["cached_run_time"]=&gt;
      int(4)
    }
  }
}

Flushing cache, cache put/cache miss    clear_cache(0)
bool(true)
        query_is_select('SELECT id FROM test WHERE id = 1'): 5
        get_hash(5)
        find_query_in_cache(1)
        add_query_to_cache_if_not_exists(6)
NULL


</pre>
</div>

</div>
<p><br class="example-break">
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.setup"></a>8.5 Installing/Configuring</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.requirements">8.5.1 Requirements</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.installation">8.5.2 Installation</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration">8.5.3 Runtime Configuration</a></span></dt></dl>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.requirements"></a>8.5.1 Requirements</h3>
</div>
</div>
</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        <code class="literal">PHP 5.3.3</code> or a newer version of
        <code class="literal">PHP</code>.
      </p><p>
        PECL/mysqlnd_qc is a mysqlnd plugin. It plugs into the mysqlnd
        library. To use you this plugin with a PHP MySQL extension, the
        extension (<a class="link" href="apis-php-mysqli.html#apis-php-ref.mysqli" title="3.15 Aliases and deprecated Mysqli Functions">mysqli</a>,
        <a class="link" href="apis-php-mysql.html#apis-php-ref.mysql" title="5.5 MySQL Functions">mysql</a>, or
        <a class="link" href="apis-php-pdo-mysql.html" title="Chapter 4 MySQL Functions (PDO_MYSQL)">PDO_MYSQL</a>) must enable
        the mysqlnd library.
      </p><p>
        For using the
        <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a> storage
        handler with PECL/mysqlnd_qc 1.0 <code class="literal">APC
        3.1.3p1-beta</code> or newer. PECL/mysqlnd_qc 1.2 has been
        tested with <code class="literal">APC 3.1.13-beta</code>. The APC storage
        handler cannot be used with a shared build. You cannot use the
        PHP configuration directive <code class="literal">extension</code> to load
        the APC and PECL/mysqlnd_qc extensions if PECL/mysqlnd_qc will
        use APC as a storage handler. For using the APC storage handler,
        you have to statically compile PHP with APC and PECL/mysqlnd_qc
        support into PHP.
      </p><p>
        For using <code class="literal">MEMCACHE</code> storage handler: Use
        <code class="literal">libmemcache 0.38</code> or newer. PECL/mysqlnd_qc
        1.2 has been tested with <code class="literal">libmemcache 1.4.0</code>.
      </p><p>
        For using <code class="literal">sqlite</code> storage handler: Use the
        <a class="ulink" href="http://www.php.net/book.sqlite3" target="_top">sqlite3</a>
        extension that bundled with PHP.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.installation"></a>8.5.2 Installation</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        This <a class="ulink" href="http://pecl.php.net/" target="_top">PECL</a> extension is
        not bundled with PHP.
      </p><p>
        Information for installing this PECL extension may be found in
        the manual chapter titled
        <a class="ulink" href="http://www.php.net/install.pecl" target="_top">Installation of
        PECL extensions</a>. Additional information such as new
        releases, downloads, source files, maintainer information, and a
        CHANGELOG, can be located here:
        <a class="ulink" href="http://pecl.php.net/package/mysqlnd_qc" target="_top">http://pecl.php.net/package/mysqlnd_qc</a>
      </p><p>
        A <acronym class="acronym">DLL</acronym> for this <acronym class="acronym">PECL</acronym>
        extension is currently unavailable. See also the
        <a class="ulink" href="http://www.php.net/install.windows.building" target="_top">building
        on Windows</a> section.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.configuration"></a>8.5.3 Runtime Configuration</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
The behaviour of these functions is affected by settings in <code class="filename">php.ini</code>.
</p><p>
</p>
<div class="table">
<a name="idm139660442900496"></a><p class="title"><b>Table 8.1 mysqlnd_qc Configure Options</b></p>
<div class="table-contents">
<table class="table" summary="mysqlnd_qc Configure Options" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Default</th><th scope="col">Changeable</th><th scope="col">Changelog</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.enable-qc">mysqlnd_qc.enable_qc</a></td><td>1</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.ttl">mysqlnd_qc.ttl</a></td><td>30</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-by-default">mysqlnd_qc.cache_by_default</a></td><td>0</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-no-table">mysqlnd_qc.cache_no_table</a></td><td>0</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.use-request-time">mysqlnd_qc.use_request_time</a></td><td>0</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.time-statistics">mysqlnd_qc.time_statistics</a></td><td>1</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-statistics">mysqlnd_qc.collect_statistics</a></td><td>0</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-statistics-log-file">mysqlnd_qc.collect_statistics_log_file</a></td><td>/tmp/mysqlnd_qc.stats</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-query-trace">mysqlnd_qc.collect_query_trace</a></td><td>0</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.query-trace-bt-depth">mysqlnd_qc.query_trace_bt_depth</a></td><td>3</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-normalized-query-trace">mysqlnd_qc.collect_normalized_query_trace</a></td><td>0</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.ignore-sql-comments">mysqlnd_qc.ignore_sql_comments</a></td><td>1</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.slam-defense">mysqlnd_qc.slam_defense</a></td><td>0</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.slam-defense-ttl">mysqlnd_qc.slam_defense_ttl</a></td><td>30</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.std-data-copy">mysqlnd_qc.std_data_copy</a></td><td>0</td><td>PHP_INI_SYSTEM</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.apc-prefix">mysqlnd_qc.apc_prefix</a></td><td>qc_</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.memc-server">mysqlnd_qc.memc_server</a></td><td>127.0.0.1</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.memc-port">mysqlnd_qc.memc_port</a></td><td>11211</td><td>PHP_INI_ALL</td><td> </td></tr><tr><td scope="row"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.sqlite-data-file">mysqlnd_qc.sqlite_data_file</a></td><td>:memory:</td><td>PHP_INI_ALL</td><td> </td></tr></tbody></table>
</div>

</div>
<p><br class="table-break">
      </p><p>
        Here's a short explanation of the configuration directives.
      </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><a name="apis-php-ini.mysqlnd-qc.enable-qc"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.enable_qc</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Enables or disables the plugin. If disabled the
                extension will not plug into
                <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a> to proxy
                internal <a class="link" href="apis-php-mysqlnd.html" title="Chapter 6 MySQL Native Driver">mysqlnd</a>
                C API calls.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.ttl"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.ttl</code></em> <span class="type">integer</span>
            </span></dt><dd><p>
                Default Time-to-Live (TTL) for cache entries in seconds.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.cache-by-default"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.cache_by_default</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Cache all queries regardless if they begin with the SQL
                hint that enables caching of a query or not. Storage
                handler cannot overrule the setting. It is evaluated by
                the core of the plugin.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.cache-no-table"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.cache_no_table</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Whether to cache queries with no table name in any of
                columns meta data of their result set, for example,
                <code class="literal">SELECT SLEEP(1)</code>, <code class="literal">SELECT
                NOW()</code>, <code class="literal">SELECT SUBSTRING()</code>.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.use-request-time"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.use_request_time</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Use PHP global request time to avoid
                <code class="literal">gettimeofday()</code> system calls? If using
                <code class="literal">
                <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a>
                </code> storage handler it should be set to the value
                of <code class="literal">
                <a class="ulink" href="http://www.php.net/apc.configuration" target="_top">apc.use_request_time</a>
                </code>, if not warnings will be generated.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.time-statistics"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.time_statistics</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Collect run time and store time statistics using
                <code class="literal">gettimeofday()</code> system call? Data will
                be collected only if you also set
                <code class="literal">mysqlnd_qc.collect_statistics = 1</code>,
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.collect-statistics"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.collect_statistics</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Collect statistics for
                <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>?
                Does not influence storage handler statistics! Handler
                statistics can be an integral part of the handler
                internal storage format. Therefore, collection of some
                handler statistics cannot be disabled.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.collect-statistics-log-file"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.collect_statistics-log-file</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                If <code class="literal">mysqlnd_qc.collect_statistics</code> and
                <code class="literal">mysqlnd_qc.collect_statistics_log_file</code>
                are set, the plugin will dump statistics into the
                specified log file at every 10th web request during PHP
                request shutdown. The log file needs to be writable by
                the web server user.
              </p><p>
                Since 1.1.0.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.collect-query-trace"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.collect_query_trace</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Collect query back traces?
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.query-trace-bt-depth"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.query_trace_bt_depth</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Maximum depth/level of a query code backtrace.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.ignore-sql-comments"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.ignore_sql_comments</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Whether to remove SQL comments from a query string
                before hashing it to generate a cache key. Disable if
                you do not want two statemts such as <code class="literal">SELECT
                /*my_source_ip=123*/ id FROM test</code> and
                <code class="literal">SELECT /*my_source_ip=456*/ id FROM
                test</code> to refer to the same cache entry.
              </p><p>
                Since 1.1.0.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.slam-defense"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.slam_defense</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Activates handler based slam defense (cache stampeding
                protection) if available. Supported by
                <code class="literal">Default</code> and <code class="literal">
                <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a>
                </code> storage handler
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.slam-defense-ttl"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.slam_defense_ttl</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                <code class="literal">TTL</code> for stale cache entries which are
                served while another client updates the entries.
                Supported by <code class="literal">
                <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a>
                </code> storage handler.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.collect-normalized-query-trace"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.collect_normalized_query_trace</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Collect aggregated normalized query traces? The setting
                has no effect by default. You compile the extension
                using the define <code class="literal">NORM_QUERY_TRACE_LOG</code>
                to make use of the setting.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.std-data-copy"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.std_data_copy</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                Default storage handler: copy cached wire data?
                EXPERIMENTAL – use default setting!
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.apc-prefix"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.apc_prefix</code></em>
              <span class="type">string</span>
            </span></dt><dd><p>
                The <code class="literal">
                <a class="ulink" href="http://www.php.net/ref.apc" target="_top">APC</a>
                </code> storage handler stores data in the
                <code class="literal">APC</code> user cache. The setting sets a
                prefix to be used for cache entries.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.memc-server"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.memc_server</code></em>
              <span class="type">string</span>
            </span></dt><dd><p>
                <code class="literal">MEMCACHE</code> storage handler: memcache
                server host.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.memc-port"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.memc_port</code></em>
              <span class="type">integer</span>
            </span></dt><dd><p>
                <code class="literal">MEMCACHE</code> storage handler: memcached
                server port.
              </p></dd><dt><a name="apis-php-ini.mysqlnd-qc.sqlite-data-file"></a><span class="term">
              <em class="parameter"><code>mysqlnd_qc.sqlite_data_file</code></em>
              <span class="type">string</span>
            </span></dt><dd><p>
                <code class="literal">sqlite</code> storage handler: data file.
                Any setting but <code class="literal">:memory:</code> may be of
                little practical value.
</p></dd></dl>
</div>
<p>
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.constants"></a>8.6 Predefined Constants</h2>

</div>

</div>

</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
The constants below are defined by this extension, and
will only be available when the extension has either
been compiled into PHP or dynamically loaded at runtime.
</p><p>
      <span class="emphasis"><em>SQL hint related</em></span>
    </p><p>
</p>
<div class="example">
<a name="idm139660442753824"></a><p class="title"><b>Example 8.16 Using SQL hint constants</b></p>
<div class="example-contents">
<p>
          The query cache is controlled by SQL hints. SQL hints are used
          to enable and disable caching. SQL hints can be used to set
          the <code class="literal">TTL</code> of a query.
        </p><p>
          The SQL hints recognized by the query cache can be manually
          changed at compile time. This makes it possible to use
          <code class="literal">mysqlnd_qc</code> in environments in which the
          default SQL hints are already taken and interpreted by other
          systems. Therefore it is recommended to use the SQL hint
          string constants instead of manually adding the default SQL
          hints to the query string.
        </p><pre class="programlisting">

&lt;?php
/* Use constants for maximum portability */
$query = "/*" . MYSQLND_QC_ENABLE_SWITCH . "*/SELECT id FROM test";

/* Valid but less portable: default TTL */
$query = "/*qc=on*/SELECT id FROM test";

/* Valid but less portable: per statement TTL */
$query = "/*qc=on*//*qc_ttl=5*/SELECT id FROM test";

printf("MYSQLND_QC_ENABLE_SWITCH: %s\n", MYSQLND_QC_ENABLE_SWITCH);
printf("MYSQLND_QC_DISABLE_SWITCH: %s\n", MYSQLND_QC_DISABLE_SWITCH);
printf("MYSQLND_QC_TTL_SWITCH: %s\n", MYSQLND_QC_TTL_SWITCH);
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

MYSQLND_QC_ENABLE_SWITCH: qc=on
MYSQLND_QC_DISABLE_SWITCH: qc=off
MYSQLND_QC_TTL_SWITCH: qc_ttl=


</pre>
</div>

</div>
<p><br class="example-break">
    </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><a name="apis-php-constant.mysqlnd-qc-enable-switch"></a><span class="term">
            <code class="constant">MYSQLND_QC_ENABLE_SWITCH</code>
            (<span class="type">string</span>)
          </span></dt><dd>
      SQL hint used to enable caching of a query.
     </dd><dt><a name="apis-php-constant.mysqlnd-qc-disable-switch"></a><span class="term">
            <code class="constant">MYSQLND_QC_DISABLE_SWITCH</code>
            (<span class="type">string</span>)
          </span></dt><dd>
      SQL hint used to disable caching of a query if
      <code class="literal">mysqlnd_qc.cache_by_default = 1</code>.
     </dd><dt><a name="apis-php-constant.mysqlnd-qc-ttl-switch"></a><span class="term">
            <code class="constant">MYSQLND_QC_TTL_SWITCH</code>
            (<span class="type">string</span>)
          </span></dt><dd>
      SQL hint used to set the TTL of a result set.
     </dd><dt><a name="apis-php-constant.mysqlnd-qc-server-id"></a><span class="term">
            <code class="constant">MYSQLND_QC_SERVER_ID_SWITCH</code>
            (<span class="type">string</span>)
          </span></dt><dd><p class="simpara">
      This SQL hint should not be used in general.
     </p><p class="simpara">
      It is needed by <a class="link" href="apis-php-mysqlnd-ms.html" title="Chapter 7 Mysqlnd replication and load balancing plugin">PECL/mysqlnd_ms</a>
      to group cache entries for one statement
      but originating from different physical connections. If the
      hint is used connection settings such as user, hostname and charset
      are not considered for generating a cache key of a query.
      Instead the given value and the query string are used as input
      to the hashing function that generates the key.
     </p><p class="simpara">
      PECL/mysqlnd_ms may, if instructed, cache results from
      MySQL Replication slaves. Because it can hold many connections
      to the slave the cache key shall not be formed from the user,
      hostname or other settings that may vary for the various slave
      connections. Instead, PECL/mysqlnd_ms provides an identifier
      which refers to the group of slave connections that shall be enabled
      to share cache entries no matter which physical slave connection was
      to generate the cache entry.
     </p><p class="simpara">
      Use of this feature outside of PECL/mysqlnd_ms is not recommended.
</p></dd></dl>
</div>
<p>
    </p><p>
      <span class="emphasis"><em><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
      related</em></span>
    </p><p>
</p>
<div class="example">
<a name="idm139660442728192"></a><p class="title"><b>Example 8.17 Example
          <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
usage</b></p>
<div class="example-contents">
<p>
          The function
          <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
          allows setting conditions for automatic caching of statements
          which don't begin with the SQL hints necessary to
          manually enable caching.
        </p><pre class="programlisting">

&lt;?php
/* Cache all accesses to tables with the name "new%" in schema/database "db_example" for 1 second */
if (!mysqlnd_qc_set_cache_condition(MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN, "db_example.new%", 1)) {
  die("Failed to set cache condition!");
}

$mysqli = new mysqli("host", "user", "password", "db_example", "port");
/* cached although no SQL hint given  */
$mysqli-&gt;query("SELECT id, title FROM news");

$pdo_mysql = new PDO("mysql:host=host;dbname=db_example;port=port", "user", "password");
/* not cached: no SQL hint, no pattern match */
$pdo_mysql-&gt;query("SELECT id, title FROM latest_news");
/* cached: TTL 1 second, pattern match */
$pdo_mysql-&gt;query("SELECT id, title FROM news");
?&gt;

</pre>
</div>

</div>
<p><br class="example-break">
    </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><a name="apis-php-constant.mysqlnd-qc-condition-meta-schema-pattern"></a><span class="term">
            <code class="constant">MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</code>
            (<span class="type">int</span>)
          </span></dt><dd>
      Used as a parameter of <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
      to set conditions for schema based automatic caching.
</dd></dl>
</div>
<p>
    </p><p>
      <span class="emphasis"><em>Other</em></span>
    </p><p>
      The plugin version number can be obtained using either
      <code class="constant">MYSQLND_QC_VERSION</code>, which is the string
      representation of the numerical version number, or
      <code class="constant">MYSQLND_QC_VERSION_ID</code>, which is an integer
      such as 10000. Developers can calculate the version number as
      follows.
    </p><p>
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Version (part)</th><th scope="col">Example</th></tr></thead><tbody><tr><td scope="row">Major*10000</td><td>1*10000 = 10000</td></tr><tr><td scope="row">Minor*100</td><td>0*100 = 0</td></tr><tr><td scope="row">Patch</td><td>0 = 0</td></tr><tr><td scope="row">MYSQLND_QC_VERSION_ID</td><td>10000</td></tr></tbody></table>
</div>
<p>
    </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><a name="apis-php-constant.mysqlnd-qc-version"></a><span class="term">
            <code class="constant">MYSQLND_QC_VERSION</code>
            (<span class="type">string</span>)
          </span></dt><dd>
      Plugin version string, for example, <span class="quote">“<span class="quote">1.0.0-prototype</span>”</span>.
</dd></dl>
</div>
<p>
    </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><a name="apis-php-constant.mysqlnd-qc-version-id"></a><span class="term">
            <code class="constant">MYSQLND_QC_VERSION_ID</code>
            (<span class="type">int</span>)
          </span></dt><dd>
      Plugin version number, for example, 10000.
</dd></dl>
</div>
<p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-ref.mysqlnd-qc"></a>8.7 mysqlnd_qc Functions</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-clear-cache">8.7.1 <code class="literal">mysqlnd_qc_clear_cache</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-available-handlers">8.7.2 <code class="literal">mysqlnd_qc_get_available_handlers</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info">8.7.3 <code class="literal">mysqlnd_qc_get_cache_info</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats">8.7.4 <code class="literal">mysqlnd_qc_get_core_stats</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log">8.7.5 <code class="literal">mysqlnd_qc_get_normalized_query_trace_log</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-query-trace-log">8.7.6 <code class="literal">mysqlnd_qc_get_query_trace_log</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition">8.7.7 <code class="literal">mysqlnd_qc_set_cache_condition</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-is-select">8.7.8 <code class="literal">mysqlnd_qc_set_is_select</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-storage-handler">8.7.9 <code class="literal">mysqlnd_qc_set_storage_handler</code></a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-user-handlers">8.7.10 <code class="literal">mysqlnd_qc_set_user_handlers</code></a></span></dt></dl>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-clear-cache"></a>8.7.1 <code class="literal">mysqlnd_qc_clear_cache</code></h3>
</div>
</div>
</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_clear_cache</code>
          </p><p>
            Flush all cache contents
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">bool </span><span class="methodname">mysqlnd_qc_clear_cache</span>();</code><p>
        Flush all cache contents.
      </p><p>
        Flushing the cache is a storage handler responsibility. All
        built-in storage handler but the <code class="literal">memcache</code>
        storage handler support flushing the cache. The
        <code class="literal">memcache</code> storage handler cannot flush its
        cache contents.
      </p><p>
        User-defined storage handler may or may not support the
        operation.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns <code class="constant">TRUE</code> on success or
        <code class="constant">FALSE</code> on failure.
      </p><p>
        A return value of <code class="constant">FALSE</code> indicates that
        flushing all cache contents has failed or the operation is not
        supported by the active storage handler. Applications must not
        expect that calling the function will always flush the cache.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-get-available-handlers"></a>8.7.2 <code class="literal">mysqlnd_qc_get_available_handlers</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_get_available_handlers</code>
          </p><p>
            Returns a list of available storage handler
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">array </span><span class="methodname">mysqlnd_qc_get_available_handlers</span>();</code><p>
        Which storage are available depends on the compile time
        configuration of the query cache plugin. The
        <code class="literal">default</code> storage handler is always available.
        All other storage handler must be enabled explicitly when
        building the extension.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns an array of available built-in storage handler. For each
        storage handler the version number and version string is given.
      </p><p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442665504"></a><p class="title"><b>Example 8.18 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-available-handlers" title="8.7.2 mysqlnd_qc_get_available_handlers"><code class="function">mysqlnd_qc_get_available_handlers</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
var_dump(mysqlnd_qc_get_available_handlers());
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

array(5) {
  ["default"]=&gt;
  array(2) {
    ["version"]=&gt;
    string(5) "1.0.0"
    ["version_number"]=&gt;
    int(100000)
  }
  ["user"]=&gt;
  array(2) {
    ["version"]=&gt;
    string(5) "1.0.0"
    ["version_number"]=&gt;
    int(100000)
  }
  ["APC"]=&gt;
  array(2) {
    ["version"]=&gt;
    string(5) "1.0.0"
    ["version_number"]=&gt;
    int(100000)
  }
  ["MEMCACHE"]=&gt;
  array(2) {
    ["version"]=&gt;
    string(5) "1.0.0"
    ["version_number"]=&gt;
    int(100000)
  }
  ["sqlite"]=&gt;
  array(2) {
    ["version"]=&gt;
    string(5) "1.0.0"
    ["version_number"]=&gt;
    int(100000)
  }
}

</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.installation" title="8.5.2 Installation">Installation</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-storage-handler" title="8.7.9 mysqlnd_qc_set_storage_handler"><code class="function">mysqlnd_qc_set_storage_handler</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-get-cache-info"></a>8.7.3 <code class="literal">mysqlnd_qc_get_cache_info</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_get_cache_info</code>
          </p><p>
            Returns information on the current handler, the number of
            cache entries and cache entries, if available
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">array </span><span class="methodname">mysqlnd_qc_get_cache_info</span>();</code><p></p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns information on the current handler, the number of cache
        entries and cache entries, if available. If and what data will
        be returned for the cache entries is subject to the active
        storage handler. Storage handler are free to return any data.
        Storage handler are recommended to return at least the data
        provided by the default handler, if technically possible.
      </p><p>
        The scope of the information is the PHP process. Depending on
        the PHP deployment model a process may serve one or more web
        requests.
      </p><p>
        Values are aggregated for all cache activities on a per storage
        handler basis. It is not possible to tell how much queries
        originating from <code class="literal">mysqli</code>,
        <code class="literal">PDO_MySQL</code> or <code class="literal">mysql</code>.API
        calls have contributed to the aggregated data values. Use
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>
        to get timing data aggregated for all storage handlers.
      </p><p>
        Array of cache information
      </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
              <em class="parameter"><code>handler</code></em> <span class="type">string</span>
            </span></dt><dd><p>
                The active storage handler.
              </p><p>
                All storage handler. Since 1.0.0.
              </p></dd><dt><span class="term">
              <em class="parameter"><code>handler_version</code></em> <span class="type">string</span>
            </span></dt><dd><p>
                The version of the active storage handler.
              </p><p>
                All storage handler. Since 1.0.0.
              </p></dd><dt><span class="term">
              <em class="parameter"><code>num_entries</code></em> <span class="type">int</span>
            </span></dt><dd><p>
                The number of cache entries. The value depends on the
                storage handler in use.
              </p><p>
                The default, APC and SQLite storage handler provide the
                actual number of cache entries.
              </p><p>
                The MEMCACHE storage handler always returns
                <code class="literal">0</code>. MEMCACHE does not support counting
                the number of cache entries.
              </p><p>
                If a user defined handler is used, the number of entries
                of the <code class="literal">data</code> property is reported.
              </p><p>
                Since 1.0.0.
              </p></dd><dt><span class="term">
              <em class="parameter"><code>data</code></em> <span class="type">array</span>
            </span></dt><dd><p>
                The version of the active storage handler.
              </p><p>
                Additional storage handler dependent data on the cache
                entries. Storage handler are requested to provide
                similar and comparable information. A user defined
                storage handler is free to return any data.
              </p><p>
                Since 1.0.0.
              </p><p>
                The following information is provided by the default
                storage handler for the <code class="literal">data</code>
                property.
              </p><p>
                The <code class="literal">data</code> property holds a hash. The
                hash is indexed by the internal cache entry identifier
                of the storage handler. The cache entry identifier is
                human-readable and contains the query string leading to
                the cache entry. Please, see also the example below. The
                following data is given for every cache entry.
              </p><p>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
                      <em class="parameter"><code>statistics</code></em>
                      <span class="type">array</span>
                    </span></dt><dd><p>
                        Statistics of the cache entry.
                      </p><p>
                        Since 1.0.0.
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Property</th><th scope="col">Description</th><th scope="col">Version</th></tr></thead><tbody><tr><td scope="row"><code class="literal">rows</code></td><td>Number of rows of the cached result set.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">stored_size</code></td><td>The size of the cached result set in bytes. This is the size of the
                                payload. The value is not suited for
                                calculating the total memory consumption
                                of all cache entries including the
                                administrative overhead of the cache
                                entries.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">cache_hits</code></td><td>How often the cached entry has been returned.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">run_time</code></td><td>Run time of the statement to which the cache entry belongs. This is the
                                run time of the uncached statement. It
                                is the time between sending the
                                statement to MySQL receiving a reply
                                from MySQL. Run time saved by using the
                                query cache plugin can be calculated
                                like this: <code class="literal">cache_hits *
                                ((run_time - avg_run_time) + (store_time
                                - avg_store_time))</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">store_time</code></td><td>Store time of the statements result set to which the cache entry
                                belongs. This is the time it took to
                                fetch and store the results of the
                                uncached statement.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">min_run_time</code></td><td>Minimum run time of the cached statement. How long it took to find the
                                statement in the cache.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">min_store_time</code></td><td>Minimum store time of the cached statement. The time taken for fetching
                                the cached result set from the storage
medium and decoding</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">avg_run_time</code></td><td>Average run time of the cached statement.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">avg_store_time</code></td><td>Average store time of the cached statement.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">max_run_time</code></td><td>Average run time of the cached statement.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">max_store_time</code></td><td>Average store time of the cached statement.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">valid_until</code></td><td>Timestamp when the cache entry expires.</td><td>Since 1.1.0.</td></tr></tbody></table>
</div>
</dd><dt><span class="term">
                      <em class="parameter"><code>metadata</code></em> <span class="type">array</span>
                    </span></dt><dd><p>
                        Metadata of the cache entry. This is the
                        metadata provided by MySQL together with the
                        result set of the statement in question.
                        Different versions of the MySQL server may
                        return different metadata. Unlike with some of
                        the PHP MySQL extensions no attempt is made to
                        hide MySQL server version dependencies and
                        version details from the caller. Please, refer
                        to the MySQL C API documentation that belongs to
                        the MySQL server in use for further details.
                      </p><p>
                        The metadata list contains one entry for every
                        column.
                      </p><p>
                        Since 1.0.0.
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Property</th><th scope="col">Description</th><th scope="col">Version</th></tr></thead><tbody><tr><td scope="row"><code class="literal">name</code></td><td>The field name. Depending on the MySQL version this may be the fields
                                alias name.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">org_name</code></td><td>The field name.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">table</code></td><td>The table name. If an alias name was used for the table, this usually
                                holds the alias name.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">org_table</code></td><td>The table name.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">db</code></td><td>The database/schema name.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">max_length</code></td><td>The maximum width of the field. Details may vary by MySQL server
                                version.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">length</code></td><td>The width of the field. Details may vary by MySQL server version.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">type</code></td><td>The data type of the field. Details may vary by the MySQL server in use.
                                This is the MySQL C API type constants
                                value. It is recommended to use type
                                constants provided by the
                                <code class="literal">mysqli</code> extension to
                                test for its meaning. You should not
                                test for certain type values by
comparing with certain numbers.</td><td>Since 1.0.0.</td></tr></tbody></table>
</div>
</dd></dl>
</div>
<p>
              </p><p>
                The APC storage handler returns the same information for
                the <code class="literal">data</code> property but no
                <code class="literal">metadata</code>. The
                <code class="literal">metadata</code> of a cache entry is set to
                <code class="literal">NULL</code>.
              </p><p>
                The MEMCACHE storage handler does not fill the
                <code class="literal">data</code> property. Statistics are not
                available on a per cache entry basis with the MEMCACHE
                storage handler.
              </p><p>
                A user defined storage handler is free to provide any
                data.
</p></dd></dl>
</div>
<p>
      </p><p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442547872"></a><p class="title"><b>Example 8.19 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>
example</b></p>
<div class="example-contents">
<p>
          The example shows the output from the built-in default storage
          handler. Other storage handler may report different data.
        </p><pre class="programlisting">

&lt;?php
/* Populate the cache, e.g. using mysqli */
$mysqli = new mysqli("host", "user", "password", "schema");
$mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/SELECT id FROM test");

/* Display cache information */
var_dump(mysqlnd_qc_get_cache_info());
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

array(4) {
 ["num_entries"]=&gt;
 int(1)
 ["handler"]=&gt;
 string(7) "default"
 ["handler_version"]=&gt;
 string(5) "1.0.0"
 ["data"]=&gt;
 array(1) {
   ["Localhost via UNIX socket 3306 user schema|/*qc=on*/SELECT id FROM test"]=&gt;
   array(2) {
     ["statistics"]=&gt;
     array(11) {
       ["rows"]=&gt;
       int(6)
       ["stored_size"]=&gt;
       int(101)
       ["cache_hits"]=&gt;
       int(0)
       ["run_time"]=&gt;
       int(471)
       ["store_time"]=&gt;
       int(27)
       ["min_run_time"]=&gt;
       int(0)
       ["max_run_time"]=&gt;
       int(0)
       ["min_store_time"]=&gt;
       int(0)
       ["max_store_time"]=&gt;
       int(0)
       ["avg_run_time"]=&gt;
       int(0)
       ["avg_store_time"]=&gt;
       int(0)
     }
     ["metadata"]=&gt;
     array(1) {
       [0]=&gt;
       array(8) {
         ["name"]=&gt;
         string(2) "id"
         ["orig_name"]=&gt;
         string(2) "id"
         ["table"]=&gt;
         string(4) "test"
         ["orig_table"]=&gt;
         string(4) "test"
         ["db"]=&gt;
         string(4) "schema"
         ["max_length"]=&gt;
         int(1)
         ["length"]=&gt;
         int(11)
         ["type"]=&gt;
         int(3)
       }
     }
   }
 }
}


</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-get-core-stats"></a>8.7.4 <code class="literal">mysqlnd_qc_get_core_stats</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_get_core_stats</code>
          </p><p>
            Statistics collected by the core of the query cache
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">array </span><span class="methodname">mysqlnd_qc_get_core_stats</span>();</code><p>
        Returns an array of statistics collected by the core of the
        cache plugin. The same data fields will be reported for any
        storage handler because the data is collected by the core.
      </p><p>
        The <code class="literal">PHP</code> configuration setting
        <code class="literal">mysqlnd_qc.collect_statistics</code> controls the
        collection of statistics. The collection of statistics is
        disabled by default for performance reasons. Disabling the
        collection of statistics will also disable the collection of
        time related statistics.
      </p><p>
        The <code class="literal">PHP</code> configuration setting
        <code class="literal">mysqlnd_qc.collect_time_statistics</code> controls
        the collection of time related statistics.
      </p><p>
        The scope of the core statistics is the <code class="literal">PHP</code>
        process. Depending on your deployment model a
        <code class="literal">PHP</code> process may handle one or multiple
        requests.
      </p><p>
        Statistics are aggregated for all cache entries and all storage
        handler. It is not possible to tell how much queries originating
        from <code class="literal">mysqli</code>, <code class="literal">PDO_MySQL</code> or
        <code class="literal">mysql</code> API calls have contributed to the
        aggregated data values.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Array of core statistics
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col width="10%"><col width="70%"><col width="20%"></colgroup><thead><tr><th scope="col">Statistic</th><th scope="col">Description</th><th scope="col">Version</th></tr></thead><tbody><tr><td scope="row"><code class="literal">cache_hit</code></td><td>Statement is considered cacheable and cached data has been reused.
                Statement is considered cacheable and a cache miss
                happened but the statement got cached by someone else
                while we process it and thus we can fetch the result
                from the refreshed cache.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">cache_miss</code></td><td>Statement is considered cacheable...

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                      ... and has been added to the cache
                    </p></li><li class="listitem"><p>
                      ... but the <code class="literal">PHP</code> configuration
                      directive setting of
                      <code class="literal">mysqlnd_qc.cache_no_table = 1</code>
                      has prevented caching.
                    </p></li><li class="listitem"><p>
                      ... but an unbuffered result set is requested.
                    </p></li><li class="listitem"><p>
                      ... but a buffered result set was empty.
</p></li></ul>
</div>
</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">cache_put</code></td><td>Statement is considered cacheable and has been added to the cache. Take
                care when calculating derived statistics. Storage
                handler with a storage life time beyond process scope
                may report <code class="literal">cache_put = 0</code> together
                with <code class="literal">cache_hit &gt; 0</code>, if another
                process has filled the cache. You may want to use
                <code class="literal">num_entries</code> from
                <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>
                if the handler supports it ( <code class="literal">default</code>,
                <code class="literal">APC</code>).</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_should_cache</code></td><td>Statement is considered cacheable based on query string analysis. The
                statement may or may not be added to the cache. See also
                <code class="literal">cache_put</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_should_not_cache</code></td><td>Statement is considered not cacheable based on query string analysis.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_not_cached</code></td><td>Statement is considered not cacheable or it is considered cachable but
                the storage handler has not returned a hash key for it.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_could_cache</code></td><td>Statement is considered cacheable...

<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                      ... and statement has been run without errors
                    </p></li><li class="listitem"><p>
                      ... and meta data shows at least one column in the
                      result set
</p></li></ul>
</div>

                The statement may or may not be in the cache already. It
                may or may not be added to the cache later on.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_found_in_cache</code></td><td>Statement is considered cacheable and we have found it in the cache but
                we have not replayed the cached data yet and we have not
                send the result set to the client yet. This is not
                considered a cache hit because the client might not
                fetch the result or the cached data may be faulty.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_uncached_other</code></td><td>Statement is considered cacheable and it may or may not be in the cache
                already but either replaying cached data has failed, no
                result set is available or some other error has
                happened.</td><td class="auto-generated"> </td></tr><tr><td scope="row"><code class="literal">query_uncached_no_table</code></td><td>Statement has not been cached because the result set has at least one
                column which has no table name in its meta data. An
                example of such a query is <code class="literal">SELECT
                SLEEP(1)</code>. To cache those statements you have
                to change default value of the PHP configuration
                directive <code class="literal">mysqlnd_qc.cache_no_table</code>
                and set <code class="literal">mysqlnd_qc.cache_no_table =
                1</code>. Often, it is not desired to cache such
                statements.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_uncached_use_result</code></td><td>Statement would have been cached if a buffered result set had been used.
                The situation is also considered as a cache miss and
                <code class="literal">cache_miss</code> will be incremented as
                well.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_run_time_cache_hit</code></td><td>Aggregated run time (ms) of all cached queries. Cached queries are those
                which have incremented <code class="literal">cache_hit</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_run_time_cache_put</code></td><td>Aggregated run time (ms) of all uncached queries that have been put into
                the cache. See also <code class="literal">cache_put</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_run_time_total</code></td><td>Aggregated run time (ms) of all uncached and cached queries that have
                been inspected and executed by the query cache.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_store_time_cache_hit</code></td><td>Aggregated store time (ms) of all cached queries. Cached queries are
                those which have incremented
                <code class="literal">cache_hit</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_store_time_cache_put</code></td><td>Aggregated store time ( <code class="literal">ms</code>) of all uncached queries
                that have been put into the cache. See also
                <code class="literal">cache_put</code>.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">query_aggr_store_time_total</code></td><td>Aggregated store time (ms) of all uncached and cached queries that have
                been inspected and executed by the query cache.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">receive_bytes_recorded</code></td><td>Recorded incoming network traffic ( <code class="literal">bytes</code>) send from
                MySQL to PHP. The traffic may or may not have been added
                to the cache. The traffic is the total for all queries
                regardless if cached or not.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">receive_bytes_replayed</code></td><td>Network traffic replayed during cache. This is the total amount of
                incoming traffic saved because of the usage of the query
                cache plugin.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">send_bytes_recorded</code></td><td>Recorded outgoing network traffic ( <code class="literal">bytes</code>) send from
                MySQL to PHP. The traffic may or may not have been added
                to the cache. The traffic is the total for all queries
                regardless if cached or not.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">send_bytes_replayed</code></td><td>Network traffic replayed during cache. This is the total amount of
                outgoing traffic saved because of the usage of the query
                cache plugin.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">slam_stale_refresh</code></td><td>Number of cache misses which triggered serving stale data until the
                client causing the cache miss has refreshed the cache
entry.</td><td>Since 1.0.0.</td></tr><tr><td scope="row"><code class="literal">slam_stale_hit</code></td><td>Number of cache hits while a stale cache entry gets refreshed.</td><td>Since 1.0.0.</td></tr></tbody></table>
</div>
<p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442439696"></a><p class="title"><b>Example 8.20 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-core-stats" title="8.7.4 mysqlnd_qc_get_core_stats"><code class="function">mysqlnd_qc_get_core_stats</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
/* Enable collection of statistics - default: disabled */
ini_set("mysqlnd_qc.collect_statistics", 1);

/* Enable collection of all timing related statistics -
default: enabled but overruled by mysqlnd_qc.collect_statistics = 0 */
ini_set("mysqlnd_qc.collect_time_statistics", 1);

/* Populate the cache, e.g. using mysqli */
$mysqli = new mysqli('host', 'user', 'password', 'schema');

/* Cache miss and cache put */
$mysqli-&gt;query("/*qc=on*/SELECT id FROM test");
/* Cache hit */
$mysqli-&gt;query("/*qc=on*/SELECT id FROM test");

/* Display core statistics */
var_dump(mysqlnd_qc_get_core_stats());
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

array(26) {
  ["cache_hit"]=&gt;
  string(1) "1"
  ["cache_miss"]=&gt;
  string(1) "1"
  ["cache_put"]=&gt;
  string(1) "1"
  ["query_should_cache"]=&gt;
  string(1) "2"
  ["query_should_not_cache"]=&gt;
  string(1) "0"
  ["query_not_cached"]=&gt;
  string(1) "0"
  ["query_could_cache"]=&gt;
  string(1) "2"
  ["query_found_in_cache"]=&gt;
  string(1) "1"
  ["query_uncached_other"]=&gt;
  string(1) "0"
  ["query_uncached_no_table"]=&gt;
  string(1) "0"
  ["query_uncached_no_result"]=&gt;
  string(1) "0"
  ["query_uncached_use_result"]=&gt;
  string(1) "0"
  ["query_aggr_run_time_cache_hit"]=&gt;
  string(1) "4"
  ["query_aggr_run_time_cache_put"]=&gt;
  string(3) "395"
  ["query_aggr_run_time_total"]=&gt;
  string(3) "399"
  ["query_aggr_store_time_cache_hit"]=&gt;
  string(1) "2"
  ["query_aggr_store_time_cache_put"]=&gt;
  string(1) "8"
  ["query_aggr_store_time_total"]=&gt;
  string(2) "10"
  ["receive_bytes_recorded"]=&gt;
  string(2) "65"
  ["receive_bytes_replayed"]=&gt;
  string(2) "65"
  ["send_bytes_recorded"]=&gt;
  string(2) "29"
  ["send_bytes_replayed"]=&gt;
  string(2) "29"
  ["slam_stale_refresh"]=&gt;
  string(1) "0"
  ["slam_stale_hit"]=&gt;
  string(1) "0"
  ["request_counter"]=&gt;
  int(1)
  ["process_hash"]=&gt;
  int(3547549858)
}


</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">Runtime configuration</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-statistics">mysqlnd_qc.collect_statistics</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.time-statistics">mysqlnd_qc.time_statistics</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-get-normalized-query-trace-log"></a>8.7.5 <code class="literal">mysqlnd_qc_get_normalized_query_trace_log</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_get_normalized_query_trace_log</code>
          </p><p>
            Returns a normalized query trace log for each query
            inspected by the query cache
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">array </span><span class="methodname">mysqlnd_qc_get_normalized_query_trace_log</span>();</code><p>
        Returns a normalized query trace log for each query inspected by
        the query cache. The collection of the trace log is disabled by
        default. To collect the trace log you have to set the PHP
        configuration directive
        <code class="literal">mysqlnd_qc.collect_normalized_query_trace</code> to
        <code class="literal">1</code>
      </p><p>
        Entries in the trace log are grouped by the normalized query
        statement. The normalized query statement is the query statement
        with all statement parameter values being replaced with a
        question mark. For example, the two statements <code class="literal">SELECT
        id FROM test WHERE id = 1</code> and <code class="literal">SELECT id FROM
        test WHERE id = 2</code> are normalized as <code class="literal">SELECT id
        FROM test WHERE id = ?</code>. Whenever a statement is
        inspected by the query cache which matches the normalized
        statement pattern, its statistics are grouped by the normalized
        statement string.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        An array of query log. Every list entry contains the normalized
        query stringand further detail information.
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Key</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">query</code></td><td>Normalized statement string.</td></tr><tr><td scope="row"><code class="literal">occurences</code></td><td>How many statements have matched the normalized statement string in
                addition to the one which has created the log entry. The
                value is zero if a statement has been normalized, its
                normalized representation has been added to the log but
                no further queries inspected by PECL/mysqlnd_qc have the
                same normalized statement string.</td></tr><tr><td scope="row"><code class="literal">eligible_for_caching</code></td><td>Whether the statement could be cached. An statement eligible for caching
                has not necessarily been cached. It not possible to tell
                for sure if or how many cached statement have
                contributed to the aggregated normalized statement log
                entry. However, comparing the minimum and average run
                time one can make an educated guess.</td></tr><tr><td scope="row"><code class="literal">avg_run_time</code></td><td>The average run time of all queries contributing to the query log entry.
                The run time is the time between sending the query
                statement to MySQL and receiving an answer from MySQL.</td></tr><tr><td scope="row"><code class="literal">avg_store_time</code></td><td>The average store time of all queries contributing to the query log
                entry. The store time is the time needed to fetch a
                statements result set from the server to the client and,
                storing it on the client.</td></tr><tr><td scope="row"><code class="literal">min_run_time</code></td><td>The minimum run time of all queries contributing to the query log entry.</td></tr><tr><td scope="row"><code class="literal">min_store_time</code></td><td>The minimum store time of all queries contributing to the query log
                entry.</td></tr><tr><td scope="row"><code class="literal">max_run_time</code></td><td>The maximum run time of all queries contributing to the query log entry.</td></tr><tr><td scope="row"><code class="literal">max_store_time</code></td><td>The maximum store time of all queries contributing to the query log
entry.</td></tr></tbody></table>
</div>
<p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442387744"></a><p class="title"><b>Example 8.21 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log" title="8.7.5 mysqlnd_qc_get_normalized_query_trace_log"><code class="function">mysqlnd_qc_get_normalized_query_trace_log</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.collect_normalized_query_trace=1

   </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

/* not cached */
$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* cache put */
$res = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 2");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* cache hit */
$res = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 2");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

var_dump(mysqlnd_qc_get_normalized_query_trace_log());
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

array(1) {
  ["id"]=&gt;
  string(1) "1"
}
array(1) {
  ["id"]=&gt;
  string(1) "2"
}
array(1) {
  ["id"]=&gt;
  string(1) "2"
}
array(4) {
  [0]=&gt;
  array(9) {
    ["query"]=&gt;
    string(25) "DROP TABLE IF EXISTS test"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [1]=&gt;
  array(9) {
    ["query"]=&gt;
    string(27) "CREATE TABLE test (id INT )"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [2]=&gt;
  array(9) {
    ["query"]=&gt;
    string(40) "INSERT INTO test (id ) VALUES (? ), (? )"
    ["occurences"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["avg_run_time"]=&gt;
    int(0)
    ["min_run_time"]=&gt;
    int(0)
    ["max_run_time"]=&gt;
    int(0)
    ["avg_store_time"]=&gt;
    int(0)
    ["min_store_time"]=&gt;
    int(0)
    ["max_store_time"]=&gt;
    int(0)
  }
  [3]=&gt;
  array(9) {
    ["query"]=&gt;
    string(31) "SELECT id FROM test WHERE id =?"
    ["occurences"]=&gt;
    int(2)
    ["eligible_for_caching"]=&gt;
    bool(true)
    ["avg_run_time"]=&gt;
    int(159)
    ["min_run_time"]=&gt;
    int(12)
    ["max_run_time"]=&gt;
    int(307)
    ["avg_store_time"]=&gt;
    int(10)
    ["min_store_time"]=&gt;
    int(8)
    ["max_store_time"]=&gt;
    int(13)
  }
}

</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">Runtime configuration</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-query-trace">mysqlnd_qc.collect_normalized_query_trace</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.time-statistics">mysqlnd_qc.time_statistics</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-query-trace-log" title="8.7.6 mysqlnd_qc_get_query_trace_log"><code class="function">mysqlnd_qc_get_query_trace_log</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-get-query-trace-log"></a>8.7.6 <code class="literal">mysqlnd_qc_get_query_trace_log</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_get_query_trace_log</code>
          </p><p>
            Returns a backtrace for each query inspected by the query
            cache
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">array </span><span class="methodname">mysqlnd_qc_get_query_trace_log</span>();</code><p>
        Returns a backtrace for each query inspected by the query cache.
        The collection of the backtrace is disabled by default. To
        collect the backtrace you have to set the PHP configuration
        directive <code class="literal">mysqlnd_qc.collect_query_trace</code> to
        <code class="literal">1</code>
      </p><p>
        The maximum depth of the backtrace is limited to the depth set
        with the PHP configuration directive
        <code class="literal">mysqlnd_qc.query_trace_bt_depth</code>.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        An array of query backtrace. Every list entry contains the query
        string, a backtrace and further detail information.
</p>
<div class="informaltable">
<table class="informaltable" summary="Unknown PHP API feature." border="1"><colgroup><col><col></colgroup><thead><tr><th scope="col">Key</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">query</code></td><td>Query string.</td></tr><tr><td scope="row"><code class="literal">origin</code></td><td>Code backtrace.</td></tr><tr><td scope="row"><code class="literal">run_time</code></td><td>Query run time in milliseconds. The collection of all times and the
                necessary <code class="literal">gettimeofday</code> system calls
                can be disabled by setting the PHP configuration
                directive <code class="literal">mysqlnd_qc.time_statistics</code>
                to <code class="literal">0</code></td></tr><tr><td scope="row"><code class="literal">store_time</code></td><td>Query result set store time in milliseconds. The collection of all times
                and the necessary <code class="literal">gettimeofday</code> system
                calls can be disabled by setting the PHP configuration
                directive <code class="literal">mysqlnd_qc.time_statistics</code>
                to <code class="literal">0</code></td></tr><tr><td scope="row"><code class="literal">eligible_for_caching</code></td><td><code class="constant">TRUE</code> if query is cacheable otherwise
                <code class="constant">FALSE</code>.</td></tr><tr><td scope="row"><code class="literal">no_table</code></td><td><code class="constant">TRUE</code> if the query has generated a result set and at
                least one column from the result set has no table name
                set in its metadata. This is usually the case with
                queries which one probably do not want to cache such as
                <code class="literal">SELECT SLEEP(1)</code>. By default any such
                query will not be added to the cache. See also PHP
                configuration directive
                <code class="literal">mysqlnd_qc.cache_no_table</code>.</td></tr><tr><td scope="row"><code class="literal">was_added</code></td><td><code class="constant">TRUE</code> if the query result has been put into the
                cache, otherwise <code class="constant">FALSE</code>.</td></tr><tr><td scope="row"><code class="literal">was_already_in_cache</code></td><td><code class="constant">TRUE</code> if the query result would have been added to
                the cache if it was not already in the cache (cache
hit). Otherwise <code class="constant">FALSE</code>.</td></tr></tbody></table>
</div>
<p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442330688"></a><p class="title"><b>Example 8.22 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-query-trace-log" title="8.7.6 mysqlnd_qc_get_query_trace_log"><code class="function">mysqlnd_qc_get_query_trace_log</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

mysqlnd_qc.collect_query_trace=1

   </pre><pre class="programlisting">

&lt;?php
/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema", "port", "socket");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2)");

/* not cached */
$res = $mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* cache put */
$res = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 2");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

/* cache hit */
$res = $mysqli-&gt;query("/*" . MYSQLND_QC_ENABLE_SWITCH . "*/" . "SELECT id FROM test WHERE id = 2");
var_dump($res-&gt;fetch_assoc());
$res-&gt;free();

var_dump(mysqlnd_qc_get_query_trace_log());
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

array(1) {
  ["id"]=&gt;
  string(1) "1"
}
array(1) {
  ["id"]=&gt;
  string(1) "2"
}
array(1) {
  ["id"]=&gt;
  string(1) "2"
}
array(6) {
  [0]=&gt;
  array(8) {
    ["query"]=&gt;
    string(25) "DROP TABLE IF EXISTS test"
    ["origin"]=&gt;
    string(102) "#0 qc.php(4): mysqli-&gt;query('DROP TABLE IF E...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [1]=&gt;
  array(8) {
    ["query"]=&gt;
    string(25) "CREATE TABLE test(id INT)"
    ["origin"]=&gt;
    string(102) "#0 qc.php(5): mysqli-&gt;query('CREATE TABLE te...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [2]=&gt;
  array(8) {
    ["query"]=&gt;
    string(36) "INSERT INTO test(id) VALUES (1), (2)"
    ["origin"]=&gt;
    string(102) "#0 qc.php(6): mysqli-&gt;query('INSERT INTO tes...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(0)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [3]=&gt;
  array(8) {
    ["query"]=&gt;
    string(32) "SELECT id FROM test WHERE id = 1"
    ["origin"]=&gt;
    string(102) "#0 qc.php(9): mysqli-&gt;query('SELECT id FROM ...')
#1 {main}"
    ["run_time"]=&gt;
    int(0)
    ["store_time"]=&gt;
    int(25)
    ["eligible_for_caching"]=&gt;
    bool(false)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [4]=&gt;
  array(8) {
    ["query"]=&gt;
    string(41) "/*qc=on*/SELECT id FROM test WHERE id = 2"
    ["origin"]=&gt;
    string(103) "#0 qc.php(14): mysqli-&gt;query('/*qc=on*/SELECT...')
#1 {main}"
    ["run_time"]=&gt;
    int(311)
    ["store_time"]=&gt;
    int(13)
    ["eligible_for_caching"]=&gt;
    bool(true)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(true)
    ["was_already_in_cache"]=&gt;
    bool(false)
  }
  [5]=&gt;
  array(8) {
    ["query"]=&gt;
    string(41) "/*qc=on*/SELECT id FROM test WHERE id = 2"
    ["origin"]=&gt;
    string(103) "#0 qc.php(19): mysqli-&gt;query('/*qc=on*/SELECT...')
#1 {main}"
    ["run_time"]=&gt;
    int(13)
    ["store_time"]=&gt;
    int(8)
    ["eligible_for_caching"]=&gt;
    bool(true)
    ["no_table"]=&gt;
    bool(false)
    ["was_added"]=&gt;
    bool(false)
    ["was_already_in_cache"]=&gt;
    bool(true)
  }
}

</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">Runtime configuration</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-query-trace">mysqlnd_qc.collect_query_trace</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.query-trace-bt-depth">mysqlnd_qc.query_trace_bt_depth</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.time-statistics">mysqlnd_qc.time_statistics</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-no-table">mysqlnd_qc.cache_no_table</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-normalized-query-trace-log" title="8.7.5 mysqlnd_qc_get_normalized_query_trace_log"><code class="function">mysqlnd_qc_get_normalized_query_trace_log</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-set-cache-condition"></a>8.7.7 <code class="literal">mysqlnd_qc_set_cache_condition</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_set_cache_condition</code>
          </p><p>
            Set conditions for automatic caching
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">bool </span><span class="methodname">mysqlnd_qc_set_cache_condition</span>(<span class="methodparam"><span class="type">int </span><span class="parameter">condition_type</span></span>,<br>                                    <span class="methodparam"><span class="type">mixed </span><span class="parameter">condition</span></span>,<br>                                    <span class="methodparam"><span class="type">mixed </span><span class="parameter">condition_option</span></span>);</code><p>
        Sets a condition for automatic caching of statements which do
        not contain the necessary SQL hints to enable caching of them.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
            <em class="parameter"><code>condition_type</code></em>
          </span></dt><dd><p>
              Type of the condition. The only allowed value is
              <code class="constant">MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</code>.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>condition</code></em>
          </span></dt><dd><p>
              Parameter for the condition set with
              <code class="literal">condition_type</code>. Parameter type and
              structure depend on <code class="literal">condition_type</code>
            </p><p>
              If <code class="literal">condition_type</code> equals
              <code class="literal">MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</code>
              <code class="literal">condition</code> must be a string. The string
              sets a pattern. Statements are cached if table and
              database meta data entry of their result sets match the
              pattern. The pattern is checked for a match with the
              <code class="literal">db</code> and <code class="literal">org_table</code>
              meta data entries provided by the underlying MySQL client
              server library. Please, check the MySQL Reference manual
              for details about the two entries. The
              <code class="literal">db</code> and <code class="literal">org_table</code>
              values are concatenated with a dot (<code class="literal">.</code>)
              before matched against <code class="literal">condition</code>.
              Pattern matching supports the wildcards
              <code class="literal">%</code> and <code class="literal">_</code>. The
              wildcard <code class="literal">%</code> will match one or many
              arbitrary characters. <code class="literal">_</code> will match one
              arbitrary character. The escape symbol is backslash.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>condition_option</code></em>
          </span></dt><dd><p>
              Option for <code class="literal">condition</code>. Type and
              structure depend on <code class="literal">condition_type</code>.
            </p><p>
              If <code class="literal">condition_type</code> equals
              <code class="literal">MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</code>
              <code class="literal">condition_options</code> is the TTL to be
              used.
</p></dd></dl>
</div>
<p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442271296"></a><p class="title"><b>Example 8.23 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
/* Cache all accesses to tables with the name "new%" in schema/database "db_example" for 1 second */
if (!mysqlnd_qc_set_cache_condition(MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN, "db_example.new%", 1)) {
  die("Failed to set cache condition!");
}

$mysqli = new mysqli("host", "user", "password", "db_example", "port");
/* cached although no SQL hint given  */
$mysqli-&gt;query("SELECT id, title FROM news");

$pdo_mysql = new PDO("mysql:host=host;dbname=db_example;port=port", "user", "password");
/* not cached: no SQL hint, no pattern match */
$pdo_mysql-&gt;query("SELECT id, title FROM latest_news");
/* cached: TTL 1 second, pattern match */
$pdo_mysql-&gt;query("SELECT id, title FROM news");
?&gt;

</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns TRUE on success or FALSE on FAILURE.
      </p><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.pattern-based-caching" title="8.4.5 Pattern based caching">Quickstart: pattern based caching</a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-set-is-select"></a>8.7.8 <code class="literal">mysqlnd_qc_set_is_select</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_set_is_select</code>
          </p><p>
            Installs a callback which decides whether a statement is
            cached
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">mixed </span><span class="methodname">mysqlnd_qc_set_is_select</span>(<span class="methodparam"><span class="type">string </span><span class="parameter">callback</span></span>);</code><p>
        Installs a callback which decides whether a statement is cached.
      </p><p>
        There are several ways of hinting PELC/mysqlnd_qc to cache a
        query. By default, PECL/mysqlnd_qc attempts to cache a if
        caching of all statements is enabled or the query string begins
        with a certain SQL hint. The plugin internally calls a function
        named <code class="literal">is_select()</code> to find out. This internal
        function can be replaced with a user-defined callback. Then, the
        user-defined callback is responsible to decide whether the
        plugin attempts to cache a statement. Because the internal
        function is replaced with the callback, the callback gains full
        control. The callback is free to ignore the configuration
        setting <code class="literal">mysqlnd_qc.cache_by_default</code> and SQL
        hints.
      </p><p>
        The callback is invoked for every statement inspected by the
        plugin. It is given the statements string as a parameter. The
        callback returns <code class="constant">FALSE</code> if the statement
        shall not be cached. It returns <code class="constant">TRUE</code> to
        make the plugin attempt to cache the statements result set, if
        any. A so-created cache entry is given the default TTL set with
        the PHP configuration directive
        <code class="literal">mysqlnd_qc.ttl</code>. If a different TTL shall be
        used, the callback returns a numeric value to be used as the
        TTL.
      </p><p>
        The internal <code class="literal">is_select</code> function is part of
        the internal cache storage handler interface. Thus, a
        user-defined storage handler offers the same capabilities.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
      </p><p>
        This function has no parameters.
      </p><p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns <code class="constant">TRUE</code> on success or
        <code class="constant">FALSE</code> on failure.
      </p><p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442241632"></a><p class="title"><b>Example 8.24 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-is-select" title="8.7.8 mysqlnd_qc_set_is_select"><code class="function">mysqlnd_qc_set_is_select</code></a>
example</b></p>
<div class="example-contents">
<pre class="programlisting">

&lt;?php
/* callback which decides if query is cached */
function is_select($query) {
  static $patterns = array(
   /* true - use default from mysqlnd_qc.ttl */
   "@SELECT\s+.*\s+FROM\s+test@ismU" =&gt; true,
   /* 3 - use TTL = 3 seconds */
   "@SELECT\s+.*\s+FROM\s+news@ismU" =&gt; 3
  );
  /* check if query does match pattern */
  foreach ($patterns as $pattern =&gt; $ttl) {
    if (preg_match($pattern, $query)) {
      printf("is_select(%45s): cache\n", $query);
      return $ttl;
    }
  }
  printf("is_select(%45s): do not cache\n", $query);
  return false;
}
mysqlnd_qc_set_is_select("is_select");

/* Connect, create and populate test table */
$mysqli = new mysqli("host", "user", "password", "schema");
$mysqli-&gt;query("DROP TABLE IF EXISTS test");
$mysqli-&gt;query("CREATE TABLE test(id INT)");
$mysqli-&gt;query("INSERT INTO test(id) VALUES (1), (2), (3)");

/* cache put */
$mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
/* cache hit */
$mysqli-&gt;query("SELECT id FROM test WHERE id = 1");
/* cache put */
$mysqli-&gt;query("SELECT * FROM test");
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

is_select(                    DROP TABLE IF EXISTS test): do not cache
is_select(                    CREATE TABLE test(id INT)): do not cache
is_select(    INSERT INTO test(id) VALUES (1), (2), (3)): do not cache
is_select(             SELECT id FROM test WHERE id = 1): cache
is_select(             SELECT id FROM test WHERE id = 1): cache
is_select(                           SELECT * FROM test): cache

</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.configuration" title="8.5.3 Runtime Configuration">Runtime configuration</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.ttl">mysqlnd_qc.ttl</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.cache-by-default">mysqlnd_qc.cache_by_default</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-user-handlers" title="8.7.10 mysqlnd_qc_set_user_handlers"><code class="function">mysqlnd_qc_set_user_handlers</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-set-storage-handler"></a>8.7.9 <code class="literal">mysqlnd_qc_set_storage_handler</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_set_storage_handler</code>
          </p><p>
            Change current storage handler
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">bool </span><span class="methodname">mysqlnd_qc_set_storage_handler</span>(<span class="methodparam"><span class="type">string </span><span class="parameter">handler</span></span>);</code><p>
        Sets the storage handler used by the query cache. A list of
        available storage handler can be obtained from
        <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-available-handlers" title="8.7.2 mysqlnd_qc_get_available_handlers"><code class="function">mysqlnd_qc_get_available_handlers</code></a>.
        Which storage are available depends on the compile time
        configuration of the query cache plugin. The
        <code class="literal">default</code> storage handler is always available.
        All other storage handler must be enabled explicitly when
        building the extension.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
            <em class="parameter"><code>handler</code></em>
          </span></dt><dd><p>
              Handler can be of type string representing the name of a
              built-in storage handler or an object of type
              <code class="literal">mysqlnd_qc_handler_default</code>. The names
              of the built-in storage handler are
              <code class="literal">default</code>, <code class="literal">APC</code>,
              <code class="literal">MEMCACHE</code>, <code class="literal">sqlite</code>.
</p></dd></dl>
</div>
<p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns <code class="constant">TRUE</code> on success or
        <code class="constant">FALSE</code> on failure.
      </p><p>
        If changing the storage handler fails a catchable fatal error
        will be thrown. The query cache cannot operate if the previous
        storage handler has been shutdown but no new storage handler has
        been installed.
      </p><p>
        <span class="bold"><strong>Examples</strong></span>
</p>
<div class="example">
<a name="idm139660442205024"></a><p class="title"><b>Example 8.25 <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-storage-handler" title="8.7.9 mysqlnd_qc_set_storage_handler"><code class="function">mysqlnd_qc_set_storage_handler</code></a>
example</b></p>
<div class="example-contents">
<p>
          The example shows the output from the built-in default storage
          handler. Other storage handler may report different data.
        </p><pre class="programlisting">

&lt;?php
var_dump(mysqlnd_qc_set_storage_handler("memcache"));

if (true === mysqlnd_qc_set_storage_handler("default"))
  printf("Default storage handler activated");

/* Catchable fatal error */
var_dump(mysqlnd_qc_set_storage_handler("unknown"));
?&gt;

   </pre><p>
          The above examples will output:
        </p><pre class="screen">

bool(true)
Default storage handler activated
Catchable fatal error: mysqlnd_qc_set_storage_handler(): Unknown handler 'unknown' in (file) on line (line)


</pre>
</div>

</div>
<br class="example-break"><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.installation" title="8.5.2 Installation">Installation</a>

          </td></tr><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-available-handlers" title="8.7.2 mysqlnd_qc_get_available_handlers"><code class="function">mysqlnd_qc_get_available_handlers</code></a>

          </td></tr></table><p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-function.mysqlnd-qc-set-user-handlers"></a>8.7.10 <code class="literal">mysqlnd_qc_set_user_handlers</code></h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysqlnd_qc_set_user_handlers</code>
          </p><p>
            Sets the callback functions for a user-defined procedural
            storage handler
</p></li></ul>
</div>
<p>
        <span class="bold"><strong>Description</strong></span>
      </p><code class="methodsynopsis"><span class="type">bool </span><span class="methodname">mysqlnd_qc_set_user_handlers</span>(<span class="methodparam"><span class="type">string </span><span class="parameter">get_hash</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">find_query_in_cache</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">return_to_cache</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">add_query_to_cache_if_not_exists</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">query_is_select</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">update_query_run_time_stats</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">get_stats</span></span>,<br>                                  <span class="methodparam"><span class="type">string </span><span class="parameter">clear_cache</span></span>);</code><p>
        Sets the callback functions for a user-defined procedural
        storage handler.
      </p><p>
        <span class="bold"><strong>Parameters</strong></span>
</p>
<div class="variablelist">
<dl class="variablelist"><dt><span class="term">
            <em class="parameter"><code>get_hash</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">get_hash</code> functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>find_query_in_cache</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">find_in_cache</code> functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>return_to_cache</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">return_to_cache</code> functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>add_query_to_cache_if_not_exists</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">add_query_to_cache_if_not_exists</code>
              functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>query_is_select</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">query_is_select</code> functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>update_query_run_time_stats</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">update_query_run_time_stats</code>
              functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>get_stats</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">get_stats</code> functionality.
            </p></dd><dt><span class="term">
            <em class="parameter"><code>clear_cache</code></em>
          </span></dt><dd><p>
              Name of the user function implementing the storage handler
              <code class="literal">clear_cache</code> functionality.
</p></dd></dl>
</div>
<p>
        <span class="bold"><strong>Return Values</strong></span>
      </p><p>
        Returns TRUE on success or FALSE on FAILURE.
      </p><p>
        <span class="bold"><strong>See Also</strong></span>
      </p><p>
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.set-user-handlers" title="8.4.9 Beyond TTL: user-defined storage">Procedural user-defined storage handler example</a>

          </td></tr></table><p>
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="apis-php-mysqlnd-qc.changes"></a>8.8 Change History</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-two">8.8.1 PECL/mysqlnd_qc 1.2 series</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-one">8.8.2 PECL/mysqlnd_qc 1.1 series</a></span></dt><dt><span class="section"><a href="apis-php-mysqlnd-qc.html#apis-php-mysqlnd-qc.changes-one-o">8.8.3 PECL/mysqlnd_qc 1.0 series</a></span></dt></dl>
</div>
<p>
      <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
      Documentation Group.</a>
    </p><p>
      This change history is a high level summary of selected changes
      that may impact applications and/or break backwards compatibility.
    </p><p>
      See also the <code class="filename">CHANGES</code> file in the source
      distribution for a complete list of changes.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.changes-one-two"></a>8.8.1 PECL/mysqlnd_qc 1.2 series</h3>
</div>
</div>
</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        1.2.0 - alpha

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 03/2013
     </li><li class="listitem">
      Motto/theme: PHP 5.5 compatibility
</li></ul>
</div>
<p>
      </p><p>
        Feature changes

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Update build for PHP 5.5 (Credits: Remi Collet)
            </p></li><li class="listitem"><p>
              APC storage handler update

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
          Fix build for APC 3.1.13-beta and trunk
</li></ul>
</div>
<p>
            </p></li><li class="listitem"><p>
              Introduced
              <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-constant.mysqlnd-qc-version"><code class="constant">MYSQLND_QC_VERSION</code></a>
              and
              <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-constant.mysqlnd-qc-version-id"><code class="constant">MYSQLND_QC_VERSION_ID</code></a>.
</p></li></ul>
</div>
<p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.changes-one-one"></a>8.8.2 PECL/mysqlnd_qc 1.1 series</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        1.1.0 - stable

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 04/2012
     </li><li class="listitem">
      Motto/theme: PHP 5.4 compatibility, schema pattern based caching and mysqlnd_ms support
</li></ul>
</div>
<p>
      </p><p>
        1.1.0 - beta

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 04/2012
     </li><li class="listitem">
      Motto/theme: PHP 5.4 compatibility, schema pattern based caching and mysqlnd_ms support
</li></ul>
</div>
<p>
      </p><p>
        1.1.0 - alpha

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 04/2012
     </li><li class="listitem">
      Motto/theme: PHP 5.4 compatibility, schema pattern based caching and mysqlnd_ms support
</li></ul>
</div>
<p>
      </p><p>
        Feature changes

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              APC storage handler update

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
          Fix build for APC 3.1.9+
         </li><li class="listitem">
          Note: Use of the APC storage handler is currently
          not recommended due to stability issues of APC itself.
</li></ul>
</div>
<p>
            </p></li><li class="listitem"><p>
              New PHP configuration directives

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.collect-statistics-log-file">
          mysqlnd_qc.collect_statistics_log_file</a></code>. Aggregated
          cache statistics log file written after every 10th request served by the
          PHP process.
         </li><li class="listitem"><code class="literal"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-ini.mysqlnd-qc.ignore-sql-comments">
          mysqlnd_qc.ignore_sql_comments</a></code>.
          Control whether SQL comments are ignored for cache key hash generation.
</li></ul>
</div>
<p>
            </p></li><li class="listitem"><p>
              New constants and SQL hints

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-constant.mysqlnd-qc-server-id"><code class="constant">
          MYSQLND_QC_SERVER_ID_SWITCH</code></a> allows grouping of cache entries from
          different physical connections. This is needed by PECL/mysqlnd_ms.
         </li><li class="listitem"><a class="link" href="apis-php-mysqlnd-qc.html#apis-php-constant.mysqlnd-qc-condition-meta-schema-pattern"><code class="constant">MYSQLND_QC_CONDITION_META_SCHEMA_PATTERN</code></a>
          to be used with <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>.
</li></ul>
</div>
<p>
            </p></li><li class="listitem"><p>
              New function
              <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-set-cache-condition" title="8.7.7 mysqlnd_qc_set_cache_condition"><code class="function">mysqlnd_qc_set_cache_condition</code></a>
              for built-in schema pattern based caching. Likely to
              support a wider range of conditions in the future.
            </p></li><li class="listitem"><p>
              Report <code class="literal">valid_until</code> timestamp for cache
              entries of the default handler through
              <a class="link" href="apis-php-mysqlnd-qc.html#apis-php-function.mysqlnd-qc-get-cache-info" title="8.7.3 mysqlnd_qc_get_cache_info"><code class="function">mysqlnd_qc_get_cache_info</code></a>.
            </p></li><li class="listitem"><p>
              Include charset number for cache entry hashing. This
              should prevent serving result sets which have the wrong
              charset.
            </p><p>
              API change: get_hash_key expects new "charsetnr"
              (int) parameter after "port".
            </p></li><li class="listitem"><p>
              API change: changing is_select() signature from bool
              is_select() to mixed is_select(). Mixed can be either
              boolean or array(long ttl, string server_id). This is
              needed by PECL/mysqlnd_ms.
</p></li></ul>
</div>
<p>
      </p><p>
        Other

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Support acting as a cache backend for
              <a class="link" href="apis-php-mysqlnd-ms.html" title="Chapter 7 Mysqlnd replication and load balancing plugin">PECL/mysqlnd_ms</a>
              1.3.0-beta or later to transparently replace MySQL
              Replication slave reads with cache accesses, if the user
              explicitly allows.
</p></li></ul>
</div>
<p>
      </p><p>
        Bug fixes

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Fixed Bug #59959 (config.m4, wrong library - 64bit memcached handler builds) (Credits: Remi Collet)
</li></ul>
</div>
<p>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="apis-php-mysqlnd-qc.changes-one-o"></a>8.8.3 PECL/mysqlnd_qc 1.0 series</h3>

</div>

</div>

</div>
<p>
        <a class="link" href="apis-php-introduction.html#php-api-copyright">Copyright 1997-2014 the PHP
        Documentation Group.</a>
      </p><p>
        1.0.1-stable

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 12/2010
     </li><li class="listitem">
      Motto/theme: Prepared statement support
</li></ul>
</div>
<p>
      </p><p>
        Added support for Prepared statements and unbuffered queries.
      </p><p>
        1.0.0-beta

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
      Release date: 07/2010
     </li><li class="listitem">
      Motto/theme: TTL-based cache with various storage options (Memcache, APC, SQLite, user-defined)
</li></ul>
</div>
<p>
      </p><p>
        Initial public release of the transparent TTL-based query result
        cache. Flexible storage of cached results. Various storage media
        supported.
</p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="apis-php-mysqlnd-ms.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="apis-php-mysqlnd-uh.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 7 Mysqlnd replication and load balancing plugin</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 9 Mysqlnd user handler plugin</td>
</tr>
</table>
</div>
</body>
</html>
