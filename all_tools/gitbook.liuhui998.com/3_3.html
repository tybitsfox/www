<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="content-language" content="en">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<title>Git Book 中文版 - 分支与合并@基础</title>
	<link rel="icon" href="favicon.png" type="image/png">
	<link rel="stylesheet" href="assets/blueprint/screen.css" type="text/css" media="screen, projection">
  <link rel="stylesheet" href="assets/blueprint/print.css" type="text/css" media="print">
  <!--[if IE]><link rel="stylesheet" href="assets/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
	<link rel="stylesheet" href="assets/stylesheets/mac_classic.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" media="screen, projection">
</head>

<body>
<div class="container chapter showgrids">

  <div class="span-21 header">
    <div class="nav"><a href="3_2.html">Prev</a>  <a href="3_4.html">Next</a></div>
    <div class="title"><a href='index.html'>Git Community Book 中文版</a></div>
  </div>
  
  <div class="span-21">
    <br/>
  </div>
  
  <div class="span-21">
    <h2>分支与合并@基础</h2>

<p>一个Git仓库可以维护很多开发分支。现在我们来创建一个新的叫”experimental”的分支：</p>

<pre><code>$ git branch experimental
</code></pre>

<p>如果你运行下面这条命令：</p>

<pre><code>$ git branch
</code></pre>

<p>你会得到当前仓库中存在的所有分支列表：</p>

<pre><code>  experimental
* master
</code></pre>

<p>“experimental” 分支是你刚才创建的，“master”分支是Git系统默认创建的主分支。星号(“*”)标识了你当工作在哪个分支下，输入：</p>

<pre><code>$ git checkout experimental
</code></pre>

<p>切换到”experimental”分支，先编辑里面的一个文件，再提交(commit)改动，最后切换回 “master”分支。</p>

<pre><code>(edit file)
$ git commit -a
$ git checkout master
</code></pre>

<p>你现在可以看一下你原来在“experimental”分支下所作的修改还在不在；因为你现在切换回了“master”分支，所以原来那些修改就不存在了。</p>

<p>你现在可以在“master”分支下再作一些不同的修改:</p>

<pre><code>(edit file)
$ git commit -a
</code></pre>

<p>这时，两个分支就有了各自不同的修改(diverged)；我们可以通过下面的命令来合并“experimental”和“master”两个分支:</p>

<pre><code>$ git merge experimental
</code></pre>

<p>如果这个两个分支间的修改没有冲突(conflict), 那么合并就完成了。如有有冲突，输入下面的命令就可以查看当前有哪些文件产生了冲突:</p>

<pre><code>$ git diff
</code></pre>

<p>当你编辑了有冲突的文件，解决了冲突后就可以提交了：</p>

<pre><code>$ git commit -a
</code></pre>

<p>提交(commit)了合并的内容后就可查看一下:</p>

<pre><code>$ gitk
</code></pre>

<p>执行了gitk后会有一个很漂亮的图形的显示项目的历史。</p>

<p>这时你就可以删除掉你的 “experimental” 分支了(如果愿意)：</p>

<pre><code>$ git branch -d experimental
</code></pre>

<p>git branch -d只能删除那些已经被当前分支的合并的分支. 如果你要强制删除某个分支的话就用git branch –D；下面假设你要强制删除一个叫”crazy-idea”的分支：</p>

<pre><code>$ git branch -D crazy-idea
</code></pre>

<p>分支是很轻量级且容易的，这样就很容易来尝试它。</p>

<h3>如何合并</h3>

<p>你可以用下面的面的命令来合并两个分离的分支：<a href="http://www.kernel.org/pub/software/scm/git/docs/git-merge.html">git merge</a>:</p>

<pre><code>$ git merge branchname
</code></pre>

<p>这个命令把分支"branchname"合并到了当前分支里面。如有冲突(冲突--同一个文件在远程分支和本地分支里按不同的方式被修改了）；那么命令的执行输出就像下面一样</p>

<pre><code>$ git merge next
 100% (4/4) done
Auto-merged file.txt
CONFLICT (content): Merge conflict in file.txt
Automatic merge failed; fix conflicts and then commit the result.
</code></pre>

<p>在有问题的文件上会有冲突标记，在你手动解决完冲突后就可以把此文件添
加到索引(index)中去，用git commit命令来提交，就像平时修改了一个文件
一样。</p>

<p>如果你用gitk来查看commit的结果，你会看到它有两个父分支：一个指向当前
的分支，另外一个指向刚才合并进来的分支。</p>

<h3>解决合并中的冲突</h3>

<p>如果执行自动合并没有成功的话，git会在索引和工作树里设置一个特殊的状态，
提示你如何解决合并中出现的冲突。</p>

<p>有冲突(conflicts)的文件会保存在索引中，除非你解决了问题了并且更新了索引，否则执行 <a href="http://www.kernel.org/pub/software/scm/git/docs/git-commit.html">git commit</a>都会失败:</p>

<pre><code>$ git commit
file.txt: needs merge
</code></pre>

<p>如果执行 <a href="http://www.kernel.org/pub/software/scm/git/docs/git-status.html">git status</a> 会显示这些文件没有合并(unmerged),这些有冲突的文件里面会添加像下面的冲突标识符:</p>

<pre><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:file.txt
Hello world
=======
Goodbye
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 77976da35a11db4580b80ae27e8d65caf5208086:file.txt
</code></pre>

<p>你所需要的做是就是编辑解决冲突，（接着把冲突标识符删掉），再执行下面的命令:</p>

<pre><code>$ git add file.txt
$ git commit
</code></pre>

<p>注意：提交注释里已经有一些关合并的信息了，通常是用这些默认信息，但是你可以添加一些你想要的注释。</p>

<p>上面这些就是你要做一个简单合并所要知道的，但是git提供更多的一些信息来
帮助解决冲突。</p>

<h3>撒销一个合并</h3>

<p>如果你觉得你合并后的状态是一团乱麻，想把当前的修改都放弃，你可以用下面的命令回到合并之前的状态：</p>

<pre><code>$ git reset --hard HEAD
</code></pre>

<p>或者你已经把合并后的代码提交，但还是想把它们撒销：</p>

<pre><code>$ git reset --hard ORIG_HEAD
</code></pre>

<p>但是刚才这条命令在某些情况会很危险，如果你把一个已经被另一个分支合并的分支给删了，那么
以后在合并相关的分支时会出错。</p>

<h3>快速向前合并</h3>

<p>还有一种需要特殊对待的情况，在前面没有提到。通常，一个合并会产生一个合并提交(commit),
把两个父分支里的每一行内容都合并进来。</p>

<p>但是，如果当前的分支和另一个分支没有内容上的差异，就是说当前分支的每一个提交(commit)都已经存在另一个分支里了，git 就会执行一个“快速向前"(fast forward)操作；git 不创建任何新的提交(commit),只是将当前分支指向合并进来的分支。</p>

<p><a href="" title="GitCast #6: Branching and Merging">gitcast:c6-branch-merge</a></p>


  </div>
  
  <div class="span-21">
    <hr/>
    <div class="center"><a href="3_2.html">Prev</a>  <a href="3_4.html">Next</a></div>
    <hr/>
  </div>
  
  <div class="span-17 footer">
  	<div class="menu">
  		This book is maintained by Scott Chacon, and hosting is donated by GitHub.
  		<br>
  		Please email me at <a href="mailto:schacon@gmail.com">schacon@gmail.com</a>
  		with patches, suggestions and comments.<br>
		中文版是由 <a href="http://liuhui998.com">liuhui998.com</a>维护,如果有任何意见建议或发现有bug,请联系我.
	  </div>

  </div>
  <div class="span-4 last center">
    <a href="http://github.com/liuhui998/gitbook"><img src="assets/images/github.png" alt="github logo"></a>
  </div>
  
</div>



<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-82337-12");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script src="http://static.getclicky.com/40584.js" type="text/javascript"></script>
<noscript><p><img alt="Clicky" src="http://in.getclicky.com/40584-db6.gif" /></p></noscript>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6896227-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</script>

<div style="display:none">
<script src="http://s9.cnzz.com/stat.php?id=2459744&web_id=2459744" language="JavaScript"></script>
</div>

</body>
</html>
