<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Chapter 17. MySQL Cluster</title><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="MySQL 5.1 Reference Manual"><link rel="up" href="index.html" title="MySQL 5.1 Reference Manual"><link rel="prev" href="custom-engine.html" title="Chapter 16. Writing a Custom Storage Engine"><link rel="next" href="partitioning.html" title="Chapter 18. Partitioning">
<style>
<!--
span.quote
	{}
 table.MsoNormalTable
	{mso-style-parent:"";
	font-size:10.0pt;
	
	}
 li.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	font-size:12.0pt;
	
	; margin-left:0cm; margin-right:0cm; margin-top:0cm}
-->
</style>
</head><body><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ndbcluster"></a>
	第17章：MySQL簇</h2></div></div></div><div class="toc"><p><b>
	目录</b></p><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-overview">17.1. 
		MySQL簇概述</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-basics">
		17.2. MySQL簇的基本概念</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-computer">
		17.3. 多计算机的简单基础知识</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#multi-hardware-software-network">
			17.3.1. 硬件、软件和联网</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-install">
			17.3.2. 安装</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-config">
			17.3.3. 配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-initial">
			17.3.4. 首次启动</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-load-data-queries">
			17.3.5. 加载示例数据并执行查询</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-shutdown-restart">
			17.3.6. 安全关闭和重启</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-configuration">17.4. 
		MySQL簇的配置</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-building">
			17.4.1. 从源码创建MySQL簇</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-installing">
			17.4.2. 安装软件</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-quick">
			17.4.3. MySQL簇的快速测试设置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-file">17.4.4. 
			配置文件</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-process-management">
		17.5. MySQL簇中的进程管理</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysqld-process">
			17.5.1. 用于MySQL簇的MySQL服务器进程使用</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-process">17.5.2. <span><strong class="command">
			ndbd</strong></span>，存储引擎节点进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-process">17.5.3. <span><strong class="command">
			ndb_mgmd</strong></span>，“管理服务器”进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-process">17.5.4. <span><strong class="command">
			ndb_mgm</strong></span>，“管理客户端”进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-command-options">
			17.5.5. 用于MySQL簇进程的命令选项</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-management">
		17.6. MySQL簇的管理</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-startup-phases">17.6.1. 
			MySQL簇的启动阶段</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mgm-client-commands">
			17.6.2. “管理客户端”中的命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-event-reports">
			17.6.3. MySQL簇中生成的事件报告</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-single-user-mode">
			17.6.4. 单用户模式</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup">
			17.6.5. MySQL簇的联机备份</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-interconnects">
		17.7. 使用与MySQL簇的高速互连</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#sci-sockets">
			17.7.1. 配置MySQL簇以使用SCI套接字</a></span></dt><dt><span class="section"><a href="ndbcluster.html#performance-figures">
			17.7.2. 理解簇互连的影响</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-limitations">
		17.8. MySQL簇的已知限制</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-roadmap">17.9. 
		MySQL簇发展的重要历程</a></span></dt><dd><dl><dt><span class="section"><a href="ndbcluster.html#mysql-5-0-cluster-changes">17.9.1. 
			MySQL 5.0中的MySQL簇变化</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-5-1-cluster-roadmap">
			17.9.2. 关于MySQL簇的MySQL 5.1发展历程</a></span></dt></dl></dd><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-faq">17.10. 
		MySQL簇常见问题解答</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-glossary">17.11. 
		MySQL簇术语表</a></span></dt></dl></div>
	<p><span>MySQL</span>簇是<span>MySQL</span>适合于分布式计算环境的高实用、高冗余版本。它采用了<span><span>NDB</span>簇存储引擎，允许在<span>1</span>个簇中运行多个</span><span>MySQL</span>服务器。在<span>MySQL 
	5.1</span>二进制版本中、以及与最新的<span>Linux</span>版本兼容的<span>RPM</span>中提供了该存储引擎。（注意，要想获得<span>MySQL</span>簇的功能，必须安装<span>mysql-server</span>和<span>mysql-max</span><span> 
	RPM</span>）。</p>
	<p>目前能够运行<span>MySQL</span>簇的操作系统有<span>Linux</span>、<span>Mac 
	OS X</span>和<span>Solaris</span>。（一些用户通报成功地在<span>FreeBSD</span>上运行了<span>MySQL</span>簇，但<span>MySQL 
	AB</span>公司尚未正式支持该特性）。我们正在努力，以便使<span>MySQL</span>簇能运行在<span>MySQL</span>支持的所有操作系统上，包括<span>Windows</span>，而且当支持新的平台时，将更新该页面。</p>
	<p>本章介绍了正在进行的工作，其内容将随着<span>MySQL</span>簇的不断演化而变化。关于<span>MySQL</span>簇的更多信息，请访问<span>MySQL 
	AB</span>公司的网站<span>http://www.mysql.com/products/cluster/</span>。</p>
	<p>或许你也希望使用<span>MySQL AB</span>提供的两种额外资源：</p>
	<p>
	<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	</span></span><span>MySQL</span>簇<span><a target="_top"  href="http://lists.mysql.com/cluster"><span>邮件列表</span></a></span>。</p>
	<p>
	<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	</span></span><span>MySQL</span>用户论坛上的<span><a target="_top"  href="http://forums.mysql.com/list.php?25"><span>簇主题区</span></a></span>。</p>
	<p>关于簇的一些常见问题，请参见<a href="ndbcluster.html#mysql-cluster-faq" title="17.10. MySQL Cluster FAQ">17.10节，“MySQL簇常见问题解答”</a>。如果你是<span>MySQL</span>簇的新手，请阅读我方开发人员区的文章<span><a target="_top"  href="http://dev.mysql.com/tech-resources/articles/mysql-cluster-for-two-servers.html"><span>如何为两个服务器设置</span>MySQL<span>簇</span></a></span>，这会有所帮助。</p>
	<div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-overview"></a>
		17.1.&nbsp;MySQL簇概述</h2></div></div></div>
		<p><em><span>MySQL</span><span>簇</span></em>是一种技术，该技术允许在无共享的系统中部署“内存中”数据库的簇。通过无共享体系结构，系统能够使用廉价的硬件，而且对软硬件无特殊要求。此外，由于每个组件有自己的内存和磁盘，不存在单点故障。</p>
		<p><span>MySQL</span>簇将标准的<span>MySQL</span>服务器与名为<span>NDB</span>的“内存中”簇式存储引擎集成了起来。在我们的文档中，术语<span><span>NDB</span>指的是与存储引擎相关的设置部分，</span>而术语“<span class="quote"><span>MySQL</span>簇</span>”指的是<span>MySQL</span>和<span><span>NDB</span>存储引擎的组合。</span></p>
		<p><span>MySQL</span>簇由一组计算机构成，每台计算机上均运行着多种进程，包括<span>MySQL</span>服务器，<span>NDB</span>簇的数据节点，管理服务器，以及（可能）专门的数据访问程序。关于簇中这些组件的关系，请参见下图：</p>
		<p><img src="images/cluster-components-1.png" alt="MySQL Cluster Components"></p>
		<p>所有这些程序一起构成了<span>MySQL</span>簇。将数据保存到<span>NDB</span>簇存储引擎中时，表将保存在数据节点内。能够从簇中所有其他<span>MySQL</span>服务器直接访问这些表。因此，在将数据保存在簇内的工资表应用程序中，如果某一应用程序更新了<span>1</span>位雇员的工资，所有查询该数据的其他<span>MySQL</span>服务器能立刻发现这种变化。</p>
		<p>对于<span>MySQL</span>簇，保存在数据节点内的数据可被映射，簇能够处理单独数据节点的故障，除了少数事务将因事务状态丢失而被放弃外，不会产生其他影响。由于事务性应用程序能够处理事务失败事宜，因而它不是问题源。</p>
		<p>通过将<span>MySQL</span>簇引入开放源码世界，<span>MySQL</span>为所有需要它的人员提供了具有高可用性、高性能和可缩放性的簇数据管理。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-basics"></a>
		17.2.&nbsp;MySQL簇的基本概念</h2></div></div></div>
		<p><strong><span>NDB</span></strong>是一种“内存中”存储引擎，它具有可用性高和数据一致性好的特点。</p>
		<p>能够使用多种故障切换和负载平衡选项配置<span>NDB</span>存储引擎，但以簇层面上的存储引擎开始最简单。<span>MySQL</span>簇的<span>NDB</span>存储引擎包含完整的数据集，仅取决于簇本身内的其他数据。</p>
		<p>下面，我们介绍了设置由<span>NDB</span>存储引擎和一些<span>MySQL</span>服务器构成的<span>MySQL</span>簇的设置方法。</p>
		<p>目前，<span>MySQL</span>簇的簇部分可独立于<span>MySQL</span>服务器进行配置。在<span>MySQL</span>簇中，簇的每个部分被视为<span>1</span>个节点。</p>
		<p><strong><span>注释：</span></strong>在很多情况下，术语“节点”用于指计算机，但在讨论<span>MySQL</span>簇时，它表示的是进程。在单台计算机上可以有任意数目的节点，为此，我们采用术语<strong><span>簇主机</span></strong>。</p>
		<p>有三类簇节点，在最低的<span>MySQL</span>簇配置中，至少有三个节点，这三类节点分别是：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>管理<span>(<span>MGM</span>)</span>节点：这类节点的作用是管理<span>MySQL</span>簇内的其他节点，如提供配置数据、启动并停止节点、运行备份等。由于这类节点负责管理其他节点的配置，应在启动其他节点之前首先启动这类节点。<span>MGM</span>节点是用命令<strong><span>ndb_mgmd</span></strong>启动的。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>数据节点：</span></strong>这类节点用于保存簇的数据。数据节点的数目与副本的数目相关，是片段的倍数。例如，对于两个副本，每个副本有两个片段，那么就有<span>4</span>个数据节点。没有必要有一个以上的副本。数据节点是用命令<strong><span>ndbd</span></strong>启动的。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>SQL</span><span>节点：</span></strong>这是用来访问簇数据的节点。对于<span>MySQL</span>簇，客户端节点是使用<span>NDB</span>簇存储引擎的传统<span>MySQL</span>服务器。典型情况下，<span>SQL</span>节点是使用命令<strong><span>mysqld
		</span><span>–<span>ndbcluster</span></span></strong>启动的，或将<span><span>ndbcluster</span>添加到<span>my.cnf</span>后使用</span><strong><span>mysqld</span></strong>启动。</p>
		<p>簇配置包括对簇中单独节点的配置，以及设置节点之间的单独通信链路。对于目前设计的<span>MySQL</span>簇，其意图在于，从处理器的能力、内存空间和带宽来讲，存储节点是同质的，此外，为了提供单一的配置点，作为整体，簇的所有配置数据均位于<span>1</span>个配置文件中。</p>
		<p>管理服务器<span>(MGM</span>节点<span>)</span>负责管理簇配置文件和簇日志。簇中的每个节点从管理服务器检索配置数据，并请求确定管理服务器所在位置的方式。当数据节点内出现有趣的事件时，节点将关于这类事件的信息传输到管理服务器，然后，将这类信息写入簇日志。</p>
		<p>此外，可以有任意数目的簇客户端进程或应用程序。它们分为两种类型：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>标准<span>MySQL</span>客户端：</span></strong>对于<span>MySQL</span>簇，它们与标准的（非簇类）<span>MySQL</span>没有区别。换句话讲，能够从用<span>PHP</span>、<span>Perl</span>、<span>C</span>、<span>C++</span>、<span>Java</span>、<span>Python</span>、<span>Ruby</span>等编写的现有<span>MySQL</span>应用程序访问<span>MySQL</span>簇。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>管理客户端</span></strong>：这类客户端与管理服务器相连，并提供了优雅地启动和停止节点、启动和停止消息跟踪（仅对调试版本）、显示节点版本和状态、启动和停止备份等的命令。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="multi-computer"></a>
		17.3.&nbsp;多计算机的简单基础知识</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#multi-hardware-software-network">
			17.3.1. 硬件、软件和联网</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-install">
			17.3.2. 安装</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-config">
			17.3.3. 配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-initial">
			17.3.4. 首次启动</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-load-data-queries">
			17.3.5. 加载示例数据并执行查询</a></span></dt><dt><span class="section"><a href="ndbcluster.html#multi-shutdown-restart">
			17.3.6. 安全关闭和重启</a></span></dt></dl></div>
		<p>本节介绍了如何规划、安装、配置和运行<span>MySQL</span>簇的基本知识。与<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>中给出的示例不同，按照下面介绍的步骤和指南，所得的结果应是有用的<span>MySQL</span>簇，它满足对数据可用性和安全防护的最低要求。</p>
		<p>在本节中，我们介绍了下述内容：硬件和软件要求，联网事宜，<span>MySQL</span>簇的安装，配置事宜，簇的启动、停止和重启，加载样本数据库，以及执行查询的方法。</p>
		<p><strong><span>基本假定</span></strong> </p>
		<p>本节作了如下假定：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>我们将建立具有<span>4</span>个节点的簇，每个节点位于不同的主机上，而且在典型的以太网中具有固定的网络地址，如下所述：</p>
		<table border="1" cellpadding="0" id="table1">
			<tr>
				<td>
				<p><strong><span>节点</span></strong></td>
				<td>
				<p><strong>
				<span>IP</span><span>地址</span></strong></td>
			</tr>
			<tr>
				<td>
				<p>管理<span>(MGM)</span>节点</td>
				<td>
				<p><span>192.168.0.10</span></td>
			</tr>
			<tr>
				<td>
				<p><span>MySQL</span>服务器<span>(SQL)</span>节点</td>
				<td>
				<p><span>192.168.0.20</span></td>
			</tr>
			<tr>
				<td>
				<p>数据<span>(NDBD)</span>节点<span>&quot;A&quot;</span></td>
				<td>
				<p><span>192.168.0.30</span></td>
			</tr>
			<tr>
				<td>
				<p>数据<span>(NDBD)</span>节点<span>&quot;B&quot;</span></td>
				<td>
				<p><span>192.168.0.40</span></td>
			</tr>
		</table>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>通过下图可更清楚的表明这点：</p>
		<ol start="3" type="1">
			<li><span><img src="images/multi-comp-1.png" alt="MySQL Cluster Multi-Computer
            Setup"></span></li>
		</ol>
		<p>
		<span>4.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>注释：</span></strong>出于简单性（以及可靠性）方面的考虑，在本基本知识介绍中我们仅使用数值<span>IP</span>地址。但是，如果在你的网络中具备<span>DNS</span>解析功能，在配置簇的过程中，可使用主机名代替<span>IP</span>地址。作为可选方式，也能使用<span><span>/etc/hosts</span>文件，或能提供主机查询的操作系统的等效物（如果可用的话）。</span></p>
		<p><span>
		5.<span>&nbsp;&nbsp;&nbsp; </span>
		</span>在我们的场景中，每台主机均是基于<span>Intel</span>的桌面<span>PC</span>，<span>PC</span>上运行的是常见的一般性<span>Linux</span>版本，操作系统以标准配置安装在磁盘上，未运行任何不必要的服务。具备标准<span>TCP/IP</span>联网客户端的核心操作系统应足以符合我们的要求。此外，为了简单性，我们还假定所有主机上的文件系统是等同的。如果这些主机上的文件系统不同，就需对这些说明作相应的调整。</p>
		<p><span>6.<span>&nbsp;&nbsp;&nbsp;
		</span></span>在每台机器上安装了标准的<span>100 Mbps</span>或<span>1</span>吉比特以太网卡，为每块网卡安装了恰当的驱动程序，并用标准的以太网联网装置（如交换器等）将<span>4</span>台主机连接起来（所有机器应使用具有相同容量的网卡，也就是说，簇中的所有<span>4</span>台机器应全部使用<span>100M</span>网卡，或全部使用<span>1G</span>网卡）。<span>MySQL</span>簇将工作在<span>100 
		Mbps</span>网络中，但吉比特以太网能提供更好的性能。</p>
		<p>注意，<span>MySQL</span>簇不适合于连通性低于<span>100 
		Mbps</span>的网络。出于该原因（尤其是），在公共网络如<span>Internet</span>上运行<span>MySQL</span>簇很难成功，也不推荐这样做。</p>
		<p><span>7.<span>&nbsp;&nbsp;&nbsp;
		</span></span>对于样本数据，我们将使用世界数据库，该数据库可从<span>MySQL AB</span>公司的网站上下载。由于该数据库占用的空间相对较小，我们假定每台机器有<span>256 
		MB RAM</span>，这足以运行操作系统、主机<span>NDB</span>进程、以及存储数据库（对于数据节点）。</p>
		<p>尽管在本基本介绍中采用的是<span>Linux</span>操作系统，但对这里给出的说明和步骤来说，仅过简单的修改，也能适用于<span>Solaris</span>或<span>Mac 
		OS X</span>。此外，我们还假定你已掌握了安装和配置具备联网功能的操作系统的基本知识，或能够在需要的时候获得帮助。</p>
		<p>下一节，我们更详细地讨论了<span>MySQL</span>簇的硬件、软件和联网要求。（请参见<a href="ndbcluster.html#multi-hardware-software-network" title="17.3.1. Hardware, Software, and Networking">17.3.1节，“硬件、软件和联网”</a>）。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-hardware-software-network"></a>
			17.3.1.&nbsp;硬件、软件和联网</h3></div></div></div>
			<p><span>MySQL</span>簇的一个强大优点在于，它能运行在普通硬件上，除了需要较大的<span>RAM</span>外在这点上没有特殊要求，这是因为实际的数据存储均是在内存中进行的。（注意，未来这点会改变，我们打算在未来的<span>MySQL</span>簇版本中实现基于磁盘的存储）。显然，多个<span>CPU</span>和更快的<span>CPU</span>能增强性能。对于簇进程来说，对内存的要求相对较少。</p>
			<p>簇的软件要求程度适中。主机操作系统不需要任何特殊模块、服务、应用程序、或配置就能支持<span>MySQL</span>簇。对于<span>Mac 
			OS X</span>或<span>Solaris</span>，标准安装就已足够。对于<span>Linux</span>，标准的“<span class="quote">即开即用</span>”安装应是所需的全部。<span>MySQL</span>软件要求很简单：<span>MySQL-max 
			5.1</span>的生产版就是所需的全部，要想获得簇支持，必须使用<span>MySQL</span>的<span><span>-max</span>版本</span>。无需自己编译<span>MySQL</span>就能使用簇。在本节中，我们假定你使用了与<span>Linux</span>相适应的<span><span>-max</span>二进制版本。对于</span><span>Solaris</span>或<span>Mac 
			OS X</span>操作系统，相应的部分可通过<span>MySQL</span>软件下载页面获得，<span><a target="_top"  href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a></span>。</p>
			<p>对于节点之间的通信，簇支持采用标准拓扑方案的<span>TCP/IP</span>联网，对于每台主机的预期最低要求是<span>1</span>块标准的<span>100 
			Mbps</span>以太网卡，对于作为整体的簇，还需加上交换器、网络集线器或路由器以提供网络连通性。我们强烈建议，应在其自己的子网内运行<span>MySQL</span>簇，不与非簇机器共享该子网，原因如下：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>安全性：</span></strong>簇节点之间的通信未采用任何特殊加密或防护。对<span>MySQL</span>簇内传输的唯一保护方法是，在受保护的网络上运行簇。如果打算将<span>MySQL</span>簇用于<span>Web</span>应用，簇应明确地位于防火墙后面，而且不应位于网络的非军事区（<span><a target="_top"  href="http://compnetworking.about.com/cs/networksecurity/g/bldef_dmz.htm">DMZ</a></span>）或其他地方。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>效率：</span></strong>在专有的或受保护的网络上设置<span>MySQL</span>簇，这样，簇就能独享簇主机之间的带宽。为<span>MySQL</span>簇使用单独的交换器不仅能防止对簇数据的非法访问，而且还能确保簇节点不受网络上其他计算机之间信息传输的干扰。为了增强可靠性，可以使用双交换器和双卡，以防止网络出现单点故障，对于这类通信链路，很多设备驱动均支持故障切换功能。</p>
			<span>也能与<span>MySQL</span>簇一起使用高速<span>SCI</span>（规模可扩展的计算机接口），但这不是要求的。关于该协议的更多信息，以及它与<span>MySQL</span>簇的用法，请参见</span><a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7节，“使用与MySQL簇的高速互连”</a>
        </div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-install"></a>
			17.3.2.&nbsp;安装</h3></div></div></div>
			<p>对于每台运行存储或<span>SQL</span>节点的<span>MySQL</span>簇主机计算机，必须在其上安装<span>MySQL-max</span>二进制版本。对于管理节点，没有必要安装<span>MySQL</span>服务器二进制版本，但应安装<span>MGM</span>服务器端口监督程序和客户端二进制版本（分别是<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>）。在本节中，我们介绍了为每种簇节点安装正确的二进制版本所需的步骤。</p>
			<p><span>MySQL AB</span>提供了预编译的二进制文件，它们支持簇，你不需要自己编译这些文件（如果你确实需要定制的二进制文件，请参见<a href="installing.html#installing-source-tree" title="2.8.3. Installing from the Development Source Tree">2.8.3节，“从开发源码树安装”</a>）。因此，对于每台簇主机，安装进程的第一步是从<span><a target="_top"  href="http://dev.mysql.com/downloads/">MySQL<span>下载区</span></a></span>下载文件<span>mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz</span>。我们假定你将该文件放在各机器的<span>/var/tmp</span>目录下。</p>
			<p>对于<span>32</span>位和<span>64</span>位<span>Linux</span>平台，均有相应的<span>RPM</span>，<span>RPM</span>安装的<span><span>-max</span>二进制文件支持<span>NDB</span>簇存储引擎。如果你选择使用它们而不是二进制文件，务必在运行簇节点的所有机器上安装<span>-server</span>和<span>-max</span>软件包</span>（关于使用<span>RPM</span>安装<span>MySQL</span>的更多信息，请参见<a href="installing.html#linux-rpm" title="2.4. Installing MySQL on Linux">2.4节，“在Linux下安装MySQL”</a>）。使用<span>RPM</span>完成安装后，仍需对簇进行配置，请参见<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3节，“配置”</a>。</p>
			<p><strong><span>注释：</span></strong>完成安装后，不启动任何二进制文件。配置完所有节点后，我们将向你介绍执行这类操作的方法。</p>
			<p><strong><span>存储节点和<span>SQL</span>节点安装</span></strong></p>
			<p>在设计为运行存储节点或<span>SQL</span>节点的三台机器的每一台上，以系统根用户身份执行下述步骤：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>检查你的<span>/etc/passwd</span>和<span>/etc/group</span>文件（或使用操作系统提供的用于管理用户和组的工具），查看在系统上是否已存在<span><span>mysql</span>组</span>和<span>mysql</span>用户，这是因为某些操作系统会将其作为安装进程的一部分予以创建。如果它们不存在，创建新的<span><span>mysql</span>用户组</span>，然后为该组添加<span>1</span>个<span>mysql</span>用户。</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>groupadd mysql</span></pre>
			<pre><span>3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>useradd -g mysql mysql</span></pre>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>进入包含下载文件的目录，解包档案文件，并创建与<span>mysql-max</span>可执行文件的<span>symlink</span>。注意，根据<span>MySQL</span>的版本号，实际的文件名和目录名会有所不同。</p>
			<pre><span>5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /var/tmp</span></pre>
			<pre><span>6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tar -xzvf -C /usr/local/bin mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz</span></pre>
			<pre><span>7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ln -s /usr/local/bin/mysql-max-5.1.2-alpha-pc-linux-gnu-i686 mysql</span></pre>
			<p>
			<span>8.<span>&nbsp;&nbsp;&nbsp;
			</span></span>进入<span><span>mysql</span>目录，</span>运行所提供的用于创建系统数据库的脚本：</p>
			<pre><span>9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd mysql</span></pre>
			<pre><span>10.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>scripts/mysql_install_db --user=mysql</span></pre>
			<p>
			<span>11.</span>为<span>MySQL</span>服务器和数据目录设置必要的权限：</p>
			<pre><span>12.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chown -R root .</span></pre>
			<pre><span>13.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chown -R mysql data</span></pre>
			<pre><span>14.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chgrp -R mysql .</span></pre>
			<p>注意，在每台运行数据节点的机器上，数据目录是<span><span>/usr/local/mysql/data</span>。配置管理节点时将用到这类信息</span>（请参见<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3节，“配置”</a>）。</p>
			<p>
			<span>15.</span>将<span>MySQL</span>启动脚本拷贝到恰当的目录下，使之成为可执行的脚本，并设置它以便在启动操作系统时启动：</p>
			<pre><span>16.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cp support-files/mysql.server /etc/rc.d/init.d/</span></pre>
			<pre><span>17.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chmod +x /etc/rc.d/init.d/mysql.server</span></pre>
			<pre><span>18.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chkconfig --add mysql.server</span></pre>
			<p>在此，我们使用<span>Red Hat</span>的<strong><span>chkconfig</span></strong>来创建与启动脚本的链接，请在你的操作系统上使用恰当的用于该目的的方式，如<span>Debian</span>上的<strong><span>update-rc.d</span><span>。</span></strong></p>
			<p>请记住，对于存储节点或<span>SQL</span>节点所在的每台机器，必须分别指向上述步骤。</p>
			<p><strong><span>管理节点安装</span></strong></p>
			<p>对于<span>MGM</span>（管理）节点，不需要安装<strong><span>mysqld</span></strong>可执行文件，仅需安装用于<span>MGM</span>服务器和客户端的二进制文件，这类文件可在下载的<span><span>-max</span>档案中找到。再次假定你将该文件放在了<span>/var/tmp</span>目录下，引导系统时</span>（也就是说使用<strong><span>sudo</span></strong><span>,
			<strong><span>su root</span></strong></span>或系统的等效命令后，假定具有系统管理员账户的权限），执行下述步骤，在簇管理节点主机上安装<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>即如<span>/var/tmp</span>目录，从档案文件中将<strong><span>ndb_mgm</span></strong>和<strong><span>ndb_mgmd</span></strong>提取到恰当的目录下，如<span>/usr/local/bin</span>：</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /var/tmp</span></pre>
			<pre><span>3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>tar -zxvf mysql-max-5.1.2-alpha-pc-linux-gnu-i686.tar.gz /usr/local/bin &#39;*/bin/ndb_mgm*&#39;</span></pre>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>进入解包文件所在的目录，然后使这两个文件成为可执行的：</p>
			<pre><span>5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cd /usr/local/bin</span></pre>
			<pre><span>6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>chmod +x ndb_mgm*</span></pre>
			<p>在<a href="ndbcluster.html#multi-config" title="17.3.3. Configuration">17.3.3节，“配置”</a>中，我们将为示例簇中的所有节点创建和编写配置文件。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-config"></a>
			17.3.3.&nbsp;配置</h3></div></div></div>
			<p>对于我们的<span>4</span>节点、<span>4</span>主机<span>MySQL</span>簇，需要编写<span>4</span>个配置文件，每个节点<span>/</span>主机<span>1</span>个。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>每个数据节点或<span>SQl</span>节点需要<span>1</span>个<span><span>my.cnf</span>文件，该文件提供了两类信息</span>：<strong><span>connectstring</span></strong>（连接字符串），用于通知节点到哪里找到<span>MGM</span>节点；以及一行，用于通知该主机（容纳数据节点的机器）上的<span>MySQL</span>服务器运行在<span>NDB</span>模式下。</p>
			<p>关于连接字符串的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2节，“MySQL簇连接字符串<code class="literal"></code>”</a>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>管理节点需要<span><span>config.ini</span>文件，</span>该文件通知节点有多少需要维护的副本，需要在每个数据节点上为数据和索引分配多少内存，数据节点的位置，在每个数据节点上保存数据的磁盘位置，以及<span>SQL</span>节点的位置。</p>
			<p><strong><span>配置存储节点和<span>SQL</span>节点</span></strong></p>
			<p>数据节点所需的<span><span>my.cnf</span>文件相当简单。配置文件应位于<span>/etc</span>目录下，并能用任何文本编辑器进行编辑（如有必要，创建该文件），例如：</span></p>
			<pre><span>vi /etc/my.cnf</span></pre>
			<p>对于本示例中的每个数据节点和<span>SQL</span>节点，<span><span>my.cnf</span>文件类似于：</span></p>
			<pre><span># Options for mysqld process:</span></pre>
			<pre><span>[MYSQLD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>ndbcluster&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # run NDB engine</span></pre>
			<pre><span>ndb-connectstring=192.168.0.10&nbsp; # location of MGM node</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for ndbd process:</span></pre>
			<pre><span>[MYSQL_CLUSTER]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>ndb-connectstring=192.168.0.10&nbsp; # location of MGM node</span></pre>
			<p>输入上述内容后，保存文件并退出文本编辑器。在容纳数据节点“<span>A</span>”、数据节点“<span>B</span>”和<span>SQL</span>节点的机器上分别执行上述操作。</p>
			<p><strong><span>配置管理节点</span></strong></p>
			<p>配置<span>MGM</span>节点的第一步是创建目录，该目录用于存放配置文件，然后创建配置文件本身。例如（以根用户身份运行）：</p>
			<pre><span>mkdir /var/lib/mysql-cluster</span></pre>
			<pre><span>cd /var/lib/mysql-cluster</span></pre>
			<pre><span>vi config.ini</span></pre>
			<p>在此使用了<span>vi</span>来创建文件，不过，任何文本编辑器均应能胜任。</p>
			<p>对于我们的典型设置，<span><span>config.ini</span>文件应类似于：</span></p>
			<pre><span># Options affecting ndbd processes on all data nodes:</span></pre>
			<pre><span>[NDBD DEFAULT]&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>NoOfReplicas=2&nbsp;&nbsp;&nbsp; # Number of replicas</span></pre>
			<pre><span>DataMemory=80M&nbsp;&nbsp; &nbsp;# How much memory to allocate for data storage</span></pre>
			<pre><span>IndexMemory=18M&nbsp;&nbsp; # How much memory to allocate for index storage</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # For DataMemory and IndexMemory, we have used the</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # default values. Since the &quot;world&quot; database takes up</span></pre>
			<pre><span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# only about 500KB, this should be more than enough for</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # this example Cluster setup.</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># TCP/IP options:</span></pre>
			<pre><span>[TCP DEFAULT]&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>portnumber=2202&nbsp;&nbsp; # This the default; however, you can use any</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # port that is free for all the hosts in cluster</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Note: It is recommended beginning with MySQL 5.0 that</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # you do not specify the portnumber at all and simply allow</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # the default value to be used instead</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Management process options:</span></pre>
			<pre><span>[NDB_MGMD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address of MGM node</span></pre>
			<pre><span>datadir=/var/lib/mysql-cluster&nbsp; # Directory for MGM node logfiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for data node &quot;A&quot;:</span></pre>
			<pre><span>[NDBD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (one [NDBD] section per data node)</span></pre>
			<pre><span>hostname=192.168.0.30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>datadir=/usr/local/mysql/data&nbsp;&nbsp; # Directory for this data node&#39;s datafiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Options for data node &quot;B&quot;:</span></pre>
			<pre><span>[NDBD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>datadir=/usr/local/mysql/data&nbsp;&nbsp; # Directory for this data node&#39;s datafiles</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># SQL node options:</span></pre>
			<pre><span>[MYSQLD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
			<pre><span>hostname=192.168.0.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Hostname or IP address</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (additional mysqld connections can be</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # specified for this node for various</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # purposes such as running ndb_restore)</span></pre>
			<p>（<strong><span>注释：</span></strong><span>&quot;world&quot;</span>数据库可从站点<span><a target="_top"  href="http://dev.mysql.com/doc/">http://dev.mysql.com/doc/</a></span>下载，它列在“示例”栏目下）。</p>
			<p>一旦创建了所有的配置文件并指定了这些最低选项，可启动簇，并验证所有进程均能正常运行。关于这方面的讨论，请参见<a href="ndbcluster.html#multi-initial" title="17.3.4. Initial Startup">17.3.4节，“首次启动”</a>。</p>
			<p>关于可用<span>MySQL</span>簇配置参数以及其用法的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4节，“配置文件”</a>和<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>。关于与进行备份有关的<span>MySQL</span>簇配置，请参见<a href="ndbcluster.html#mysql-cluster-backup-configuration" title="17.6.5.4. Configuration for Cluster Backup">17.6.5.4节，“簇备份的配置”</a>。</p>
			<p><strong><span>注释：</span></strong>簇管理节点的默认端口是<span>1186</span>，数据节点的默认端口<span>2202</span>。从<span>MySQL 
			5.0.3</span>开始，该限制已被放宽，簇能够根据空闲的端口自动地为数据节点分配端口。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-initial"></a>
			17.3.4.&nbsp;首次启动</h3></div></div></div>
			<p>
			完成配置后，启动簇并不很困难。必须在数据节点所在的主机上分别启动每个簇节点进程。尽管能够按任何顺序启动节点，但我们建议，应首先启动管理节点，然后启动存储节点，最后启动<span>SQL</span>节点：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>在管理主机上，从系统<span>shell</span>发出下述命令以启动<span>MGM</span>节点进程：</p>
			<pre><span>2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>shell&gt; <span><b>ndb_mgmd -f /var/lib/mysql-cluster/config.ini</b></span></span></pre>
			<p>注意，必须用“<span><span>-f”</span>或</span>“<span><span>--config-file”</span>选项，</span>告诉<strong><span>ndb_mgmd</span></strong>到哪里找到配置文件（详情请参见<a href="ndbcluster.html#ndb-mgmd-process" title="17.5.3. ndb_mgmd, the Management Server Process">17.5.3节，“<span><strong class="command">ndb_mgmd</strong></span>，“管理服务器”进程”</a>）。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>在每台数据节点主机上，对于首次启动，运行下述命令启动<span>NDBD</span>进程：</p>
			<pre><span>4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>shell&gt; <span><b>ndbd --initial</b></span></span></pre>
			<p>注意，仅应在首次启动<strong><span>ndbd</span></strong>时，或在备份／恢复或配置变化后重启<strong><span>ndbd</span></strong>时使用“<span>--initial</span>”参数，这很重要。原因在于，该参数会使节点删除由早期<strong><span>ndbd</span><span>实例</span></strong>创建的、用于恢复的任何文件，包括恢复用日志文件。</p>
			<p>
			<span>5.<span>&nbsp;&nbsp;&nbsp;
			</span></span>如果使用<span>RPM</span>在<span>SQL</span>节点所在的簇主机上安装了<span>MySQL</span>，能够（也应当）使用安装在<span><span>/etc/init.d</span>下的启动脚本在<span>SQL</span>节点上启动</span><span>MySQL</span>服务器进程。注意，要想运行“<span>-max</span>”服务器二进制文件，除了标准的<span>RPM</span>外，还需要安装<span>-max</span>服务器<span>RPM</span>。</p>
			<p>如果一切顺利，并已正确设置了簇，那么簇现在应能运行。通过调用<strong><span>ndb_mgm</span></strong>管理节点客户端，可对其进行测试。其输出应类似于：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm</b></span></span></pre>
			<pre><span>-- NDB Cluster -- Management Client --</span></pre>
			<pre><span>ndb_mgm&gt; SHOW</span></pre>
			<pre><span>Connected to Management Server at: localhost:1186</span></pre>
			<pre><span>Cluster Configuration</span></pre>
			<pre><span>---------------------</span></pre>
			<pre><span>[ndbd(NDB)]&nbsp;&nbsp;&nbsp;&nbsp; 2 node(s)</span></pre>
			<pre><span>id=2&nbsp;&nbsp;&nbsp; @192.168.0.30&nbsp; (Version: 5.1.2-alpha, Nodegroup: 0, Master)</span></pre>
			<pre><span>id=3&nbsp;&nbsp;&nbsp; @192.168.0.40&nbsp; (Version: 5.1.2-alpha, Nodegroup: 0)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[ndb_mgmd(MGM)] 1 node(s)</span></pre>
			<pre><span>id=1&nbsp;&nbsp;&nbsp; @192.168.0.10&nbsp; (Version: 5.1.2-alpha)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[mysqld(SQL)]&nbsp;&nbsp; 1 node(s)</span></pre>
			<pre><span>id=4&nbsp;&nbsp; (Version: 5.1.2-alpha)</span></pre>
			<p>具体的输出内容可能会略有不同，这取决于你所使用的<span>MySQL</span>版本。</p>
			<p><strong><span>注释：</span></strong>如果你正在使用较早的<span>MySQL</span>版本，你或许会看到引用为‘<span>[mysqld(API)]</span>’的<span>SQL</span>节点。这是一种早期的用法，现已放弃。</p>
			<p>现在，应能在<span>MySQL</span>簇中处理数据库，表和数据。关于这方面的简要讨论，请参见<a href="ndbcluster.html#multi-load-data-queries" title="17.3.5. Loading Sample Data and Performing Queries">17.3.5节，“加载示例数据并执行查询”</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-load-data-queries"></a>
			17.3.5.&nbsp;加载示例数据并执行查询</h3></div></div></div>
			<p>与没有使用簇的<span>MySQL</span>相比，在<span>MySQL</span>簇内操作数据的方式没有太大的区别。执行这类操作时应记住两点：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>表必须用<span>ENGINE=NDB</span>或<span><span>ENGINE=NDBCLUSTER</span>选项创建，或用<span>ALTER 
			TABLE</span>选项更改，以使用</span><span>NDB</span>簇存储引擎在簇内复制它们。如果使用<strong><span>mysqldump</span></strong>的输出从已有数据库导入表，可在文本编辑器中打开<span>SQL</span>脚本，并将该选项添加到任何表创建语句，或用这类选项之一替换任何已有的<span>ENGINE</span>（或<span><span>TYPE</span>）选项。</span>例如，假定在另一个<span>MySQL</span>服务器（不支持<span>MySQL</span>簇）上有样本世界数据库，而且你打算导出城市表的定义：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>mysqldump --add-drop-table world City &gt; city_table.sql</b></span></span></pre>
			<p>在所得的<span>city_table.sql</span>文件中，将包含这条表创建语句（以及导入表数据所需的<span><span>INSERT</span>语句）：</span></p>
			<pre><span>DROP TABLE IF EXISTS City;</span></pre>
			<pre><span>CREATE TABLE City (</span></pre>
			<pre><span>ID int(11) NOT NULL auto_increment,</span></pre>
			<pre><span>Name char(35) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>CountryCode char(3) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>District char(20) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>Population int(11) NOT NULL default &#39;0&#39;,</span></pre>
			<pre><span>PRIMARY KEY&nbsp; (ID)</span></pre>
			<pre><span>) ENGINE=MyISAM;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>INSERT INTO City VALUES (1,&#39;Kabul&#39;,&#39;AFG&#39;,&#39;Kabol&#39;,1780000);</span></pre>
			<pre><span>INSERT INTO City VALUES (2,&#39;Qandahar&#39;,&#39;AFG&#39;,&#39;Qandahar&#39;,237500);</span></pre>
			<pre><span>INSERT INTO City VALUES (3,&#39;Herat&#39;,&#39;AFG&#39;,&#39;Herat&#39;,186800);</span></pre>
			<pre><span># (remaining INSERT statements omitted)</span></pre>
			<p>需要确认<span>MySQL</span>为该表使用了<span>NDB</span>存储引擎。有两种完成该任务的方法。其中一种方法是，在将表导入簇数据库之前更改其定义，使其类似于（仍使用“城市”作为示例）：</p>
			<pre><span>DROP TABLE IF EXISTS City;</span></pre>
			<pre><span>CREATE TABLE City (</span></pre>
			<pre><span>ID int(11) NOT NULL auto_increment,</span></pre>
			<pre><span>Name char(35) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>CountryCode char(3) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>District char(20) NOT NULL default &#39;&#39;,</span></pre>
			<pre><span>Population int(11) NOT NULL default &#39;0&#39;,</span></pre>
			<pre><span>PRIMARY KEY&nbsp; (ID)</span></pre>
			<pre><span>) ENGINE=NDBCLUSTER;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>INSERT INTO City VALUES (1,&#39;Kabul&#39;,&#39;AFG&#39;,&#39;Kabol&#39;,1780000);</span></pre>
			<pre><span>INSERT INTO City VALUES (2,&#39;Qandahar&#39;,&#39;AFG&#39;,&#39;Qandahar&#39;,237500);</span></pre>
			<pre><span>INSERT INTO City VALUES (3,&#39;Herat&#39;,&#39;AFG&#39;,&#39;Herat&#39;,186800);</span></pre>
			<pre><span># (etc.)</span></pre>
			<p>
			对于将成为簇数据库组成部份的每个表，均需要为其定义执行上述操作。完成该任务的最简单方法是，简单地在<span><span>world.sql</span>文件上执行<span>“</span>查找<span>-</span>替换<span>”</span>，并用<span>ENGINE=NDBCLUSTER</span>替换所有的<span>TYPE=MyISAM</span>实例。如果你不打算更改该文件，也可使用<span>ALTER 
			TABLE</span>。详情请参见下面的介绍。</span></p>
			<p>假定你已在簇的<span>SQL</span>节点上创建了名为“<span>world</span>”的数据库，随后可使用<strong><span>mysql</span></strong>命令行客户端读取<span>city_table.sql</span>，并按通常方式创建和填充对应的表：</p>
			<pre><span>shell&gt; <span><b>mysql world &lt; city_table.sql</b></span></span></pre>
			<p>请记住，上述命令必须在运行<span>SQL</span>节点的主机上执行，这点十分重要。对于本例，应在<span>IP</span>地址为<strong><span>192.168.0.20</span></strong>的机器上执行。</p>
			<p>要想在<span>SQL</span>节点上创建世界数据库的副本，请将文件保存到<span>/usr/local/mysql/data</span>，然后运行：</p>
			<pre><span>shell&gt; <span><b>cd /usr/local/mysql/data</b></span></span></pre>
			<pre><span>shell&gt; <span><b>mysql world &lt; world.sql</b></span></span></pre>
			<p>当然，<span>SQL</span>脚本必须能被<span><span>mysql</span>系统用户读取。</span>如果将文件保存到了不同的目录下，请作相应的调整。</p>
			<p>注意，在<span>MySQL 5.1</span>中，<span>NDB</span>簇不支持自动发现数据库的功能，这点很重要（请参见<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8节，“MySQL簇的已知限制”</a>）。这意味着，一旦在一个数据节点上创建了世界（<span>world</span>）数据库和它的表，在簇中的每个<span>SQL</span>节点上还需要发出命令<strong><span>CREATE 
			DATABASE world</span></strong>（从<span>MySQL 5.0.2</span>开始，可以使用<strong><span>CREATE 
			SCHEMA world</span><span>取而代之），</span></strong>后跟<strong><span>FLUSH 
			TABLES</span><span>。这样，节点就能识别数据库并读取</span></strong>其表定义。</p>
			<p>在<span>SQL</span>节点上运行<strong><span>SELECT</span></strong>查询与在<span>MySQL</span>服务器的任何其他实例上运行查询没有区别。要想从命令行运行查询，首先应按照通常方式登录到<span>MySQL</span>监视器：</p>
			<pre><span>shell&gt; <span><b>mysql -u root -p</b></span></span></pre>
			<pre><span>Enter password:</span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>键入’<span>help;</span>’或’<span>\h</span>’获取帮助。键入’<span>\c</span>’清空缓冲区。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt;</span></pre>
			<p>如果在导入<span>MySQL</span>脚本之前未更改表定义中的<span><span>ENGINE=</span>子句，应在此时运行</span>下述命令：</p>
			<pre><span>mysql&gt; <span><b>USE world;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE City ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE Country ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>ALTER TABLE CountryLanguage ENGINE=NDBCLUSTER;</b></span></span></pre>
			<p>注意，在这里我们简单地使用了<span>MySQL</span>服务器密码为空的默认根用户账户。当然，在生产设置下，安装<span>MySQL</span>服务器时，总应遵守标准的安全方法措施，包括设置牢靠的根用户密码，并为用户创建具有完成任务所需的权限的用户账户。关于这方面的更多信息，请参见<a href="database-administration.html#privilege-system" title="5.7. The MySQL Access Privilege System">5.7节，“MySQL访问权限系统”</a>。</p>
			<p>需要关注的是，当簇节点彼此访问时不使用<span>MySQL</span>的权限系统，设置或更改<span>MySQL</span>用户账户（包括根用户账户）不影响节点之间的交互，它们仅对访问<span>SQL</span>节点的应用程序有效。</p>
			<p>能够以通常的方式选择数据库，并对表执行<span>SELECT</span>查询，就像退出<span>MySQL</span>监视器一样：</p>
			<pre><span>mysql&gt; <span><b>USE world;</b></span></span></pre>
			<pre><span>mysql&gt; <span><b>SELECT Name, Population FROM City ORDER BY Population DESC LIMIT 5;</b></span></span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>| </span>名称<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </span>人口<span> |</span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>| </span>孟买<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 10500000 |</span></pre>
			<pre><span>| </span>汉城<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9981619 |</span></pre>
			<pre><span>| </span>圣保罗<span>&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9968485 |</span></pre>
			<pre><span>| </span>上海<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9696300 |</span></pre>
			<pre><span>| </span>雅加达<span>&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; 9604900 |</span></pre>
			<pre><span>+-----------+------------+</span></pre>
			<pre><span>5 rows in set (0.34 sec)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>\q</b></span></span></pre>
			<pre><span>Bye</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>shell&gt;</span></pre>
			<p>使用<span>MySQL</span>的应用程序能够使用标准的<span>API</span>。重要的是应记住，你的应用程序必须访问<span>SQL</span>节点，而不是<span>MGM</span>或存储节点。在下面的简单示例中，介绍了使用<span>PHP 
			5</span>的<span><span>mysqli</span>扩展（运行在位于网络中其他位置的<span>Web</span>服务器上）执行相同查询的方法：</span></p>
			<pre><span>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span></pre>
			<pre><span>&nbsp; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span></pre>
			<pre><span>&lt;html&gt;</span></pre>
			<pre><span>&lt;head&gt;</span></pre>
			<pre><span>&nbsp; &lt;meta http-equiv=&quot;Content-Type&quot;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content=&quot;text/html; charset=iso-8859-1&quot;&gt;</span></pre>
			<pre><span>&nbsp; &lt;title&gt;SIMPLE mysqli SELECT&lt;/title&gt;</span></pre>
			<pre><span>&lt;/head&gt;</span></pre>
			<pre><span>&lt;body&gt;</span></pre>
			<pre><span>&lt;?php</span></pre>
			<pre><span>&nbsp; # connect to SQL node:</span></pre>
			<pre><span>&nbsp; $link = new mysqli(&#39;192.168.0.20&#39;, &#39;root&#39;, &#39;&#39;, &#39;world&#39;);</span></pre>
			<pre><span>&nbsp; # parameters for mysqli constructor are:</span></pre>
			<pre><span>&nbsp; #&nbsp;&nbsp; host, user, password, database</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; if( mysqli_connect_errno() )</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; die(&quot;Connect failed: &quot; . mysqli_connect_error());</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; $query = &quot;SELECT Name, Population</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM City</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORDER BY Population DESC</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LIMIT 5&quot;;</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; # if no errors...</span></pre>
			<pre><span>&nbsp; if( $result = $link-&gt;query($query) )</span></pre>
			<pre><span>&nbsp; {</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&lt;table border=&quot;1&quot; width=&quot;40%&quot; cellpadding=&quot;4&quot; cellspacing =&quot;1&quot;&gt;</span></pre>
			<pre><span>&nbsp; &lt;tbody&gt;</span></pre>
			<pre><span>&nbsp; &lt;tr&gt;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; &lt;th width=&quot;10%&quot;&gt;City&lt;/th&gt;</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; &lt;th&gt;Population&lt;/th&gt;</span></pre>
			<pre><span>&nbsp; &lt;/tr&gt;</span></pre>
			<pre><span>&lt;?</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; # then display the results...</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; while($row = $result-&gt;fetch_object())</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&lt;tr&gt;\n&nbsp; &lt;td align=\&quot;center\&quot;&gt;%s&lt;/td&gt;&lt;td&gt;%d&lt;/td&gt;\n&lt;/tr&gt;\n&quot;,</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $row-&gt;Name, $row-&gt;Population);</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&nbsp; &lt;/tbody</span></pre>
			<pre><span>&lt;/table&gt;</span></pre>
			<pre><span>&lt;?</span></pre>
			<pre><span>&nbsp; # ...and verify the number of rows that were retrieved</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; printf(&quot;&lt;p&gt;Affected rows: %d&lt;/p&gt;\n&quot;, $link-&gt;affected_rows);</span></pre>
			<pre><span>&nbsp; }</span></pre>
			<pre><span>&nbsp; else</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; # otherwise, tell us what went wrong</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp; echo mysqli_error();</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>&nbsp; # free the result set and the mysqli connection object</span></pre>
			<pre><span>&nbsp; $result-&gt;close();</span></pre>
			<pre><span>&nbsp; $link-&gt;close();</span></pre>
			<pre><span>?&gt;</span></pre>
			<pre><span>&lt;/body&gt;</span></pre>
			<pre><span>&lt;/html&gt;</span></pre>
			<p>我们假定运行在<span>Web</span>服务器上的进程能够访问<span>SQL</span>节点的<span>IP</span>地址。</p>
			<p>采用类似的风格，可以使用<span>MySQL C 
			API</span>、<span>Perl-DBI</span>、<span>Python-mysql</span>、或<span>MySQL 
			AB</span>自己的连接器来执行数据定义和操控任务，就像正常使用<span>MySQL</span>那样。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>另外还请记住，<em><span>每个</span></em><span><i><span>NDB</span>表</i></span><em><span>必须有一个主键</span></em>。如果在创建表时用户未定义主键，<span><span>NDB</span>簇存储引擎将自动生成隐含的主键。（</span><strong><span>注释：</span></strong>该隐含
			键也将占用空间，就像任何其他的表索引一样。由于没有足够的内存来容纳这些自动创建的键，出现问题并不罕见）。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="multi-shutdown-restart"></a>
			17.3.6.&nbsp;安全关闭和重启</h3></div></div></div>
			<p>要想关闭簇，可在<span>MGM</span>节点所在的机器上，在<span>Shell</span>中简单地输入下述命令：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm -e shutdown</b></span></span></pre>
			<p>该命令将恰当地中止<strong><span>ndb_mgm</span></strong>、<strong><span>ndb_mgmd</span></strong>以及任何<strong><span>ndbd</span></strong>进程。使用<strong><span>mysqladmin 
			shutdown</span></strong>或其他方法，可中止<span>SQL</span>节点。注意，这里的“<span><span>-e”</span>选项用于将命令从<span>shell</span>传递到</span><strong><span>ndb_mgm</span></strong>客户端。请参见<a href="using-mysql-programs.html#command-line-options" title="4.3.1. Using Options on the Command Line">4.3.1节，“在命令行上使用选项”</a>。</p>
			<p>要想重启簇，可简单地运行下述命令：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在管理主机上（本设置中为<span><span>192.168.0.10</span>）：</span></p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>ndb_mgmd -f /var/lib/mysql-cluster/config.ini</b></span></span></pre>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在每台数据节点主机上（<span>192.168.0.30</span>和<span>192.168.0.40</span>）：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>ndbd</b></span></span></pre>
			<p>请记住，正常重启<span>NDBD</span>节点时，不要用“<span>--initial</span>”选项调用该命令。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在<span>SQL</span>主机上（<span>192.168.0.20</span>）：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>shell&gt; <span><b>mysqld &amp;</b></span></span></pre>
			<p>关于创建簇备份的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-backup-using-management-server" title="17.6.5.2. Using The Management Server to Create a Backup">17.6.5.2节，“使用管理服务器创建备份”</a>。</p>
			<p>要想从备份中恢复簇，需要使用<strong><span>ndb_restore</span></strong>命令。请参见<a href="ndbcluster.html#mysql-cluster-restore" title="17.6.5.3. How to Restore a Cluster Backup">17.6.5.3节，“如何恢复簇备份”</a>。</p>
			<p>关于配置<span>MySQL</span>簇的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>。</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-configuration"></a>17.4. MySQL簇的配置</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-building">
		17.4.1. 从源码创建MySQL簇</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-installing">
		17.4.2. 安装软件</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-quick">
		17.4.3. MySQL簇的快速测试设置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-file">17.4.4. 
		配置文件</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
			作为<span>MySQL</span>簇组成部份的<span>MySQL</span>服务器仅在一个方面上与正常的（非簇式）<span>MySQL</span>服务器不同，它采用了<span><span>NDB</span>簇存储引擎。该引擎也简单地称为<span>NDB</span>，这两个术语是同义词。</span><p>
			为了避免不必要的资源分配，默认情况下，在服务器的配置中将禁止<span>NDB</span>存储引擎。要想启用<span><span>NDB</span>，需要更改</span>服务器的<span><span>my.cnf</span>配置文件，或使用<span>“—ndbcluster”</span>选项启动服务器。</span></p>
			<p>由于<span>MySQL</span>服务器是簇的一部分，它也需要知道如何访问<span>MGM</span>节点，以便获得簇配置数据。默认行为是查找本地主机上<span>MGM</span>节点。但是，如果需要另外指定它的位置，可在<span><span>my.cnf</span>文件或</span><span>MySQL</span>服务器命令行上进行。能够使用<span><span>NDB</span>存储引擎之前，至少应有一个<span>MGM</span>节点是可操作的，而且还应有</span>所需的数据节点。</p>
			<h3 class="title"><a name="mysql-cluster-building"></a>
			17.4.1.&nbsp;从源码创建MySQL簇</h3></div></div></div>
			<p><span>对于</span><span>Linux</span>、<span>Mac 
			OS X</span>和<span>Solaris</span>，在其二进制分发版中均提供了<span><span>NDB</span>簇存储引擎。在<span>Windows</span>平台上尚不支持它，但我们打算在不远的将来使其能用于</span><span>win32</span>和其他平台。</p>
			<p>如果选择从源码<span>tarball</span>或<span>MySQL 5.1 
			BitKeeper</span>树创建它，运行<strong><span>configure</span></strong>时，务必使用“<span><span>--with-ndbcluster”</span>选项。也可以使用</span><strong><span>BUILD/compile-pentium-max</span></strong>创建脚本。注意，该脚本包含<span>OpenSSL</span>，因此，要想成功创建，必须有或获得<span>OpenSSL</span>，如不然，需要更改“<strong><span>compile-pentium-max</span></strong>”以便将该要求排除在外，当然，也能采用标准步骤来编译你自己的二进制文件，然后执行常规测试和安装步骤。请参见<a href="installing.html#installing-source-tree" title="2.8.3. Installing from the Development Source Tree">2.8.3节，“从开发源码树安装”</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-installing"></a>
			17.4.2.&nbsp;安装软件</h3></div></div></div>
			<p>在下面的数节内，假定你已熟悉了<span>MySQL</span>的安装方法，在此，我们仅介绍了<span>MySQL</span>簇配置与不具备簇功能的<span>MySQL</span>配置之间的差别。如果希望了解关于后者的更多信息，请参见<a href="installing.html" title="Chapter 2. Installing MySQL">第2章：安装MySQL</a>。</p>
			<p>如果首先运行了所有的管理和数据节点，你将发现簇配置最简单，这或许是最花时间的配置部分。编辑<span><span>my.cnf</span>文件相对直接，在本节中，仅讨论与</span>不具备簇功能的<span>MySQL</span>配置不同的部分。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-quick"></a>
			17.4.3.&nbsp;MySQL簇的快速测试设置</h3></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			为了帮助你熟悉基本概念，我们将介绍功能性<span>MySQL</span>簇的最简单的可能配置。然后，按照本章相关部分提供的信息，你应能设计自己所需的配置。<p>
			首先，应以系统根用户身份通过执行下述命令创建配置目录，如<span>/var/lib/mysql-cluster</span>：</p>
			<pre><span>shell&gt; <span><b>mkdir /var/lib/mysql-cluster</b></span></span></pre>
			<p>在该目录下，使用下述信息创建名为<span><span>config.ini</span>的文件</span>，针对系统的情况，用恰当的值替换<span>HostName</span>和<span><span>DataDir</span>。</span></p>
			<pre><span># file &quot;config.ini&quot; - showing minimal setup consisting of 1 data node,</span></pre>
			<pre><span># 1 management server, and 3 MySQL servers.</span></pre>
			<pre><span># The empty default sections are not required, and are shown only for</span></pre>
			<pre><span># the sake of completeness.</span></pre>
			<pre><span># Data nodes must provide a hostname but MySQL Servers are not required</span></pre>
			<pre><span># to do so.</span></pre>
			<pre><span># If you don&#39;t know the hostname for your machine, use localhost.</span></pre>
			<pre><span># The DataDir parameter also has a default value, but it is recommended to</span></pre>
			<pre><span># set it explicitly.</span></pre>
			<pre><span># Note: DB, API, and MGM are aliases for NDBD, MYSQLD, and NDB_MGMD</span></pre>
			<pre><span># respectively. DB and API are deprecated and should not be used in new</span></pre>
			<pre><span># installations.</span></pre>
			<pre><span>[NDBD DEFAULT]</span></pre>
			<pre><span>NoOfReplicas= 1</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[MYSQLD DEFAULT]</span></pre>
			<pre><span>[NDB_MGMD DEFAULT]</span></pre>
			<pre><span>[TCP DEFAULT]</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDB_MGMD]</span></pre>
			<pre><span>HostName= myhost.example.com</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>HostName= myhost.example.com</span></pre>
			<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<p>现在，能够按下述方式启动管理服务器：</p>
			<pre><span>shell&gt; <span><b>cd /var/lib/mysql-cluster</b></span></span></pre>
			<pre><span>shell&gt; <span><b>ndb_mgmd</b></span></span></pre>
			<p>接下来，通过运行<strong><span>ndbd</span></strong>启动单个<span>DB</span>节点。首次为给定的<span>DB</span>节点启动<strong><span>ndbd</span></strong>时，应使用“<span><span>—initial”</span>选项，如下所示：</span></p>
			<pre><span>shell&gt; <span><b>ndbd --initial</b></span></span></pre>
			<p>对于后续的<strong><span>ndbd</span></strong>启动，通常不需要使用该选项：</p>
			<pre><span>shell&gt; <span><b>ndbd</b></span></span></pre>
			<p>这是因为，<span><span>--initial</span>选项将删除该数据节点的</span>所有已有数据和日志文件（以及所有的表元数据），并创建新的数据和日志文件。该规则的一项例外是：添加了新数据节点后重启簇并从备份进行恢复之时。</p>
			<p>默认情况下，<strong><span>ndbd</span></strong>将在端口<span>1186</span>上查找本地主机上的管理服务器。</p>
			<p><strong><span>注释：</span></strong>如果从二进制<span>tarball</span>安装了<span>MySQL</span>，需要明确指定<strong><span>ndb_mgmd</span></strong>和<strong><span>ndbd</span></strong>服务器的路径。（正常情况下，它们位于<span>/usr/local/mysql/bin</span>目录下）。</p>
			<p>最后，进入<span>MySQL</span>数据目录（通常是<span>/var/lib/mysql</span>或<span><span>/usr/local/mysql/data</span>），并确保<span>my.cnf</span>文件包含启用<span>NDB</span>存储引擎所需的选项：</span></p>
			<pre><span>[mysqld]</span></pre>
			<pre><span>ndbcluster</span></pre>
			<p>现在，你能按通常方式启动<span>MySQL</span>服务器：</p>
			<pre><span>shell&gt; <span><b>mysqld_safe --user=mysql &amp;</b></span></span></pre>
			<p>等待一段时间，确认<span>MySQL</span>服务器正在恰当运行。如果发现通知用<span><span>mysql</span>停止，请检查服务器的<span>.err</span>文件，找出错误。</span></p>
			<p>如果到目前为止一切正常，可使用簇启动它：</p>
			<pre><span>shell&gt; <span><b>mysql</b></span></span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha-Max</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>键入’<span>help;</span>’或’<span>\h</span>’获取帮助。键入’<span>\c</span>’清空缓冲区。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>SHOW ENGINES\G</b></span></span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>...</span></pre>
			<pre><span>*************************** 12. row ***************************</span></pre>
			<pre><span>Engine: NDBCLUSTER</span></pre>
			<pre><span>Support: YES</span></pre>
			<pre><span>Comment: Clustered, fault-tolerant, memory-based tables</span></pre>
			<pre><span>*************************** 13. row ***************************</span></pre>
			<pre><span>Engine: NDB</span></pre>
			<pre><span>Support: YES</span></pre>
			<pre><span>Comment: Alias for NDBCLUSTER</span></pre>
			<pre><span>...</span></pre>
			<p>（注意，上例输出中显示的行号可能与你的系统上显示的不同，具体情况取决于使用的<span>MySQL</span>版本，以及配置它的方式）。</p>
			<pre><span>shell&gt; <span><b>mysql</b></span></span></pre>
			<pre><span>Welcome to the MySQL monitor.&nbsp; Commands end with ; or \g.</span></pre>
			<pre><span>Your MySQL connection id is 1 to server version: 5.1.2-alpha-Max</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre>键入’<span>help;</span>’或’<span>\h</span>’获取帮助。键入’<span>\c</span>’清空缓冲区。</pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>USE test;</b></span></span></pre>
			<pre><span>Database changed</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>CREATE TABLE ctest (i INT) ENGINE=NDBCLUSTER;</b></span></span></pre>
			<pre><span>Query OK, 0 rows affected (0.09 sec)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>mysql&gt; <span><b>SHOW CREATE TABLE ctest \G</b></span></span></pre>
			<pre><span>*************************** 1. row ***************************</span></pre>
			<pre><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Table: ctest</span></pre>
			<pre><span>Create Table: CREATE TABLE `ctest` (</span></pre>
			<pre><span>&nbsp; `i` int(11) default NULL</span></pre>
			<pre><span>) ENGINE=ndbcluster DEFAULT CHARSET=latin1</span></pre>
			<pre><span>1 row in set (0.00 sec)</span></pre>
			<p>要想检查是否恰当设置了节点，可启动管理客户端：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm</b></span></span></pre>
			<p>随后，为了获得关于簇状态的报告，可从管理客户端内使用<strong><span>SHOW</span></strong>命令：</p>
			<pre><span>NDB&gt; SHOW</span></pre>
			<pre><span>Cluster Configuration</span></pre>
			<pre><span>---------------------</span></pre>
			<pre><span>[ndbd(NDB)]&nbsp;&nbsp;&nbsp;&nbsp; 1 node(s)</span></pre>
			<pre><span>id=2&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3, Nodegroup: 0, Master)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[ndb_mgmd(MGM)] 1 node(s)</span></pre>
			<pre><span>id=1&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3)</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[mysqld(API)]&nbsp;&nbsp; 3 node(s)</span></pre>
			<pre><span>id=3&nbsp;&nbsp;&nbsp; @127.0.0.1&nbsp; (Version: 3.5.3)</span></pre>
			<pre><span>id=4 (not connected, accepting connect from any host)</span></pre>
			<pre><span>id=5 (not connected, accepting connect from any host)</span></pre>
			<p>此时，你成功地设置了工作的<span>MySQL</span>簇。现在，你能使用由<span>ENGINE=NDBCLUSTER</span>或其别名<span><span>ENGINE=NDB</span>创建的表，将数据保存到簇中。</span></p>
			<h3 class="title"><a name="mysql-cluster-config-file"></a>17.4.4. 配置文件</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-config-example">
				17.4.4.1. MySQL簇的配置示例</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-connectstring">
				17.4.4.2. MySQL簇连接字符串<code class="literal"></code></a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-computer-definition">
				17.4.4.3. 定义构成MySQL簇的计算机</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-mgm-definition">
				17.4.4.4. 定义MySQL簇管理服务器</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-db-definition">
				17.4.4.5. 定义MySQL簇数据节点</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-api-definition">
				17.4.4.6. 定义MySQL簇内的SQL节点</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-tcp-definition">
				17.4.4.7. MySQL簇TCP/IP连接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-direct-tcp-definition">17.4.4.8. 
				使用直接连接的MySQL簇TCP/IP连接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-shm-definition">
				17.4.4.9. MySQL簇共享内存连接</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-sci-definition">
				17.4.4.10. MySQL簇SCI传输连接</a></span></dt></dl></div>
			<p>配置<span>MySQL</span>簇需要与两个文件打交道：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>my.cnf</span>：为所有的<span>MySQL</span>簇可执行文件指定了选项。你应熟悉了前面介绍的使用<span>MySQL</span>的方式，通过运行在簇中的每个可执行文件，必须能够访问该文件。</p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>config.ini</span></span>：该文件仅由<span>MySQL</span>簇管理服务器读取，随后管理服务器会将包含该文件的信息分配给簇中的所有进程。<span><span>config.ini</span>文件包含对簇中各节点的描述。包括数据节点的配置参数，以及簇中所有节点间连接的配置参数。</span></p>
			<p>
			我们正在不断改进簇配置，并努力简化该进程。尽管我们将尽量维护向后兼容性，但在某些时候，可能也需要引入不兼容的变动。在这种情况下，我们将尽量让簇用户事先了解该变动是否是向后兼容的。如果你发现了尚未记录在文档中的这类变动，请使用我们的<span><a target="_top"  href="http://bugs.mysql.com/"><span>缺陷数据库</span></a></span>通报它。</p>
			<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-config-example"></a>
				17.4.4.1.&nbsp;MySQL簇的配置示例</h4></div></div></div>
				<p>为了支持<span>MySQL</span>簇，需要更新文件<span><span>my.cnf</span>，如下例所示。注意，不应将这里给出的选项与<span>config.ini</span>文件中出现的选项混淆起来。此外，从命令行调用可执行文件时，或许也应指定这些参数。</span></p>
				<pre><span># my.cnf</span></pre>
				<pre><span># example additions to my.cnf for MySQL Cluster</span></pre>
				<pre><span># (valid in MySQL 5.1)</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># enable ndbcluster storage engine, and provide connectstring for</span></pre>
				<pre><span># management server host (default port is 1186)</span></pre>
				<pre><span>[mysqld]</span></pre>
				<pre><span>ndbcluster</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide connectstring for management server host (default port: 1186)</span></pre>
				<pre><span>[ndbd]</span></pre>
				<pre><span>connect-string=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide connectstring for management server host (default port: 1186)</span></pre>
				<pre><span>[ndb_mgm]</span></pre>
				<pre><span>connect-string=ndb_mgmd.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># provide location of cluster configuration file</span></pre>
				<pre><span>[ndb_mgmd]</span></pre>
				<pre><span>config-file=/etc/config.ini</span></pre>
				<p>（关于连接字符的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2节，“MySQL簇连接字符串<code class="literal"></code>”</a>）。</p>
				<pre><span># my.cnf</span></pre>
				<pre><span># example additions to my.cnf for MySQL Cluster</span></pre>
				<pre><span># (will work on all versions)</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span># enable ndbcluster storage engine, and provide connectstring for management</span></pre>
				<pre><span># server host to the default port 1186</span></pre>
				<pre><span>[mysqld]</span></pre>
				<pre><span>ndbcluster</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com:1186</span></pre>
				<p>或许，你也可以使用簇<span><span>my.cnf</span>中单独的<span>[mysql_cluster]</span></span>部分，设置可被所有可执行文件读取的设置，并影响所有的可执行文件：</p>
				<pre><span># cluster-specific settings</span></pre>
				<pre><span>[mysql_cluster]</span></pre>
				<pre><span>ndb-connectstring=ndb_mgmd.mysql.com:1186</span></pre>
				<p>目前，配置文件采用的是<span>INI</span>格式，默认情况下被命名为<span><span>config.ini</span>。该文件在启动时由</span><strong><span>ndb_mgmd</span></strong>读取，并能被置于任何地方。在命令行上与<strong><span>ndb_mgmd</span></strong>一起使用<span><span>--config-file=[<i>&lt;path&gt;</i>]<i>&lt;filename&gt;</i></span>，可指定其位置和名称。如果未指定配置文件，</span>默认情况下，<strong><span>ndb_mgmd</span></strong>将尝试读取位于当前工作目录下的文件<span>config.ini</span>。</p>
				<p>对于大多数参数，均定义了默认值，也能在<span><span>config.ini</span>文件中指定默认值。</span>要想创建默认值部分，可简单地将单词<span><span>DEFAULT</span>添加到该部分的名称上。</span>例如，数据节点是使用<span><span>[NDBD]</span>部分配置的。如果所有的数据节点使用相同大小的数据内存，而且该内存大小不同于默认的大小，应创建包含<span>DataMemory</span>行的<span>[NDBD 
				DEFAULT]</span>部分，为所有数据节点指定默认的数据内存大小。</span></p>
				<p><span>INI</span>格式包含多个部分，每一部分以该部分的标题（用方括号括住）开始，后跟恰当的参数名和值。与标准格式的不同之处在于，不能用冒号“<span>:</span>”和等号“<span>=</span>”隔开参数名和值；另一处不同是，这些部分并不是用名称唯一标识的。其唯一性条目（如具有相同类型的两个不同节点）是由唯一<span>ID</span>标识的。</p>
				<p>作为最低要求，配置文件必须定义簇中的计算机和节点，以及这些节点所在的计算机。下面给出了一个简单的簇配置文件示例，该簇包含<span>1</span>个管理服务器，<span>2</span>个数据节点和<span>2</span>个<span>MySQL</span>服务器：</p>
				<pre><span># file &quot;config.ini&quot; - 2 data nodes and 2 SQL nodes</span></pre>
				<pre><span># This file is placed in the startup directory of ndb_mgmd (the management</span></pre>
				<pre><span># server)</span></pre>
				<pre><span># The first MySQL Server can be started from any host. The second can be started</span></pre>
				<pre><span># only on the host mysqld_5.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD DEFAULT]</span></pre>
				<pre><span>NoOfReplicas= 2</span></pre>
				<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDB_MGMD]</span></pre>
				<pre><span>Hostname= ndb_mgmd.mysql.com</span></pre>
				<pre><span>DataDir= /var/lib/mysql-cluster</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD]</span></pre>
				<pre><span>HostName= ndbd_2.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[NDBD]</span></pre>
				<pre><span>HostName= ndbd_3.mysql.com</span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>[MYSQLD]</span></pre>
				<pre><span>[MYSQLD]</span></pre>
				<pre><span>HostName= mysqld_5.mysql.com</span></pre>
				<p>在该配置文件中，有6个不同部分：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[COMPUTER]</span>：定义了簇主机。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]</span>：定义了簇的数据节点。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]</span>：定义了簇的<span>MySQL</span>服务器节点。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MGM]</span>或<span>[NDB_MGMD]</span>：定义了簇的管理服务器节点。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[TCP]</span>：定义了簇中节点间的<span>TCP/IP</span>连接，<span>TCP/IP</span>是默认的连接协议。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]</span>：定义了节点间的共享内存连接。以前，这类连接仅能在使用“<span>--with-ndb-shm</span>”选项创建的二进制文件中使用。在<span>MySQL 
				5.1-Max</span>中，默认情况下它是允许的，但仍应将其视为试验性的。</p>
				<p>注意，每个节点在<span><span>config.ini</span>文件中有自己的部分。例如，由于该簇有两个数据节点，在配置文件中，也包含定义这些节点的部分。</span></p>
				<p>可以为每个部分定义<span><span>DEFAULT</span>值。所有的簇参数名称均区分大小写。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-connectstring"></a>
				17.4.4.2.&nbsp;MySQL簇连接字符串<code class="literal"></code></h4></div></div></div>
				<p>除了<span>MySQL</span>簇管理服务器（<strong><span>ndb_mgmd</span></strong>），构成<span>MySQL</span>簇的每个节点均需要<span>1</span>个连接字符串，该连接字符串指向管理服务器所在的位置。它用于建立与管理服务器的连接，并执行其他任务，这类其他任务取决于节点在簇内扮演的角色。连接字符串的语法如下：</p>
				<pre><span>&lt;connectstring&gt; :=</span></pre>
				<pre><span>&nbsp;&nbsp;&nbsp; [&lt;nodeid-specification&gt;,]&lt;host-specification&gt;[,&lt;host-specification&gt;]</span></pre>
				<pre><span>&nbsp;&nbsp;&nbsp; </span></pre>
				<pre><span>&lt;nodeid-specification&gt; := <span><i>node_id</i></span></span></pre>
				<pre><span>&nbsp;</span></pre>
				<pre><span>&lt;host-specification&gt; := <span><i>host</i></span>[:<span><i>port</i></span>]</span></pre>
				<p><span>node_id</span>是大于<span>1</span>的整数，用于确定<span><span>config.ini</span>中的节点。<i><span>port</span></i></span>是引用正常<span>Unix</span>端口的整数。<span><i><span>host</span></i></span>是代表有效<span>Internet</span>地址的字符串。</p>
				<pre><span>example 1 (long):&nbsp;&nbsp;&nbsp; &quot;nodeid=2,myhost1:1100,myhost2:1100,192.168.0.3:1200&quot;</span></pre>
				<pre><span>example 2 (short):&nbsp;&nbsp; &quot;myhost1&quot;</span></pre>
				<p>如果未提供，所有节点均将使用<span>localhost:1186</span>作为默认的连接字符串值。如果在连接字符串中省略了<span>&lt;port&gt;</span>，默认端口为<span>1186</span>。该端口在网络上总应是可用的，这是因为它是由<span>IANA</span>为该目的而指定的（详情请参见<span><a target="_top"  href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></span>）。</p>
				<p>通过列出多个<span><span>&lt;host-specification&gt;</span>值，</span>能够指定数个冗余管理服务器。簇节点将按照指定的顺序尝试连接到每台主机上的连续管理服务器，直至成功建立起连接为止。</p>
				<p>有多种指定连接字符串的不同方法：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>
				每个可执行文件有自己的命令行选项，使用它，能够在启动时指定管理服务器（关于各可执行程序的介绍，请参见相应的文档）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>也能一次性地为簇中的所有节点设置连接字符串，方法是将其放在管理服务器的<span><span>my.cnf</span>文件的<span>[mysql_cluster]</span>部分。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>为了向后兼容性，还提供了两种其他选项，其使用的语法相同：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>设置<span>NDB_CONNECTSTRING</span>环境变量，使之包含<span>connectstring</span>（连接字符串）。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>将针对各可执行文件的<span>connectstring</span>（连接字符串）写入名为<span><span>Ndb.cfg</span>的文本文件，并将该文件放在可执行文件的启动目录下。</span></p>
				<p>但是，这些方法目前已不再受重视，对于新安装，不应使用它们。</p>
				<p>指定连接字符串时，推荐的方法是在命令行上设置它，或为每个可执行文件在<span><span>my.cnf</span>文件中设置它。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-computer-definition"></a>
				17.4.4.3.&nbsp;定义构成MySQL簇的计算机</h4></div></div></div>
				<p>除了用于避免为系统中的每个节点定义主机名外，<span><span>[COMPUTER]</span>部分没有实际的重要意义。这里所提到的所有参数都是需要的。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[COMPUTER]Id</span><span>
				</span></p>
				<p>这是整数值，用于引用位于配置文件中别处的主机计算机。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[COMPUTER]HostName</span><span>
				</span></p>
				<p>这是计算机的主机名或<span>IP</span>地址。<span>
				</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-mgm-definition"></a>
				17.4.4.4.&nbsp;定义MySQL簇管理服务器</h4></div></div></div>
				<p><span><span>[NDB_MGMD]</span>部分</span>（或其别名<span>[MGM]</span>）用于配置管理服务器的行为。下面列出的所有参数均能被忽略，如果是这样，将使用其默认值。<strong><span>注释：</span></strong>如果<span><span>ExecuteOnComputer</span>和<span>HostName</span>参数均未出现，</span>会为它们指定默认值<span><span>localhost</span>。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]Id</span><span>
				</span></p>
				<p>簇中的每个节点都有唯一的标识，由从<span>1</span>到<span>63</span>的整数表示。所有的内部簇消息使用该<span>ID</span>来定址结点。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ExecuteOnComputer</span><span>
				</span></p>
				<p>它引用在<span><span>[COMPUTER]</span>部分中定义的计算机之一。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]PortNumber</span><span>
				</span></p>
				<p>这是管理服务器用于监听配置请求和管理命令的端口号。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]LogDestination</span><span>
				</span></p>
				<p>该参数指定了将簇登录信息发送到哪里。有三种选项，<span>CONSOLE</span>、<span>SYSLOG</span>和<span>FILE</span>：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><span>
				CONSOLE</span>，将日志输出到标准输出设备</span>（<span>stdout</span>）：</p>
				<pre><span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>CONSOLE</span></pre>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><span>
				SYSLOG</span>，将日志发送到<span>syslog</span>（系统日志）软设备</span>，可能的值包括：<span>auth</span>、<span>authpriv</span>、<span>cron</span>、<span>daemon</span>、<span>ftp</span>、<span>kern</span>、<span>lpr</span>、<span>mail</span>、<span>news</span>、<span>syslog</span>、<span>user</span>、<span>uucp</span>、<span>local0</span>、<span>local1</span>、<span>local2</span>、<span>local3</span>、<span>local4</span>、<span>local5</span>、<span>local6</span>或<span>local7</span>。</p>
				<p><strong>
				<span>注释：</span></strong>并非所有的操作系统均支持所有的软设备。</p>
				<pre><span>SYSLOG:facility=syslog</span></pre>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>FILE</span>，将簇日志输出导向相同机器上的正规文件。可指定下述值：</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				filename</span>：日志文件的名称。</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				maxsize</span>：日志记录切换到新文件之前，文件能增长到的最大尺寸。出现该情况时，将通过在文件名上添加<span>.x</span>，重命名日志文件，其中，<span>x</span>是该名称尚未使用的下一个数字。</p>
				<p >
				<span  >
				§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				maxfiles</span>：日志文件的最大数目。</p>
				<pre><span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>FILE:filename=cluster.log,maxsize=1000000,maxfiles=6</span></pre>
				<p>使用由分号分隔的字符串，可以指定多个日志目标，如下所示：</p>
				<pre><span>CONSOLE;SYSLOG:facility=local0;FILE:filename=/var/log/mgmd</span></pre>
				<p><span>
				<span>FILE</span>参数的默认值是<span>FILE:filename=ndb_<i>node_id</i>_cluster.log,maxsize=1000000,maxfiles=6</span></span>，其中，<span><span>node_id</span>是节点的<span>ID</span>。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ArbitrationRank</span><span>
				</span></p>
				<p>该参数用于定义哪个节点将扮演仲裁程序的角色。只有<span>MGM</span>节点和<span>SQL</span>节点能扮演仲裁程序的角色。<span>ArbitrationRank</span>可以取下述值之一：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>0</span>：该节点永远不会用作仲裁程序。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>1</span>：该节点具有高的优先级，也就是说，与低优先级节点相比，它更容易成为仲裁程序。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>2</span>：表明节点具有低的优先级，仅当具有高优先级的节点无法用于该目的时，才能成为仲裁程序。</p>
				<p>通常情况下，应将<span><span>ArbitrationRank</span>设置为<span>1</span>（默认值），并将所有的<span>SQL</span>节点设置为<span>0</span>，</span>将管理服务器配置为仲裁程序。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]ArbitrationDelay</span><span>
				</span></p>
				<p>
				整数值，以毫秒为单位规定了管理服务器对仲裁请求的延迟时间。默认情况下，该值为<span>0</span>，通常不需要改变它。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDB_MGMD]DataDir</span><span>
				</span></p>
				<p>
				它用于设置保存管理服务器输出文件的位置。这些文件包括簇日志文件、进程输出文件、以及端口监督程序的<span>pid</span>文件（对于日志文件，可通过设置<span><span>[NDB_MGMD]LogDestination</span>的<span>FILE</span>参数覆盖它，请参见本节前面的讨论）。</span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-db-definition"></a>
				17.4.4.5.&nbsp;定义MySQL簇数据节点</h4></div></div></div>
				<p><span>[NDBD]</span>部分用于配置簇数据节点的行为。有很多可用于控制缓冲区大小、池大小、超时等的参数。强制性参数包括：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				ExecuteOnComputer</span>或<span>HostName</span><span>.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>参数<span>NoOfReplicas</span><span>
				</span></p>
				<p>这些参数需要在<span>[NDBD 
				DEFAULT]</span>部分中定义。<span> </span></p>
				<p>大多数数据节点参数是在<span><span>[NDBD 
				DEFAULT]</span>部分中设置的。只有那些明确声明为能设置本地值的参数才能在<span>[NDBD]</span>部分中被更改。<span>HostName</span></span>、<span>Id</span>以及<span><span>ExecuteOnComputer</span>必须在本地<span>[NDBD]</span>部分中定义。</span></p>
				<p><strong><span>识别数据节点</span></strong>
				</p>
				<p>启动节点时，可在命令行上分配<span><span>Id</span>值</span>（即数据节点<span>ID</span>），也能在配置文件中分配<span>Id</span>值。</p>
				<p>对于各参数，能够使用后缀<span>k</span>、<span>M</span>或<span>G</span>用于指明单位，分别表示<span>1024</span>、<span>1024*1024</span>或<span>1024*1024*1024</span>（例如，<span>100k</span>表示<span>100 
				* 1024 = 102400</span>）。目前，参数和值区分大小写。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NBDB]Id</span><span>
				</span></p>
				<p>这是用作节点地址的节点<span>ID</span>，供有的簇内部消息使用。这是介于<span>1</span>～<span>63</span>之间的整数。簇中的每个节点均有唯一的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]ExecuteOnComputer</span><span>
				</span></p>
				<p>用于引用在<span><span>COMPUTER</span>部分中定义的计算机（主机）。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HostName</span><span>
				</span></p>
				<p>指定该参数的效果类似于指定<span>ExecuteOnComputer</span>。它定义了存储节点所在计算机的主机名。指定除<span><span>localhost</span>之外的其他主机名时，需要</span>该参数或<span><span>ExecuteOnComputer</span>。</span><span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>(<em><span>OBSOLETE</span></em>)
				<span>[NDBD]ServerPort</span> </span>
				</p>
				<p>
				簇中的各节点使用端口来与其他节点相连。该端口也用于连接建立阶段中的非<span>TCP</span>传输器。由于默认端口是动态分配的，同一台计算机上的两个节点具有不同的端口号，正常情况下不需要为该参数指定值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfReplicas</span><span>
				</span></p>
				<p>该全局参数仅能在<span><span>[NDBD 
				DEFAULT]</span>中设置，它定义了簇中每个表保存的副本数。该参数还指定了节点组的大小。节点组指的是保存相同信息的节点集合。</span></p>
				<p>节点组是以隐式方式构成的。第<span>1</span>个节点组由具有最低节点<span>ID</span>的数据节点集合构成，下一个节点组由具有次低节点<span>ID</span>的数据节点集合构成，依此类推。作为示例，截顶我们有<span>4</span>个数据节点，并将<span><span>NoOfReplicas</span>设置为<span>2</span>。这四个数据节点的<span>ID</span>分别是<span>2</span>、<span>3</span>、<span>4</span>、<span>5</span>。那么第<span>1</span>个节点组由节点<span>2</span>和<span>3</span>构成，第<span>2</span>个节点组由节点<span>4</span>和<span>5</span>构成。重要的是对簇进行相应的配置，使得同一节点组中的节点位于不同的计算机上，这是因为，如果位于相同的计算机上，单个硬件故障会导致整个簇崩溃。</span></p>
				<p>如果未提供节点<span>ID</span>，那么数据节点的顺序将是节点组的决定因素。无论是否进行了明确的分配，可在管理客户端<span>SHOW</span>命令的输出中查看它们。</p>
				<p><span>
				<span>NoOfReplicas</span>没有默认值，最大的可能值为<span>4</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]DataDir</span><span>
				</span></p>
				<p>该参数指定了存放跟踪文件、日志文件、<span>pid</span>文件以及错误日志的目录。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]FileSystemPath</span><span>
				</span></p>
				<p>该参数指定了存放为元数据创建的所有文件、<span>REDO</span>日志、<span>UNDO</span>日志和数据文件的目录。默认目录是由<span><span>DataDir</span>指定的。注意，启动</span><strong><span>ndbd</span></strong><span>进程之前，该目录必须已存在。</span></p>
				<p>为<span>MySQl</span>簇推荐的目录层次包括<span><span>/var/lib/mysql-cluster</span>，在其下为节点的文件系统创建<span>1</span>个为目录。该子目录包含节点<span>ID</span>。例如，如果节点<span>ID</span>为<span>2</span>，该子目录的名称为<span>ndb_2_fs</span></span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupDataDir</span><span>
				</span></p>
				<p>也能指定存放备份的目录。默认情况下，该目录是<span><i><span>FileSystemPath/</span></i><span>BACKUP</span></span>（请参见前面的介绍）。</p>
				<p><strong><span>数据内存和索引内存</span></strong><span>
				</span></p>
				<p><span>参数<span>DataMemory</span>和<span>IndexMemory</span>指定了存放实际记录及其索引的内存段的大小。</span>这是它们的值时，重要的是应掌握使用<span><span>DataMemory</span>和<span>IndexMemory</span></span>的方式，这是因为，为了反映簇的实际使用情况，常常需要更新它们：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]DataMemory</span><span>
				</span></p>
				<p>
				该参数定义了用于保存数据库记录的空间大小。全部空间均是分配在内存中的，因此，机器应具有足够的物理内存来容纳该值，这点极其重要。</p>
				<p>由<span><span>DataMemory</span>分配的内存用于保存实际记录和索引。目前，每条记录具有固定的大小（甚至<span>VARCHAR</span>列也保存为固定宽度列）。每条记录的开销为<span>16</span>字节，</span>此外，每条记录还需要额外的空间，这是因为，这类记录保存在具有<span>128</span>字节页面开销的<span>32KB</span>页中（请参见下面的介绍）。由于每条记录仅保存在<span>1</span>个页中，因而每页有少量的浪费。目前，最大记录大小为<span>8052</span>字节。</p>
				<p>由<span><span>DataMemory</span>定义的内存空间也用于保存有序索引，对于每条记录，索引约使用<span>10</span>字节。在有序索引中，表示了</span>每个表行。用户常犯的一个错误是，想当然地认为所有的索引均保存在由<span><span>IndexMemory</span>分配的内存中，但情况并非如此：只有主键和唯一性混编索引使用该内存，有序索引使用的是</span>由<span><span>DataMemory</span>分配的内存。然而，创建主键或唯一性混编索引</span>时，也会在相同的
				键上创建有序索引，除非在索引创建语句中指定了<span><span>USING 
				HASH</span>。</span>通过在管理客户端中运行<strong><span>ndb_desc 
				-d </span></strong><span><b><i>
				<span>db_name</span></i></b></span><strong><span>
				</span></strong><span><b><i>
				<span>table_name</span></i></b></span>，可对其进行验证。</p>
				<p><span>
				<span>DataMemory</span>分配的内存空间由多个</span><span>32KB</span>页构成，它们是为表片段分配的。通常情况下，为每一表划分的表片段数目与簇中的节点数目相同。因此，对于每一节点，片段数目与在<span><span>NoOfReplicas</span>中设置的相同。</span>一旦分配了<span>1</span>页，目前无法将其返回到自由页池中，除非删除表。执行节点恢复也将压缩分区，这是因为，所有记录均会被插入到其他活动节点的空分区中。</p>
				<p><span>
				<span>DataMemory</span>内存空间也包含</span><span>UNDO</span>信息：对于每一更新，未改变记录的副本将被分配到<span><span>DataMemory</span>中。在有序表索引中，还有对每一副本的引用。仅当更新唯一性索引列时，才会更新唯一性混编索引，在该情况下，将在索引表中插入新的条目，并在提交时删除旧的条目。因此，也有必要分配足够的内存，以便处理由使用簇的应用程序执行的最大事务。</span>在任何情况下，执行少量大的事务并不比使用众多小的事务占优，原因如下：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大事务的速度没有较小事务的速度快。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大的事务会增加丢失操作的数目，一旦事务失败，必须重复执行。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>大的事务使用更多的内存。</p>
				<p><span>
				<span>DataMemory</span>的默认值是</span><span>80MB</span>，最小为<span>1MB</span>。没有最大尺寸限制，但在实际使用过程中，最大限制应恰当，以便当达到最大限制时，进程不会启动交换功能。该限制由机器上可用的物理<span>RAM</span>量、以及操作系统能提交给任何进程的内存量决定。对于<span>32</span>位操作系统，该限制值为每进程<span>2</span>～<span>4GB</span>，对于<span>64</span>位操作系统，该限制值更大。对于大的数据库，出于该原因，最好使用<span>64</span>位操作系统。此外，在每台机器上也能运行一个以上的<strong><span>ndbd</span></strong>进程，在使用多<span>CPU</span>的机器上，该特性颇具优势。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]IndexMemory</span><span>
				</span></p>
				<p>该参数用于控制<span>MySQL</span>簇中哈希（混编）索引所使用的存储量。哈希（混编）索引总用于主键索引、唯一性索引、以及唯一性约束。注意，定义主键和唯一性索引时，将创建两条索引，其中一条是用于所有<span>tuple</span>访问和锁定处理的哈希（混编）索引。此外，它还能用于增强唯一性约束。</p>
				<p>哈希（混编）索引的大小是每记录<span>25</span>字节，再加上主键的大小。对大于<span>32</span>字节的主键，还需加上<span>8</span>字节。</p>
				<p>考虑下例定义的表：</p>
				<pre><span>CREATE TABLE example (</span></pre>
				<pre><span>&nbsp; a INT NOT NULL,</span></pre>
				<pre><span>&nbsp; b INT NOT NULL,</span></pre>
				<pre><span>&nbsp; c INT NOT NULL,</span></pre>
				<pre><span>&nbsp; PRIMARY KEY(a),</span></pre>
				<pre><span>&nbsp; UNIQUE(b)</span></pre>
				<pre><span>) ENGINE=NDBCLUSTER;</span></pre>
				<p>有<span>12</span>字节的开销（无可空列将节省<span>4</span>字节的开销）加上每记录<span>12</span>字节的数据。此外，在列<span>a</span>和<span>b</span>上有两个有序索引，假定每记录分别耗用约<span>10</span>字节的空间。在每记录约使用<span>29</span>字节的基表上有<span>1</span>条主键哈希索引。唯一性约束由以<span>b</span>作为主键以及<span>a</span>作为列的单独表实现。对于该表，每记录将耗用额外的<span>29</span>字节索引内存，在示例表中，还包括<span>12</span>字节的开销再加上<span>8</span>字节的记录数据。</p>
				<p>因此，对于<span>100</span>万条记录，需要<span>58MB</span>的索引内存来处理用于主键和唯一性约束的哈希索引。还需要<span>64 
				MB</span>来处理基表和唯一索引表、以及两个有序索引表的记录。</p>
				<p>
				由此可见，哈希索引占用了相当大的内存空间，但作为回报，它们提供了对数据的极快访问。在<span>MySQl</span>簇中，它们也用于处理唯一性约束。</p>
				<p>
				目前仅有的分区算法是散列法，有序索引对每个节点来说都是局部性的。因此，有序索引不能用于处理一般情况下的唯一性约束。</p>
				<p>对于<span><span>IndexMemory</span>和<span>DataMemory</span>，重要的是，总的数据库大小是各节点组的所有数据内存和所有索引内存之和。每个节点组用于保存复制信息，因此，如果有<span>4</span>个节点和<span>2</span>个副本，将有<span>2</span>个节点组。对于每个数据节点，可用的总数据内存是</span><span>2*<span>DataMemory</span></span><span>。</span></p>
				<p>强烈建议为所有的节点设置相同的<span><span>DataMemory</span>值和<span>IndexMemory</span></span>值。由于数据是平均分布在簇中的所有节点上，任何节点可用的最大空间不超过簇中最小节点的可用空间。</p>
				<p>
				<span>DataMemory</span>和<span>IndexMemory</span>可被更改，但降低任何一个的值均会导致危险，如果这样做，很容易使某一节点甚至整个簇因缺少足够的内存空间而无法重启。增加它们的值应是可接受的，但建议采用与软件升级相同的方式升级它，首先更新配置文件，然后重启管理服务器，最后依次重启每个数据节点。</p>
				<p>
				更新不会增加所用的索引内存。插入将立刻生效，但是，在提交事务之前并不会实际删除行。</p>
				<p><span>
				<span>IndexMemory</span>的默认值是</span><span>18MB</span>。最小值为<span>1MB</span>。</p>
				<p><strong><span>事务参数</span></strong></p>
				<p>下面讨论的三个参数十分重要，这是因为，它们会影响并发事务的数目，以及系统能够处理的事务的大小。<span><span>MaxNoOfConcurrentTransactions</span>用于设置节点内可能的并发事务数目。<span>MaxNoOfConcurrentOperations</span></span>用于设置能同时出现在更新阶段或同时锁定的记录数目。</p>
				<p>对于打算设定特定值、不使用默认值的用户，这两个参数可能正是他们所需的（尤其是<span><span>MaxNoOfConcurrentOperations</span>）。默认值是为使用小型事务的系统而设置的，</span>为的是确保这类事务不会使用过多的内存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentTransactions</span><span>
				</span></p>
				<p>对于簇中的每个活动事务，必须在簇节点之一中有<span>1</span>条记录。对事务的协调任务是在各节点间进行的：在簇中，事务记录的总数等于任意给定节点中的事务数乘以簇中的节点数。</p>
				<p>事务记录被分配给单独的<span>MySQL</span>服务器。正常情况下，对于使用簇中任何表的每个连接，必须为其分配至少<span>1</span>条事务记录。出于该原因，应确保簇中的事务记录数大于簇中所有<span>MySQL</span>服务器的并发连接数。</p>
				<p>对于所有的簇节点，必须将该参数设置为相同的值。<span>
				</span></p>
				<p>
				更改该参数不安全，如果这样做，会导致簇崩溃。当某一节点崩溃时，簇中的一个节点（实际上是生存时间最久的节点）将为崩溃之时正在崩溃节点中运行的所有事务建立事务状态。因此，重要的是，该节点的事务记录数不低于失效节点中的事务记录数。</p>
				<p>该参数的默认值为<span>4096.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentOperations</span><span>
				</span></p>
				<p>
				根据事务的大小和数目调整该参数的值，这个想法不错。执行仅包含少量操作且不涉及很多记录的事务时，不需要将该参数设置得很高。但在执行涉及大量记录的大事务时，需要将该参数设置得较高。</p>
				<p>
				对于每次事务更新的簇数据，均会保存记录，并会将它们保存在事务协调器中以及执行实际更新的节点中。这些记录包含所需的状态信息，这类信息可用于为回滚操作找到<span>UNDO</span>记录，用于锁定查询或其他目的。</p>
				<p>
				该参数应被设置为：事务中同时更新的记录数除以簇数据节点的数目。例如，在包含<span>4</span>个数据节点的簇中，如果预期处理的、使用事务的并发更新数为<span>1000000</span>，就应将该值设置为<span>1000000 
				/ 4 = 250000</span>。</p>
				<p>
				设置锁定的读请求也会导致操作记录的创建。在单独节点内也会分配一些额外的空间，以便处理在节点间分配不完美的问题。</p>
				<p>
				当查询使用唯一性哈希索引时，对于事务中的每条记录，实际上将使用两条操作记录。第<span>1</span>条记录代表在索引表中的读，第<span>2</span>条记录负责处理基表上的操作。</p>
				<p>该参数的默认值为<span>32768.
				</span></p>
				<p>该参数实际上处理的是能分别配置的两个值。第<span>1</span>个值指定了将多少操作记录放到事务协调器中，第<span>2</span>个值指定了多少操作记录是数据库的本地记录。</p>
				<p>对于在<span>8</span>节点簇上执行的特大事务，它要求事务协调器中的操作记录数不少于事务中涉及的读取、更新和删除次数。然而，簇中的操作记录分布在所有的<span>8</span>个节点上。因此，如果有必要为特大事务配置系统，良好的方法是分别配置该参数的两个部分。<span><span>MaxNoOfConcurrentOperations</span>总会被用于计算</span>节点的事务协调器部分中的操作记录数。</p>
				<p>应了解操作记录对内存的要求，这点也很重要。每记录约消耗<span>1KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfLocalOperations</span><span>
				</span></p>
				<p>默认情况下，将按照<span>1.1 *
				<span>MaxNoOfConcurrentOperations</span></span><span>计算该参数，它适合于具有很多并发事务但不存在特大事务的系统。</span>如果需要在某一时间处理特大事务而且有很多节点，最好通过明确指定该参数以覆盖默认值。</p>
				<p><strong><span>事务临时存储</span></strong></p>
				<p>下一组参数用于决定执行作为簇事务组成部分的查询时所需的临时存储空间。查询完成后将释放所有记录，簇将等待提交或回滚事件。</p>
				<p>
				对于大多数情况，这些参数的默认值是恰当的。但是，如果需要支持涉及大量行或操作的事务，用户或许应增大这些参数的值，以便在系统中获得更好的平行性。对于需要相对较少事务的应用程序，用户可降低这些参数的值，以便节省内存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentIndexOperations</span><span>
				</span></p>
				<p>
				对于使用唯一性哈希索引的查询，在查询执行期间，将使用操作记录的另一个临时集合。该参数用于设置记录池的大小。因此，仅当执行查询的某一部分时才会分配该记录，一旦该部分执行完成，将释放记录。对于处理放弃和提交所需的状态，它是由正常的操作记录负责处理的，这类记录的池大小由参数<span>MaxNoOfConcurrentOperations</span>设置。</p>
				<p>该参数的默认值为<span>8192</span>。只有在极其罕见的情况下，需要使用唯一性哈希索引执行极高的并行操作时，才有必要增大该值。如果<span>DBA</span>（数据库管理员）确信该簇不需要高的并行操作，可以使用较小的值并节省内存。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfFiredTriggers</span><span>
				</span></p>
				<p>
				<span>MaxNoOfFiredTriggers</span>的默认值是<span>4000</span>，它足以应付大多数情况。在某些情况下，如果<span>DBA</span>认为在簇中对并行操作的要求并不高，甚至还能降低它。</p>
				<p>
				执行会影响唯一哈希索引的操作时，将创建记录。在具有哈希索引的表中插入或删除记录时，或更新作为唯一哈希索引组成部分的列时，均会触发索引表中的插入或删除操作。所获得的记录用于代表该索引表操作，同时等待促使其完成的初始操作。该操作的时间很短，但对于在基表（包含唯一哈希索引）上有很多并发写操作的情形，仍需要在记录池中有大量的记录。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionBufferMemory</span><span>
				</span></p>
				<p>
				该参数影响的内存用于跟踪更新索引表和读取唯一索引时执行的操作。该内存用于保存关于这类操作的键和列信息。几乎不需要更改该参数的默认值。</p>
				<p>正常的读和写操作使用类似的缓冲区，其使用时间甚至更短。编译时间参数<span>ZATTRBUF_FILESIZE</span>（在<span>ndb/src/kernel/blocks/Dbtc/Dbtc.hpp</span>中）被设为<span>4000*128</span>字节（<span>500KB</span>）。用于
				键信息的类似缓冲区，<span>ZDATABUF_FILESIZE</span>（也在<span><span>Dbtc.hpp</span>中）包含</span><span>4000 
				* 16 = 62.5KB</span>的缓冲空间。<span><span>Dbtc</span>是用于处理事务协调的模块。</span></p>
				<p><strong><span>扫描和缓冲</span></strong></p>
				<p>在<span><span>Dblqh</span>模块中</span>（在<span>ndb/src/kernel/blocks/Dblqh/Dblqh.hpp</span>内）有很多附加参数，这些参数会影响读和写操作。这些参数包括：<span>ZATTRINBUF_FILESIZE</span>，默认值为<span>10000*128</span>字节（<span>1250KB</span>）；以及<span>ZDATABUF_FILE_SIZE</span>，默认的缓冲空间大小为<span>10000*16</span>字节（约<span>156KB</span>）。到目前为止，没有任何迹象表明应增加这类编译时间限制参数的值，无论是用户报告还是我们自己的大量测试。</p>
				<p><span>
				TransactionBufferMemory</span>的默认值是<span>1MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfConcurrentScans</span><span>
				</span></p>
				<p>
				该参数用于控制可在簇中执行的并行扫描的数目。每个事务协调程序均能处理为该参数定义的并行扫描。对于每次执行的扫描查询，将以并行方式扫描所有分区。每次分区扫描将使用分区所在节点内的扫描记录，记录数等于该参数的值乘以节点数。簇应能支持从簇内所有节点同时执行的<span><span>MaxNoOfConcurrentScans</span>扫描。</span></p>
				<p>扫描实际上是在两种情况下执行的。第<span>1</span>种情况是，处理查询时不存在哈希或有序索引，在该情况下，查询是通过执行全表扫描进行的。第<span>2</span>种情况是，没有支持查询的哈希索引，但存在有序索引。使用有序索引意味着将执行并发范围扫描。由于顺序仅保存在本地分区上，需要在所有分区上执行索引扫描。</p>
				<p>
				<span>MaxNoOfConcurrentScans</span>的默认值是<span>256</span>。最大值为<span>500</span>。</p>
				<p>
				该参数指定了事务协调器中的可能扫描数。如果未提供本地扫描记录的数目，会对其进行计算，等于<span><span>MaxNoOfConcurrentScans</span>乘以系统中数据节点的数目。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfLocalScans</span><span>
				</span></p>
				<p>如果很多扫描不是完全并行化的，指定本地扫描记录的数目。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BatchSizePerLocalScan</span><span>
				</span></p>
				<p>
				该参数用于计算锁定记录的数目，要想处理很多并发扫描操作，需要这类记录。</p>
				<p>默认值是<span>64</span>，该值与<span>SQL</span>节点中定义的<span>ScanBatchSize</span>关系密切。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LongMessageBuffer</span><span>
				</span></p>
				<p>
				这是用于在单独节点内和节点之间传递消息的内部缓冲。尽管几乎不需要改变它，但它仍是可配置的。默认情况下，它被设置为<span>1MB</span>。</p>
				<p><strong><span>日志和<span>Checkpointing</span></span></strong></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfFragmentLogFiles</span><span>
				</span></p>
				<p>该参数用于设置节点的<span>REDO</span>日志文件的大小。<span>REDO</span>日志文件是按循环方式组织的。第<span>1</span>个和最后<span>1</span>个日志文件（有时也分别称为“头”日志文件和“尾”日志文件）不应相遇，这点极其重要，当它们彼此过于接近时，由于缺少新日志记录的空间，节点将开始放弃所有事务，包括更新。</p>
				<p>自插入日志记录开始，在三个本地检查点完成之前，不会删除<span>REDO</span>日志记录。检查点的频率由其自己的配置参数集决定，请参见本章的相应部分。</p>
				<p>默认的参数值为<span>8</span>，它表示有<span>8</span>个集合，每个集合有<span>4</span>个<span>16MB</span>文件，总容量为<span>512MB</span>。换句话讲，<span>REDO</span>日志空间必须按<span>64MB</span>的块大小分配。在需要大量更新的情况下，可能需要将<span><span>NoOfFragmentLogFiles</span>的值增加到<span>300</span>或更高，以便为<span>REDO</span>日志提供足够的空间。</span></p>
				<p>如果<span>checkpointing</span>很慢，并有很多对数据库的写操作以至于日志文件已满，而且在没有<span>jeapo 
				rdising</span>恢复功能的情况下无法截断日志尾部，那么所有的更新日志均将被放弃，并给出错误代码<span>410</span>或缺少临时日志空间。该状况将一直持续，直至完成了检查点操作并能将日志尾部向前移动为止。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfSavedMessages</span><span>
				</span></p>
				<p>
				该参数用于设置跟踪文件的最大数目，在覆盖旧文件之前，将保留这些跟踪文件。无论出于何种原因，当节点崩溃时将创建跟踪文件。</p>
				<p>默认为<span>25</span>个跟踪文件。</p>
				<p><strong><span>元数据对象</span></strong></p>
				<p>
				下一组参数为元数据对象定义了池的大小，可用于定义最大属性数，表，索引，索引使用的触发程序对象，事件，以及簇之间的复制。注意，这些参数仅是对簇的“建议”，任何未指定的参数均将采用其默认值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfAttributes</span><span>
				</span></p>
				<p>定义了可在簇中定义的属性数目。</p>
				<p>该参数的默认值为<span>1000</span>，最小的可能值为<span>32</span>。没有最大值限制。对于每一属性，每节点约需<span>200</span>字节的存储空间，这是应为，所有的元数据将完整地复制到服务器上。</p>
				<p>设置<span><span>MaxNoOfAttributes</span>时，应实现准备好打算在将来执行的任何<span>ALTER 
				TABLE</span>命令，这点很重要。这是因为下述事实，</span>在簇表上执行<span><span>ALTER 
				TABLE</span>的过程中，所使用的属性数目是原始表中的<span>3</span>倍。例如，</span>如果某一表需要<span>100</span>个属性，而且你打算在以后更改它，那么就需要将<span><span>MaxNoOfAttributes</span>的值设为<span>300</span>。有一个良好的经验规则，如果你能在不出现问题的情况下创建所有所需的表，请将最大表中属性数目的两倍加到<span>MaxNoOfAttributes</span>上。完成该设置后，应通过执行实际的<span>ALTER 
				TABLE</span>操作，验证该数目是足够的。如果失败，将原始值的倍数加到<span>MaxNoOfAttributes</span>上，并再次测试。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfTables</span><span>
				</span></p>
				<p>
				表对象是为每个表、唯一哈希索引和有序索引分配的。该参数为作为整体的簇设置了最大表对象数目。</p>
				<p>对于具有<span>BLOB</span>数据类型的每个属性，将使用额外的表来保存大部分<span>BLOB</span>数据。定义表的总数时，必须将这些表考虑在内。</p>
				<p>该参数的默认值为<span>128</span>。最小值为<span>8</span>，最大值为<span>1600</span>。每个表对象每节点约需<span>20KB</span>的空间。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfOrderedIndexes</span><span>
				</span></p>
				<p>对于簇中的每个有序索引，将分配<span>1</span>个对象，该对象描述了编入索引的是什么以及其存储段。默认情况下，每个这样定义的索引还将定义<span>1</span>个有序索引。每个唯一索引和主键既有<span>1</span>个有序索引还有<span>1</span>个哈希索引。</p>
				<p>该参数的默认值为<span>128</span>。每个对象每节点约需<span>10KB</span>的数据。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfUniqueHashIndexes</span><span>
				</span></p>
				<p>对于每个不是主键的唯一索引，将分配<span>1</span>个特殊表，该表将唯一键映射到索引表的主键上。默认情况下，对于每个唯一索引，还将定义<span>1</span>个有序索引。为了防止该情况，定义唯一索引时，必须使用<span><span>USING 
				HASH</span>选项。</span></p>
				<p>默认值是<span>64</span>。每个索引每节点约需<span>15KB</span>的空间。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfTriggers</span><span>
				</span></p>
				<p>
				对于每个唯一性哈希索引，将分配内部更新、插入、和删除触发程序（这意味着对于每个唯一性哈希索引，将创建三个触发程序）。但是，<span>1</span>个有序索引仅需要<span>1</span>个触发程序对象。对于簇中每个正常表，备份也将使用三个触发程序对象。</p>
				<p><strong>
				<span>注释</span></strong>：支持簇之间的复制时，也将使用内部触发程序。</p>
				<p>该参数用于设置簇中触发程序对象的最大数目。</p>
				<p>该参数的默认值为<span>768.
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]MaxNoOfIndexes</span><span>
				</span></p>
				<p>在<span>MySQL 5.1</span>中，该参数已被放弃，应使用<span>MaxNoOfOrderedIndexes</span>和<span>MaxNoOfUniqueHashIndexes</span>取而代之。</p>
				<p>
				该参数仅供唯一性哈希索引使用。对于在簇中定义的每个唯一性哈希索引，在该池中需要有<span>1</span>条记录。</p>
				<p>该参数的默认值为<span>128.
				</span></p>
				<p><strong><span>布尔参数</span></strong></p>
				<p>数据节点的行为也会受具有布尔值的一组参数的影响。将其设为“<span>1</span>”或“<span>Y</span>”，可将这类参数设置为“真”，将其设为“<span>0</span>”或“<span>N</span>”，可将这类参数设置为“假”。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LockPagesInMainMemory</span><span>
				</span></p>
				<p>对于包括<span>Solaris</span>和<span>Linux</span>在内的很多操作系统，能够将进程锁定在内存中，以避免与磁盘的交换。使用它，可确保簇的实时特性。</p>
				<p>默认情况下，该特性是被禁止的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StopOnError</span><span>
				</span></p>
				<p>出现错误时，该参数指定了<span>NDBD</span>进程是退出还是执行自动重启。</p>
				<p>默认情况下，允许该特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]Diskless</span><span>
				</span></p>
				<p>能够将<span>MySQL</span>簇的表指定为“无磁盘的”，这意味着不会在磁盘上对表执行检查点操作，也不会出现日志操作。这类表仅存在于主内存中。使用“无磁盘”表的一个结果是，出现崩溃侯，不会保留这类表，也不会保留这类表中的任何记录。但是，当工作在“无磁盘”模式下时，能够在无盘计算机上运行<strong><span>ndbd</span><span>。</span></strong></p>
				<p><strong>
				<span>要点：</span></strong>该特性会使整个簇运行在“无磁盘”模式下。</p>
				<p>允许该特性时，可执行备份操作，但不会实际保存备份数据。</p>
				<p>将“<span>Diskless</span>”设置为“<span>1</span>”或“<span>Y</span>”可允许该特性。默认情况下，禁止该特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]RestartOnErrorInsert</span><span>
				</span></p>
				<p>
				仅当创建调试版时才能访问该特性，在执行作为测试组成部份的代码块的过程中，可以插入错误。</p>
				<p>默认情况下，该特性是被禁止的。</p>
				<p><strong><span>控制超时、间隔、和磁盘分页</span></strong><span>
				</span></p>
				<p>有多种用于指定超时以及簇数据节点中各种动作间时间间隔的参数。大多数超时值以毫秒为单位指定。任何例外均将在适用时指明。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenWatchDogCheck</span><span>
				</span></p>
				<p>
				为了防止主线程在某一点上陷入无限循环，采用了“看门狗”线程来检查主线程。该参数以毫秒为单位指定了检查之间的时间间隔。如果三次检查之后进程仍保持在相同的状态，它将被“看门狗”线程中止。</p>
				<p>
				出于试验目的，可方便地更改该参数，也可以对其进行调整以适合本地条件。也可以按节点指定它，虽然这样作的理由很少。</p>
				<p>默认超时为<span>4000</span>毫秒（<span>4</span>秒）。<span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartPartialTimeout</span><span>
				</span></p>
				<p>
				该参数指定了在调用簇初始化子程序之前，簇等待所有存储节点出现的时间。该超时参数由于防止部分簇启动。</p>
				<p>默认值是<span>30000</span>毫秒（<span>30</span>秒）。<span><span>0</span>表示无限超时，换句话讲，</span>仅当所有节点均可能时才会启动簇。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartPartitionedTimeout</span><span>
				</span></p>
				<p>等待了<span><span>StartPartialTimeout</span>毫秒后，如果簇做好了启动准备但仍可能处于隔离状态，簇将等待该超时时间结束。</span></p>
				<p>默认超时为<span>60000</span>毫秒（<span>60</span>秒）。 
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]StartFailureTimeout</span><span>
				</span></p>
				<p>
				如果数据节点在该参数指定的时间内未完成其启动序列，节点启动将失败。如果将该参数设置为<span>0</span>，表示不采用数据节点超时。</p>
				<p>默认值是<span>60000</span>毫秒<span>(60</span>秒）。对于包含大量数据的数据节点，应增加该参数。例如，对于包含数<span>GB</span>数据的存储节点，为了执行节点重启，可能需要<span>10</span>～<span>15</span>分钟（即<span>600000</span>～<span>1000000</span>毫秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HeartbeatIntervalDbDb</span><span>
				</span></p>
				<p>
				发现失败节点的主要方法之一是使用“心跳”数。该参数指明了心跳信号的发送频率，以及接收它们的频率。如果在<span>1</span>行内丢失了三次心跳，节点将被宣告为死亡。因此，通过心跳机制发现故障的最大时间是心跳间隔的四倍。</p>
				<p>默认的心跳间隔为<span>1500</span>毫秒（<span>1.5</span>秒）。不得大幅度更改该参数，各节点间该参数的变化范围也不得过宽。例如，如果某一节点使用了<span>5000</span>毫米的值，而观察它的节点采用<span>1000</span>毫秒，很显然，该节点很快就会被宣布为死亡。能够在软件升级期间更改该参数，但增量应较小。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]HeartbeatIntervalDbApi</span><span>
				</span></p>
				<p>每个数据节点会将心跳信号发送到各<span>MySQL</span>服务器（<span>SQL</span>节点），以确保保持接触。如果某一<span>MySQL</span>服务器未能及时发出心跳信号，它将被宣布为死亡。在这种情况下，所有正在进行的事务将结束并释放所有资源。<span>SQL</span>节点不能重新连接，直至由以前的<span>MySQL</span>实例初始化的所有活动完成为止。用于该判断的<span>3</span>心跳判据与<span><span>HeartbeatIntervalDbDb</span>描述的相同。</span></p>
				<p>默认时间间隔为<span>1500</span>毫秒（<span>1.5</span>秒）。不同的数据节点之间，该间隔可以有所不同，这是因为，每个存储节点均会独立于所有其他数据节点观察与之相连的<span>MySQL</span>服务器。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenLocalCheckpoints</span><span>
				</span></p>
				<p>
				该参数是一个例外，它未指定启动新的本地检查前应等待的时间，相反，它用于确保在出现相对较少更新的簇内未执行本地检查点操作。在具有较高更新率的大多数簇内，很可能在前一个本地检查点操作完成后立刻启动一个新的检查点操作。</p>
				<p>
				从前一个本地检查点启动后，所有已执行写操作的大小将增加。该参数也是一个例外，原因在于它被指定为<span>4</span>字节字总数的以<span>2</span>为底数的对数，因此，默认值<span>20</span>表示<span>4MB 
				(4 </span>×<span> 2<sup>20</sup>)</span>写操作，<span>21</span>表示<span>8MB</span>，依此类推，直至等同于<span>8GB</span>写操作的最大值<span>31</span>。</p>
				<p>簇中所有的写操作将加在一起。将<span><span>TimeBetweenLocalCheckpoints</span>设置为<span>6</span>或更小表示本地检查点操作将不停顿地连续执行，与簇的工作负荷无关。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenGlobalCheckpoints</span><span>
				</span></p>
				<p>
				提交事务时，它被提交到存有镜像数据的所有节点的主内存中。但是，事务日志记录不会作为提交进程的一部分写入磁盘。其原因在于，在至少两台独立主机机器上安全体提交事务应能满足关于关于持久性的合理标准。</p>
				<p>
				另一个很重要的方面是，应确保即使在最差情况下（簇完全崩溃），也能进行恰当地处理。为了确保这点，在给定时间间隔内出现的所有事务均会被放到全局检查点，可将其视为写入磁盘的已提交事务的集合。换句话讲，作为提交进程的组成部分，事务将被放入全局检查点组；稍后，该组的日志记录将被写入磁盘，然后将整个事务组安全地提交到簇内所有计算机的磁盘上。。</p>
				<p>该参数定义了全局检查点操作之间的时间间隔。默认值为<span>2000</span>毫秒。<span> 
				milliseconds. </span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TimeBetweenInactiveTransactionAbortCheck</span><span>
				</span></p>
				<p>
				对于该参数指定的每个时间间隔，通过检查每个事务的定时器来执行超时处理。因此，如果该参数被设为<span>1000</span>毫秒，每隔<span>1</span>秒就会对事务进行检查。</p>
				<p>该参数的默认值为<span>1000</span>毫秒（<span>1</span>秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionInactiveTimeout</span><span>
				</span></p>
				<p>
				如果事务目前未执行任何查询，而是等待进一步的用户输入，该参数指明了放弃事务之前用户能够等待的最长时间。</p>
				<p>该参数的默认值是<span>0</span>（无超时）。对于需要确保无任何事务锁定了过长时间的数据库，应将参数设置为较小的值。单位为毫秒。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]TransactionDeadlockDetectionTimeout</span><span>
				</span></p>
				<p>
				当节点执行涉及事务的查询时，在继续之前，节点将等待簇中其他节点作出回应。如果出现下述原因，将无法予以回应：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>节点“死亡”。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>操作进入锁定队列。</p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>被请求执行动作的节点负荷过重。</p>
				<p>
				该超时参数指明了放弃事务之前，事务协调器等候另一节点执行查询的时间长短，该参数在节点失败处理和死锁检测方面十分重要。在涉及死锁和节点失败的情形下，如果将其设置的过高，会导致不合需要的行为。</p>
				<p>默认的超时值为<span>1200</span>毫秒（<span>1.2</span>秒）。<span>
				</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskAfterRestartTUP</span><span>
				</span></p>
				<p>
				执行本地检查点操作时，相应的算法会将所有数据页写入磁盘。如果追求尽快完成该操作而不是适中，很可能会对处理器、网络和磁盘带来过重负担。为了控制写入速度，该参数指明了每<span>100</span>毫秒可写入多少数据页。在本情形下，<span>1</span>个数据页定义为<span>8KB</span>，因而该参数的单位是每秒<span>80KB</span>。因此，如果将<span><span>NoOfDiskPagesToDiskAfterRestartTUP</span>设置为<span>20</span>，</span>那么在执行本地检查点操作期间，要求每秒想磁盘写入<span>1.6MB</span>的数据。该值包括针对数据页的<span>UNDO</span>日志记录写入，也就是说，该参数能处理来自数据内存的写入限制。置于针对索引页的<span>UNDO</span>日志记录，它们是由参数<span>NoOfDiskPagesToDiskAfterRestartACC</span>处理的（关于索引页的更多信息，请参见关于<span><span>IndexMemory</span>的条目）。</span></p>
				<p>简而言之，该参数指定了执行本地检查点操作的速度，并能与<span>NoOfFragmentLogFiles</span>、<span>DataMemory</span>和<span>IndexMemory</span>一起使用。</p>
				<p>默认值是<span>40</span>（每秒<span>3.2MB</span>的数据页）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskAfterRestartACC</span><span>
				</span></p>
				<p>该参数使用的单位与<span><span>NoOfDiskPagesToDiskAfterRestartTUP</span>的相同，工作方式也类似，但限制的是从索引内存进行的索引页写入速度。</span></p>
				<p>该参数的默认值为每秒<span>20</span>个索引内存页（<span>1.6MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskDuringRestartTUP</span><span>
				</span></p>
				<p>该参数的工作方式类似于<span>NoOfDiskPagesToDiskAfterRestartTUP</span>和<span><span>NoOfDiskPagesToDiskAfterRestartACC</span>，</span>但仅对重启节点时在节点内执行的本地检查点操作有效。作为所有节点重启的组成部份，总会执行本地检查点操作。在节点重启过程中，能够以比其他时间更快的速度执行磁盘写入操作，这是因为，此时在节点内执行的活动数较少。</p>
				<p>该参数涉及从数据内存写入的页。</p>
				<p>默认值是<span>40</span>（<span>3.2MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]NoOfDiskPagesToDiskDuringRestartACC</span><span>
				</span></p>
				<p>
				在节点重启的本地检查点阶段，对能够写入到磁盘的索引内存页的数目进行控制。</p>
				<p>与<span>NoOfDiskPagesToDiskAfterRestartTUP</span>和<span>NoOfDiskPagesToDiskAfterRestartACC</span>一样，该参数的值采用的单位也是每<span>100</span>毫秒写入<span>8KB</span>（<span>80KB/</span>秒）。</p>
				<p>默认值是<span>20 (1.6MB</span>每秒）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]ArbitrationTimeout</span><span>
				</span></p>
				<p>
				该参数指定了数据节点等待仲裁程序对仲裁消息的回应的时间。如果超过了该时间，将假定网络已断开。</p>
				<p>默认值是<span>1000</span>毫秒（<span>1</span>秒）。</p>
				<p><strong><span>缓冲和日志功能</span></strong></p>
				<p>
				一些与以前的编译时间参数对应的配置参数仍可用。使用这些参数，高级用户能够对节点进程使用的资源进行更多的控制，并能根据需要调整各种缓冲区大小。</p>
				<p>
				将日志记录写入磁盘时，这些缓冲区用作文件系统的前端。如果节点运行在无盘模式下，那么可以将这些参数设置为它们的最小值而不会造成负面影响，这是因为，磁盘写入是由<span>NDB</span>存储引擎的文件系统提取层虚拟的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]UndoIndexBuffer</span><span>
				</span></p>
				<p>该缓冲用于本地检查点操作执行期间。<span><span>NDB</span>存储引擎</span>采用了一种恢复方案，该方案建立在检查点一致性以及操作性<span>REDO</span>日志值上。为了在不隔断整个系统的写操作的情况下获得一致的检查点，在执行本地检查点操作的同时，将执行<span>UNDO</span>日志操作。<span>UNDO</span>日志功能每次是在单个表偏短上触发的。由于表全部保存在主内存中，该优化是可能的。</p>
				<p><span>UNDO</span>索引缓冲用于主键哈希索引上的更新。插入和删除操作会导致哈希索引的重新排列，<span>NDB</span>存储引擎将映射了所有物理变化的<span>UNDO</span>日志记录写入索引页，以便能在系统重启时撤销这些变化。它还能记录启动本地检查点操作时对每个偏短的所有插入操作。</p>
				<p>
				读取和更新能够设置锁定位，并更新哈希索引条目中的标题。这类变更由页写入算法负责处理，以确保这些操作不需要<span>UNDO</span>日志。</p>
				<p>该缓冲的默认大小为<span>2MB</span>。最小值为<span>1MB</span>，对于大多数应用，最小值已足够。对于执行极大和／或大量插入和删除操作、并处理大事务和大主键的应用程序，或许有必要增大该缓冲。如果该缓冲过小，<span>NDB</span>存储引擎会发出错误代码<span>677</span>“索引<span>UNDO</span>缓冲过载”<span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]UndoDataBuffer</span><span>
				</span></p>
				<p><span>UNDO</span>数据缓冲的作用与<span>UNDO</span>索引缓冲的相同，不同之处在于，它作用在数据内存上而不是索引内存上。对于插入、删除和更新，该缓冲是在片段的本地检查点阶段使用的。</p>
				<p>由于<span>UNDO</span>日志条目会随着所记录操作的增加而增大，该缓冲大于与之对应的索引内存缓冲，默认值为<span>16MB</span>。</p>
				<p>
				对于某些应用程序，该内存可能过大。在这种情况下，可降低它的值，最小为<span>1MB</span>。</p>
				<p>
				需要增加该缓冲的情况十分罕见。如果确实有这方面的要求，较好的方式是，检查磁盘是否能实际处理数据库更新活动所产生的负荷。如果缺少足够的磁盘空间，即使增加该缓冲的大小也不能解决问题。</p>
				<p>如果该缓冲过小并变得“拥挤不堪”，<span>NDB</span>存储引擎将发出错误代码<span>891</span>“数据<span>UNDO</span>缓冲过载”。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]RedoBuffer</span><span>
				</span></p>
				<p>
				所有的更新活动也需要被记录到日志中。使用这类日志，当系统重启时，能够重现这类更新。<span>NDB</span>恢复算法采用了“模糊”数据检查点和<span>UNDO</span>日志，然后使用<span>REDO</span>日志再现所有变化直至到达恢复点。</p>
				<p>该缓冲的默认大小是<span>8MB</span>。最小值为<span>1MB</span>。</p>
				<p>如果该缓冲过小，<span>NDB</span>存储引擎将发出错误代码<span>1221</span>“<span><span>REDO</span>日志缓冲过载<span>”</span>。</span></p>
				<p>在管理簇的过程中，应能控制为各种事件类型发送至标准输出装置的日志消息的数目，这点十分重要。有<span>16</span>种可能的事件级别（编号从<span>0</span>到<span>15</span>）。如果将给定事件类别的事件通报级别设置为<span>15</span>，那么该类别中的所有事件报告均会被发送至标准输出装置，如果将其设置为<span>0</span>，表示在该类别中的没有事件报告。</p>
				<p>默认情况下，仅会将启动消息发送至标准输出装置，其余的事件通报级别默认为<span>0</span>。这样做的原因在于，这些消息也会被发送至管理服务器的簇日志。</p>
				<p>对于管理客户端，也能设置类似的级别，用以确定在簇日志中记录哪些级别的事件。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelStartup</span><span>
				</span></p>
				<p>通报级别，用于进程启动过程中生成的事件。</p>
				<p>默认级别为<span>1. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelShutdown</span><span>
				</span></p>
				<p>通报级别，用于作为节点恰当关闭进程组成部分而生成的事件。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelStatistic</span><span>
				</span></p>
				<p>
				通报级别，用于统计事件，如主键法读取次数，更新数目，插入数目，与缓冲使用有关的信息等。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelCheckpoint</span><span>
				</span></p>
				<p>通报级别，用于由本地和全局检查点操作生成的事件。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelNodeRestart</span><span>
				</span></p>
				<p>通报级别，用于在节点重启过程中生成的事件。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelConnection</span><span>
				</span></p>
				<p>通报级别，用于由簇节点间的连接生成的事件。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelError</span><span>
				</span></p>
				<p>
				通报级别，用于由在整个簇内的错误和警告生成的事件。这类错误不会导致任何节点失败，当仍值得通报。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]LogLevelInfo</span><span>
				</span></p>
				<p>通报级别，用于为簇的一般状态信息而生成的事件。</p>
				<p>默认级别为<span>0. </span>
				</p>
				<p><strong><span>备份参数</span></strong></p>
				<p>本节讨论的参数定义了与在线备份执行有关的内存缓冲集。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupDataBufferSize</span><span>
				</span></p>
				<p>
				在创建备份的过程中，为了将数据发送到磁盘，将使用两类缓冲。备份数据缓冲用于填充由扫描节点的表而记录的数据。一旦将该缓冲填充到了指定的水平<span>BackupWriteSize</span>（请参见下面的介绍），就会将页发送至磁盘。在将页写入磁盘的同时，备份进程能够继续填充该缓冲，直至其空间消耗完为止。出现该情况时，备份进程将暂停扫描，直至一些磁盘写入操作完成并释放了内存为止，然后扫描继续。</p>
				<p>该参数的默认值为<span>2MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupLogBufferSize</span><span>
				</span></p>
				<p>
				备份日志缓冲扮演的角色类似于备份数据缓冲，不同之处在于，它用于生成备份执行期间进行的所有表写入的日志。相同的原理也适用于备份数据缓冲情形下的页写入，不同之处在于，当备份日志缓冲中没有多余空间时，备份将失败。出于该原因，备份日志缓冲的大小应足以处理执行备份时产生的负载。</p>
				<p>
				该参数的默认值对于大多数应用程序均是适当的。事实上，备份失败的原因更可能是因为磁盘写入速度不够，而不是备份日志缓冲变满。如果没有为应用程序产生的写负载配置磁盘子系统，簇很可能无法执行所需的操作。</p>
				<p>最好按恰当的方式配置簇，使得处理器成为瓶颈而不是磁盘或网络连接。</p>
				<p>默认值是<span>2MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupMemory</span><span>
				</span></p>
				<p>该参数是<span><span>BackupDataBufferSize</span>和<span>BackupLogBufferSize</span></span>之和。</p>
				<p>默认值是<span>2MB + 2MB = 
				4MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[NDBD]BackupWriteSize</span><span>
				</span></p>
				<p>该参数指定了由备份日志缓冲和备份数据缓冲写入磁盘的消息大小。</p>
				<p>默认值是<span>32KB. </span></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-api-definition"></a>
				17.4.4.6.&nbsp;定义MySQL簇内的SQL节点</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				在<span><span>config.ini</span>文件的<span>[MYSQLD]</span>部分中，定义了用于访问簇数据的<span>MySQL</span>服务器（<span>SQL</span>节点）的行为</span>。不需要其中所给出的参数。如果未提供计算机或主机名，那么任何主机均能使用该<span>SQL</span>节点。<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]Id</span><span> </span></p>
				<p>该值用作节点的地址，供所有的簇内部消息使用，它必须是介于<span>1</span>和<span>63</span>之间的整数。在簇内，每个簇节点必须有唯一的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]ExecuteOnComputer</span><span> </span>
				</p>
				<p>它引用的是在配置文件的<span><span>[COMPUTER]</span>部分定义的主机（计算机）之一。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]ArbitrationRank</span><span>
				</span></p>
				<p>该参数用于定义可作为仲裁程序的节点。<span>MGM</span>节点和<span>SQL</span>节点均能成为仲裁程序。如果值为<span><span>0</span>，表明给定的节点永远不会用作仲裁程序，如果值为<span>1</span>，表明给定的节点在成为仲裁程序方面具有高的优先级，如果值为<span>2</span>，表明给定的节点在成为仲裁程序方面具有低的优先级</span>。对于正常配置，使用管理服务器作为仲裁程序，将它的<span><span>ArbitrationRank</span>设置为<span>1</span>（默认），并将所有<span>SQL</span>节点的<span>ArbitrationRank</span>设置为<span>0</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]ArbitrationDelay</span><span> </span>
				</p>
				<p>如果将该参数设置为除<span>0</span>（默认值）以外的其他值，表示仲裁程序对仲裁请求的相应将被延迟设定的毫秒数。通常不需要更改该值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[MYSQLD]BatchByteSize</span><span> </span></p>
				<p>
				对于转换为全表扫描或对索引的范围扫描的查询，要想获得最佳性能，重要的是以恰当的大小获取记录。能够以记录数为单位（<span>BatchSize</span>）和字节为单位（<span><span>BatchByteSize</span>）设置恰当的大小。</span>实际的批大小由两个参数限定。</p>
				<p>查询的执行速度可能会出现<span>40</span>％的变化，具体情况取决于该参数的设置。在未来的版本中，<span>MySQL</span>服务器将根据查询类型恰当地设置与批大小相关的参数。</p>
				<p>该参数以字节为单位，默认值是<span>32KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]BatchSize</span><span>
				</span></p>
				<p>该参数以记录数为单位，默认值是<span>64</span>。最大值为<span>992</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[MYSQLD]MaxScanBatchSize</span><span>
				</span></p>
				<p>
				批大小指的是从各数据节点发送的每批数据的大小。大多数扫描均是以并行方式执行的，目的是为了防止<span>MySQL</span>服务器收到来自众多节点的过多数据，该参数对所有节点上的总的批大小进行了限制。</p>
				<p>该参数的默认值为<span>256KB</span>。其最大大小为<span>16MB</span>。</p>
				<h4 class="title"><a name="mysql-cluster-tcp-definition"></a>
				17.4.4.7.&nbsp;MySQL簇TCP/IP连接</h4></div></div></div>
				<p>在<span>MySQL</span>簇中，<span>TCP/IP</span>是用于建立连接的默认传输协议。正常情况下不需要定义连接，这是因为，簇能自动建立数据节点间、数据节点与所有<span>MySQL</span>服务器节点、以及数据节点与管理服务器之间的连接（关于该规则的例外，，请参见<a href="ndbcluster.html#mysql-cluster-direct-tcp-definition" title="17.4.4.8. MySQL Cluster TCP/IP Connections Using Direct Connections">17.4.4.8节，“使用直接连接的MySQL簇TCP/IP连接”</a><span>)</span>。</p>
				<p>如果打算覆盖默认的连接参数，才需要定义连接。在这种情况下，至少需要定义<span><i><span>NodeId1</span></i></span>、<span><i><span>NodeId2</span></i></span>、以及打算更改的参数。</p>
				<p>通过在<span><span>[TCP 
				DEFAULT]</span>部分进行设置，也能更改这些参数的默认值。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[TCP]<i>NodeId1</i></span><span> ,
				<span>[TCP]<i>NodeId2</i></span> </span>
				</p>
				<p>要想确定两个节点之间的连接，需要在配置文件的［<span>TCP</span>］部分中提供每个节点的<span>ID</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]SendBufferMemory</span><span>
				</span></p>
				<p>在向操作系统发出调用请求之前，<span>TCP</span>传输器采用缓冲来保存所有的消息。当该缓冲达到<span>64KB</span>时，将发送其内容，执行完一组消息循环后，也将发送这些内容。为了处理临时过载情况，也能定义一个较大的发送缓冲。发送缓冲的默认值是<span>256KB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]SendSignalId</span><span>
				</span></p>
				<p>为了能够回扫分布式消息图，需要确定每条消息。将该参数设置为“<span>Y</span>”时，将通过网络传输消息<span>ID</span>。默认情况下禁止该特性。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]Checksum</span><span>
				</span></p>
				<p>该参数也是一个布尔参数（<span>Y</span><span>/<span>N</span></span>或<span>1</span><span>/<span>0</span></span>），默认情况下是禁止的。启用了该参数时，在将所有消息置于发送缓冲之前，将为所有参数计算校验和。使用该特性，当消息等候在发送缓冲中时，可以确保消息不会损坏，也能确保消息不会被传输机制破坏。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]PortNumber</span><span>
				</span></p>
				<p>
				（已过时）以前，该参数指定了用于监听来自其他节点的连接的端口号。不应再使用嘎参数。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[TCP]ReceiveBufferMemory</span><span>
				</span></p>
				<p>指定了从<span>TCP/IP</span>套接字接收数据时所使用的缓冲大小。几乎不需要更改该参数的默认值，默认值为<span>64KB</span>，但是如果打算节省内存，也能更改它。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-direct-tcp-definition"></a>17.4.4.8. 使用直接连接的MySQL簇TCP/IP连接</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			使用数据节点之间的直接连接建立簇时，需要在簇<span><span>config.ini</span>文件的<span>[TCP]</span>部分中</span>明确指定如此连接的数据节点的交叉<span>IP</span>地址。<p>
			在下面的示例中，假定簇具有至少<span>4</span>台主机，<span>1</span>台用于管理服务器，一台用于<span>SQL</span>节点，两台用于数据节点。作为整体，簇位于<span>LAN</span>的<span>172.23.72.*</span>子网内。除了通常的网络连接外，两个数据节点使用标准的交叉电缆直接相连，并使用范围在<span><span>1.1.0.*</span>的</span><span>IP</span>地址彼此间直接通信，如下所示：</p>
			<pre><span># Management Server</span></pre>
			<pre><span>[NDB_MGMD]</span></pre>
			<pre><span>Id=1</span></pre>
			<pre><span>HostName=172.23.72.20</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># SQL Node</span></pre>
			<pre><span>[MYSQLD]</span></pre>
			<pre><span>Id=2</span></pre>
			<pre><span>HostName=172.23.72.21</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># Data Nodes</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>Id=3</span></pre>
			<pre><span>HostName=172.23.72.22</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span>[NDBD]</span></pre>
			<pre><span>Id=4</span></pre>
			<pre><span>HostName=172.23.72.23</span></pre>
			<pre><span>&nbsp;</span></pre>
			<pre><span># TCP/IP Connections</span></pre>
			<pre><span>[TCP]</span></pre>
			<pre><span>NodeId1=3</span></pre>
			<pre><span>NodeId2=4</span></pre>
			<pre><span>HostName1=1.1.0.1</span></pre>
			<pre><span>HostName2=1.1.0.2</span></pre>
			<p>使用数据节点间的直接连接能够改善簇的整体效率，使用该方式，数据节点能绕过以太网设备，如交换器、<span>Hub</span>、路由器等，从而减少了簇的等待时间。注意，对于两个以上的数据节点，要想充分利用这类直接连接的优点，需要为各数据节点建立与相同节点组内的其他数据节点间的直接连接。</p>
			<h4 class="title"><a name="mysql-cluster-shm-definition"></a>
			17.4.4.9.&nbsp;MySQL簇共享内存连接</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				<span>MySQL</span>簇将尝试使用共享内存传输器，并在可能的情况下自动配置它，尤其是在相同的簇主机上同时运行着<span>1</span>个以上的节点时。在<span>MySQL</span>簇的早期版本中，仅当使用<span><span>--with-ndb-shm</span>创建了<span>-max</span>二进制版本时，才支持共享内存段。明确地将共享内存定义为连接方法时，至少需要定义<span>NodeId1</span></span>、<span>NodeId2</span>和<span>ShmKey</span>。对于所有其他参数，应具有在大多数情况下均良好工作的默认值。<p>
				<strong><span>注释：</span></strong><span>SHM</span>支持仍应被视为试验性的。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[SHM]NodeId1</span><span>,
				<span>[SHM]NodeId2</span> </span></p>
				<p>要想确定两个节点之间的连接，需要为每个节点提供节点<span>ID</span>，<span>NodeId1</span>和<span>NodeId2</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]ShmKey</span><span>
				</span></p>
				<p>设置共享内存段时，节点<span>ID</span>用于唯一地确定通信所用的共享内存段。它以整数表示，没有默认值。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]ShmSize</span><span>
				</span></p>
				<p>每个<span>SHM</span>连接均有一个共享内存段，发送方将节点之间的消息置于该处，读取方从该处读取这类消息。<span>gai
				</span>共享内存段的大小由<span>ShmSize</span>定义。默认值是<span>1MB</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				[SHM]SendSignalId</span><span> </span></p>
				<p>为了回扫分布式消息的路径，需要为每条消息提供唯一性<span>ID</span>。如果将该参数设置为“<span>Y</span>”，也能在网络上传输这类消息<span>ID</span>。<span>默认情况下，该特性是禁止的。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[SHM]Checksum</span><span>
				</span></p>
				<p>该参数也是一种<span>Y</span><span>/<span>N</span></span><span>参数，默认情况下处于禁止状态。如果允许该参数，在将所有消息置于发送缓冲之前，对为所有消息计算校验和。</span></p>
				<p>
				使用该特性，当消息等候在发送缓冲中时，能防止消息损坏。此外，它还能用于在传输过程中检查损坏的数据。</p>
				<h4 class="title"><a name="mysql-cluster-sci-definition"></a>
				17.4.4.10.&nbsp;MySQL簇SCI传输连接</h4></div></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		仅当使用<span>--with-ndb-sci=<i>/your/path/to/SCI</i></span>创建了<span>MySQL-Max</span>二进制版本时，在<span>MySQL</span>簇中才支持使用<span>SCI</span>传输器来连接节点。<span><i><span>path</span></i></span>应指向包含最低库的目录，并应包括含<span>SISCI</span>库和头文件的目录。<p>
		此外，<span>SCI</span>要求专用硬件。</p>
		<p>强烈建议，仅应为<span>ndbd</span>进程之间的通信使用<span>SVI</span>传输器。注意，使用<span>SCI</span>传输器意味着<span>ndbd</span>进程永不停止。因此，仅应在具有至少两块专供<span>ndbd</span>进程使用的<span>CPU</span>的机器上使用<span>SCI</span>传输器。每个<span>ndbd</span>进程至少应有<span>1</span>块<span>CPU</span>，至少还应有<span>1</span>块<span>CPU</span>用于处理操作系统的活动。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]NodeId1</span><span>,
		<span>[SCI]NodeId2</span> </span></p>
		<p>为了确定两个节点之间的连接，需要为每个节点提供节点<span>ID</span>，<span>NodeId1</span>和<span>NodeId2</span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host1SciId0</span><span> </span></p>
		<p>它用于确定第<span>1</span>个簇节点上的<span>SCI</span>节点<span>ID</span>（由<span>NodeId1</span>确定）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host1SciId1</span><span> </span></p>
		<p>能够为两块<span>SCI</span>卡间的故障切换设置<span>SCI</span>传输器，这两块卡应使用节点之间的不同网络。它用于确定节点<span>ID</span>，以及在第<span>1</span>个节点上使用的第<span>2</span>块<span>SCI</span>卡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host2SciId0</span><span> </span></p>
		<p>它用于确定第<span>2</span>个簇节点上的<span>SCI</span>节点<span>ID</span>（由<span>NodeId2</span>确定）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>
		[SCI]Host2SciId1</span><span> </span></p>
		<p>使用两块<span>SCI</span>卡来提供故障切换功能时，该参数用于确定将在第<span>2</span>个节点上使用的第<span>2</span>块<span>SCI</span>卡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SharedBufferSize</span><span>
		</span></p>
		<p>每个<span>SCI</span>传输器均有<span>1</span>个用于两节点间通信的共享内存段。可将该共享内存段设置为默认的<span>1 
		MB</span>，这足以应对大多数应用程序。如果使用较小的值，当执行大量并行插入操作时，会出现问题，如共享缓冲过小，还会导致<span>ndbd</span>进程崩溃。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SendLimit</span><span>
		</span></p>
		<p><span>SCI</span>媒介前面的小缓冲用于保存消息，在通过<span>SCI</span>网络传输这类消息前，会将它们保存在该缓冲内。它的默认值为<span>8kB</span>。按照我们的基准，在<span>64KB</span>时性能最好，但<span>16kB</span>仅有少量提升，即使大于<span>8KB</span>有好处，好处也不大。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]SendSignalId</span><span>
		</span></p>
		<p>为了跟踪分布式消息，需要唯一地确定每条消息。将该参数设置为“<span>Y</span>”时，就能在网络上传输消息<span>ID</span>。默认情况下禁止该特性。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>[SCI]Checksum</span><span>
		</span></p>
		<p><span>T</span>该参数也是一种布尔值，默认情况下，该参数是被禁止的。启用了<span><span>Checksum</span>（校验和）时，</span>在将所有消息置于发送缓冲之前，将为所有参数计算校验和。使用该特性，当消息等候在发送缓冲中时，可以确保消息不会损坏。此外，它还能用于在传输过程中检查损坏的数据。</p>
		<h2 class="title"><a name="mysql-cluster-process-management"></a>
		17.5.&nbsp;MySQL簇中的进程管理</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysqld-process">
			17.5.1. 用于MySQL簇的MySQL服务器进程使用</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-process">17.5.2. <span><strong class="command">
			ndbd</strong></span>，存储引擎节点进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-process">17.5.3. <span><strong class="command">
			ndb_mgmd</strong></span>，“管理服务器”进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-process">17.5.4. <span><strong class="command">
			ndb_mgm</strong></span>，“管理客户端”进程</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-command-options">
			17.5.5. 用于MySQL簇进程的命令选项</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
			要想掌握管理<span>MySQL</span>簇的方法，需要了解<span>4</span>种基本进程。在本章下面的几节内，介绍了这些进程在簇内的作用，它们的使用方法，以及每种进程可用的启动选项。<h3 class="title"><a name="mysqld-process"></a>
			17.5.1.&nbsp;用于MySQL簇的MySQL服务器进程使用</h3></div></div></div>
			<p><strong><span>mysqld</span></strong>是传统的<span>MySQL</span>服务器进程。要想与<span>MySQL</span>簇一起使用，所创建的<strong><span>mysqld</span></strong>应支持<span><span>NDB</span>簇存储引擎，就像在预编译的<span>-max</span>二进制版本中那样，</span><span><a target="_top"  href="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</a></span>。</p>
			<p>即使采用该方式创建了<strong><span>mysqld</span></strong>二进制版本，在默认情况下，<span><span>NDB</span>簇存储引擎仍处于禁止状态。要想启用<span>NDB</span>簇存储引擎，可使用两种可能的选项之一：</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>启动<b><span>mysqld</span></b>时，将“—<span>ndbcluster</span>”用作启动选项。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>在<span><span>my.cnf</span>文件的<span>[mysqld]</span>部分插入包含<span>ndbcluster</span>的<span>1</span>行内容。</span></p>
			<p>验证运行的服务器是否启用了<span><span>NDB</span>簇存储引擎的简单方法是，在<span>MySQL</span>监视器（<span>mysql</span>）中发出命令<span>SHOW 
			ENGINES</span>。在列出<span>NDBCLUSTER</span>的行中应能看到值<span>YES</span>，如果在该行上看到<span>NO</span>（或在输出中未显示该行），你所运行的是未启用<span>NDB</span>功能的<span>MySQl</span>版本。如果在该行上看到<span>DISABLED</span>，就需采用上述两种方法之一启用它。</span></p>
			<p>为了读取簇配置数据，<span>MySQL</span>服务器至少需要<span>3</span>种信息：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>MySQL</span>服务器自己的簇节点<span>ID</span>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>管理服务器（<span>MGM</span>节点）的主机名或<span>IP</span>地址。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>与管理服务器相连的端口。</p>
			<p>节点<span>ID</span>可动态分配，因此不一定需要明确指定它们。</p>
			<p><strong><span>mysqld</span></strong>参数<span><span>ndb-connectstring</span>用于指定连接字符串，或是在启动</span><strong><span>mysqld</span></strong>时在命令行上指定，或是在<span><span>my.cnf</span>文件中指定。连接字符串包含主机名或<span>IP</span>地址，</span>以及能够发现管理服务器的端口。</p>
			<p>在下面的示例中，<span>ndb_mgmd.mysql.com</span>是管理服务器所在的主机，管理服务器在端口<span>1186</span>上监听簇消息。</p>
			<pre><span>shell&gt; <span><b>mysqld --ndb-connectstring=ndb_mgmd.mysql.com:1186</b></span></span></pre>
			<p>关于连接字符串的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2节，“MySQL簇连接字符串<code class="literal"></code>”</a>。</p>
			<p>给定该信息，<span>MySQL</span>服务器将成为簇中的完全参与者。（有时，我们也将运行在该方式下的<strong><span>mysqld</span></strong>进程称为<span>SQL</span>节点）。它能完全了解所有的簇数据节点以及它们的状态，并能建立与所有数据节点的连接。在这种情形下，它能将任何数据节点用作事务协调器，并能访问数据节点以执行读取和更新操作。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndbd-process"></a>17.5.2. <span><strong class="command">ndbd</strong></span>，存储引擎节点进程</h3></div></div></div>
			<p><strong><span>ndbd</span></strong>是使用<span>NDB</span>簇存储引擎处理表中所有数据的进程。通过该进程，存储节点能够实现分布式事务处理，节点恢复，对磁盘的检查点操作，在线备份，以及相关的任务。</p>
			<p>在<span>MySQL</span>簇中，一组<strong><span>ndbd</span></strong>进程能够共同处理数据。这些进程可以在相同的计算机（主机）上执行，也能在不同的计算机上执行。数据节点和簇主机之间的通信是完全可配置的。</p>
			<p><strong><span>Ndbd</span></strong>将生成一组日志文件，这些文件位于由配置文件中<span><span>DataDir</span>指定的目录下。下面列出了这些日志文件。注意，<i><span>node_id</span></i></span>代表节点的唯一<span>ID</span>。例如，<span><span>ndb_2_error.log</span>是由节点<span>ID</span>为<span>2</span>的存储节点生成的错误日志。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_error.log</span>是包含所引用<span>ndbd</span>进程所遇到的所有崩溃记录的文件。该文件中的每条记录均包含<span>1</span>个简要的错误字符串，以及对该崩溃跟踪文件的引用。该文件的典型条目与下面给出的类似：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Date/Time: Saturday 30 July 2004 - 00:20:01</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Type of error: error</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Message: Internal program error (failed ndbrequire)</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Fault ID: 2341</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Problem data: DbtupFixAlloc.cpp</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>Object of reference: DBTUP (Line: 173)</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>ProgramName: NDB Kernel</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>ProcessID: 14909</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>TraceFile: ndb_2_trace.log.2</span></pre>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>***EOM***</span></pre>
			<p><strong>
			<span>注释：</span></strong><em><span>请记住，错误日志文件中的最后<span>1</span>个条目并不必然是最新的（也不太可能），这点很重要</span><span>。</span></em>错误日志中的条目不是按时间顺序排列的，而是与<span><span>ndb_<i>node_id</i>_trace.log.next</span>（请参见下面的介绍）中定义的跟踪文件的顺序对应。因此，错误日志条目是按循环方式而不是顺序方式覆盖的。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_trace.log.<i>trace_id</i></span>是准确描述了错误出现之时所发生情况的跟踪文件。该信息在<span>MySQL</span>簇开发团队进行分析时很有帮助。</p>
			<p>能够对覆盖旧文件之前创建的跟踪文件的数目进行配置。<span><i><span>trace_id</span></i></span>是为每个连续的跟踪文件增加的编号。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_trace.log.next</span>是记录了要指定的下一个跟踪文件编号的文件。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_out.log</span>是包含<span>ndbd</span>进程的任何数据输出的文件。仅当将<span>ndbd</span>启动为端口监督程序时才会创建该文件。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>.pid</span>是包含启动时作为端口监督程序的<span>ndbd</span>进程的进程<span>ID</span>的文件。它还能起到锁定文件的作用，以防止启动具有相同<span>ID</span>的节点。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_signal.log</span>是仅在<span>ndbd</span>调试版下使用的文件，它能跟踪<span>ndbd</span>进程中所有的入站、出站和内部消息。以及它们的数据。</p>
			<p>建议不要使用通过<span>NFS</span>安装的目录，这是因为在某些情况下，如果<span>pid-file</span>上的锁定依旧有效，即使当进程中止后也会产生问题。</p>
			<p>启动<strong><span>ndbd</span></strong>时，或许需要指定管理服务器的主机名以及监听的端口号。作为可选方式，也可以指定进程将使用的节点<span>ID</span>。</p>
			<pre><span>shell&gt; <span><b>ndbd --connect-string=&quot;nodeid=2;host=ndb_mgmd.mysql.com:1186&quot;</b></span></span></pre>
			<p>关于这方面的额外信息，请参见<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2节，“MySQL簇连接字符串<code class="literal"></code>”</a>。</p>
			<p>启动<strong><span>ndbd</span></strong>时，它实际上将启动两种进程。第<span>1</span>种进程称为“<span class="quote"><span>angel 
			process</span></span>”（天使进程），它的唯一任务是发现执行进程在何时完成，然后重启<span>ndbd</span>进程（如果作了该配置的话）。因此，如果你打算使用<span>Unix</span>的<span>kill</span>命令杀死<span>ndbd</span>进程，就需要杀死这两个进程。中止<span>ndbd</span>进程的更恰当方法是使用管理客户端，并通过该管理客户端停止进程。</p>
			<p>执行进程采用了<span>1</span>个线程，用于读取、写入和扫描数据，以及所有其他任务。该线程是异步实施的，以便能方便地处理数以千计的并发活动。此外，看门狗线程负责监督执行线程，以确保执行线程不会陷入无限循环。线程池负责处理文件<span>I/O</span>，每个线程均能处理一个打开的文件。这些线程也能被<span>ndbd</span>进程中的传输器用作传输器连接。在执行包含更新在内的大量操作的系统中，如果允许，<span>ndbd</span>进程能占用<span>2</span>个<span>CPU</span>。对于拥有多<span>CPU</span>的机器，建议使用属于不同节点组的数个<span>ndbd</span>进程。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndb-mgmd-process"></a>17.5.3. <span><strong class="command">ndb_mgmd</strong></span>，“管理服务器”进程</h3></div></div></div>
			<p>
			管理服务器是这样一种进程，它读取簇配置文件，并将该信息分配给簇中所有请求该信息的节点。它还负责维护簇活动的日志。管理客户端能够连接到管理服务器，并检查簇的状态。</p>
			<p>启动管理服务器时，不是一定需要指定连接字符串。但是，如果使用了<span>1</span>个以上的管理服务器，应提供连接字符串，而且簇中的每个节点应明确指定自己的节点<span>ID</span>。</p>
			<p>下述文件是由<strong><span>ndb_mgmd</span></strong>在其启动目录下创建或使用的，并会被置于配置文件中指定的<span><span>DataDir</span>中。在下面的列表中，<i><span>node_id</span></i></span>是唯一性节点<span>ID</span>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>
			config.ini</span>是作为整体的簇的配置文件。该文件由用户创建并由管理服务器读取。在<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>中，讨论了设置该文件的方法。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_cluster.log</span>是簇事件日志文件。这类事件的例子包括：检查点操作的启动和完成，节点启动事件，节点故障，以及内存使用水平。关于簇事件的完整列表和描述，请参见<a href="ndbcluster.html#mysql-cluster-management" title="17.6. Management of MySQL Cluster">17.6节，“MySQL簇的管理”</a>。</p>
			<p>当簇日志的大小达到<span>1MB</span>时，文件将被重命名为<span>ndb_<i>node_id</i>_cluster.log.<i>seq_id</i></span>，其中<span><i><span>seq_id</span></i></span>是簇日志文件的序列号（例如，如果编号<span>1</span>、<span>2</span>、<span>3</span>已存在，下一个日志文件将用<span>4</span>命名）。</p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>_out.log</span>是将管理服务器用作端口监督程序时用于<span>stdout</span></span>和<span><span>stderr</span>的文件。</span></p>
			<p>
			<span>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ndb_<i>node_id</i>.pid</span>是将管理服务器用作端口监督程序时所使用的<span>PID</span>文件。</span></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ndb-mgm-process"></a>17.5.4. <span><strong class="command">ndb_mgm</strong></span>，“管理客户端”进程</h3></div></div></div>
			<p>
			对于簇的运行，实际上不需要管理客户端的进程。其价值在于它提供了一组命令，这组命令可用于检查簇的状态、启动备份、并执行其他管理功能。管理客户端使用<span>C 
			API</span>来访问管理服务器，高级用户也能使用<span>C API</span>来编制专用的管理进程来执行任务，这类任务与<strong><span>ndb_mgm</span></strong>执行的类似。</p>
			<p>启动管理客户端时，需要提供管理服务器的主机名和端口号，如下例所示。默认值是<span>localhost</span>和<span>1186</span>。</p>
			<pre><span>shell&gt; <span><b>ndb_mgm localhost 1186</b></span></span></pre>
			<p>关于使用<strong><span>ndb_mgm</span></strong>的更多信息，请参见<a href="ndbcluster.html#ndb-mgm-command-options" title="17.5.5.4. Command Options for ndb_mgm">17.5.5.4节，“ndb_mgm的命令选项<span><strong class="command"></strong></span>”</a>和<a href="ndbcluster.html#mgm-client-commands" title="17.6.2. Commands in the Management Client">17.6.2节，“管理客户端”中的命令</a>。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-command-options"></a>
			17.5.5.&nbsp;用于MySQL簇进程的命令选项</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#new-mysqld-command-options">
				17.5.5.1. 用于mysqld的与MySQL有关的命令选项<span><strong class="command"></strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndbd-command-options">
				17.5.5.2. ndbd命令选项<span><strong class="command"></strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgmd-command-options">
				17.5.5.3. ndb_mgmd的命令选<span><strong class="command">项</strong></span></a></span></dt><dt><span class="section"><a href="ndbcluster.html#ndb-mgm-command-options">
				17.5.5.4. ndb_mgm的命令选项<span><strong class="command"></strong></span></a></span></dt></dl></div>
			<p>所有<span>MySQL</span>簇的可执行文件（除<strong><span>mysqld</span></strong>）均使用下述选项。早期<span>MySQL</span>簇版本的用户应注意，这些选项开关中的一些与<span>MySQL 
			4.1</span>簇中的相比有所改变，为的是保持它们之间的一致性，以及与<strong><span>mysqld</span></strong>的一致性。可以使用<span><span>-?</span>开关来查看支持的选项列表。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-?</span><span>,
			<span>--usage</span>,
			<span>--help</span> </span></p>
			<p>给出简明清单，以及可用命令选项的描述。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-V</span><span>,
			<span>--version</span> </span></p>
			<p>给出<strong><span>ndbd</span></strong>进程的版本号。该版本号是<span>MySQL</span>簇的版本号。版本号有一定的作用，这是因为并非所有的版本均能一起使用，而且在启动时，<span>MySQL</span>簇进程将验证二进制文件的版本是否能在同一簇内共存。执行<span>MySQL</span>簇的在线升级时，它也很重要（请参见<span><span>MySQL</span>簇的软件升级）。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-c <i>
			connect_string</i></span><span>,
			<span>--connect-string</span> </span></p>
			<p><span><i>
			<span>connect_string</span></i></span>作为命令选项，用于设置与管理服务器的连接字符串。</p>
			<pre><span>shell&gt; <span><b>ndbd --connect-string=&quot;nodeid=2;host=ndb_mgmd.mysql.com:1186&quot;</b></span></span></pre>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>
			--debug[=<i>options</i>]</span><span> </span></p>
			<p>该选项仅能用于具有调试功能的版本。使用它，能够以与<strong><span>mysqld</span><span>进程</span></strong>相同的方式允许来自调试调用的输出。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>-e</span><span>,
			<span>--execute</span> </span></p>
			<p>使用它，能够从系统<span>shell</span>将命令发送至簇执行程序，如：</p>
			<pre><span>shell&gt; <span><b>ndb_mgm -e show</b></span></span></pre>
			<p>或</p>
			<pre><span>shell&gt; <span><b>ndb_mgm --execute=&quot;SHOW&quot;</b></span></span></pre>
			<p>等效于</p>
			<pre><span>NDB&gt; SHOW;</span></pre>
			<p>它类似于“<span><span>-e”</span>选项与</span><strong><span>mysql</span></strong>命令行客户端一起工作的方式。请参见<a href="using-mysql-programs.html#command-line-options" title="4.3.1. Using Options on the Command Line">4.3.1节，“在命令行上使用选项”</a>。</p>
			<div class="itemizedlist">&nbsp;</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="new-mysqld-command-options"></a>
			17.5.5.1.&nbsp;用于mysqld的与MySQL有关的命令选项<span><strong class="command"></strong></span></h4></div></div></div><div class="itemizedlist">
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--ndbcluster</span><span>
				</span></p>
				<p>如果二进制版本包含对<span><span>NDB</span>簇存储引擎的支持，可使用该选项覆盖对<span>NDB</span>簇存储引擎（简称为<span>NDB</span>存储引擎）的默认禁止设置。使用<span>MySQL</span>簇时，<span>NDB</span>簇存储引擎是必要的。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--skip-ndbcluster</span><span> </span></p>
				<p>禁止<span><span>NDB</span>簇存储引擎。对于包含该功能的二进制版本，在默认情况下，该功能是被禁止的，换句话讲，<span>NDB</span>簇存储引擎处于禁止状态，直至使用<span>“—ndbcluster”</span>选项激活了它为止。仅当所编译的服务器支持<span>NDB</span>簇存储引擎时，才能使用该选项。</span></p>
				<p>
				<span>
				·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--ndb-connectstring=<i>connect_string</i></span><span>
				</span></p>
				<p>使用<span><span>NDB</span>存储引擎时，通过设置该选项，能够指定分配簇配置数据的管理服务器。</span></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndbd-command-options"></a>
				17.5.5.2.&nbsp;ndbd命令选项<span><strong class="command"></strong></span></h4></div></div></div>
				<p>关于某些常见选项的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5节，“用于MySQL簇进程的命令选项”</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-d</span><span>,
				<span>--daemon</span> </span></p>
				<p>通知<strong><span>ndbd</span></strong>作为<span>daemon</span>（端口监督程序）进程执行（默认行为）。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nodaemon</span><span>
				</span></p>
				<p>指明<strong><span>ndbd</span></strong>不得作为<span>daemon</span>（端口监督程序）进程启动。调试<span>ndbd</span>以及希望将输出重定向到屏幕时，它很有用。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--initial</span><span> </span></p>
				<p>通知<strong><span>ndbd</span></strong>执行初始化启动。初始化启动将删除以前<span>ndbd</span>实例为恢复目的创建的任何文件。它还能重新创建恢复用日志文件。注意，在某些操作系统上，该进程可能会占用较长的时间。</p>
				<p>仅在首次启动<span>ndbd</span>进程时才应使用<span><span>—initial</span>启动，这是因为它将删除簇文件系统的所有文件，并再次创建所有的<span>REDO</span>日志文件。</span>该规则的例外如下：</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>执行那些会更改文件内容的软件升级时。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>用新的<span>ndbd</span>版本重启节点时。</p>
				<p>
				<span>
				o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span>
				出于某种原因，节点重启或系统重启不断失败时的最后手段。在这类情形下，请注意，由于数据文件的损坏，不能使用该节点来恢复数据。</p>
				<p>该选项不影响那些已被受影响节点创建的备份文件。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nostart</span><span>
				</span></p>
				<p>指示<strong><span>ndbd</span></strong>不自动启动。使用该选项时，<strong><span>ndbd</span></strong>连接到管理服务器，从管理服务器获取配置数据，并初始化通信对象。但是，在管理服务器特别要求之前，它不会实际启动执行引擎。通过向管理客户端发出恰当的命令，可完成该任务。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndb-mgmd-command-options"></a>
				17.5.5.3.&nbsp;ndb_mgmd的命令选<span><strong class="command">项</strong></span></h4></div></div></div>
				<p>关于某些常见选项的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5节，“用于MySQL簇进程的命令选项”</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-f
				<i>filename</i>, --config-file=<i>filename</i></span><span>, 
				(<strong><span>OBSOLETE</span></strong>):
				<span>-c <i>filename</i></span> </span>
				</p>
				<p>
				通知管理服务器应使用哪个文件作为其配置文件。必须指定该选项。文件名默认为<span><span>config.ini</span>。注意，</span>“<span><span>-c”</span>快捷方式已过时，不应在新的安装实例中使用它。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>-d</span><span>,
				<span>--daemon</span> </span></p>
				<p>指示<strong><span>ndb_mgmd</span></strong>作为端口监督程序启动。这是默认行为。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>--nodaemon</span><span>
				</span></p>
				<p>指示管理服务器不作为端口监督程序启动。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ndb-mgm-command-options"></a>
				17.5.5.4.&nbsp;ndb_mgm的命令选项<span><strong class="command"></strong></span></h4></div></div></div>
				<p>关于某些常见选项的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-command-options" title="17.5.5. Command Options for MySQL Cluster Processes">17.5.5节，“用于MySQL簇进程的命令选项”</a>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>[<i>host_name</i> 
				[<i>port_num</i>]]</span><span> </span></p>
				<p>
				要想启动管理客户端，需要指定管理服务器所在的位置，即指定主机名和端口。默认的主机名是<span><span>localhost</span>，默认端口是<span>1186</span>。</span></p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				--try-reconnect=<i>number</i></span><span>
				</span></p>
				<p>如果与管理服务器的连接断开，每隔<span>5</span>秒，节点将尝试再次连接到管理服务器，直至成功。使用该选项，能够将尝试的字数限制在<span>number</span>指定的值，超过该限制后，将放弃尝试并通报错误。</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-management"></a>
		17.6.&nbsp;MySQL簇的管理</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-startup-phases">17.6.1. 
			MySQL簇的启动阶段</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mgm-client-commands">
			17.6.2. “管理客户端”中的命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-event-reports">
			17.6.3. MySQL簇中生成的事件报告</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-single-user-mode">
			17.6.4. 单用户模式</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup">
			17.6.5. MySQL簇的联机备份</a></span></dt></dl></div>
		<p>管理<span>MySQL</span>簇涉及众多任务，首先是配置和启动<span>MySQL</span>簇。详情请参见<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>和<a href="ndbcluster.html#mysql-cluster-process-management" title="17.5. Process Management in MySQL Cluster">17.5节，“MySQL簇中的进程管理”</a>。</p>
		<p>下面介绍了<span>MySQL</span>簇的管理事宜。</p>
		<p>有两种积极管理<span>MySQL</span>簇的基本方法。第<span>1</span>种方法是，使用在管理客户端中输入的命令，借此可检查簇的状态，更改日志级别，启动和停止备份，以及启动和停止节点。对于第<span>2</span>种方法，需要研究管理服务器<span><span>DataDir</span>目录下簇日志文件<span>ndb_<i>node_id</i>_cluster.log</span>的内容。（<i><span>node_id</span></i></span>代表其活动已被记录的节点的唯一<span>ID</span>）。簇日志包含由<strong><span>ndbd</span></strong>生成的事件报告。也能将簇日志条目发送到<span>Unix</span>的系统日志中。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-startup-phases"></a>17.6.1. MySQL簇的启动阶段</h3></div></div></div>
			<p>本节介绍了启动簇时涉及的步骤。</p>
			<p>有数种不同的启动类型和模式，如下所述：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>首次启动：</span></strong>在所有节点上与干净的文件系统一起启动簇。这或是出现在首次启动簇时，或是使用“<span>--initial</span>”选项重启簇时。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>系统重启：</span></strong>簇启动并读取保存在数据节点中的数据。这出现在下述情况下：使用完后关闭了簇，并希望从簇的停止点恢复簇操作时。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>节点重启：</span></strong>这是在簇运行的同时簇节点的在线重启。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>首次节点重启：</span></strong>与节点重启类似，差别在于将再次初始化节点，并与干净的文件系统一起启动。</p>
			<p>启动之前，必须对每个节点进行初始化操作（<span><span>ndbd</span>进程）。这包括下述步骤：</span></p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>获取节点<span>ID</span>。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>获取配置数据。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>为节点间的通信分配端口。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>根据从配置文件获得的设置分配内存。</p>
			<p>一旦完成了对各节点的初始化操作，将进入簇启动进程。在该进程中，簇将经历下述阶段：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>0</span></span></strong><span>
			</span></p>
			<p>清理簇文件系统。仅当使用“<span>--initial</span>”选项启动簇时，才会出现。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>1</span></span></strong><span>
			</span></p>
			<p>建立簇连接，建立节点间的通信。启动簇“心跳”机制。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>2</span></span></strong><span>
			</span></p>
			<p>选举仲裁程序节点。</p>
			<p>如果这是系统重启阶段，簇将确定最近的可恢复全局检查点。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>3</span></span></strong><span>
			</span></p>
			<p>该阶段包括众多内部簇变量的初始化。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>4</span></span></strong><span>
			</span></p>
			<p>对于初始启动或初始节点重启，将创建<span>redo</span>日志文件。这类文件的数目等于<span>NoOfFragmentLogFiles</span>／</p>
			<p>对于系统重启：</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>读取方案。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>从本地检查点和<span>undo</span>日志读取数据。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>应用所有的<span>redo</span>信息，直至到达最近的可恢复检查点为止。</p>
			<p>对于节点重启，找到<span>redo</span>日志的末尾。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>5</span></span></strong><span>
			</span></p>
			<p>如果这是首次启动，将创建<span>SYSTAB_0</span>和<span><span>NDB$EVENTS</span>内部系统表。</span></p>
			<p>对于节点重启或首次节点重启：</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>节点包含在事务处理操作中。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>将节点的方案与主服务器的方案进行比较，并与其同步。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>对所收到的、来自本节点所在节点组内其他节点的、<span>INSERT</span>形式的数据进行同步。</p>
			<p>
			<span>
			o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
			</span>在任何情形下，等待由仲裁程序判定的本地检查点操作的完成。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>6</span></span></strong><span>
			</span></p>
			<p>更新内部变量。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>7</span></span></strong><span>
			</span></p>
			<p>更新内部变量。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>8</span></span></strong><span>
			</span></p>
			<p>在系统重启中，重建所有的索引。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>9</span></span></strong><span>
			</span></p>
			<p>更新内部变量。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>10</span></span></strong><span>
			</span></p>
			<p>在节点重启或首次节点重启的这一阶段，<span>API</span>可能会连接到节点，并接收事件。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>阶段<span>11</span></span></strong><span>
			</span></p>
			<p>
			在节点重启或首次节点重启的这一阶段，将事件传递任务提交给加入簇的节点。新加入的节点负责将其主要数据传递给订方。</p>
			<p>
			对于首次启动或系统重启，一旦该进程完成，将启用事务处理功能。对于节点重启或首次节点重启，启动进程的完成意味着节点现在能够成为事务协调程序。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mgm-client-commands"></a>
			17.6.2.&nbsp;“管理客户端”中的命令</h3></div></div></div></div><div class="section"><div class="titlepage"><div><div>
			除了中央配置文件外，还能通过管理客户端<strong><span>ndb_mgm</span></strong>提供的命令行界面对簇进行控制。这是运行簇的主要管理界面。<p>
			管理客户端提供了下述基本命令。在下面给出的清单中，<span><i><span>node_id</span></i></span>指的是数据库节点<span>ID</span>或关键字<span><span>ALL</span>，指明命令将应用到所有的簇数据节点上。</span></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>HELP</span><span>
			</span></p>
			<p>显示关于所有可能命令的信息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>SHOW</span><span>
			</span></p>
			<p>显示关于簇状态的信息。</p>
			<p><strong>
			<span>注释：</span></strong>在使用多个管理节点的簇中，该命令仅显示与当前管理服务器实际相连的数据节点的信息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> START</span></span><span>
			</span></p>
			<p>启动由<span><i><span>node_id</span></i></span>标识的数据节点（或所有数据节点）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> STOP</span></span><span>
			</span></p>
			<p>停止由<span><i><span>node_id</span></i></span>标识的数据节点（或所有数据节点）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> RESTART [-N] [-I]</span></span><span>
			</span></p>
			<p>重启由<span><i><span>node_id</span></i></span>标识的数据节点（或所有数据节点）。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span><i><span>
			node_id</span></i><span> STATUS</span></span><span>
			</span></p>
			<p>显示由<span><i><span>node_id</span></i></span>标识的数据节点（或所有数据节点）的状态信息。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>ENTER 
			SINGLE USER MODE <i>node_id</i></span><span> </span>
			</p>
			<p>进入单用户模式，仅允许由节点<span>ID</span>“<span><i><span>node_id</span></i></span>”标识的<span>MySQL</span>服务器访问数据库。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>EXIT 
			SINGLE USER MODE</span><span> </span></p>
			<p>退出单用户模式，允许所有的<span>SQL</span>节点（即所有运行的<strong><span>mysqld</span></strong>进程）访问数据库。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>QUIT</span><span>
			</span></p>
			<p>中止管理客户端。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>SHUTDOWN</span><span>
			</span></p>
			<p>关闭除<span>SQL</span>节点之外的所有簇节点，并退出。</p>
			<p>在下一节中，介绍了用于事件日志的命令。在这些议题的单独一节中，介绍了用于创建备份以及从备份中恢复的命令。</p>
			<h3 class="title"><a name="mysql-cluster-event-reports"></a>
			17.6.3.&nbsp;MySQL簇中生成的事件报告</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-logging-management-commands">
				17.6.3.1. 登记管理命令</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-log-events">
				17.6.3.2. 日志事件</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
				在本节中，我们讨论了<span>MySQL</span>簇提供的事件日志的类型，以及记录的事件类型。<p>
				<span>MySQL</span>簇提供了两种事件日志。它们是<strong><span>cluster 
				log</span></strong>和<strong><span>node 
				logs</span></strong>，<strong><span>cluster 
				log</span></strong>（簇日志）包括由所有簇节点生成的事件，<strong><span>node 
				logs</span></strong>（节点日志）仅记录每个数据节点的本地事件。</p>
				<p>由簇事件日志功能生成的输出可以有多个目的地，包括文件、管理服务器控制台窗口、或<span>syslog</span>。由节点事件日志功能生成的输出将被写入数据节点的控制台窗口。</p>
				<p>可以对这两类事件日志进行设置，使之记录不同的事件子集。</p>
				<p><strong><span>注释：</span></strong>簇日志是为大多数使用场合推荐的日志，这是因为它在<span>1</span>个文件中提供了关于整个簇的日志信息。节点日志仅应在应用程序的开发过程中使用，或用于调试应用程序代码。</p>
				<p>可根据三种不同的判据识别每个值得通报的事件：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Category</span></em>（类别）：可以是下述值之一：<span>STARTUP</span><span>,
				<span>SHUTDOWN</span>,
				<span>STATISTICS</span>,
				<span>CHECKPOINT</span>,
				<span>NODERESTART</span>,
				<span>CONNECTION</span>,
				<span>ERROR</span>,</span>或<span>INFO</span>。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Priority</span></em>（优先级）：由从<span>1</span>到<span>15</span>的数字表示，“<span>1</span>”表示“最重要”，“<span>15</span>”表示“最不重要”。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><em><span>
				Severity Level</span></em>（严重级别）：可以是下述值之一：<span>ALERT</span><span>,
				<span>CRITICAL</span>,
				<span>ERROR</span>,
				<span>WARNING</span>,
				<span>INFO</span>, </span>或<span>DEBUG</span>。</p>
				<p>无论是簇日志还是节点日志，都能根据这些属性进行过滤。</p>
				<h4 class="title"><a name="mysql-cluster-logging-management-commands"></a>
				17.6.3.1.&nbsp;登记管理命令</h4></div></div></div>
				<p>下述管理命令与簇日志有关：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG ON</span><span> </span></p>
				<p>打开簇日志。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG OFF</span><span> </span></p>
				<p>关闭簇日志。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG INFO</span><span> </span></p>
				<p>关于簇日志设置的信息。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span><i><span>
				node_id</span></i><span> CLUSTERLOG <i>category</i>=<i>threshold</i></span></span><span>
				</span></p>
				<p>用小于或等于<span><i><span>threshold</span></i></span>的优先级将<span><i><span>category</span></i></span>事件记录到簇日志。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				CLUSTERLOG FILTER <i>severity_level</i></span><span>
				</span></p>
				<p>将簇事件日志切换为指定的<span><i><span>severity_level</span></i></span>。</p>
				<p>在下表中，介绍了簇日志类别阈值的默认设置（对于所有数据节点）。如果事件的优先级值低于或等于优先级阈值，就会在簇日志中记录。</p>
				<p>注意，事件是按数据节点通报的，可在不同的节点上设置不同的阈值。</p>
				<table border="1" cellpadding="0" id="table2">
					<tr>
						<td>
						<p><strong>
						<span>类别</span></strong></td>
						<td>
						<p><strong>
						<span>默认阈值（所有数据节点）</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>STARTUP</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>SHUTDOWN</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>STATISTICS</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>CHECKPOINT</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>NODERESTART</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>CONNECTION</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>ERROR</span></td>
						<td>
						<p><strong>
						<span>15</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>
						<span>INFO</span></td>
						<td>
						<p><strong>
						<span>7</span></strong></td>
					</tr>
				</table>
				<p>阈值用于过滤每种类别中的事件。例如，对于优先级为<span>3</span>的<span><span>STARTUP</span>事件，</span>不会将其记录到日志中，除非将<span><span>STARTUP</span>的阈值更改为<span>3</span>或更小。如果阈值为<span>3</span>，仅发送优先级等于或小于<span>3</span>的事件。</span></p>
				<p>下面给出了事件的严重级别（注释：它们与<span>Unix</span>的<span><span>syslog</span>级别对应；但<span>LOG_EMERG</span>和<span>LOG_NOTICE</span>除外，未使用或未映射它们）：</span></p>
				<table border="1" cellpadding="0" id="table3">
					<tr>
						<td>
						<p><strong>
						<span>1</span></strong></td>
						<td>
						<p>
						<span>ALERT</span></td>
						<td>
						<p>应立刻更正的状况，如损坏的系统数据库。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>2</span></strong></td>
						<td>
						<p>
						<span>CRITICAL</span></td>
						<td>
						<p>临界状况，如设备错误或资源不足。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>3</span></strong></td>
						<td>
						<p>
						<span>ERROR</span></td>
						<td>
						<p>应予以更正的状况，如配置错误等。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>4</span></strong></td>
						<td>
						<p>
						<span>WARNING</span></td>
						<td>
						<p>不能称其为错误的状况，但仍需要特别处理。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>5</span></strong></td>
						<td>
						<p>
						<span>INFO</span></td>
						<td>
						<p>通报性消息。</td>
					</tr>
					<tr>
						<td>
						<p><strong>
						<span>6</span></strong></td>
						<td>
						<p>
						<span>DEBUG</span></td>
						<td>
						<p>调试消息，用于<span><span>NDB</span>簇开发。</span></td>
					</tr>
				</table>
				<p>
				可以打开或关闭事件严重级别。如果打开了事件严重级别，那么优先级等于或低于类别阈值的事件均将被记录。如果关闭了事件严重级别，那么将不记录属于该严重级别的任何事件。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-log-events"></a>
				17.6.3.2.&nbsp;日志事件</h4></div></div></div>
				<p>事件日志中记录的事件报告采用下述格式：<span><i><span>datetime</span></i><span> 
				[<i>string</i>] <i>severity</i> – <i>message</i></span></span>。例如：</p>
				<pre><span>09:19:30 2005-07-24 [NDB] INFO -- Node 4 Start phase 4 completed</span></pre>
				<p>本节讨论了所有值得通报的事件，按类别以及每一类别中的严重级别排序。</p>
				<p><span><b><span>CONNECTION</span></b></span><strong><span>事件</span></strong></p>
				<p>这类事件与簇节点之间的连接有关。</p>
				<table border="1" cellpadding="0" id="table4">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点已连接</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>数据节点已连接</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点断开连接</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>数据节点断开连接</td>
					</tr>
					<tr>
						<td>
						<p>通信关闭</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>SQL</span>节点或数据节点的连接已关闭</td>
					</tr>
					<tr>
						<td>
						<p>通信打开</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>SQL</span>节点或数据节点的连接已打开</td>
					</tr>
				</table>
				<p><span><b><span>CHECKPOINT</span></b></span><strong><span>事件</span></strong></p>
				<p>下面给出的日志消息与检查点有关。</p>
				<p>（注释：<span>GCP =</span>全局检查点，<span>LCP =</span>本地检查点）。</p>
				<table border="1" cellpadding="0" id="table5">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>在<span>calc keep GCI</span>中，<span>LCP</span>已停止</td>
						<td>
						<p><span>0</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p><span>LCP</span>已停止</td>
					</tr>
					<tr>
						<td>
						<p>本地检查点片段完成</td>
						<td>
						<p><span>11</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>片段上的<span>LCP</span>已完成</td>
					</tr>
					<tr>
						<td>
						<p>全局检查点完成</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>GCP</span>完成</td>
					</tr>
					<tr>
						<td>
						<p>全局检查点启动</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>启动<span>GCP</span>：将<span>REDO</span>日志写入磁盘</td>
					</tr>
					<tr>
						<td>
						<p>本地检查点完成</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>LCP</span>已正常完成</td>
					</tr>
					<tr>
						<td>
						<p>本地检查点启动</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>启动<span>LCP</span>：将数据写入磁盘</td>
					</tr>
					<tr>
						<td>
						<p>报告<span>undo</span>日志已封闭</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>UNDO</span>日志已封闭：缓冲快要溢出</td>
					</tr>
				</table>
				<p><span><b><span>STARTUP</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件是在成功或失败的节点启动或簇启动时生成的。它们还提供了与启动进程进展状况有关的信息，包括与日志活动有关的信息。</p>
				<table border="1" cellpadding="0" id="table6">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>收到内部启动信号<span>STTORRY</span></td>
						<td>
						<p><span>15</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>重启完成后收到的信息块</td>
					</tr>
					<tr>
						<td>
						<p><span>Undo</span>记录已执行</td>
						<td>
						<p><span>15</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>新的<span>REDO</span>日志已启动</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>GCI</span>保持<span><i><span>X</span></i></span>，最新的可恢复<span>GCI
						<span><i>Y</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>新日志已启动</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>日志部分<span><i><span>X</span></i></span>，启动<span>MB
						<span><i>Y</i></span></span>，停止<span>MB
						<span><i>Z</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>拒绝将节点纳入簇中</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>由于配置错误、无法建立通信、或其他问题，不能将节点包含在簇中。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点邻居</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>显示附近的数据节点。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点启动阶段<span>X</span>完成</td>
						<td>
						<p><span>4</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>数据节点启动阶段已完成。</td>
					</tr>
					<tr>
						<td>
						<p>节点已被簇成功接纳</td>
						<td>
						<p><span>3</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>显示节点，管理节点，以及动态<span>ID</span>。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点启动阶段已开始</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>NDB</span>簇节点正在启动。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点的所有启动阶段已完成</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>NDB</span>簇节点已启动。</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点关闭操作已启动</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>数据节点的关闭操作已开始</td>
					</tr>
					<tr>
						<td>
						<p><span>DB</span>节点关闭操作失败</td>
						<td>
						<p><span>1</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>无法正常关闭数据节点。</td>
					</tr>
				</table>
				<p><span><b><span>NODERESTART</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件是在重启节点时产生的，并与节点重启进程的成功或失败相关。</p>
				<table border="1" cellpadding="0" id="table7">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>节点失败阶段完成</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>通报节点失败阶段的完成</td>
					</tr>
					<tr>
						<td>
						<p>节点失败，节点状态为<span><i><span>X</span></i></span></td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>通报节点已失败</td>
					</tr>
					<tr>
						<td>
						<p>通报仲裁程序结果</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>对于仲裁尝试，有<span>8</span>种不同的可能结果：</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁检查失败，剩余节点少于<span>1/2</span>。</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁检查成功，节点组多数</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁检查失败，丢失节点组</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>网络分区，要求仲裁</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁成功，来自节点<span><i><span>X</span></i></span>的正面回应</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>仲裁失败，来自节点<span><i><span>X</span></i></span>的负面回应</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>网络分区，无可用的仲裁程序</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>网络分区，未配置仲裁程序</td>
					</tr>
					<tr>
						<td>
						<p>完成了片段复制</td>
						<td>
						<p><span>10</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了目录信息复制</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了分配信息复制</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>开始复制片段</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>完成了所有片段的复制</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>GCP</span>接收已启动</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>GCP</span>接收已完成</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>LCP</span>接收已启动</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p><span>LCP</span>接收已完成（状态<span>=
						<span><i>X</i></span></span>）</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>通报是否发现了仲裁程序</td>
						<td>
						<p><span>6</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>搜索仲裁程序时，有<span>7</span>种可能的结果：</p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>管理服务器重启仲裁线程<span>[state=<span><i>X</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>准备仲裁程序节点<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>接收仲裁程序节点<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>启动仲裁程序节点<span><i><span>X</span></i></span><span> 
						[ticket=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丢失了仲裁程序节点<span><i><span>X</span></i></span><span>
						</span>– 进程失败<span> [state=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丢失了仲裁程序节点<span><i><span>X</span></i></span><span>
						</span>– 进程退出<span> [state=<span><i>Y</i></span>]
						</span></p>
						<p>
						<span>
						·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</span></span>丢失了仲裁程序节点<span><i><span>X</span></i></span><span> 
						&lt;error msg&gt; [state=<span><i>Y</i></span>]
						</span></td>
					</tr>
				</table>
				<p><span><b><span>STATISTICS</span></b></span><strong><span>事件</span></strong></p>
				<p>下述事件具有统计特性。它们提供了相应的信息，如事务和其他操作的数目，低浓度节点发送或接收的数据量，以及内存使用率等。</p>
				<table border="1" cellpadding="0" id="table8">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>通报作业日程统计</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>平均的内部作业日程统计</td>
					</tr>
					<tr>
						<td>
						<p>发送的字节数</td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>发送至节点<span><i><span>X</span></i></span>的平均字节数</td>
					</tr>
					<tr>
						<td>
						<p>接收的自己<span>#</span></td>
						<td>
						<p><span>9</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>从节点<span><i><span>X</span></i></span>接收的平均字节数</td>
					</tr>
					<tr>
						<td>
						<p>通报事务统计</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>
						事务数目，提交次数，读取次数，简单读取次数，写入次数，并发操作数目。属性信息，以及放弃次数</td>
					</tr>
					<tr>
						<td>
						<p>通报操作</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>操作数目</td>
					</tr>
					<tr>
						<td>
						<p>通报表创建</td>
						<td>
						<p><span>7</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>内存使用</td>
						<td>
						<p><span>5</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>数据内存和索引内存的使用率（<span>80%</span>、<span>90%</span>和<span>100%</span>）</td>
					</tr>
				</table>
				<p><span><b><span>ERROR</span></b></span><strong><span>事件</span></strong></p>
				<p>这些事件与簇错误和告警有关，如果出现<span>1</span>个或多个这类事件，表明出现了重大故障或失败。</p>
				<table border="1" cellpadding="0" id="table9">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>因失去心跳而死亡</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>ALERT</span></td>
						<td>
						<p>因失去心跳而声明节点<span><i><span>X</span></i></span>死亡。</td>
					</tr>
					<tr>
						<td>
						<p>传输器错误</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>ERROR</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>传输器告警</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
					<tr>
						<td>
						<p>失去心跳</td>
						<td>
						<p><span>8</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p>节点<span><i><span>X</span></i></span>失去心跳<span>#<span><i>Y</i></span></span></td>
					</tr>
					<tr>
						<td>
						<p>一般性告警事件</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>WARNING</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
				</table>
				<p><span><b><span>INFO</span></b></span><strong><span>事件</span></strong></p>
				<p>这些事件给出了关于簇状态和簇维护活动的一般信息，如日志和心跳传输等。</p>
				<table border="1" cellpadding="0" id="table10">
					<tr>
						<td>
						<p><strong>
						<span>事件</span></strong></td>
						<td>
						<p><strong>
						<span>优先级</span></strong></td>
						<td>
						<p><strong>
						<span>严重级别</span></strong></td>
						<td>
						<p><strong>
						<span>描述</span></strong></td>
					</tr>
					<tr>
						<td>
						<p>发出心跳</td>
						<td>
						<p><span>12</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>将心跳发送至节点<span><i><span>X</span></i></span></td>
					</tr>
					<tr>
						<td>
						<p>创建日志字节</td>
						<td>
						<p><span>11</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p>日志部分，日志文件，<span>MB</span></td>
					</tr>
					<tr>
						<td>
						<p>一般信息事件</td>
						<td>
						<p><span>2</span></td>
						<td>
						<p><span>INFO</span></td>
						<td>
						<p><span>&nbsp;</span></td>
					</tr>
				</table>
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-single-user-mode"></a>
		17.6.4.&nbsp;单用户模式</h3></div></div></div>
			<p>采用单用户模式，数据库管理员能够将对数据库系统的访问限制在<span>1</span>个<span>MySQL</span>服务器（<span>SQL</span>节点）。进入单用户模式时，与所有其他<span>MySQL</span>服务器的所有连接均将恰当关闭，而且所有正在运行的事务均将被放弃。不允许启动任何新事务。</p>
			<p>一旦簇进入单用户模式，只有指定的<span>SQL</span>节点才有权访问数据库。使用<strong><span>ALL 
			STATUS</span></strong>命令，可查看簇进入单用户模式的时间。</p>
			<p>示例：</p>
			<pre><span>NDB&gt; <span><b>ENTER SINGLE USER MODE 5</b></span></span></pre>
			<p>执行该命令而且簇进入单用户模式后，节点<span>ID</span>为<span>5</span>的<span>SQL</span>节点将成为簇中唯一允许的用户。</p>
			<p>上述命令中指定的节点必须是<span>MySQL</span>服务器节点，如果指定任何其他类型的节点，将被拒绝。</p>
			<p><strong><span>注释：</span></strong>执行上述命令时，指定节点上所有正在运行的事务均将被放弃，连接关闭，而且必须重启服务器。</p>
			<p>使用<strong><span>EXIT SINGLE 
			USER MODE</span></strong>命令，能够将簇数据节点的状态从单用户模式更改为正常模式。对于等待连接的<span>MySQL</span>服务器（即，对于即将准备就绪并可用的簇），现在允许进行连接。在状态变化期间和变化之后，指定为单用户<span>SQL</span>节点的<span>MySQL</span>服务器将继续运行（如果仍连接的话）。</p>
			<p>示例：</p>
			<pre><span>NDB&gt; <span><b>EXIT SINGLE USER MODE</b></span></span></pre>
			<p>运行在单用户模式下时，如果节点失败，推荐的处理方法是：</p>
			<ul type="disc">
				<li><span>&nbsp;</span></li>
			</ul>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>结束所有的单用户模式事务。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>发出<strong><span>EXIT 
			SINGLE USER MODE</span></strong>命令。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>重启簇的数据节点。</p>
			<p><em><span>或</span></em></p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>进入单用户模式之前重启数据库。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-cluster-backup"></a>
			17.6.5.&nbsp;MySQL簇的联机备份</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-concepts">
				17.6.5.1. 簇备份概念</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-using-management-server">
				17.6.5.2. 使用管理服务器创建备份</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-restore">
				17.6.5.3. 如何恢复簇备份</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-configuration">
				17.6.5.4. 簇备份的配置</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-cluster-backup-troubleshooting">
				17.6.5.5. 备份故障诊断与排除</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div>
				在本节中，介绍了创建备份的方法，以及从备份恢复数据库的方法。<h4 class="title"><a name="mysql-cluster-backup-concepts"></a>
				17.6.5.1.&nbsp;簇备份概念</h4></div></div></div></div><div class="section"><div class="titlepage"><div><div>
				备份指的是在给定时间对数据库的快照。备份包含三个主要部分：<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Metadata</span></strong>（元数据）：所有数据库表的名称和定义。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Table records</span></strong>（表记录）：执行备份时实际保存在数据库表中的数据。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><strong><span>
				Transaction log</span></strong>（事务日志）：指明如何以及何时将数据保存在数据库中的连续记录。</p>
				<p>每一部分均会保存在参与备份的所有节点上。在备份过程中 ，每个节点均会将这三个部分保存在磁盘上的三个文件中：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>.<i>node_id</i>.ctl</span><span>
				</span></p>
				<p>
				包含控制信息和元数据的控制文件。每个节点均会将相同的表定义（对于簇中的所有表）保存在自己的该文件中。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>-0.<i>node_id</i>.data</span><span>
				</span></p>
				<p>
				包含表记录的数据文件，它是按片段保存的，也就是说，在备份过程中，不同的节点会保存不同的片段。每个节点保存的文件以指明了记录所属表的标题开始。在记录清单后面有一个包含关于所有记录校验和的脚注。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BACKUP-<i>backup_id</i>.<i>node_id</i>.log</span><span>
				</span></p>
				<p>
				包含已提交事务的记录的日志文件。在日志中，仅保存已在备份中保存的表上的事务。参与备份的节点将保存不同的记录，这是因为，不同的节点容纳了不同的数据库片段。</p>
				<p>在上面所列的内容中，<span><i><span>backup_id</span></i></span>指的是备份<span>ID</span>，<span><i><span>node_id</span></i></span>是创建文件的节点的唯一<span>ID</span>。</p>
				<h4 class="title"><a name="mysql-cluster-backup-using-management-server"></a>
				17.6.5.2.&nbsp;使用管理服务器创建备份</h4></div></div></div>
				<p>开始备份前，请确保已为备份操作恰当地配置了簇。（请参见<a href="ndbcluster.html#mysql-cluster-backup-configuration" title="17.6.5.4. Configuration for Cluster Backup">17.6.5.4节，“簇备份的配置”</a>）。</p>
				<p>使用管理服务器创建备份包含以下步骤：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>启动管理服务器<span>(<strong><span>ndb_mgm</span></strong>)</span>。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>执行命令<span>START 
				BACKUP</span>。</p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理服务器将用消息“指示备份开始”作出应答。这意味着管理服务器将请求提交给了簇，但尚未收到任何回应。</p>
				<p>
				<span>4.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理服务器回复“<span>备份<i><span>backup_id</span></i>开始<span>”</span>，其中，<i><span>backup_id</span></i></span>是该备份的唯一<span>ID</span>（如果未作其他配置，该<span>ID</span>还将保存在簇日志中）。这意味着簇已收到并开始处理备份请求。它不表示备份已完成。</p>
				<p>
				<span>5.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理服务器发出消息“<span>备份<i><span>backup_id</span></i>完成</span>”，通知备份操作已结束。</p>
				<p>要想放弃正在处理的备份：</p>
				<p>
				<span>1.<span>&nbsp;&nbsp;&nbsp;
				</span></span>启动管理服务器。</p>
				<p>
				<span>2.<span>&nbsp;&nbsp;&nbsp;
				</span></span>执行命令<span>ABORT 
				BACKUP <i>backup_id</i></span>。<span><i><span>backup_id</span></i></span>是当备份开始时包含在管理服务器应大中的备份<span>ID</span>（在消息“备份<span><i><span>backup_id</span></i>启动<span>”</span>中）。</span></p>
				<p>
				<span>3.<span>&nbsp;&nbsp;&nbsp;
				</span></span>管理服务器用消息“放弃指示的备份<span><i><span>backup_id</span></i></span>”确认放弃请求，注意，尚未收到对该请求的实际回应。</p>
				<p>
				<span>4.<span>&nbsp;&nbsp;&nbsp;
				</span></span>一旦放弃了备份，管理服务器将通报“备份<span><i><span>backup_id</span></i>因<span>XYZ</span>而放弃</span>”。这意味着簇中止了备份，并从簇文件系统中删除了与该备份有关的所有文件。</p>
				<p>在系统<span>shell</span>中使用下述命令，也能放弃正在执行的备份：</p>
				<pre><span>shell&gt; <span><b>ndb_mgm -e &quot;ABORT BACKUP <i>backup_id</i>&quot;</b></span></span></pre>
				<p><strong><span>注释：</span></strong>执行放弃操作时，如果没有<span>ID</span>为<span><i><span>backup_id</span></i></span>的备份，管理服务器不会给出任何明确回应。但是，所发出的无效放弃命令将在簇日志中给出。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-restore"></a>
				17.6.5.3.&nbsp;如何恢复簇备份</h4></div></div></div>
				<p>簇恢复程序是作为单独的命令行实用工具<strong><span>ndb_restore</span></strong>实现的，它将读取由备份创建的文件，并将保存的信息插入数据库。必须为每组备份文件执行恢复程序，也就是说，执行次数与创建备份时运行的数据库节点数相同。</p>
				<p>
				首次执行恢复程序时，还需要恢复元数据。换句话讲，必须重新创建数据库表（注意，开始执行恢复操作时，簇中应有一个空数据库）。恢复程序对于簇来说相当于<span>API</span>，因此，需要一个空闲连接，以便与簇相连。可使用<strong><span>ndb_mgm</span></strong>命令<strong><span>SHOW</span></strong>（在系统<span>shell</span>下使用<strong><span>ndb_mgm 
				-e SHOW</span><span>即可</span></strong>完成该操作）进行验证。可以使用开关“<span>-c
				<i>connectstring</i></span>”来确定<span>MGM</span>节点的位置。（关于连接字符串的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-connectstring" title="17.4.4.2. The MySQL Cluster connectstring">17.4.4.2节，“MySQL簇连接字符串<code class="literal"></code>”</a>。备份文件必须位于恢复程序参量给定的目录下。</p>
				<p>能够使用与创建是所用配置不同的配置将备份恢复到数据库。例如，对于备份<span>ID</span>为<span>12</span>的备份，该备份是在具有两个数据库节点（节点<span>ID</span>无恶<span>2</span>和<span>3</span>）的簇中创建的，可以将其恢复到具有<span>4</span>个节点的簇中。这样，<strong><span>ndb_restore</span></strong>必须运行两次，为创建备份时的每个数据库节点运行一次。</p>
				<p><strong><span>注释：</span></strong>对于快速恢复，能够以并行方式恢复数据，但必须有足够的可用簇连接。然而，数据文件必须始终前于日志文件。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-backup-configuration"></a>
				17.6.5.4.&nbsp;簇备份的配置</h4></div></div></div>
				<p>有<span>4</span>个用于备份的基本配置参数：</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupDataBufferSize</span><span> </span></p>
				<p>将数据写入磁盘之前用于对数据进行缓冲处理的内存量。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupLogBufferSize</span><span> </span></p>
				<p>将日志记录写入磁盘之前用于对其进行缓冲处理的内存量。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupMemory</span><span> </span></p>
				<p>
				在数据库节点中为备份分配的总内存。它应是分配给备份数据缓冲的内存和分配给备份日志缓冲的内存之和。</p>
				<p>
				<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</span></span><span>
				BackupWriteSize</span><span> </span></p>
				<p>写入磁盘的块大小。它适用于备份数据缓冲和备份日志缓冲</p>
				<p>关于这些参数的更多细节，请参见<a href="ndbcluster.html#mysql-cluster-configuration" title="17.4. MySQL Cluster Configuration">17.4节，“MySQL簇的配置”</a>。</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="mysql-cluster-backup-troubleshooting"></a>
				17.6.5.5.&nbsp;备份故障诊断与排除</h4></div></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		如果在发出备份请求时返回了错误代码，最可能的原因是内存不足，或磁盘空间不足。应检查是否为备份分配了足够的内存。此外，还应检查在备份目标的硬盘分区上是否有足够的空间。<p>
		<span>NDB</span>不支持重复的读取操作，对于恢复进程，这类操作会导致问题。尽管备份进程“<span>hot</span>”，但从备份恢复<span>MySQL</span>簇并不是<span>100</span>％“<span>hot</span>”的进程。其原因在于，在恢复进程执行期间，正在运行的事务会从已恢复的数据中获取不可重复的读。这意味着，当恢复正在进行时，数据的状态是不一致的。</p>
		<h2 class="title"><a name="mysql-cluster-interconnects"></a>
		17.7.&nbsp;使用与MySQL簇的高速互连</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#sci-sockets">
			17.7.1. 配置MySQL簇以使用SCI套接字</a></span></dt><dt><span class="section"><a href="ndbcluster.html#performance-figures">
			17.7.2. 理解簇互连的影响</a></span></dt></dl></div>
		<p>即使在<span>1996</span>年开始<span><span>NDB</span>簇的设计之前，在创建并行数据库的过程中遇到的一个主要问题显然是网络中节点之间的通信问题。正因为如此，从开始设计时，<span>NDB</span>簇就允许使用多种不同的数据传输机制。在本手册中，我们使用了术语</span><em><span>传输器</span></em>。</p>
		<p>目前，<span>MySQL</span>簇代码库包含对四种不同传输器的支持。目前的大多数用户采用的是以太网上的<span>TCP/IP</span>，这是因为它无处不在。它也是迄今为止在<span>MySQL</span>簇中经过最佳测试的传输器。</p>
		<p>我们正在努力，以确保与<strong><span>ndbd</span></strong>进程的通信是尽可能大的“组块”，这是因为，它有利于所有的数据传输类型。</p>
		<p>对于需要它的用户，也能使用簇互联以进一步增强性能。实现它的方式有两种：或使用能处理该情况的定制传输器，或使用能绕过<span>TCP/IP</span>堆栈的套接字实施方案。我们使用由<span><a target="_top"  href="http://www.dolphinics.com/">Dolphin</a></span>开发的<span>SCI</span>（规模可扩展的计算机连接接口）技术，对这两类技术进行了试验。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sci-sockets"></a>
			17.7.1.&nbsp;配置MySQL簇以使用SCI套接字</h3></div></div></div>
			<p>在本节中，我们将介绍如何改编为常规<span>TCP/IP</span>通信配置的簇，以使用<span>SCI</span>套接字。本文档基于<span>2004</span>年<span>10</span>月<span>1</span>日发布的<span>SCI</span>套接字<span>2.3.0</span>版。</p>
			<p><strong><span>前提条件</span></strong></p>
			<p>对于任何打算使用<span>SCI</span>套接字的机器，都必须配备<span>SCI</span>卡。</p>
			<p>能够与任何版本的<span>MySQL</span>簇一起使用<span>SCI</span>套接字。不需要特殊创建，这是因为它采用了<span>MySQL</span>簇中已提供的正常套接字调用。但是，目前仅在<span>Linux 
			2.4</span>和<span>2.6</span>内核上才支持<span>SCI</span>套接字。尽管到目前为止我们仅在<span>Linux 
			2.4</span>上核实了这点，在一些其他操作系统上也成功测试了<span>SCI</span>传输器。</p>
			<p>对于<span>SCI</span>套接字，有四种基本要求：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>创建<span>SCI</span>套接字库。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>安装<span>SCI</span>套接字内核库。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span>安装<span>1</span>个或<span>2</span>个配置文件。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span>必须为整个机器或启动<span>MySQL</span>簇进程的<span>shell</span>启用<span>SCI</span>套接字库。</p>
			<p>对于打算将<span>SCI</span>套接字用于节点间的通信的簇，需要为簇中的每台机器重复该进程。</p>
			<p>要想使<span>SCI</span>套接字工作，需要获得两个软件包：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span>包含用于<span>SCI</span>套接字库的<span>DIS</span>支持库的源码软件包。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span>用于<span>SCI</span>套接字库本身的源码软件包。</p>
			<p>目前，仅以源码格式提供了它们。编写本文档时可用的最新版本的软件包分别是<span>DIS_GPL_2_5_0_SEP_10_2004.tar.gz</span>和<span>SCI_SOCKET_2_3_0_OKT_01_2004.tar.gz</span>。在下述站点，可找到它们（也可能找到更新的版本）：<span><a target="_top"  href="http://www.dolphinics.no/support/downloads.html">http://www.dolphinics.no/support/downloads.html</a></span>。</p>
			<p><strong><span>软件包安装</span></strong></p>
			<p>获得库软件包后，接下来应将它们解包到恰当的目录下，将<span>SCI</span>套接字库解包到<span>DIS</span>代码下的目录中。然后，需要创建库。在下面的示例中，给出了在<span>Linux/x86</span>平台上执行该任务所需的命令：</p>
			<pre><span>shell&gt; <span><b>tar xzf DIS_GPL_2_5_0_SEP_10_2004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd DIS_GPL_2_5_0_SEP_10_2004/src/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>tar xzf ../../SCI_SOCKET_2_3_0_OKT_01_2004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd ../adm/bin/Linux_pkgs</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./make_PSB_66_release</b></span></span></pre>
			<p>能够为<span>64</span>位处理器创建这些库。要想为使用<span>64</span>位扩展的<span>Opteron 
			CPU</span>创建这些库，请运行<strong><span>make_PSB_66_X86_64_release</span></strong>而不是<strong><span>make_PSB_66_release</span></strong>。如果创建工作是在<span>Itanium</span>机器上进行的，应使用<strong><span>make_PSB_66_IA64_release</span></strong>。<span>X86-64</span>变体应能与<span>Intel 
			EM64T</span>体系结构一起工作，但这点尚未测试（就我们所知）。</p>
			<p>完成创建进程后，在<span>zipped tar</span>文件中可发现已编译好的库，文件的名称符合<span>DIS-<i>&lt;operating-system&gt;</i>-<i>time</i>-<i>date</i></span>。现在，可将软件包安装到恰当位置。在本例中，我们使用的安装目录是<span>/opt/DIS</span>（注释：你很可能需要以系统根用户的身份运行下述命令）：</p>
			<pre><span>shell&gt; <span><b>cp DIS_Linux_2.4.20-8_181004.tar.gz /opt/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>cd /opt</b></span></span></pre>
			<pre><span>shell&gt; <span><b>tar xzf DIS_Linux_2.4.20-8_181004.tar.gz</b></span></span></pre>
			<pre><span>shell&gt; <span><b>mv DIS_Linux_2.4.20-8_181004 DIS</b></span></span></pre>
			<p><strong><span>网络配置</span></strong></p>
			<p>至此，所有的库和二进制文件均已安装到了恰当的位置，还需确保<span>SCI</span>卡在<span>SCI</span>的地址空间范围内拥有恰当的节点<span>ID</span>。</p>
			<p>进行后面的操作前，还需确定网络结构。对于该情形，有三种可使用的网络结构：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span>一维单环网络。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>1</span>个或多个<span>SCI</span>交换器，每个交换器端口有<span>1</span>个环形网。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><span>2</span>维或<span>3</span>维环面网。</p>
			<p>每类拓扑结构均有自己的、用于提供节点<span>ID</span>的方法。下面给出了简要讨论。</p>
			<p>单环网采用的节点<span>ID</span>是<span>4</span>的非<span>0</span>倍数，<span>4</span>，<span>8</span>，<span>12</span>…。</p>
			<p>下一个可行的选择是<span>SCI</span>交换器。<span>1</span>个<span>SCI</span>交换器有<span>8</span>个端口，每个端口都能支持<span>1</span>个环形网。有必要确保不同的环形网使用了不同的节点<span>ID</span>空间。对于典型的配置，第<span>1</span>个端口使用的节点<span>ID</span>低于<span>64</span>（<span>4</span>～<span>60</span>），接下来的<span>64</span>个节点<span>ID</span>（<span>68</span>～<span>124</span>）指定给下一个端口，依此类推，节点<span>ID 
			452</span>～<span>508</span>将被指定给第<span>8</span>个端口。</p>
			<p>对于<span>2</span>维或<span>3</span>维环面网结构，每个节点位于各维中，在第<span>1</span>维中，各节点的增量为<span>4</span>，在第<span>2</span>维中，增量为<span>64</span>，在第<span>3</span>维中（如果适用的话），增量为<span>1024</span>。关于更详尽的文档，请参见<span><a target="_top"  href="http://www.dolphinics.com/support/index.html">Dolphin<span>的网站</span></a></span>。</p>
			<p>在我们的测试中，采用了交换器方式，但大多数大型簇安装应用使用的是<span>2</span>维或<span>3</span>维环面网结构。采用交换器方式具有的优点是：使用双<span>SCI</span>卡和双交换器，能够相对容易地创建冗余网络，<span>SCI</span>网络上的平均故障切换时间在<span>100</span>毫秒量级。对于<span>SCI</span>套接字实施，<span>MySQl</span>簇中的<span>SCI</span>传输器支持该结构，而且它也处于发展当中。</p>
			<p>对于<span>2D/3D</span>环面网，故障切换也是可能的，但需要向所有节点发送发出新的路由索引。然而，这仅需要<span>100</span>毫秒左右就能完成，对于大多数高可用性情形，这是可接受的。</p>
			<p>通过将簇数据节点恰当地置于交换式体系结构中，能够使用<span>2</span>个交换器来构建结构，将<span>16</span>台计算机互联在一起，任何单点故障均不会妨碍<span>1</span>台以上的计算机。对于<span>32</span>台计算机和<span>2</span>台交换器，也能以这样的方式配置簇，任何单点故障均不会导致<span>2</span>个以上的节点丢失，在此情况下，也能知道那一对节点收到影响。因此，通过将两个节点置于不同的节点组，就能创建“安全的”<span>MySQL</span>簇。</p>
			<p>要想为<span>SCI</span>卡设置节点<span>ID</span>，可使用<span><span>/opt/DIS/sbin</span>目录中的下述命令。在本例中，</span>“<span><span>-c 
			1”</span>指的是<span>SCI</span>卡的编号</span>（如果在机器上只有<span>1</span>块卡，它总为<span>1</span>），“<span><span>-a 
			0”</span>指的是适配器<span>0</span>，</span>“<span><span>68”</span>是节点<span>ID</span>：</span></p>
			<pre><span>shell&gt; <span><b>./sciconfig -c 1 -a 0 -n 68</b></span></span></pre>
			<p>如果在同一台机器上有多块<span>SCI</span>卡，使用下述命令（假定当前的工作目录是<span>/opt/DIS/sbin</span>），可确定哪块卡使用哪个插槽：</p>
			<pre><span>shell&gt; <span><b>./sciconfig -c 1 -gsn</b></span></span></pre>
			<p>它将给出<span>SCI</span>卡的序列号。然后用“<span><span>-c 
			2<span>”</span></span>重复该步骤，依此类推（对机器上的每块卡）。一旦将每块卡与</span><span>1</span>个插槽匹配后，可为所有卡设置节点<span>ID</span>。</p>
			<p>安装了必要的库和二进制文件，并设置了<span>SCI</span>节点<span>ID</span>后，下一步是设置从主机名（或<span>IP</span>地址）到<span>SCI</span>节点<span>ID</span>的映射。该任务可在<span>SCI</span>套接字配置文件中完成，该文件应被保存为<span>/etc/sci/scisock.conf</span>。在该文件中，通过恰当的<span>SCI</span>卡将<span>SCI</span>节点映射到与之通信的主机名或<span>IP</span>地址。这里给出了一个很简单的配置文件示例：</p>
			<pre><span>#host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #nodeId</span></pre>
			<pre><span>alpha&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8</span></pre>
			<pre><span>beta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12</span></pre>
			<pre><span>192.168.10.20&nbsp;&nbsp; 16</span></pre>
			<p>也能对配置进行限制，使其仅应用在这些主机的可用端口子集上。也能使用额外的配置文件<span><span>/etc/sci/scisock_opt.conf</span>完成该设置，如下所示：</span></p>
			<pre><span>#-key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -values</span></pre>
			<pre><span>EnablePortsByDefault&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yes</span></pre>
			<pre><span>EnablePort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2200</span></pre>
			<pre><span>DisablePort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2201</span></pre>
			<pre><span>EnablePortRange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2202 2219</span></pre>
			<pre><span>DisablePortRange&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2220 2231</span></pre>
			<p><strong><span>驱动程序安装</span></strong></p>
			<p>创建好了配置文件后，可安装驱动程序。</p>
			<p>首先应安装底层驱动，然后安装<span>SCI</span>套接字驱动：</p>
			<pre><span>shell&gt; <span><b>cd DIS/sbin/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./drv-install add PSB66</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./scisocket-install add</b></span></span></pre>
			<p>如果愿意，可调用脚本来核实<span>SCI</span>套接字配置文件中的所有节点是否均能访问，通过该方式检查安装：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/sbin/</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./status.sh</b></span></span></pre>
			<p>如果发现错误并需要更改<span>SCI</span>套接字配置，需要使用<strong><span>ksocketconfig</span></strong>来完成该任务：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/util</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./ksocketconfig -f</b></span></span></pre>
			<p><strong><span>测试设置</span></strong></p>
			<p>为了确保<span>SCI</span>套接字已实际使用，可使用<strong><span>latency_bench</span></strong>测试程序。使用该实用工具的服务器组件，客户端能够连接服务器以测试连接的等待时间，通过观察等待时间，可方便地判定是否启用了<span>SCI</span>。（注释：使用<strong><span>latency_bench</span></strong>之前，需要设置环境变量<span><span>LD_PRELOAD</span>，请参见本节后面的介绍）。</span></p>
			<p>要想设置服务器，可使用下述命令：</p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/bin/socket</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./latency_bench -server</b></span></span></pre>
			<p>要想运行客户端，再次使用<strong><span>latency_bench</span></strong>，但此时采用“<span><span>-client”</span>选项：</span></p>
			<pre><span>shell&gt; <span><b>cd /opt/DIS/bin/socket</b></span></span></pre>
			<pre><span>shell&gt; <span><b>./latency_bench -client <i>server_hostname</i></b></span></span></pre>
			<p>到目前为止，应完成了<span>SCI</span>套接字配置，而且<span>MySQL</span>簇已做好了使用<span>SCI</span>套接字和<span>SCI</span>传输器的准备（请参见<a href="ndbcluster.html#mysql-cluster-sci-definition" title="17.4.4.10. MySQL Cluster SCI Transport Connections">17.4.4.10节，“MySQL簇SCI传输连接”</a>）。</p>
			<p><strong><span>启动簇</span></strong></p>
			<p>该进程接下来的步骤是启动<span>MySQL</span>簇。要想启用<span>SCI</span>套接字，在启动<strong><span>ndbd</span></strong>、<strong><span>mysqld</span></strong>和<strong><span>ndb_mgmd</span></strong>之前，需要设置环境变量<span>LD_PRELOAD</span>。该变量应指向用于<span>SCI</span>套接字的内核库。</p>
			<p>要想在<span>bash shell</span>下启动<strong><span>ndbd</span></strong>，可执行下述命令：</p>
			<pre><span>bash-shell&gt; export LD_PRELOAD=/opt/DIS/lib/libkscisock.so</span></pre>
			<pre><span>bash-shell&gt; ndbd</span></pre>
			<p>在<span>tcsh</span>环境下，可使用下述命令完成相同的任务：</p>
			<pre><span>tcsh-shell&gt; setenv LD_PRELOAD=/opt/DIS/lib/libkscisock.so</span></pre>
			<pre><span>tcsh-shell&gt; ndbd</span></pre>
			<p><strong><span>注释：</span></strong><span>MySQL</span>簇可以仅使用<span>SCI</span>套接字的内核变体。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="performance-figures"></a>
			17.7.2.&nbsp;理解簇互连的影响</h3></div></div></div></div></div><div class="section"><div class="titlepage"><div><div>
		<strong><span>ndbd</span></strong>进程有很多简单的结构，它们可用于访问<span>MySQL</span>簇中的数据。我们创建了一个十分简单的基准测试来检查它们的性能，以及各种互联方式对其性能的影响。<p>
		有四种访问方法：</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>主键访问</span></strong></p>
		<p>
		通过其主键简单地访问记录。在最简单的情况下，一次仅访问一条记录，这意味着该单一请求需负担设置众多<span>TCP/IP</span>消息的全部开销以及众多的场景切换开销。对于在一批中发出多个主键访问请求的情况，这些访问请求将分担设置必要<span>TCP/IP</span>消息和场景切换的开销。如果<span>TCP/IP</span>消息是面向不同目标的，还须设置额外的<span>TCP/IP</span>消息。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>唯一键访问</span></strong></p>
		<p>
		唯一键访问与主键访问类似，差别在于，唯一键访问是作为在索引表上的读取操作执行的，然后是作用在表上的主键访问。但是，<span>MySQL</span>服务器仅发送一条请求，而且对索引表的读取是由<strong><span>ndbd</span></strong>负责处理的。这类请求也受益于批处理法。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>全表扫描</span></strong></p>
		<p>对于表查询，当不存在索引时，将执行全表扫描。这将作为单一请求被发送至<strong><span>ndbd</span></strong>进程，该进程随后将表扫描分为在所有簇<span>ndbd</span>进程上进行的一组并行扫描。在未来的<span>MySQL</span>簇版本中，<span>SQL</span>节点能够过滤某些扫描。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>使用有序索引的范围扫描</span></strong></p>
		<p>使用有序索引时，它将使用与全表扫描相同的方式执行扫描，不同之处在于，它仅扫描位于<span>MySQL</span>服务器（<span>SQL</span>节点）所传输查询使用的范围内的记录。当所有绑定的索引属性包含分区
		键中的所有属性时，将以并行方式扫描所有分区。</p>
		<p>为了检查这些访问方法的基本性能，我们开发了一组基准。作为这类基准之一，<strong><span>testReadPerf</span></strong>能够测试简单的和批处理式主键和唯一键访问。通过发出返回单一记录的扫描请求，该基准还能测量范围扫描的设置开销。此外，还有<span>1</span>个该基准的变体，它采用了范围扫描来获取批量记录。</p>
		<p>这样，我们就能确定单键访问的开销，以及单记录扫描访问的开销，并能根据基本访问方法测量通信媒介的影响。</p>
		<p>在我们进行的测试中，为采用<span>TCP/IP</span>套接字的正常传输器和使用<span>SCI</span>套接字的类似设置进行了基本设置。下面给出的数字是关于少量访问的，每次访问<span>20</span>条记录。使用<span>2KB</span>的记录时，串行访问和批式访问之间的差异将降低<span>3</span>～<span>4</span>倍。对于<span>2KB</span>的记录，未测试<span>SCI</span>套接字。测试是在下述簇上进行的，该簇有两个数据节点，这两个数据节点运行在<span>2</span>台双<span>CPU</span>机器上，处理器为<span>AMD 
		MP1900+</span>。</p>
		<pre><span>Access type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TCP/IP sockets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SCI Socket</span></pre>
		<pre><span>Serial pk access:&nbsp;&nbsp;&nbsp; 400 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 160 microseconds</span></pre>
		<pre><span>Batched pk access:&nbsp;&nbsp;&nbsp; 28 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22 microseconds</span></pre>
		<pre><span>Serial uk access:&nbsp;&nbsp;&nbsp; 500 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 250 microseconds</span></pre>
		<pre><span>Batched uk access:&nbsp;&nbsp;&nbsp; 70 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 36 microseconds</span></pre>
		<pre><span>Indexed eq-bound:&nbsp;&nbsp; 1250 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 750 microseconds</span></pre>
		<pre><span>Index range:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 24 microseconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12 microseconds</span></pre>
		<p>我们还执行了另一组测试，以检查<span>SCI</span>套接字的性能以及<span>SCI</span>传输器的性能，并将这两者与<span>TCP/IP</span>传输器的性能进行了比较。所有测试均采用了主键访问方法，或采用串行多线程方式，或采用多线程批方式。</p>
		<p>测试结果表明，<span>SCI</span>套接字比<span>TCP/IP</span>约快<span>100</span>％。与<span>SCI</span>套接字相比，在大多数情况下，<span>SCI</span>传输器的速度更快。在具有很多线程的测试程序中出现了<span>1</span>个值得关注的情况，它表明，与<strong><span>mysqld</span></strong>进程一起使用时，<span>SCI</span>传输器的执行性能并不很好。</p>
		<p>我们得出的总体结论是，对于大多数基准，与<span>TCP/IP</span>相比，除了罕见的通信性能不成其为关注事宜的情况外，使用<span>SCI</span>套接字能将性能提升约<span>100</span>％。当扫描过滤器占用大多数处理时间，或当执行大量的主键访问，就会出现该情况。在这类情况下，<span>ndbd</span>进程中的<span>CPU</span>处理操作将占用开销的相当大部分。</p>
		<p>对于使用<span>SCI</span>传输器来取代<span>SCI</span>套接字，它仅对<span>ndbd</span>进程之间的通信有意义。如果<span>CPU</span>能专门用于<span>ndbd</span>进程，使用<span>SCI</span>传输器也也很有意义，这是因为<span>SCI</span>传输器能确保该进程永不休息。另一个重要特性是，它能确保对<span>ndbd</span>进程的优先级进行特定的设置，即使运行了很长的时间，其优先级也不会丧失，就像在<span>Linux 
		2.6</span>中通过将进程锁定到<span>CPU</span>而能实现的那样。如果这类配置是可能的，与使用<span>SCI</span>套接字相比，<span>ndbd</span>进程将获得<span>10</span>～<span>70</span>％的性能提升（执行更新以及可能的并行扫描操作时，性能提升较大）。。</p>
		<p>对于计算机簇，还有数种其他的优化套接字实施方案，包括<span>Myrinet</span>、吉比特以太网、<span>Infiniband</span>（无限带宽）和<span>VIA</span>接口。迄今为止，我们仅与<span>SCI</span>套接字一起测试了<span>MySQL</span>簇。我们还提供了上述文档，其中，介绍了如何使用针对<span>MySQL</span>簇的常规<span>TCP/IP</span>来设置<span>SCI</span>套接字的方法。</p>
		<h2 class="title"><a name="mysql-cluster-limitations"></a>
		17.8.&nbsp;MySQL簇的已知限制</h2></div></div></div>
		<p>在本节中，我们列出了<span>5.1.x</span>系列中对<span>MySQL</span>簇的一些已知限制，并与使用<span>MyISAM</span>和<span>InnoDB</span>存储引擎时可用的特性进行了比较。目前，尚不打算在即将推出的<span>MySQL 
		5.1</span>版本中处理这些问题，但是，我们将在后续的版本系列中，提供这方面的补丁和修正。如果你检查了<span>MySQL</span>缺陷数据库（<span><a target="_top"  href="http://bugs.mysql.com">http://bugs.mysql.com</a></span>）中的“簇”类别，可发现我们打算在即将推出的<span>MyAQL 
		5.1</span>版中更正的已知缺陷（如果标记为“<span>5.1</span>”的话）。</p>
		<p>（注释：在本节末尾，列出了在当前版本中已解决的<span>MySQL 5.0</span>簇中的一些事宜）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>语法中的不兼容性</span></strong>（运行已有的应用程序时导致错误）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持文本索引。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持<span>Geometry</span>数据类型（<span><span>WKT</span>和<span>WKB</span>）。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>限制或行为中的不兼容性</span></strong>（运行已有的应用程序时可能导致错误）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>没有事务的部分回滚功能。重复键或类似错误会导致整个事务的回滚。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>存在很多可配置的硬限制，但能使用簇中的可用主内存设置限制。关于配置参数的完整清单，请参见<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4节，“配置文件”</a>。大多数配置参数可在线升级。这些硬限制包括：</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>数据库内存大小和索引内存大小（分别是<span>DataMemory</span>和<span>IndexMemory</span>）。</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>对于能够执行的最大事务数，可使用配置参数<span><span>MaxNoOfConcurrentOperations</span>进行设置。注意批量加载，<span>TRUNCATE 
		TABLE</span></span>和<span><span>ALTER 
		TABLE</span>是通过运行多个事务作为特殊情况进行处理的，因而不受该限制的约束。</span></p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>与表和索引有关的不同限制。例如，每表的最大有序索引数是由<span>MaxNoOfOrderedIndexes</span>确定的。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>在<span>NDB</span>表中，数据库名称、表名称和属性名称不能与其他表处理程序中的一样长。属性名称将被截短至<span>31</span>个字符，截短后如果不是唯一的，将导致错误。数据库名称和表名的总最大长度为<span>122</span>个字符（也就是说，<span>NDB</span>簇表名的最大长度为<span>122</span>个字符减去该表所属的数据库的名称中的字符数）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>所有的簇表行具有固定长度。这意味着（例如），如果表中有仅包含相对较小值的<span>1</span>个或多个<span><span>VARCHAR</span>字段，与使用<span>MyISAM</span>引擎的相同表和数据相比，使用<span>NDB</span>存储引擎时需要更多的内存和磁盘空间。换句话讲，对于<span>VARCHAR</span>列，它所需的存储空间与具有相同大小的<span>CHAR</span>列所需的相同。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>簇数据库中的最大表数目限制为<span>1792</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每表的最大属性数限制为<span>128</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>任一行的最大允许大小为<span>8K</span>，<em><span>不包括保存在<span>BLOB</span>列中的数据。</span></em></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每键的最大属性数为<span>32</span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>不支持的特性</span></strong>（不会导致错误，但不被支持或强制）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>外键结构将被忽略，就像在<span>MyISAM</span>表中那样。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>保存点以及对保存点的回滚将被忽略，就像在<span>MyISAM</span>中那样。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>性能以及与限制有关的事宜</span></strong></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>由于对<span>NDB</span>存储引擎的连续访问，存在查询性能问题，与<span>MyISAM</span>或<span><span>InnoDB</span>的情形相比，执行很多范围扫描时，开销相对昂贵。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持范围统计中的记录，在某些情况下，这会造成非最优查询计划。可采用<span>USE 
		INDEX</span>或<span><span>FORCE 
		INDEX</span>规避该问题。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>对于使用<span><span>USING 
		HASH</span>创建的唯一性哈希索引，如果<span>NULL</span>是键的一部分，不能使用这类索引访问表。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>MySQL</span>簇不支持磁盘上的持续提交。提交将被复制，但不保证在提交时会将日志写入磁盘。</p>
		<p><strong>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>丢失特性：</span></strong></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>唯一支持的隔离级别是<span>READ_COMMITTED</span>（<span>InnoDB</span>支持<span>READ_COMMITTED</span>、<span>READ_COMMITTED</span>、<span>REPEATABLE_READ</span>和<span><span>SERIALIZABLE</span>）。关于其如何影响簇数据库备份和恢复的更多信息，请参见</span><a href="ndbcluster.html#mysql-cluster-backup-troubleshooting" title="17.6.5.5. Backup Troubleshooting">17.6.5.5节，“备份故障诊断与排除”</a>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持磁盘上的持续提交。提交将被复制，但不保证在提交时会将日志写入磁盘。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>与多<span>MySQL</span>服务器有关的问题</span></strong>（与<span>MyISAM</span>或<span>InnoDB</span>无关）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>运行多个<span>MySQL</span>服务器时，<span>ALTER 
		TABLE</span></span>未完全锁定（无分布式表锁定）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>如果在多个<span>MySQL</span>服务器上进行了更新，<span>MySQL</span>复制功能不能正确处理。但是，如果数据库分区方案是在应用级别上完成的，而且在这些分区上非发生事务，那么可使复制功能正确工作。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>对于访问相同<span>MySQL</span>簇的多<span>MySQL</span>服务器，不支持数据库的自动发现（<span>autodiscovery</span>）功能。但是，在情况下，支持对表的自动发现（<span>autodiscovery</span>）功能。这意味着，创建了名为<span><i><span>db_name</span></i></span>的数据库后，或使用<span>1</span>个<span>MySQL</span>服务器导入了该数据库后，应在访问相同<span>MySQL</span>簇的每个额外<span>MySQL</span>服务器上发出<span><span>CREATE 
		DATABASE <i>db_name</i></span>语句（从</span><span>MySQL 5.0.2<span>开始，你还能使用</span><span>CREATE 
		SCHEMA <i>db_name</i>;</span></span>）。一旦对给定<span>MySQL</span>服务器完成了该操作，服务器应能检测到数据库表，而不产生错误。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>仅与<span>MySQL</span>簇有关的事宜</span></strong>（与<span><span>MyISAM</span>或<span>InnoDB</span></span>无关）：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>簇中使用的所有机器必须具有相同的体系结构，也就是说，所有承载节点的机器必须是<span>big-endian</span>或<span>little-endian</span>，不能混合使用这两者。例如，不能用运行在<span>PPC</span>上的管理节点指挥运行在<span>x86</span>机器上的数据节点。该限制不适用于简单运行<strong><span>mysql</span></strong>或其他客户端（可能会访问簇的<span>SQL</span>节点）的机器。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不能像使用<span>ALTER 
		TABLE</span>或<span><span>CREATE 
		INDEX</span>完成的那样</span>执行在线方案更改，这是因为<span><span>NDB</span>簇不支持这类变更的自动检测（但是，</span>能够导入或创建使用不同存储引擎的表，然后使用“<span>ALTER 
		TABLE <i>tbl_name</i> ENGINE=NDBCLUSTER;</span>”将其转换为<span>NDB</span>。在这类情况下，需要发出<span><span>FLUSH 
		TABLES</span>命令，</span>强制簇发现变化）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不能在线增加或舍弃节点（此时必须重启簇）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>使用多个管理服务器时：</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>必须在连接字符串中明确为节点指定<span>ID</span>，这是因为，在多个管理服务器上，自动分配的节点<span>ID</span>不能正常工作。</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>必须十分小心，确保所有的管理服务器具有相同的配置。簇对此方面不进行任何特殊检查，</p>
		<p >
		<span  >§<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>要想使管理节点能发现彼此的存在，创建了簇后必须重启所有的数据节点（详细解释请参见<span><a target="_top"  href="http://bugs.mysql.com/13070">Bug 
		#13070</a></span>）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持用于数据节点的多个网络接口。如果使用了这类接口，很容易导致问题，原因在于，在出现某一数据节点失败的情况下，<span>SQL</span>节点将等待以确认该数据节点是否出现问题，但由于该数据节点的另一路径仍保持打开状态，<span>SQL</span>节点永远不会收到该确认信息。这会导致簇无法工作。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>数据节点的最大数目为<span>48</span>。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>MySQL</span>簇中总的最大节点数为<span>63</span>。在该数值中包括所有的<span>MySQL</span>服务器（<span>SQL</span>节点），数据节点和管理服务器。</p>
		<p>考虑到本节开始时设定的条件，我们力图使上面列出的信息尽可能完全。你可以将任何遇到的差异通报到<span>MySQL</span>缺陷数据库，<span><a  href="http://bugs.mysql.com/">http://bugs.mysql.com/</a></span>。如果我们不打算在<span>MySQL 
		5.1</span>中更正该问题，我们会将其添加到列表中。</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-roadmap"></a>17.9. MySQL簇发展的重要历程</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ndbcluster.html#mysql-5-0-cluster-changes">17.9.1. 
		MySQL 5.0中的MySQL簇变化</a></span></dt><dt><span class="section"><a href="ndbcluster.html#mysql-5-1-cluster-roadmap">
		17.9.2. 关于MySQL簇的MySQL 5.1发展历程</a></span></dt></dl></div><a class="indexterm" name="id2972967"></a><a class="indexterm" name="id2972976"></a><a class="indexterm" name="id2972986"></a>
		<p>在本节，我们讨论了<span>MySQL 5.1</span>在<span>MySQL</span>簇实施中的一些变化，并与<span>MySQL 
		5.0</span>进行了比较。我们还将讨论对<span>MySQL</span>簇的进一步重大改进，目前是为<span>MySQL 
		5.2</span>规划的。</p>
		<p>在<span>MySQL 5.0</span>和<span>5.1</span>中，<span>NDB</span>簇存储引擎实施方案之间的变化相对较少，因此其升级相对快捷和简单。</p>
		<p>为<span>MySQL</span>簇开发的主要新特性均归入了<span>MySQL 5.1</span>树。在本节中，我们还提供了一些提示，介绍了在<span>MySQL 
		5.1</span>中簇特性可能包含的方面（请参见<a href="ndbcluster.html#mysql-5-1-cluster-roadmap" title="17.9.2. MySQL 5.1 Development Roadmap for MySQL Cluster">17.9.2节，“关于MySQL簇的MySQL 5.1发展历程”</a>）。</p>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-5-0-cluster-changes"></a>17.9.1. MySQL 
			5.0中的MySQL簇变化</h3></div></div></div>
			<p><span>MySQL 5.0.3-beta</span>以及更新的版本包含一些有趣的新特性：</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>下推条件：</span></strong>一种查询，如：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>SELECT * FROM t1 WHERE non_indexed_attribute = 1;</span></pre>
			<p>
			它将使用全表扫描，并会在簇的数据节点内评估条件。因此，不需要在网络中发送用于评估的记录（也就是说，采用函数传输而不是数据传输）。对于这种查询类型，其速度快<span>5</span>～<span>10</span>倍。请注意，模目前该特性是默认禁止的（有待更彻底的测试），但在某些情况下也能良好工作。使用命令“<span>SET 
			engine-condition-pushdown=On;</span><span> command</span>”可启用该特性。作为可选方式，你也可以用新的“<span>--engine-condition-pushdown</span>”选项标志启动<span>MySQL</span>服务器，运行启用了该特性的<strong><span>mysqld</span></strong>。</p>
			<p>可以使用<span><span>EXPLAIN</span>来判定在何时使用了下推条件。</span></p>
			<p>
			该变化的一项主要优点在于，能够以并行方式执行查询。这意味着，与以往相比，对非索引列的查询要快<span>5</span>～<span>10</span>倍，乘以数据节点的数目。原因在于，多个<span>CPU</span>能以并行方式执行查询。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>降低了</span></strong><span><b><span>IndexMemory</span></b></span><strong><span>使用：</span></strong>在<span>MySQL 
			5.1</span>中，每条记录约消耗<span>25</span>字节的索引内存，每个唯一索引每记录将使用<span>25</span>字节的索引内存（不含某些数据内存，这是因为它们保存在单独表中）。这是因为在索引内存中，不再需要保存主键。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>为<span>MySQL</span>簇启用了查询高速缓冲：</span></strong>关于配置和使用查询高速缓冲的更多信息，请参见<a href="database-administration.html#query-cache" title="5.13. The MySQL Query Cache">5.13节，“MySQL查询高速缓冲”</a>。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>新的优化</span></strong>：有一个需要给予特别关注的优化，即，目前在某些查询中使用了批式读取接口。例如，考虑下述查询：</p>
			<pre><span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span>SELECT * FROM t1 WHERE <span><i>primary_key</i></span> IN (1,2,3,4,5,6,7,8,9,10);</span></pre>
			<p>与以往的<span>MySQL</span>簇版本相比，该查询的执行速度快<span>2</span>～<span>3</span>倍，原因在于，全部<span>10</span>个
			键查找是在<span>1</span>个批次中发出的，而不是一次发送一个。</p>
			<p>
			<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>限制元数据对象的数目：</span></strong>在<span>MySQL 
			4.1</span>中，每个簇数据库最多可能包含<span>1600</span>个元数据对象，包括数据库表，系统表，索引和<span>BLOB</span>。在<span>MySQL 
			5.0</span>中，我们希望将该数值增加到<span>20320</span>。我们打算在<span>2005</span>年年中发布的<span>MySQL 
			5.0.6 beta</span>版中实现该增强特性。</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mysql-5-1-cluster-roadmap"></a>
			17.9.2.&nbsp;关于MySQL簇的MySQL 5.1发展历程</h3></div></div></div>
			<p>这里所介绍的内容是一份状态报告，它基于最近提交到<span>MySQL 5.1</span>源码树的内容。请注意，所有的<span>5.1</span>开发活动均可能随时变化。</p>
			<p>目前，有四种为<span>MySQL 5.1</span>开发的主要新特性：</p>
			<p>
			<span>1.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>将<span>MySQL</span>簇集成到了<span>MySQL</span>复制中：</span></strong>这样，就能从簇中的任何<span>MySQL</span>服务器执行更新，并由簇中的<span>1</span>个<span>MySQL</span>服务器处理<span>MySQL</span>复制，并保持了从服务器端安装的一致性。</p>
			<p>
			<span>2.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>支持基于磁盘的记录：</span></strong>将支持磁盘上的记录。对于包含主键哈希索引的有索引字段，必须仍保存在<span>RAM</span>中，但可以将所有其他字段保存在磁盘上。</p>
			<p>
			<span>3.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>大小可变的记录：</span></strong>定义为<span><span>VARCHAR(255)</span>的列目前使用<span>260</span>字节的存储空间，与任何特定记录中保存的内容无关。</span>在<span>MySQL 
			5.1</span>簇表中，只保存被记录实际占用的字段部分。这样，在很多情况下，能够将这类列的空间需求量降低<span>5</span>倍。</p>
			<p>
			<span>4.<span>&nbsp;&nbsp;&nbsp;
			</span></span><strong><span>用户定义的分区功能：</span></strong>用户能够根据主关键的字段部分定义分区。<span>MySQL</span>服务器能够发现是否能将某些分区从<span><span>WHERE</span>子句中删除。能够根据<span>KEY</span></span>、<span>HASH</span>、<span>RANGE</span>和<span><span>LIST</span>处理程序执行分区操作和子分区操作。对于很多其他处理程序，也应能使用该特性。</span></p>
			<p>此外，对于簇表中包含除<span>BLOB</span>或<span>TEXT</span>外的列类型的行，我们正准备增大<span>8K</span>的大小限制值。这是因为，行目前具有固定的大小，页大小为<span>32768</span>字节（减去用于行标题的<span>128</span>字节）。在目前，这意味着，如果允许每记录占用的大小超过<span>8K</span>，剩余的空间将为空（多达<span>14000</span>字节）。在<span>MySQL 
			5.1</span>中，我们打算更正该限制，从而使得在给定行中使用<span>8K</span>以上的空间不会导致页剩余部分的浪费。</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-faq"></a>17.10. MySQL簇常见问题解答</h2>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用簇与使用复制的区别是什么？</span></em></p>
		<p>在复制设置中，主<span>MySQL</span>服务器负责更新<span>1</span>个或多个从服务器。事务按顺序提交，较慢的事务会导致从服务器滞后于主服务器。这意味着，如果主服务器失败，从服务器可能无法记录最近的少数事务。如果使用了事务安全引擎，如<span>InnoDB</span>，要末是在从服务器上完成事务，要末是根本就不记录事务，但复制不保证主服务器和从服务器上的所有数据在任何时候都是一致的。在<span>MySQL</span>簇中，所有的数据节点保持同步，任何一个数据节点提交的事务将被提交给所有的数据节点。当某一数据节点失败时，所有剩余的数据节点仍能保持一致的状态。</p>
		<p>简而言之，尽管标准的<span>MySQL</span>复制是异步的，但<span>MySQL</span>簇是同步的。</p>
		<p>我们计划在<span>MySQL 5.1</span>中为簇实现（异步）复制功能。包括在两个簇之间，以及<span>MySQL</span>簇和非簇类<span>MySQL</span>服务器之间的复制能力。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>为了运行簇，我是否需要进行特殊的组网呢？（簇中的计算机是如何通信的？）</span></em></p>
		<p><span>MySQL</span>簇是为高带宽环境下的使用而设计的，计算机通过<span>TCP/IP</span>相连。其性能直接取决于簇计算机之间的连接速度。对于簇，最低连接要求包括：典型的<span>100MB</span>以太网网络或等效网络。如果可能，建议使用<span>GB</span>以太网。</p>
		<p>也支持更快的<span>SCI </span>
		协议，但需要特殊硬件。关于<span>SCI</span>的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7节，“使用与MySQL簇的高速互连”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>运行簇需要多少台计算机？为什么？</span></em></p>
		<p>要想运行可行的簇，最少需要<span>3</span>台计算机。但在<span>MySQL</span>簇中，推荐的最低计算机数目为<span>4</span>：<span>1</span>台负责运行管理节点，<span>1</span>台负责运行<span>SQL</span>节点，<span>2</span>台用作存储节点。使用<span>2</span>个数据节点的目的是为了提供冗余性，管理节点必须运行在单独的机器上，这样，当<span>1</span>个数据节点失败时，仍能保证连续的仲裁服务。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>簇中不同计算机所负责的任务是什么？</span></em></p>
		<p><span>MySQL</span>簇包含物理和逻辑结构，计算机是其物理部件。簇的逻辑或功能部件称为节点，容纳簇节点的计算机有时也称为簇主机。在理想情况下，每台簇主机将有<span>1</span>个节点，但在单个簇主机上可运行多个节点。簇中有三种节点，每一种节点均对应特定的角色。它们是：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>管理节点（<span>MGM</span>节点）：</span></strong>为整个簇提供管理服务，包括启动、停止、备份、以及为其他节点配置数据。管理节点服务器是作为应用程序<strong><span>ndb_mgmd</span></strong>实现的，用于通过<span>MGM</span>节点控制<span>MySQL</span>簇的管理客户端是<strong><span>ndb_mgm</span></strong>。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>数据节点：</span></strong>保存和复制数据。数据节点的功能由<span>NDB</span>数据节点进程<span>ndbd</span>的实例负责处理。</p>
		<p><span>3.<span>&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>SQL</span><span>节点：</span></strong>这是用“<strong><span>--ndb-cluster</span></strong>”选项启动的<span>MySQL</span>服务器（<strong><span>mysqld</span></strong>）的一个实例。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>用什么操作系统才能使用簇呢？</span></em></p>
		<p>在<span>MySQL 5.1</span>中，在<span>Linux</span>、<span>Mac 
		OS X</span>和<span>Solaris</span>平台上均正式支持<span>MySQL</span>簇。我们正在努力为其他平台增加簇支持，包括<span>Windows</span>，我们的目标是，最终在支持<span>MySQL</span>本身的所有平台上实现<span>MySQL</span>簇。</p>
		<p>在其他操作系统上运行簇也是可能的。用户告诉我们，他们在<span>FreeBSD</span>平台上超过运行了簇。但是，除了前面介绍的三种操作系统外，在其他平台上运行的簇应被视为<span>alpha</span>软件（最好情况），不保证在生产环境下的可靠性，而且<em><span>不被<span>MySQL 
		AB</span>支持</span><span>。</span></em></p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>运行<span>MySQL</span>簇的硬件要求是什么？</span></em></p>
		<p>在簇运行的任何平台上，应具有具备<span>NDB</span>功能的二进制文件。显而易见，更快的<span>CPU</span>和更多的内存能够改善性能，<span>64</span>位<span>CPU</span>的效率很可能高于<span>32</span>位处理器。在用于数据节点的机器上必须有足够的内存，以便容纳各节点共享的数据库部分。（更多信息，请参见<strong><span>我需要多少内存？</span></strong>）。节点能通过标准的<span>TCP/IP</span>网络和硬件进行通信。对于<span>SCI</span>支持，需要特殊的组网硬件。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>由于<span>MySQL</span>簇使用了<span>TCP/IP</span>，这是否意味着我能在<span>Internet</span>上运行<span>1</span>个或多个节点位于远程位置的簇？</span></em></p>
		<p>请记住，在<span>MySQL</span>簇中，节点间的通信并不安全，这点极其重要，这类通信未加密，也未采用任何防护机制。对于簇，最安全的配置是位于防火墙后的专用网络，不能从外部直接访问任何簇数据或管理节点（对于<span>SQL</span>节点，应采取相同的防护措施，就像在<span>MySQL</span>服务器的其他实例中那样）。</p>
		<p>无论是任何情况，在这类条件下簇的可靠运行十分令人怀疑，这是因为设计和实施<span>MySQL</span>簇时，假定它运行在能保证专用高速连通性的条件下，如使用<span>100MB</span>或<span>GB</span>以太网的<span>LAN</span>中（更倾向于后者）。对于低于该要求的任何环境，我们未作任何测试，也不保证其性能。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>
		要想使用簇，我是否不得不学习新的编程语言或查询语言？</span></em></p>
		<p>不。尽管使用了一些专用命令来管理和配置簇本身，但对于下述操作，仅需要标准的<span>(My)SQL</span>查询和命令：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>创建、更改和撤销表。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>插入、更新和删除表数据。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>创建、更改和撤销主索引和唯一索引。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>配置和管理<span>SQL</span>节点（<span>MySQL</span>服务器）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用簇时，如何了解错误或警告消息的含义呢？</span></em></p>
		<p>有两种完成它的方式：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>出现错误或告警状况时，在<span>MySQL</span>监视器内，立刻使用<strong><span>SHOW 
		ERRORS</span></strong>或<strong><span>SHOW 
		WARNINGS</span></strong>。也能在<span>MySQL Query Browser</span>（查询浏览器）中显示它们。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>在系统<span>shell</span>提示符下，使用<strong><span>perror 
		--ndb </span></strong><span><b><i>
		<span>error_code</span></i></b></span>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>MySQL</span><span>簇是事务安全的吗？支持什么隔离级别？</span></em></p>
		<p><em><span>是</span></em>。对于用<span><span>NDB</span>存储引擎创建的表，支持事务。</span>在<span>MySQL 
		5.1</span>中，簇仅支持<span><span>READ_COMMITTED</span>事务隔离级别。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>簇支持的表类型是什么？</span></em></p>
		<p>
		<span>NDB</span>是仅有的支持簇功能的<span>MySQL</span>存储引擎。</p>
		<p>（能够使用其他存储引擎在用于簇的<span>MySQL</span>服务器上创建表，如<span>MyISAM</span>或<span>InnoDB</span>，但这类非<span><span>NDB</span>表不在簇中</span>）。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>“</span></em><span class="quote"><i><span>NDB</span></i></span><em><span>”的含义是什么？</span></em></p>
		<p>它是“<strong><span>N</span></strong><span class="quote"><span>etwork
		</span></span><strong><span>D</span></strong><span class="quote"><span>ata</span></span><strong><span>b</span></strong><span class="quote"><span>ase</span></span>”（网络数据库）的缩写。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>哪些版本的<span>MySQL</span>软件支持簇？我必须从源码编译吗？</span></em></p>
		<p>在<span>5.1</span>系列的所有<span>MySQL-max</span>二进制版本中均支持簇，但下面介绍的除外。使用命令<span>SHOW 
		VARIABLES LIKE &#39;have_%&#39;;</span>或<span><span>SHOW 
		ENGINES;</span>，可检查你的服务器是否支持<span>NDB</span></span>（更多信息，请参见<a href="database-administration.html#mysqld-max" title="5.1.2. The mysqld-max Extended MySQL Server">5.1.2节，“mysq<span><strong class="command">ld-max扩展My</strong></span>SQL服务器”</a>）。</p>
		<p><span>Linux</span>用户请注意，<span><span>NDB</span>未包含在</span>标准的<span>MySQL</span>服务器<span>RPM</span>中。对于<span>NDB</span>存储引擎以及所附的管理工具和其他工具，有单独的<span>RPM</span>软件包。请参见<span>MySQL 
		5.1</span>下载页上的<span>NDB RPM</span>下载部分（以前，你必须使用以<span><span>.tar.gz</span>档案方式提供的<span>“-max”</span>二进制文件。目前仍能这样，但却不是必须的，如果愿意，可使用<span>Linux</span>分发版的<span>RPM</span>管理器）。通过从源码编译<span>-max</span>二进制文件，也能获得<span>NDB</span>支持，但使用<span>MySQL</span>簇时，不需要这样。要想只下载</span>最新的<span>MySQL 
		5.1</span>系列的二进制版本、<span>RPM</span>、或源码分发版，请访问<span><a target="_top"  href="http://dev.mysql.com/downloads/mysql/5.1.html">http://dev.mysql.com/downloads/mysql/5.1.html</a></span>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我需要多少<span>RAM</span>？是否能全部使用磁盘内存？</span></em></p>
		<p>在目前，簇是仅“内存中”的。这意味着所有的表数据（包括索引）均保存在<span>RAM</span>中。因此，如果你的数据占用了<span>1GB</span>的空间，而且打算在簇中将它复制<span>1</span>次，需要<span>2GB</span>的内存。还应加上操作系统以及在簇计算机上运行的应用程序所需的内存。</p>
		<p>可以使用下述公司粗略估计簇中每个数据节点所需的<span>RAM</span>量：</p>
		<pre><span>(SizeofDatabase * NumberOfReplicas * 1.1 ) / NumberOfDataNodes</span></pre>
		<p>
		要想更准确地计算内存需求量，需要为簇数据库中的每个表确定每行所需的存储空间（详情请参见<a href="column-types.html#storage-requirements" title="11.5. Column Type Storage Requirements">11.5节，“列类型存储需求”</a>），然后乘以占行数。还必须对列索引进行计算，方式如下：<span> </span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>对于为<span>NDB</span>簇表创建的每个主键索引或哈希索引，每记录需要<span>21-25</span>字节。这类索引使用<span>IndexMemory</span>（索引内存）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每个有序索引每记录需要<span>10</span>字节的存储空间，使用<span>DataMemory</span>（数据内存）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>创建主键或唯一索引时，还会创建<span>1</span>个有序索引，除非该索引是使用<span><span>USING 
		HASH</span>创建的。换句话讲，</span>如果未使用<span><span>USING 
		HASH</span>创建它们，对于</span>簇表上的每个键多因或唯一索引，在<span>MySQL 5.1</span>中，每记录占用<span>31-35</span>字节。</p>
		<p>注意，使用<span><span>USING 
		HASH</span>为所有主键和唯一索引创建</span><span>MySQL</span>簇表时，通常还能使表的更新速度更快。这是因为，它需要较少的内存（因未创建有序索引），对<span>CPU</span>的占用也较低（仅需读取或更新较少的索引）。</p>
		<p>请记住，所有的<span>MySQL</span>簇表必须有主键，这点极其重要。如果未定义，<span><span>NDB</span>存储引擎将自动创建主键，而且该主键是在未使用<span>USING 
		HASH</span></span>的条件下创建的。</p>
		<p>很难准确确定簇索引在任何给定时间用于存储的内存量，但是，当可用<span>DataMemory</span>和<span>/</span>或<span><span>IndexMemory</span>的使用率到达<span>80</span>％时，会将警告消息写入簇日志，到达<span>80</span>％、<span>90</span>％等时，也会写入簇日志。</span></p>
		<p>
		我们经常遇到用户通报的下述问题，当他们视图填充簇数据库时，加载进程提前终止，并显示下述错误消息：</p>
		<pre>错误<span>1114</span>：表<span>&#39;my_cluster_table&#39;</span>已满。</pre>
		<p>出现该情况时，很可能是因为在你的设置中未为所有的表数据和索引提供足够的<span>RAM</span>，<em><span>包括</span></em><span><i><span>NDB</span>存储引擎所需的主键，以及表定义中不包含主键定义时自动创建的主键。</i></span></p>
		<p>此外还应注意，所有的数据节点应具有相同的<span>RAM</span>量，这是因为，簇中任何数据节点所能使用的内存均不超过任意单独数据节点的最低可用内存。换句话讲，如果有三台运行簇数据节点的计算机，在其中两台计算机上，有<span>3GB</span>用于保存簇数据的<span>RAM</span>，另一台计算机只有<span>1GB 
		RAM</span>，那么每个数据节点仅能为簇贡献<span>1GB</span>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>出现灾难性故障时，例如整个城市断电而且我的<span>UPS</span>也出现故障，我会丢失所有的数据吗？</span></em></p>
		<p>
		所有已提交的事务将被记录。因此，在出现灾难的情况下，某些数据可能会丢失，但相当有限。通过减少每事务的操作数，能够进一步减少数据损失（在任何情形下，在每事务上执行大量操作都不是一个好主意）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>能够与簇一起使用</span></em><span><i><span>FULLTEXT</span>索引吗？</i></span></p>
		<p>
		<span>FULLTEXT</span>索引功能目前不被<span><span>NDB</span>存储引擎支持，也不被除<span>MyISAM</span>之外的任何存储引擎支持。我们打算在未来的版本中增加该功能。</span></p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能在一台计算机上运行多个节点吗？</span></em></p>
		<p>
		可以，但不建议这样。运行簇的主要原因之一是提供冗余，为了获得冗余性的全部优点，每个节点应位于单独的计算机上。如果将多个节点置于同一台机器，当该机器出现故障时，所有节点均将丢失。考虑到<span>MySQL</span>簇能运行在常见的硬件上并利用廉价的操作系统（或不需费用），为了确保任务关键型数据的安全，值得为额外的机器户花费开销。此外还须注意，对运行管理节点的簇主机的要求最低，使用<span>200 
		MHz Pentium CPU</span>，操作系统所需的足够<span>RAM</span>，以及用于<strong><span>ndb_mgmd</span></strong>和<strong><span>ndb_mgm</span></strong>进程的少量开销，就能完成该任务。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>我能在不重启的情况下为簇增加节点吗？</span></em></p>
		<p>目前不行。对于在簇中添加新的<span>MGM</span>或<span>SQL</span>节点来说，简单的重启就是所需的一切。添加数据节点时，进程略微复杂些，需要采取下述步骤：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>对所有簇数据进行完整备份。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>彻底关闭簇和所有的簇节点进程。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>使用“<span><span>—initial”</span>启动选项重启簇。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>从备份中恢复所有簇数据。</p>
		<p>在未来的<span>MySQL</span>簇版本中，我们希望为<span>MySQL</span>簇实现“热”重配置功能，以便能够将添加新节点时重启簇的要求降至最低（如果不能消除的话）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>使用簇时有需要我了解的限制吗？</span></em></p>
		<p><span>
		<span>MySQL</span>中的<span>NDB</span>表服从下述限制：</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>并非所有的字符集和校对均被支持。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>不支持<span>FULLTEXT</span>索引和前缀索引。</span>只能为完整的列设置索引。不支持<a href="spatial-extensions-in-mysql.html">第19章：</a><a href="spatial-extensions-in-mysql.html" title="Chapter 19. Spatial Extensions in MySQL"><i>MySQL中的空间扩展</i></a>中介绍的空间扩展。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>仅支持对事务的完整回滚。不支持部分回滚以及回滚至保存点。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>每表允许的最大属性数为<span>128</span>，而且属性名称不得超过<span>31</span>个字符。对于每个表，表和数据库名称的最大组合长度为<span>122</span>个字符。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>表行的最大大小为<span>8KB</span>，不包括<span>BLOB</span>。对于每表中的行数没有限制，表的大小限制取决于多种因素，尤其是每个数据节点可用的<span>RAM</span>量。</p>
		<p>
		<span>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>NDB</span>引擎</span>不支持外键约束。就像<span><span>MyISAM</span>表一样，这些约束将被忽略。</span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span>不支持查询高速缓冲功能。</p>
		<p>关于簇限制的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8节，“MySQL簇的已知限制”</a>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>怎样将已有的<span>MySQL</span>数据库导入到簇中？</span></em></p>
		<p>可以将数据库导入到<span>MySQL</span>簇中，就像用其他版本的<span>MySQL</span>那样。除了前一问题所提到的限制外，仅有的特殊要求是，准备包含到簇中的任何表必须使用<span>NDB</span>存储引擎。这意味着，表必须是用<span>ENGINE=NDB</span>或<span><span>ENGINE=NDBCLUSTER</span>创建的。使用<span>ALTER 
		TABLE</span>，能够将使用其他存储引擎的现有表转换为<span>NDB</span>簇表，但需要采取额外避规措施，</span>详情请参见<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8节，“MySQL簇的已知限制”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>簇节点是怎样彼此通信的？</span></em><span>
		</span></p>
		<p>簇节点能够通过下述三种协议中的任何一种进行通信：<span>TCP/IP</span>、<span>SHM</span>（共享内存）和<span>SCI</span>（规模可扩展的计算机连接接口）。在适用的场合，对于位于相同簇主机上的节点间通信，默认协议为<span>SHM</span>。<span>SCI</span>是高速（每秒<span>1GB</span>或更高）、高可用性协议，用于创建可扩展的多处理器系统，它需要特殊硬件和驱动。关于使用<span>SCI</span>作为簇中传输机制的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-interconnects" title="17.7. Using High-Speed Interconnects with MySQL Cluster">17.7节，“使用与MySQL簇的高速互连”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>什么是“</span></em><span class="quote"><i><span>arbitrator</span></i></span><em><span>”（仲裁程序）</span></em>？</p>
		<p>如果簇中的<span>1</span>个或多个节点失败，并非所有的簇节点均不能彼此“看到”，这是可能的。事实上，能够在网络分区中将两个节点集合彼此隔离，也称为“分裂大脑”。这类情形并不受欢迎，这是因为，每一个节点集合都试图表现为代表整个簇。</p>
		<p>当簇节点出现问题时，有两种可能性。如果剩余节点的<span>50</span>％以上能够彼此通信，那么这就是我们有时称之为的“多数支配”情形，该节点集合将被视为簇。当节点数均等时，仲裁程序将介入：在该情形下，仲裁程序所属的节点集合将被当作簇，不属于该节点集合的节点将被关闭。</p>
		<p>上述描述略为简化，更完整的解释需要考虑下面介绍的节点组：</p>
		<p>
		当至少一个节点组中的所有节点均有效时，网络分区不是问题，这是因为，簇中的任一个部分均不能构成<span>1</span>个功能性的簇。当没有一个节点组的所有成员均是有效的时，问题产生，在该情况下，网络分区（“分裂大脑”情形）成为可能。随后就需要仲裁程序。所有的簇节点将相同的节点视为仲裁程序，通常是管理服务器。但是，也能将簇中的任何<span>MySQL</span>服务器配置为仲裁程序。仲裁程序接受第一个与其接触的簇节点集合，并通知剩余的集合关闭。对于<span>MySQL</span>服务器和管理服务器节点，仲裁程序的选择是由<span><span>ArbitrationRank</span>配置参数控制的</span>（详情请参见<a href="ndbcluster.html#mysql-cluster-mgm-definition" title="17.4.4.4. Defining the MySQL Cluster Management Server">17.4.4.4节，“定义MySQL簇管理服务器”</a>）。此外还应注意，仲裁程序不会对指定主机施加过多的要求，因此，仲裁程序主机不需要特别块或拥有用于该目的的额外内存。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>MySQL</span><span>簇支持的列类型是什么？</span></em></p>
		<p><span>MySQL</span>簇支持所有通常的<span>MySQL</span>列类型，但与<span>MySQL</span>空间扩展有关的例外（请参见<a href="spatial-extensions-in-mysql.html">第19章：</a><a href="spatial-extensions-in-mysql.html" title="Chapter 19. Spatial Extensions in MySQL"><i>MySQL中的空间扩展</i></a>）。此外，对于索引，当与<span>NDB</span>表一起使用时存在一些差别。<strong><span>注释：</span></strong><span>MySQL</span>簇表（即用<span><span>ENGINE=NDBCLUSTER</span>创建的表）</span>仅有固定宽度列。这意味着（例如）含有<span><span>VARCHAR(255)</span>列的每一条记录需要</span><span>256</span>字节来保存列，无论列中保存的数据大小是多少。在未来的<span>MySQL</span>版本中，计划更正它。</p>
		<p>关于这些方面的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-limitations" title="17.8. Known Limitations of MySQL Cluster">17.8节，“MySQL簇的已知限制”</a>。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>如何启动和停止<span>MySQL</span>簇？</span></em></p>
		<p>需要按照下述顺序分别启动簇中的每个节点：</p>
		<p><span>1.<span>&nbsp;&nbsp;&nbsp;
		</span></span>用<strong><span>ndb_mgmd</span></strong>命令启动管理节点。</p>
		<p><span>2.<span>&nbsp;&nbsp;&nbsp;
		</span></span>用<strong><span>ndbd</span></strong>命令启动每个数据节点。</p>
		<p><span>3.<span>&nbsp;&nbsp;&nbsp;
		</span></span>使用<strong><span>mysqld_safe 
		--user=mysql &amp;</span></strong>，启动每个<span>MySQL</span>服务器（<span>SQL</span>节点）。</p>
		<p>对于这类命令中的每一个，必须在受影响节点所在机器上的系统<span>shell</span>中执行。在容纳<span>MGM</span>节点的机器上启动管理客户端<strong><span>ndb_mgm</span></strong>，可验证簇是否正在运行。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>当簇关闭时，会对簇数据有什么影响？</span></em></p>
		<p>由簇数据节点保存在内存中的数据将被写入磁盘，并在下一次启动簇时重新装入内存。</p>
		<p>要想关闭簇，请在<span>MGM</span>节点所在的机器上、在<span>shell</span>下输入下述命令：</p>
		<pre><span>shell&gt; <span><b>ndb_mgm -e shutdown</b></span></span></pre>
		<p>这样就能恰当地中止<strong><span>ndb_mgm</span></strong>、<strong><span>ndb_mgm</span></strong>、以及任何<strong><span>ndbd</span></strong>进程。对于用作簇<span>SQL</span>节点的<span>MySQL</span>服务器，可使用<strong><span>mysqladmin 
		shutdown</span></strong>停止它。</p>
		<p>更多信息，请参见<a href="ndbcluster.html#mgm-client-commands" title="17.6.2. Commands in the Management Client">17.6.2节，“管理客户端”中的命令</a>和<a href="ndbcluster.html#multi-shutdown-restart" title="17.3.6. Safe Shutdown and Restart">17.3.6节，“安全关闭和重启”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><em><span>簇中有<span>1</span>个以上的管理节点是否有用？</span></em></p>
		<p>对于可靠性来说它确有帮助。在任何给定的时间，仅需<span>1</span>个<span>MGM</span>节点来控制簇，但能够将<span>1</span>个<span>MGM</span>配置为主节点，并配置<span>1</span>个或多个额外的管理节点，以便在主<span>MGM</span>节点出现故障时取代它。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>在簇中能混合使用不同的硬件和操作系统吗？</span></em></p>
		<p>是。只要所有的机器和操作系统均是相同的<span>endian</span>。也能在不同的节点上使用不同的<span>MySQL</span>簇版本，但是，我们建议仅应将其作为滚动升级的一部分使用。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能在单台主机上运行两个数据节点吗？两个<span>SQL</span>节点？</span></em></p>
		<p>
		是，能够这样。在有多个数据节点的情况下，每个节点必须使用不同的数据目录。如果打算在一台机器上运行多个<span>SQL</span>节点，那么每个<strong><span>mysqld</span></strong>实例必须使用不同的<span>TCP/IP</span>端口。</p>
		<p><em>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>我能与<span>MySQL</span>簇一起使用主机名吗？</span></em></p>
		<p>是，对于簇主机，能够使用<span>DNS</span>和<span>DHCP</span>。但是，如果你的应用程序要求“<span>99.999</span>％”的可用性，建议使用固定的<span>IP</span>地址。这是因为，依赖该服务的簇节点间的通信会引入额外的故障点，故障点越少越好。</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="mysql-cluster-glossary"></a>17.11. MySQL簇术语表</h2></div></div></div>
		<p>下面给出的术语对理解<span>MySQL</span>簇有所帮助，而且在与<span>MySQL</span>簇一起使用时有一定的特殊含义。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>簇：</span></strong></p>
		<p>按照通常的理解，簇是一个计算机集合，其功能相当于<span>1</span>个单位，一起工作以完成单一任务。</p>
		<p><span><b>
		<span>NDB</span></b></span><strong><span>簇：</span></strong></p>
		<p>这是<span>MySQL</span>中使用的存储引擎，用于实现数据存储、检索、以及多个计算机间分布式管理。</p>
		<p><strong>
		<span>MySQL</span><span>簇：</span></strong></p>
		<p>指的是使用<span>NDB</span>存储引擎一起工作的一组计算机，以便在使用“内存中”存储的非共享体系结构中支持分布式<span>MySQL</span>数据库。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>配置文件：</span></strong></p>
		<p>
		包含与簇、其主机和节点有关的指令和信息的文本文件。当簇启动时，这类文件由簇的管理节点负责读取。详情请参见<a href="ndbcluster.html#mysql-cluster-config-file" title="17.4.4. Configuration File">17.4.4节，“配置文件”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>备份：</span></strong></p>
		<p>所有簇数据、事务和日志的完整拷贝，保存在磁盘上或其他长期存储介质上。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>恢复：</span></strong></p>
		<p>将簇返回以前的状态，与保存在备份中的相同。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>检查点：</span></strong></p>
		<p>
		从广义上讲，将数据保存到磁盘时，即达到了检查点。具体对于簇来说，它是将所有已提交事务保存到磁盘的时间点。对于<span>NDB</span>存储引擎，有两种一起工作的检查点，以确保维护簇数据的一致性：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>本地检查点（<span>LCP</span>）：</span></strong></p>
		<p>这是专门针对单一节点的检查点，但是，<span>LCP</span>也会在簇中的所有节点发生，同步性或强或弱。<span>LCP</span>包括将节点的所有数据保存到磁盘，通常每几分钟出现一次。准确的时间间隔会出现变化，具体情况取决于节点上保存的数据量，簇活动的级别，以及其他因素。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>全局检查点（<span>GCP</span>）：</span></strong></p>
		<p><span>GCP</span>每数秒出现一次，此时，将对所有节点的事务进行同步化处理，并将<span>redo</span>日志保存到磁盘。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>簇主机：</span></strong></p>
		<p>构成<span>MySQL</span>簇组成部分的计算机。簇具有物理结构和逻辑结构。从物理意义上讲，簇由多个计算机构成，这些计算机也称为簇主机（或主机）另请参见下面的<strong><span>节点</span></strong>和<strong><span>节点组</span></strong>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>节点：</span></strong></p>
		<p>它指的是<span>MySQL</span>簇的逻辑或功能性单元，有时也称为簇节点。对于<span>MySQL</span>簇，我们使用术语“节点”表示进程而不是簇的物理部件。实施有效的<span>MySQL</span>簇需要三种节点。它们是：</p>
		<p><strong>
		<span>
		o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>管理（<span>MGM</span>）节点：</span></strong></p>
		<p>
		负责管理簇中的其他节点。它为其他节点提供了配置数据，负责启动和停止节点，处理网络分区事宜，创建备份和从备份恢复，等等。</p>
		<p><strong>
		<span>
		o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>SQL</span><span>（<span>MySQL</span>服务器）节点：</span></strong></p>
		<p><span>MySQL</span>服务器的实例，用作簇数据节点所保存数据的前端。打算保存、检索或更新数据的客户端可访问<span>SQL</span>节点，就像访问其他<span>MySQL</span>服务器一样，采用通常的鉴定方法和<span>API</span>，节点组之间的基本数据分配对用户和应用程序来说是透明的。<span>SQL</span>节点访问作为整体的簇数据库，而不管数据在不同数据节点或簇主机上的分布情况。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>数据节点：</span></strong></p>
		<p>
		这些节点负责保存实际数据。表数据片段保存在节点组集合中，每个节点组保存表数据的不同子集。构成节点组的每个节点均保存了该节点组所负责片段的副本。目前，<span>1</span>个簇能支持总数为<span>48</span>的数据节点。</p>
		<p><span>1</span>个以上的节点能共存于单台机器上（事实上，能够在一台机器上设置完成的簇，但在生产环境下几乎没人会这样做）。请记住，使用<span>MySQL</span>簇时，术语“主机”指的是簇的物理部件，而“节点”指的是逻辑或功能部件（即进程），这很有帮助。</p>
		<p><strong><span>
		关于过时术语的注释：</span></strong>在<span>MySQL</span>簇文档的早期版本中，数据节点有时也称为“数据库节点”、“<span class="quote"><span>DB</span>节点</span>”、或偶尔使用的“<span class="quote">存储节点</span>”。此外，<span>SQL</span>节点有时也称为“客户端节点”或“<span>API</span>节点”。为了将混淆降至最低，这类早期术语已被放弃，为此，应避免使用它们。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>节点组：</span></strong></p>
		<p>
		数据节点的集合。位于节点组内的所有数据节点包含相同的数据（片段），而且单个组内的所有节点应位于不同的主机上。能够对哪个节点术语哪个节点组进行控制。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>节点失败：</span></strong></p>
		<p><span>MySQL</span>簇并不仅取决于构成构成簇的任一节点的功能，如果<span>1</span>个或多个节点失败，簇仍能运行。给定簇能容忍的失败节点的准确数目取决于节点的数目和簇的配置。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>节点重启：</span></strong></p>
		<p>重启失败簇节点的进程。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>首次节点重启：</span></strong></p>
		<p>不与其文件系统一起启动簇节点的进程。有时用于软件升级或其他特殊场合。</p>
		<p><strong>
		<span>
		·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
		</span><span>系统崩溃（或系统失败）：</span></strong></p>
		<p>当很多簇节点失败并无法保证簇的状态时，就会出现该情况。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>系统重启：</span></strong></p>
		<p>
		重启簇并根据磁盘日志和检查点重新初始化簇状态的进程。在簇的计划关闭或非计划关闭后，通常需要执行该进程。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>片段：</span></strong></p>
		<p>数据库表的一部分，在<span>NDB</span>存储引擎中，将表分为众多片段，并以片段方式保存。片段有时也称为“分区”，但“片段”是更可取的术语。在<span>MySQL</span>簇中，对表进行了片段化处理，从而简化了机器和节点间的负载平衡。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>副本：</span></strong></p>
		<p>在<span><span>NDB</span>存储引擎下，每个表片段均有多个副本，这些副本保存在其他数据节点上，以提供冗余性。目前，每片段最多有<span>4</span>个副本。</span></p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>传输器：</span></strong></p>
		<p>提供节点间数据传输的协议。<span>MySQL</span>簇目前提供了四种不同的传输器连接：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>TCP/IP</span>（本地）</p>
		<p>当然，这是广为人知的网络协议，它是<span>Internet</span>上<span>HTTP</span>、<span>FTP</span>等的基础。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>TCP/IP</span>（远程）</p>
		<p>同上，但用于远程通信。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>SCI </span></p>
		<p><strong>
		<span>SCI</span></strong>（规模可扩展的计算机连接接口）是一种高速协议，由于构建多处理器系统和并行处理应用程序。与<span>MySQL</span>簇一起使用<span>SCI</span>时，需要专门的硬件，具体讨论请参见<a href="ndbcluster.html#sci-sockets" title="17.7.1. Configuring MySQL Cluster to use SCI Sockets">17.7.1节，“配置MySQL簇以使用SCI套接字”</a>。关于<span>SCI</span>的基本介绍，请参见<span><a target="_top"  href="http://www.dolphinics.com/corporate/scitech.html">dolphinics.com<span>上的文章。</span></a></span></p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span>SHM </span></p>
		<p><span>Unix</span>风格共享内存（<span>SHM</span>）段。在任何支持的场合下，将自动使用<span>SHM</span>来连接运行在相同主机上的节点。要想了解这方面的更多信息，请参见<span><a target="_top"  href="http://www.scit.wlv.ac.uk/cgi-bin/mansec?2+shmop">关于shmop(2)的Unix手册页</a></span>。</p>
		<p><strong><span>注释：</span></strong>簇传输器是簇内部的。使用<span>MySQL</span>簇的应用程序与<span>SQL</span>节点进行通信，就像与其他版本的<span>MySQL</span>服务器进行通信一样（通过<span>TCP/IP</span>、或使用<span>Unix</span>套接字、或<span>Windows</span>命名管道）。可以使用标准的<span>MySQL 
		API</span>发出查询并检索结果。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><span><b><span>NDB</span></b></span>：</p>
		<p>它是网络数据库（<strong><span>N</span></strong><span>etwork
		<strong><span>D</span></strong>ata<strong><span>b</span></strong>ase</span>）的缩写，而且指的是用于启用<span>MySQL</span>簇的存储引擎。<span><span>NDB</span>存储引擎支持所有通常的<span>MySQL</span>列类型和<span>SQL</span>语句，</span>而且是<span>ACID</span>兼容的。该引擎还提供了对事务的完整支持（提交和回滚）。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>无共享体系结构：</span></strong><span>
		</span></p>
		<p>用于<span>MySQL</span>簇的理想体系结构。在真正的无共享设置下，每个节点运行在单独的主机上。这类安排的优点在于，单个主机或节点不会造成单点故障，也不会成为系统整体的性能瓶颈。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>内存中存储：</span></strong></p>
		<p>
		保存在每个数据节点中的数据均保存在节点宿主计算机的内存中。对于簇中的每个数据节点，必须提供足够的<span>RAM</span>，所需的<span>RAM</span>量为：数据库的大小乘以副本数目，然后除以数据节点的数目。因此，如果数据库占用<span>1GB</span>的内存，而且你打算设置具有<span>4</span>个副本和<span>8</span>个数据节点的簇，每节点所需的最小内存为<span>500 
		MB</span>。注意，还应加上操作系统所需的内存以及运行在主机上的应用程序所需的内存。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>表：</span></strong></p>
		<p>与关联数据库下的通常情况一样，术语“表”指的是具有等同结构的记录的集合。在<span>MySQL</span>簇中，数据库表以片段集合的方式保存在数据节点中，并将每个片段复制到额外的数据节点上。复制相同片段或片段集合的数据节点集合称为节点组。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>簇程序：</span></strong></p>
		<p>它们是命令行程序，用于运行、配置和管理<span>MySQL</span>簇。它们包括两种服务器端口监督程序：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndbd</span></strong><span>:
		</span></p>
		<p>数据节点端口监督程序（运行数据节点进程）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_mgmd</span></strong><span>:
		</span></p>
		<p>管理服务器端口监督程序（运行管理服务器进程）。</p>
		<p>以及客户端程序：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_mgm</span></strong><span>:
		</span></p>
		<p>管理客户端（为执行管理命令提供了<span>1</span>个界面）。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>ndb_waiter</span></strong><span>:
		</span></p>
		<p>用于验证簇中所有节点的状态。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>
		ndb_restore</span></strong><span>: </span></p>
		<p>从备份中恢复簇数据。</p>
		<p>关于这些程序及其用法的更多信息，请参见<a href="ndbcluster.html#mysql-cluster-process-management" title="17.5. Process Management in MySQL Cluster">17.5节，“MySQL簇中的进程管理”</a>。</p>
		<p>
		<span>·<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>事件日志：</span></strong></p>
		<p><span>MySQL</span>簇按照类别（启动、停止、错误、检查点等）、优先级和严重级别来记录事件。关于所有可通报事件的完整列表，请参见<a href="ndbcluster.html#mysql-cluster-event-reports" title="17.6.3. Event Reports Generated in MySQL Cluster">17.6.3节，“MySQL簇中生成的事件报告”</a>。事件日志具有两种类型：</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>簇日志：</span></strong></p>
		<p>为作为整体的簇记录所有所需的、值得记录的事件。</p>
		<p>
		<span>o<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span></span><strong><span>节点日志：</span></strong></p>
		<p>为每个单独节点保存的单独日志。</p>
		<p>
		在正常情况下，仅需保存和检查簇日志，这通常已足够。节点日志仅用于应用程序开发和调试目的。</p>
		<div class="itemizedlist">&nbsp;</div></div></div><div><hr>
	<p>这是MySQL参考手册的翻译版本，关于MySQL参考手册，请访问<a target="_top"  href="http://dev.mysql.com/doc/mysql/en">dev.mysql.com</a>。原始参考手册为英文版，与英文版参考手册相比，本翻译版可能不是最新的。</div>
</body></html>
