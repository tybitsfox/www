<HTML><HEAD><TITLE>Socket Functions</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK REL="HOME" TITLE="PHP 手册" HREF="index-2.html"><LINK REL="UP" TITLE="函数参考" HREF="funcref.html"><LINK REL="PREVIOUS" TITLE="snmpwalkoid" HREF="function.snmpwalkoid.html"><LINK REL="NEXT" TITLE="socket_accept" HREF="function.socket-accept.html"><META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=gb2312"><LINK REL="stylesheet" HREF="style.css"></HEAD><BODY TOPMARGIN="0" LEFTMARGIN="0" CLASS="reference" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#840084" ALINK="#0000FF"><TABLE BORDER="0" WIDTH="100%" HEIGHT="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD COLSPAN="3"><DIV CLASS="NAVHEADER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TH COLSPAN="3" ALIGN="center">PHP 手册</TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="bottom"><A HREF="function.snmpwalkoid.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="80%" ALIGN="center" VALIGN="bottom"></TD><TD WIDTH="10%" ALIGN="right" VALIGN="bottom"><A HREF="function.socket-accept.html" ACCESSKEY="N">前进</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></DIV></TD></TR><TR><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%"><BR><DIV CLASS="reference"><A NAME="ref.sockets"></A><DIV CLASS="TITLEPAGE"><H1 CLASS="title">CIII. Socket Functions</H1><DIV CLASS="PARTINTRO"><A NAME="AEN103600"></A><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.intro"></A>介绍</H1><P>&#13; The socket extension implements a low-level interface to the socket
communication functions based on the popular BSD sockets, providing the
possibility to act as a socket server as well as a client.
</P><P>&#13; For a more generic client-side socket interface, see
<A HREF="function.stream-socket-client.html"><B CLASS="function">stream_socket_client()</B></A>,
<A HREF="function.stream-socket-server.html"><B CLASS="function">stream_socket_server()</B></A>,
<A HREF="function.fsockopen.html"><B CLASS="function">fsockopen()</B></A>, and
<A HREF="function.pfsockopen.html"><B CLASS="function">pfsockopen()</B></A>.
</P><P>&#13; When using these functions, it is important to remember that while
many of them have identical names to their C counterparts, they
often have different declarations. Please be sure to read the
descriptions to avoid confusion.
</P><P>&#13; Those unfamiliar with socket programming can find a lot
of useful material in the appropriate Unix man pages, and there is a great
deal of tutorial information on socket programming in C on the web, much
of which can be applied, with slight modifications, to socket programming
in PHP. The <A HREF="http://www.developerweb.net/sock-faq/" TARGET="_top">Unix Socket
FAQ</A> might be a good start.
</P><DIV CLASS="warning"><P></P><TABLE CLASS="warning" BORDER="1" WIDTH="100%"><TR><TD ALIGN="CENTER"><B>警告</B></TD></TR><TR><TD ALIGN="LEFT"><P>本扩展模块是<SPAN CLASS="emphasis"><I CLASS="emphasis">实验性</I></SPAN>的。该模块的行为，包括其函数的名称以及其它任何关于此模块的文档可能会在没有通知的情况下随 PHP 以后的发布而改变。我们提醒您在使用本扩展模块的同时自担风险。
</P></TD></TR></TABLE></DIV></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.requirements"></A>需求</H1><P>无需外部库文件就可以加入本扩展模块的支持。</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.installation"></A>安装</H1><P>&#13; The socket functions described here are part of an extension to
PHP which must be enabled at compile time by giving the <TT CLASS="option">--enable-sockets</TT> option to
<B CLASS="command">configure</B>.
</P><DIV CLASS="note"><BLOCKQUOTE CLASS="note"><P><B>注: </B>IPv6 支持是 <TT CLASS="literal">PHP 5.0.0</TT> 新加的。</P></BLOCKQUOTE></DIV></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.configuration"></A>运行时配置</H1><P>该扩展模块未定义任何设置指令。</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.resources"></A>资源类型</H1><P>该扩展模块未定义任何资源类型。</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.constants"></A>预定义常量</H1><P>&#13;由于这些常量是由该扩展模块定义的，因此只有在该扩展模块被编译到 PHP 中，或者在运行时被动态加载后，这些常量才有效。</P><P></P><DIV CLASS="variablelist"><DL><DT><TT CLASS="constant"><B>AF_UNIX</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>AF_INET</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>AF_INET6</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOCK_STREAM</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOCK_DGRAM</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOCK_RAW</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOCK_SEQPACKET</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOCK_RDM</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>MSG_OOB</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>MSG_WAITALL</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>MSG_PEEK</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>MSG_DONTROUTE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_DEBUG</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_REUSEADDR</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_KEEPALIVE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_DONTROUTE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_LINGER</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_BROADCAST</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_OOBINLINE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_SNDBUF</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_RCVBUF</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_SNDLOWAT</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_RCVLOWAT</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_SNDTIMEO</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_RCVTIMEO</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_TYPE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SO_ERROR</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOL_SOCKET</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PHP_NORMAL_READ</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PHP_BINARY_READ</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOL_TCP</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>SOL_UDP</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD></DL></DIV></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.errors"></A>Socket Errors</H1><P>&#13; The socket extension was written to provide a useable interface to the
powerful BSD sockets. Care has been taken that the functions work equally
well on Win32 and Unix implementations. Almost all of the sockets
functions may fail under certain conditions and therefore emit an
<TT CLASS="constant"><B>E_WARNING</B></TT> message describing the error. Sometimes this
doesn't happen to the desire of the developer. For example the function
<A HREF="function.socket-read.html"><B CLASS="function">socket_read()</B></A> may suddenly emit an
<TT CLASS="constant"><B>E_WARNING</B></TT> message because the connection broke
unexpectedly. It's common to suppress the warning with the
<TT CLASS="literal">@</TT>-operator and catch the error code within the
application with the <A HREF="function.socket-last-error.html"><B CLASS="function">socket_last_error()</B></A> function. You
may call the <A HREF="function.socket-strerror.html"><B CLASS="function">socket_strerror()</B></A> function with this error
code to retrieve a string describing the error. See their description for
more information.
</P><DIV CLASS="note"><BLOCKQUOTE CLASS="note"><P><B>注: </B>
The <TT CLASS="constant"><B>E_WARNING</B></TT> messages generated by the socket
extension are in English though the retrieved error message will appear
depending on the current locale (<TT CLASS="constant"><B>LC_MESSAGES</B></TT>):
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
Warning - socket_bind() unable to bind address [98]: Die Adresse wird bereits verwendet</font>
</code></TD></TR></TABLE>
</P></BLOCKQUOTE></DIV></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="sockets.examples"></A>范例</H1><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN103845"></A><P><B>例子 1. Socket example: Simple TCP/IP server</B></P><P>&#13; This example shows a simple talkback server. Change the
<TT CLASS="varname">address</TT> and <TT CLASS="varname">port</TT> variables
to suit your setup and execute. You may then connect to the
server with a command similar to: <B CLASS="command">telnet 192.168.1.53
10000</B> (where the address and port match your
setup). Anything you type will then be output on the server
side, and echoed back to you. To disconnect, enter 'quit'.
</P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
#!/usr/local/bin/php -q<br /><font color="#0000BB">&lt;?php<br />error_reporting</font><font color="#007700">(</font><font color="#0000BB">E_ALL</font><font color="#007700">);<br /><br /></font><font color="#FF8000">/* Allow the script to hang around waiting for connections. */<br /></font><font color="#0000BB">set_time_limit</font><font color="#007700">(</font><font color="#0000BB">0</font><font color="#007700">);<br /><br /></font><font color="#FF8000">/* Turn on implicit output flushing so we see what we're getting<br /> * as it comes in. */<br /></font><font color="#0000BB">ob_implicit_flush</font><font color="#007700">();<br /><br /></font><font color="#0000BB">$address </font><font color="#007700">= </font><font color="#DD0000">'192.168.1.53'</font><font color="#007700">;<br /></font><font color="#0000BB">$port </font><font color="#007700">= </font><font color="#0000BB">10000</font><font color="#007700">;<br /><br />if ((</font><font color="#0000BB">$sock </font><font color="#007700">= </font><font color="#0000BB">socket_create</font><font color="#007700">(</font><font color="#0000BB">AF_INET</font><font color="#007700">, </font><font color="#0000BB">SOCK_STREAM</font><font color="#007700">, </font><font color="#0000BB">SOL_TCP</font><font color="#007700">)) &lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_create() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$sock</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />}<br /><br />if ((</font><font color="#0000BB">$ret </font><font color="#007700">= </font><font color="#0000BB">socket_bind</font><font color="#007700">(</font><font color="#0000BB">$sock</font><font color="#007700">, </font><font color="#0000BB">$address</font><font color="#007700">, </font><font color="#0000BB">$port</font><font color="#007700">)) &lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_bind() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$ret</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />}<br /><br />if ((</font><font color="#0000BB">$ret </font><font color="#007700">= </font><font color="#0000BB">socket_listen</font><font color="#007700">(</font><font color="#0000BB">$sock</font><font color="#007700">, </font><font color="#0000BB">5</font><font color="#007700">)) &lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_listen() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$ret</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />}<br /><br />do {<br />&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$msgsock </font><font color="#007700">= </font><font color="#0000BB">socket_accept</font><font color="#007700">(</font><font color="#0000BB">$sock</font><font color="#007700">)) &lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_accept() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">/* Send instructions. */<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$msg </font><font color="#007700">= </font><font color="#DD0000">"\nWelcome to the PHP Test Server. \n" </font><font color="#007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">"To quit, type 'quit'. To shut down the server type 'shutdown'.\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">, </font><font color="#0000BB">$msg</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$msg</font><font color="#007700">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;do {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">false </font><font color="#007700">=== (</font><font color="#0000BB">$buf </font><font color="#007700">= </font><font color="#0000BB">socket_read</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">, </font><font color="#0000BB">2048</font><font color="#007700">, </font><font color="#0000BB">PHP_NORMAL_READ</font><font color="#007700">))) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_read() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$ret</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break </font><font color="#0000BB">2</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!</font><font color="#0000BB">$buf </font><font color="#007700">= </font><font color="#0000BB">trim</font><font color="#007700">(</font><font color="#0000BB">$buf</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$buf </font><font color="#007700">== </font><font color="#DD0000">'quit'</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$buf </font><font color="#007700">== </font><font color="#DD0000">'shutdown'</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break </font><font color="#0000BB">2</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$talkback </font><font color="#007700">= </font><font color="#DD0000">"PHP: You said '$buf'.\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">, </font><font color="#0000BB">$talkback</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$talkback</font><font color="#007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"$buf\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;} while (</font><font color="#0000BB">true</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$msgsock</font><font color="#007700">);<br />} while (</font><font color="#0000BB">true</font><font color="#007700">);<br /><br /></font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$sock</font><font color="#007700">);<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN103853"></A><P><B>例子 2. Socket example: Simple TCP/IP client</B></P><P>&#13; This example shows a simple, one-shot HTTP client. It simply
connects to a page, submits a HEAD request, echoes the reply,
and exits.
</P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />error_reporting</font><font color="#007700">(</font><font color="#0000BB">E_ALL</font><font color="#007700">);<br /><br />echo </font><font color="#DD0000">"&lt;h2&gt;TCP/IP Connection&lt;/h2&gt;\n"</font><font color="#007700">;<br /><br /></font><font color="#FF8000">/* Get the port for the WWW service. */<br /></font><font color="#0000BB">$service_port </font><font color="#007700">= </font><font color="#0000BB">getservbyname</font><font color="#007700">(</font><font color="#DD0000">'www'</font><font color="#007700">, </font><font color="#DD0000">'tcp'</font><font color="#007700">);<br /><br /></font><font color="#FF8000">/* Get the IP address for the target host. */<br /></font><font color="#0000BB">$address </font><font color="#007700">= </font><font color="#0000BB">gethostbyname</font><font color="#007700">(</font><font color="#DD0000">'www.example.com'</font><font color="#007700">);<br /><br /></font><font color="#FF8000">/* Create a TCP/IP socket. */<br /></font><font color="#0000BB">$socket </font><font color="#007700">= </font><font color="#0000BB">socket_create</font><font color="#007700">(</font><font color="#0000BB">AF_INET</font><font color="#007700">, </font><font color="#0000BB">SOCK_STREAM</font><font color="#007700">, </font><font color="#0000BB">SOL_TCP</font><font color="#007700">);<br />if (</font><font color="#0000BB">$socket </font><font color="#007700">&lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_create() failed: reason: " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$socket</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />} else {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"OK.\n"</font><font color="#007700">;<br />}<br /><br />echo </font><font color="#DD0000">"Attempting to connect to '$address' on port '$service_port'..."</font><font color="#007700">;<br /></font><font color="#0000BB">$result </font><font color="#007700">= </font><font color="#0000BB">socket_connect</font><font color="#007700">(</font><font color="#0000BB">$socket</font><font color="#007700">, </font><font color="#0000BB">$address</font><font color="#007700">, </font><font color="#0000BB">$service_port</font><font color="#007700">);<br />if (</font><font color="#0000BB">$result </font><font color="#007700">&lt; </font><font color="#0000BB">0</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"socket_connect() failed.\nReason: ($result) " </font><font color="#007700">. </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">$result</font><font color="#007700">) . </font><font color="#DD0000">"\n"</font><font color="#007700">;<br />} else {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"OK.\n"</font><font color="#007700">;<br />}<br /><br /></font><font color="#0000BB">$in </font><font color="#007700">= </font><font color="#DD0000">"HEAD / HTTP/1.1\r\n"</font><font color="#007700">;<br /></font><font color="#0000BB">$in </font><font color="#007700">.= </font><font color="#DD0000">"Host: www.example.com\r\n"</font><font color="#007700">;<br /></font><font color="#0000BB">$in </font><font color="#007700">.= </font><font color="#DD0000">"Connection: Close\r\n\r\n"</font><font color="#007700">;<br /></font><font color="#0000BB">$out </font><font color="#007700">= </font><font color="#DD0000">''</font><font color="#007700">;<br /><br />echo </font><font color="#DD0000">"Sending HTTP HEAD request..."</font><font color="#007700">;<br /></font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$socket</font><font color="#007700">, </font><font color="#0000BB">$in</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$in</font><font color="#007700">));<br />echo </font><font color="#DD0000">"OK.\n"</font><font color="#007700">;<br /><br />echo </font><font color="#DD0000">"Reading response:\n\n"</font><font color="#007700">;<br />while (</font><font color="#0000BB">$out </font><font color="#007700">= </font><font color="#0000BB">socket_read</font><font color="#007700">(</font><font color="#0000BB">$socket</font><font color="#007700">, </font><font color="#0000BB">2048</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">$out</font><font color="#007700">;<br />}<br /><br />echo </font><font color="#DD0000">"Closing socket..."</font><font color="#007700">;<br /></font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$socket</font><font color="#007700">);<br />echo </font><font color="#DD0000">"OK.\n\n"</font><font color="#007700">;<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P></DIV></DIV><DIV CLASS="TOC"><DL><DT><B>目录</B></DT><DT><A HREF="function.socket-accept.html">socket_accept</A>&nbsp;--&nbsp;Accepts a connection on a socket</DT><DT><A HREF="function.socket-bind.html">socket_bind</A>&nbsp;--&nbsp;Binds a name to a socket</DT><DT><A HREF="function.socket-clear-error.html">socket_clear_error</A>&nbsp;--&nbsp;Clears the error on the socket or the last error code</DT><DT><A HREF="function.socket-close.html">socket_close</A>&nbsp;--&nbsp;Closes a socket resource</DT><DT><A HREF="function.socket-connect.html">socket_connect</A>&nbsp;--&nbsp;Initiates a connection on a socket</DT><DT><A HREF="function.socket-create-listen.html">socket_create_listen</A>&nbsp;--&nbsp;Opens a socket on port to accept connections </DT><DT><A HREF="function.socket-create-pair.html">socket_create_pair</A>&nbsp;--&nbsp;Creates a pair of indistinguishable sockets and stores them in fds. </DT><DT><A HREF="function.socket-create.html">socket_create</A>&nbsp;--&nbsp;Create a socket (endpoint for communication)</DT><DT><A HREF="function.socket-get-option.html">socket_get_option</A>&nbsp;--&nbsp;Gets socket options for the socket </DT><DT><A HREF="function.socket-getpeername.html">socket_getpeername</A>&nbsp;--&nbsp;
Queries the remote side of the given socket which may either result in host/port
or in a Unix filesystem path, dependent on its type.
</DT><DT><A HREF="function.socket-getsockname.html">socket_getsockname</A>&nbsp;--&nbsp;
Queries the local side of the given socket which may either result in host/port
or in a Unix filesystem path, dependent on its type.
</DT><DT><A HREF="function.socket-iovec-add.html">socket_iovec_add</A>&nbsp;--&nbsp;Adds a new vector to the scatter/gather array </DT><DT><A HREF="function.socket-iovec-alloc.html">socket_iovec_alloc</A>&nbsp;--&nbsp;
Builds a 'struct iovec' for use with sendmsg, recvmsg, writev, and readv
</DT><DT><A HREF="function.socket-iovec-delete.html">socket_iovec_delete</A>&nbsp;--&nbsp;Deletes a vector from an array of vectors </DT><DT><A HREF="function.socket-iovec-fetch.html">socket_iovec_fetch</A>&nbsp;--&nbsp;Returns the data held in the iovec specified by iovec_id[iovec_position] </DT><DT><A HREF="function.socket-iovec-free.html">socket_iovec_free</A>&nbsp;--&nbsp;Frees the iovec specified by iovec_id </DT><DT><A HREF="function.socket-iovec-set.html">socket_iovec_set</A>&nbsp;--&nbsp;Sets the data held in iovec_id[iovec_position] to new_val </DT><DT><A HREF="function.socket-last-error.html">socket_last_error</A>&nbsp;--&nbsp;Returns the last error on the socket </DT><DT><A HREF="function.socket-listen.html">socket_listen</A>&nbsp;--&nbsp;Listens for a connection on a socket</DT><DT><A HREF="function.socket-read.html">socket_read</A>&nbsp;--&nbsp;Reads a maximum of length bytes from a socket</DT><DT><A HREF="function.socket-readv.html">socket_readv</A>&nbsp;--&nbsp;Reads from an fd, using the scatter-gather array defined by iovec_id </DT><DT><A HREF="function.socket-recv.html">socket_recv</A>&nbsp;--&nbsp;Receives data from a connected socket </DT><DT><A HREF="function.socket-recvfrom.html">socket_recvfrom</A>&nbsp;--&nbsp;Receives data from a socket, connected or not </DT><DT><A HREF="function.socket-recvmsg.html">socket_recvmsg</A>&nbsp;--&nbsp;Used to receive messages on a socket, whether connection-oriented or not </DT><DT><A HREF="function.socket-select.html">socket_select</A>&nbsp;--&nbsp;
Runs the select() system call on the given arrays of sockets
with a specified timeout
</DT><DT><A HREF="function.socket-send.html">socket_send</A>&nbsp;--&nbsp;Sends data to a connected socket </DT><DT><A HREF="function.socket-sendmsg.html">socket_sendmsg</A>&nbsp;--&nbsp;Sends a message to a socket, regardless of whether it is connection-oriented or not </DT><DT><A HREF="function.socket-sendto.html">socket_sendto</A>&nbsp;--&nbsp;Sends a message to a socket, whether it is connected or not </DT><DT><A HREF="function.socket-set-block.html">socket_set_block</A>&nbsp;--&nbsp;
Sets blocking mode on a socket resource
</DT><DT><A HREF="function.socket-set-nonblock.html">socket_set_nonblock</A>&nbsp;--&nbsp;Sets nonblocking mode for file descriptor fd </DT><DT><A HREF="function.socket-set-option.html">socket_set_option</A>&nbsp;--&nbsp;Sets socket options for the socket</DT><DT><A HREF="function.socket-shutdown.html">socket_shutdown</A>&nbsp;--&nbsp;Shuts down a socket for receiving, sending, or both. </DT><DT><A HREF="function.socket-strerror.html">socket_strerror</A>&nbsp;--&nbsp;Return a string describing a socket error</DT><DT><A HREF="function.socket-write.html">socket_write</A>&nbsp;--&nbsp;Write to a socket</DT><DT><A HREF="function.socket-writev.html">socket_writev</A>&nbsp;--&nbsp;Writes to a file descriptor, fd, using the scatter-gather array defined by iovec_id </DT></DL></DIV></DIV></DIV><BR></TD><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><DIV CLASS="NAVFOOTER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="function.snmpwalkoid.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="index-2.html" ACCESSKEY="H">起点</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="function.socket-accept.html" ACCESSKEY="N">前进</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">snmpwalkoid</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="funcref.html" ACCESSKEY="U">上一级</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">socket_accept</TD></TR></TABLE></TD></TR></TABLE></DIV></TD></TR></TABLE>
<p style="text-align:center;"><script type="text/javascript" src="http://www.veryhuo.com/plus/js/manual.js"></script></p>
<div style="display:none;">
<script type="text/javascript" src="/liehuo.net/js/stat.js"></script>
</div>
</body>
</html>
