<HTML><HEAD><TITLE>PostgreSQL 数据库函数库</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK REL="HOME" TITLE="PHP 手册" HREF="index-2.html"><LINK REL="UP" TITLE="函数参考" HREF="funcref.html"><LINK REL="PREVIOUS" TITLE="posix_uname" HREF="function.posix-uname.html"><LINK REL="NEXT" TITLE="pg_affected_rows" HREF="function.pg-affected-rows.html"><META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=gb2312"><LINK REL="stylesheet" HREF="style.css"></HEAD><BODY TOPMARGIN="0" LEFTMARGIN="0" CLASS="reference" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#840084" ALINK="#0000FF"><TABLE BORDER="0" WIDTH="100%" HEIGHT="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD COLSPAN="3"><DIV CLASS="NAVHEADER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TH COLSPAN="3" ALIGN="center">PHP 手册</TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="bottom"><A HREF="function.posix-uname.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="80%" ALIGN="center" VALIGN="bottom"></TD><TD WIDTH="10%" ALIGN="right" VALIGN="bottom"><A HREF="function.pg-affected-rows.html" ACCESSKEY="N">前进</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></DIV></TD></TR><TR><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%"><BR><DIV CLASS="reference"><A NAME="ref.pgsql"></A><DIV CLASS="TITLEPAGE"><H1 CLASS="title">LXXXIV. PostgreSQL 数据库函数库</H1><DIV CLASS="PARTINTRO"><A NAME="AEN90518"></A><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.intro"></A>介绍</H1><P>&#13; PostgreSQL 是一个开放源码的免费数据库系统。Postgres
最初由加州大学伯克利分校计算机科学系开发，倡导了很多关系对象的观念，这些观念现在已经用在一些商业数据库系统中。它提供了
SQL92/SQL99 语言支持，事务处理，引用集成，存储过程以及类型扩展。PostgreSQL 则是
Postgres 的一个开放源代码的后代。
</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.requirements"></A>需求</H1><P>&#13; 要使用 PostgreSQL 支持，需要 PostgreSQL 6.5 或更新版本，PostgreSQL 7.0
或更新版本来使用所有的 PostgreSQL 模块。PostgreSQL
支持多种字符编码包括多字节字符编码。关于 PostgreSQL
的当前版本以及更多信息见 <A HREF="http://www.postgresql.org/" TARGET="_top">http://www.postgresql.org/</A>
以及 <A HREF="http://techdocs.postgresql.org/" TARGET="_top">http://techdocs.postgresql.org/</A>。
</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.installation"></A>安装</H1><P>&#13; 为添加 PostgreSQL 支持，在编译 PHP 时需要加上
<TT CLASS="option">--with-pgsql[=DIR]</TT>
选项。如果可以用共享模块方式，PostgreSQL 模块可以在
<TT CLASS="filename">php.ini</TT> 用 <A HREF="configuration.directives.html#ini.extension">extension</A>
指令或者 <A HREF="function.dl.html"><B CLASS="function">dl()</B></A> 函数加载。
</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.configuration"></A>运行时配置</H1><P>这些函数的行为受到全局<A HREF="configuration.html#configuration.file">配置文件</A> <TT CLASS="filename">php.ini</TT> 的影响。</P><P>&#13; <DIV CLASS="table"><A NAME="AEN90540"></A><P><B>表格 1. PostgreSQL 配置选项</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">名称</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">默认值</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">可变范围</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.allow_persistent</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"1"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_SYSTEM</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.max_persistent</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"-1"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_SYSTEM</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.max_links</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"-1"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_SYSTEM</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.auto_reset_persistent</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"0"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_SYSTEM</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.ignore_notice</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"0"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_ALL</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">pgsql.log_notice</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">"0"</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">PHP_INI_ALL</TD></TR></TBODY></TABLE></DIV>
PHP_INI_* 常量的更多细节和定义参见 <A HREF="function.ini-set.html"><B CLASS="function">ini_set()</B></A>。
</P><P>以下是该配置选项的简要解释。</P><P>&#13; <P></P><DIV CLASS="variablelist"><DL><DT><A NAME="ini.pgsql.allow-persistent"></A><TT CLASS="parameter"><I>pgsql.allow_persistent</I></TT>
<A HREF="language.types.boolean.html"><B CLASS="type">boolean</B></A></DT><DD><P>&#13; 是否允许持久的 Postgres 连接。
</P></DD><DT><A NAME="ini.pgsql.max-persistent"></A><TT CLASS="parameter"><I>pgsql.max_persistent</I></TT>
<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A></DT><DD><P>&#13; 每个进程所能有的持久 Postgres 连接数目。
</P></DD><DT><A NAME="ini.pgsql.max-links"></A><TT CLASS="parameter"><I>pgsql.max_links</I></TT>
<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A></DT><DD><P>&#13; 每个进程所能有的 Postgres 连接数目，包括持久连接。
</P></DD><DT><A NAME="ini.pgsql.auto-reset-persistent"></A><TT CLASS="parameter"><I>pgsql.auto_reset_persistent</I></TT>
<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A></DT><DD><P>&#13; 检测用在 <A HREF="function.pg-pconnect.html"><B CLASS="function">pg_pconnect()</B></A> 上的中断了的持久连接。需要一些损耗。
</P></DD><DT><A NAME="ini.pgsql.ignore-notice"></A><TT CLASS="parameter"><I>pgsql.ignore_notice</I></TT>
<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A></DT><DD><P>&#13; 是否忽略 PostgreSQL 后端的通告。
</P></DD><DT><A NAME="ini.pgsql.log-notice"></A><TT CLASS="parameter"><I>pgsql.log_notice</I></TT>
<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A></DT><DD><P>&#13; 是否记录 PostgreSQL 后端的通告消息。要记录通告消息日志，PHP
指令 <A HREF="ref.pgsql.html#ini.pgsql.ignore-notice">pgsql.ignore_notice</A> 必须为 off。
</P></DD></DL></DIV>
</P></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.using"></A>使用方法及提示</H1><DIV CLASS="warning"><P></P><TABLE CLASS="warning" BORDER="1" WIDTH="100%"><TR><TD ALIGN="CENTER"><B>警告</B></TD></TR><TR><TD ALIGN="LEFT"><P>&#13; 由于 notice message handling 代码中的 bug，不推荐在 PHP 4.0.6 中使用 PostgreSQL 模块。使用 4.1.0 或更新版本。
</P></TD></TR></TABLE></DIV><DIV CLASS="warning"><P></P><TABLE CLASS="warning" BORDER="1" WIDTH="100%"><TR><TD ALIGN="CENTER"><B>警告</B></TD></TR><TR><TD ALIGN="LEFT"><P>&#13; 为符合当前编码标准，PostgreSQL 函数名称将在 4.2.0 版本中改变。大多数新名称将多出一个下划线，例如 pg_lo_open()。一部分函数则改变了名称以保持一致性。例如 pg_exec() 改为 pg_query()。老的函数名依然可以在 4.2.0 和以后的少数几个版本中使用，但以后可能会删除。
</P><DIV CLASS="table"><A NAME="AEN90621"></A><P><B>表格 2. 已改变的函数名</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">旧名称</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">新名称</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_exec()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-query.html"><B CLASS="function">pg_query()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_getlastoid()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-last-oid.html"><B CLASS="function">pg_last_oid()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_cmdtuples()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-affected-rows.html"><B CLASS="function">pg_affected_rows()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_numrows()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-num-rows.html"><B CLASS="function">pg_num_rows()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_numfields()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-num-fields.html"><B CLASS="function">pg_num_fields()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_fieldname()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-field-name.html"><B CLASS="function">pg_field_name()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_fieldsize()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-field-size.html"><B CLASS="function">pg_field_size()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_fieldnum()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-field-num.html"><B CLASS="function">pg_field_num()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_fieldprtlen()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-field-prtlen.html"><B CLASS="function">pg_field_prtlen()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_fieldisnull()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-field-is-null.html"><B CLASS="function">pg_field_is_null()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_freeresult()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-free-result.html"><B CLASS="function">pg_free_result()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_result()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-fetch-result.html"><B CLASS="function">pg_fetch_result()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loreadall()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-read-all.html"><B CLASS="function">pg_lo_read_all()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_locreate()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-create.html"><B CLASS="function">pg_lo_create()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_lounlink()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-unlink.html"><B CLASS="function">pg_lo_unlink()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loopen()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-open.html"><B CLASS="function">pg_lo_open()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loclose()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-close.html"><B CLASS="function">pg_lo_close()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loread()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-read.html"><B CLASS="function">pg_lo_read()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_lowrite()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-write.html"><B CLASS="function">pg_lo_write()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loimport()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-import.html"><B CLASS="function">pg_lo_import()</B></A></TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE"><B CLASS="function">pg_loexport()</B></TD><TD ALIGN="LEFT" VALIGN="MIDDLE"><A HREF="function.pg-lo-export.html"><B CLASS="function">pg_lo_export()</B></A></TD></TR></TBODY></TABLE></DIV><P>&#13; 为以后支持异步连接，将不再提倡用旧语法使用函数 <A HREF="function.pg-connect.html"><B CLASS="function">pg_connect()</B></A>/<A HREF="function.pg-pconnect.html"><B CLASS="function">pg_pconnect()</B></A>。请用连接字符串作为参数来使用函数 <A HREF="function.pg-connect.html"><B CLASS="function">pg_connect()</B></A> 和 <A HREF="function.pg-pconnect.html"><B CLASS="function">pg_pconnect()</B></A>。
</P></TD></TR></TABLE></DIV><P>&#13; 不是所有的版本都支持所有的函数，这和 libpq 的版本和编译方法有关。如果编译源代码时少了一个函数，那么 libpq 就不支持需要该函数的功能。
</P><P>&#13; 不要使用比 PostgreSQL 服务器连接所接受更旧版本的 libpq 也很重要。如果你用的 libpq 版本比 PostgreSQL 服务器预期的低就可能出现问题。
</P><P>&#13; PostgreSQL 在 6.3 (03/02/1998) 版之后默认使用 unix domain sockets，默认状态下不会打开 TCP 端口。下面这张表说明了各种新建连接的可能性。TCP/IP socket 放在 <TT CLASS="filename">/tmp/.s.PGSQL.5432</TT>。该选项可用 <B CLASS="command">postmaster</B> 中的 '-i' 参数打开，它表示“监视 TCP/IP 端口以及 Unix domain socket”。
<DIV CLASS="table"><A NAME="AEN90744"></A><P><B>表格 3. Postmaster 和 PHP</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">Postmaster</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">PHP</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">状态</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">postmaster &#38;</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">pg_connect("dbname=MyDbName");</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">OK</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">postmaster -i &#38;</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">pg_connect("dbname=MyDbName");</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">OK</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">postmaster &#38;</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">pg_connect("host=localhost dbname=MyDbName");</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Unable to connect to PostgreSQL server: connectDB() failed:
Is the postmaster running and accepting TCP/IP (with -i)
connection at 'localhost' on port '5432'? in
/path/to/file.php on line 20.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">postmaster -i &#38;</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">pg_connect("host=localhost dbname=MyDbName");</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">OK</TD></TR></TBODY></TABLE></DIV>
</P><P>&#13; 到 PostgreSQL 服务器的连接可以通过以下命令串中的参数对建立：<B CLASS="command">$conn =
pg_connect("host=myHost port=myPort tty=myTTY options=myOptions
dbname=myDB user=myUser password=myPassword");
</B>
</P><P>&#13; 以前的语法：
<B CLASS="command">&#13; $conn = pg_connect ("host", "port", "options", "tty", "dbname")
</B>
已经不再提倡使用。
</P><P>&#13; 环境变量会影响 PostgreSQL 服务器／客户机的行为。例如如果连接串中省略了主机名，PostgreSQL 模块将会查找环境变量 PGHOST。
不同版本所支持的环境变量不同，详情参考 PostgreSQL Programmers's Manual (libpq - Environment Variables)。
</P><P>&#13; 确认已经给适当的用户设置了环境变量。用 <TT CLASS="literal">$_ENV</TT> 或 <A HREF="function.getenv.html"><B CLASS="function">getenv()</B></A> 来检查当前进程可以使用哪些环境变量。
</P><TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN90777"></A><P><B>例子 1. 设定默认参数</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE CLASS="programlisting">PGHOST=pgsql.example.com
PGPORT=7890
PGDATABASE=web-system
PGUSER=web-user
PGPASSWORD=secret
PGDATESTYLE=ISO
PGTZ=JST
PGCLIENTENCODING=EUC-JP

export PGHOST PGPORT PGDATABASE PGUSER PGPASSWORD PGDATESTYLE PGTZ PGCLIENTENCODING</PRE></TD></TR></TABLE></DIV></TD></TR></TABLE></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.constants"></A>预定义常量</H1><P>&#13;由于这些常量是由该扩展模块定义的，因此只有在该扩展模块被编译到 PHP 中，或者在运行时被动态加载后，这些常量才有效。</P><P></P><DIV CLASS="variablelist"><DL><DT><TT CLASS="constant"><B>PGSQL_ASSOC</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_NUM</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_BOTH</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_CONNECTION_BAD</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_CONNECTION_OK</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_SEEK_SET</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_SEEK_CUR</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_SEEK_END</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_ESCAPE_STRING</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_ESCAPE_BYTEA</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_EMPTY_QUERY</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_COMMAND_OK</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_TUPLES_OK</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_COPY_OUT</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_COPY_IN</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_BAD_RESPONSE</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_NONFATAL_ERROR</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD><DT><TT CLASS="constant"><B>PGSQL_FATAL_ERROR</B></TT>
(<A HREF="language.types.integer.html"><B CLASS="type">integer</B></A>)</DT><DD><P>&#13;
</P></DD></DL></DIV></DIV><DIV CLASS="section"><H1 CLASS="section"><A NAME="pgsql.examples"></A>范例</H1><P>&#13; 从 PostgreSQL 7.1.0 开始，在一个 text 类型字段中最多可以储存 1GB 的数据。在老版本中则限制为一个块的大小（默认 8KB，最大 32KB，编译时指定）。
</P><P>&#13; 要使用 large object (lo) 接口，需要把 large object 函数放在一个事务段中。事务段以 SQL 语句 <B CLASS="command">BEGIN</B> 开始，如果该事务合法，以 <B CLASS="command">COMMIT</B> 或者 <B CLASS="command">END</B>结束，如果该事务失败，则以 <B CLASS="command">ROLLBACK</B> 或者 <B CLASS="command">ABORT</B>结束。
<TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN90901"></A><P><B>例子 2. 使用 Large Object</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;$database </font><font color="#007700">= </font><font color="#0000BB">pg_connect </font><font color="#007700">(</font><font color="#DD0000">"dbname=jacarta"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">pg_query </font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">, </font><font color="#DD0000">"begin"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$oid </font><font color="#007700">= </font><font color="#0000BB">pg_lo_create </font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"$oid\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$handle </font><font color="#007700">= </font><font color="#0000BB">pg_lo_open </font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">, </font><font color="#0000BB">$oid</font><font color="#007700">, </font><font color="#DD0000">"w"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"$handle\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">pg_lo_write </font><font color="#007700">(</font><font color="#0000BB">$handle</font><font color="#007700">, </font><font color="#DD0000">"large object data"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">pg_lo_close </font><font color="#007700">(</font><font color="#0000BB">$handle</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">pg_query </font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">, </font><font color="#DD0000">"commit"</font><font color="#007700">);<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
在关闭 large object 之前不应关闭到 PostgreSQL 服务器的连接。
</P></DIV></DIV><DIV CLASS="TOC"><DL><DT><B>目录</B></DT><DT><A HREF="function.pg-affected-rows.html">pg_affected_rows</A>&nbsp;--&nbsp;返回受影响的记录数目</DT><DT><A HREF="function.pg-cancel-query.html">pg_cancel_query</A>&nbsp;--&nbsp;
取消异步查询
</DT><DT><A HREF="function.pg-client-encoding.html">pg_client_encoding</A>&nbsp;--&nbsp;
取得客户端编码方式
</DT><DT><A HREF="function.pg-close.html">pg_close</A>&nbsp;--&nbsp;关闭一个 PostgreSQL 连接</DT><DT><A HREF="function.pg-connect.html">pg_connect</A>&nbsp;--&nbsp;打开一个 PostgreSQL 连接</DT><DT><A HREF="function.pg-connection-busy.html">pg_connection_busy</A>&nbsp;--&nbsp;
获知连接是否为忙
</DT><DT><A HREF="function.pg-connection-reset.html">pg_connection_reset</A>&nbsp;--&nbsp;
重置连接（再次连接）
</DT><DT><A HREF="function.pg-connection-status.html">pg_connection_status</A>&nbsp;--&nbsp;
获得连接状态
</DT><DT><A HREF="function.pg-convert.html">pg_convert</A>&nbsp;--&nbsp;
将关联的数组值转换为适合 SQL 语句的格式。
</DT><DT><A HREF="function.pg-copy-from.html">pg_copy_from</A>&nbsp;--&nbsp;
根据数组将记录插入表中
</DT><DT><A HREF="function.pg-copy-to.html">pg_copy_to</A>&nbsp;--&nbsp;
将一个表拷贝到数组中
</DT><DT><A HREF="function.pg-dbname.html">pg_dbname</A>&nbsp;--&nbsp;获得数据库名</DT><DT><A HREF="function.pg-delete.html">pg_delete</A>&nbsp;--&nbsp;
删除记录
</DT><DT><A HREF="function.pg-end-copy.html">pg_end_copy</A>&nbsp;--&nbsp;与 PostgreSQL 后端同步</DT><DT><A HREF="function.pg-escape-bytea.html">pg_escape_bytea</A>&nbsp;--&nbsp;
转义 bytea 类型的二进制数据
</DT><DT><A HREF="function.pg-escape-string.html">pg_escape_string</A>&nbsp;--&nbsp;
转义 text/char 类型的字符串
</DT><DT><A HREF="function.pg-fetch-all.html">pg_fetch_all</A>&nbsp;--&nbsp;从结果中提取所有行作为一个数组</DT><DT><A HREF="function.pg-fetch-array.html">pg_fetch_array</A>&nbsp;--&nbsp;提取一行作为数组</DT><DT><A HREF="function.pg-fetch-assoc.html">pg_fetch_assoc</A>&nbsp;--&nbsp;提取一行作为关联数组</DT><DT><A HREF="function.pg-fetch-object.html">pg_fetch_object</A>&nbsp;--&nbsp;提取一行作为对象</DT><DT><A HREF="function.pg-fetch-result.html">pg_fetch_result</A>&nbsp;--&nbsp;从结果资源中返回值</DT><DT><A HREF="function.pg-fetch-row.html">pg_fetch_row</A>&nbsp;--&nbsp;提取一行作为枚举数组</DT><DT><A HREF="function.pg-field-is-null.html">pg_field_is_null</A>&nbsp;--&nbsp;测试字段是否为 <TT CLASS="constant"><B>NULL</B></TT></DT><DT><A HREF="function.pg-field-name.html">pg_field_name</A>&nbsp;--&nbsp;返回字段的名字</DT><DT><A HREF="function.pg-field-num.html">pg_field_num</A>&nbsp;--&nbsp;返回字段的编号</DT><DT><A HREF="function.pg-field-prtlen.html">pg_field_prtlen</A>&nbsp;--&nbsp;返回打印出来的长度</DT><DT><A HREF="function.pg-field-size.html">pg_field_size</A>&nbsp;--&nbsp;
返回指定字段占用内部存储空间的大小
</DT><DT><A HREF="function.pg-field-type.html">pg_field_type</A>&nbsp;--&nbsp;
返回相应字段的类型名称
</DT><DT><A HREF="function.pg-free-result.html">pg_free_result</A>&nbsp;--&nbsp;释放查询结果占用的内存</DT><DT><A HREF="function.pg-get-notify.html">pg_get_notify</A>&nbsp;--&nbsp;Ping 数据库连接</DT><DT><A HREF="function.pg-get-pid.html">pg_get_pid</A>&nbsp;--&nbsp;Ping 数据库连接</DT><DT><A HREF="function.pg-get-result.html">pg_get_result</A>&nbsp;--&nbsp;
取得异步查询结果
</DT><DT><A HREF="function.pg-host.html">pg_host</A>&nbsp;--&nbsp;
返回和某连接关联的主机名
</DT><DT><A HREF="function.pg-insert.html">pg_insert</A>&nbsp;--&nbsp;
将数组插入到表中
</DT><DT><A HREF="function.pg-last-error.html">pg_last_error</A>&nbsp;--&nbsp;得到某连接的最后一条错误信息</DT><DT><A HREF="function.pg-last-notice.html">pg_last_notice</A>&nbsp;--&nbsp;
返回 PostgreSQL 服务器最新一条公告信息
</DT><DT><A HREF="function.pg-last-oid.html">pg_last_oid</A>&nbsp;--&nbsp;返回上一个对象的 oid</DT><DT><A HREF="function.pg-lo-close.html">pg_lo_close</A>&nbsp;--&nbsp;关闭一个大型对象</DT><DT><A HREF="function.pg-lo-create.html">pg_lo_create</A>&nbsp;--&nbsp;新建一个大型对象</DT><DT><A HREF="function.pg-lo-export.html">pg_lo_export</A>&nbsp;--&nbsp;将大型对象导出到文件</DT><DT><A HREF="function.pg-lo-import.html">pg_lo_import</A>&nbsp;--&nbsp;将文件导入为大型对象</DT><DT><A HREF="function.pg-lo-open.html">pg_lo_open</A>&nbsp;--&nbsp;打开一个大型对象</DT><DT><A HREF="function.pg-lo-read-all.html">pg_lo_read_all</A>&nbsp;--&nbsp;
读入整个大型对象并直接发送给浏览器
</DT><DT><A HREF="function.pg-lo-read.html">pg_lo_read</A>&nbsp;--&nbsp;从大型对象中读入数据</DT><DT><A HREF="function.pg-lo-seek.html">pg_lo_seek</A>&nbsp;--&nbsp;
移动大型对象中的指针
</DT><DT><A HREF="function.pg-lo-tell.html">pg_lo_tell</A>&nbsp;--&nbsp;
返回大型对象的当前指针位置
</DT><DT><A HREF="function.pg-lo-unlink.html">pg_lo_unlink</A>&nbsp;--&nbsp;删除一个大型对象</DT><DT><A HREF="function.pg-lo-write.html">pg_lo_write</A>&nbsp;--&nbsp;向大型对象写入数据</DT><DT><A HREF="function.pg-metadata.html">pg_metadata</A>&nbsp;--&nbsp;
获得表的元数据
</DT><DT><A HREF="function.pg-num-fields.html">pg_num_fields</A>&nbsp;--&nbsp;返回字段的数目</DT><DT><A HREF="function.pg-num-rows.html">pg_num_rows</A>&nbsp;--&nbsp;返回行的数目</DT><DT><A HREF="function.pg-options.html">pg_options</A>&nbsp;--&nbsp;获得和连接有关的选项</DT><DT><A HREF="function.pg-pconnect.html">pg_pconnect</A>&nbsp;--&nbsp;打开一个持久的 PostgreSQL 连接</DT><DT><A HREF="function.pg-ping.html">pg_ping</A>&nbsp;--&nbsp;Ping 数据库连接</DT><DT><A HREF="function.pg-port.html">pg_port</A>&nbsp;--&nbsp;
返回该连接的端口号
</DT><DT><A HREF="function.pg-put-line.html">pg_put_line</A>&nbsp;--&nbsp;向 PostgreSQL 后端发送以 NULL 结尾的字符串</DT><DT><A HREF="function.pg-query.html">pg_query</A>&nbsp;--&nbsp;执行查询</DT><DT><A HREF="function.pg-result-error.html">pg_result_error</A>&nbsp;--&nbsp;
获得查询结果的错误信息
</DT><DT><A HREF="function.pg-result-seek.html">pg_result_seek</A>&nbsp;--&nbsp;在结果资源中设定内部行偏移量</DT><DT><A HREF="function.pg-result-status.html">pg_result_status</A>&nbsp;--&nbsp;
获得查询结果的状态
</DT><DT><A HREF="function.pg-select.html">pg_select</A>&nbsp;--&nbsp;
选择记录
</DT><DT><A HREF="function.pg-send-query.html">pg_send_query</A>&nbsp;--&nbsp;
发送异步查询
</DT><DT><A HREF="function.pg-set-client-encoding.html">pg_set_client_encoding</A>&nbsp;--&nbsp;
设定客户端编码
</DT><DT><A HREF="function.pg-trace.html">pg_trace</A>&nbsp;--&nbsp;启动一个 PostgreSQL 连接的追踪功能</DT><DT><A HREF="function.pg-tty.html">pg_tty</A>&nbsp;--&nbsp;
返回该连接的 tty 号
</DT><DT><A HREF="function.pg-unescape-bytea.html">pg_unescape_bytea</A>&nbsp;--&nbsp;
取消 bytea 类型中的字符串转义
</DT><DT><A HREF="function.pg-untrace.html">pg_untrace</A>&nbsp;--&nbsp;关闭 PostgreSQL 连接的追踪功能</DT><DT><A HREF="function.pg-update.html">pg_update</A>&nbsp;--&nbsp;
更新表
</DT></DL></DIV></DIV></DIV><BR></TD><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><DIV CLASS="NAVFOOTER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="function.posix-uname.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="index-2.html" ACCESSKEY="H">起点</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="function.pg-affected-rows.html" ACCESSKEY="N">前进</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">posix_uname</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="funcref.html" ACCESSKEY="U">上一级</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">pg_affected_rows</TD></TR></TABLE></TD></TR></TABLE></DIV></TD></TR></TABLE>
<p style="text-align:center;"><script type="text/javascript" src="http://www.veryhuo.com/plus/js/manual.js"></script></p>
<div style="display:none;">
<script type="text/javascript" src="/liehuo.net/js/stat.js"></script>
</div>
</body>
</html>
