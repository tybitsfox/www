<HTML><HEAD><TITLE>preg_match_all</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK REL="HOME" TITLE="PHP 手册" HREF="index-2.html"><LINK REL="UP" TITLE="正则表达式函数库（Perl 兼容）" HREF="ref.pcre.html"><LINK REL="PREVIOUS" TITLE="preg_grep" HREF="function.preg-grep.html"><LINK REL="NEXT" TITLE="preg_match" HREF="function.preg-match.html"><META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=gb2312"><LINK REL="stylesheet" HREF="style.css"></HEAD><BODY TOPMARGIN="0" LEFTMARGIN="0" CLASS="refentry" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#840084" ALINK="#0000FF"><TABLE BORDER="0" WIDTH="100%" HEIGHT="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD COLSPAN="3"><DIV CLASS="NAVHEADER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TH COLSPAN="3" ALIGN="center">PHP 手册</TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="bottom"><A HREF="function.preg-grep.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="80%" ALIGN="center" VALIGN="bottom"></TD><TD WIDTH="10%" ALIGN="right" VALIGN="bottom"><A HREF="function.preg-match.html" ACCESSKEY="N">前进</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></DIV></TD></TR><TR><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%"><BR><H1><A NAME="function.preg-match-all"></A>preg_match_all</H1><DIV CLASS="refnamediv"><A NAME="AEN95972"></A><P> (PHP 3&#62;= 3.0.9, PHP 4 )</P>preg_match_all&nbsp;--&nbsp;进行全局正则表达式匹配</DIV><DIV CLASS="refsect1"><A NAME="AEN95975"></A><H2>说明</H2>int <B CLASS="methodname">preg_match_all</B> ( string pattern, string subject, array matches [, int flags])<BR></BR><P>&#13; 在 <TT CLASS="parameter"><I>subject</I></TT> 中搜索所有与
<TT CLASS="parameter"><I>pattern</I></TT> 给出的正则表达式匹配的内容并将结果以
<TT CLASS="parameter"><I>flags</I></TT> 指定的顺序放到
<TT CLASS="parameter"><I>matches</I></TT> 中。
</P><P>&#13; 搜索到第一个匹配项之后，接下来的搜索从上一个匹配项末尾开始。
</P><P>&#13; <TT CLASS="parameter"><I>flags</I></TT> 可以是下列标记的组合（注意把
<TT CLASS="constant"><B>PREG_PATTERN_ORDER</B></TT> 和
<TT CLASS="constant"><B>PREG_SET_ORDER</B></TT> 合起来用没有意义）：
<P></P><DIV CLASS="variablelist"><DL><DT>PREG_PATTERN_ORDER</DT><DD><P>&#13; 对结果排序使 $matches[0] 为全部模式匹配的数组，$matches[1]
为第一个括号中的子模式所匹配的字符串组成的数组，以此类推。
</P><P>&#13; <DIV CLASS="informalexample"><A NAME="AEN96008"></A><P></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />preg_match_all </font><font color="#007700">(</font><font color="#DD0000">"|&lt;[^&gt;]+&gt;(.*)&lt;/[^&gt;]+&gt;|U"</font><font color="#007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">"&lt;b&gt;example: &lt;/b&gt;&lt;div align=left&gt;this is a test&lt;/div&gt;"</font><font color="#007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$out</font><font color="#007700">, </font><font color="#0000BB">PREG_PATTERN_ORDER</font><font color="#007700">);<br />print </font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">0</font><font color="#007700">].</font><font color="#DD0000">", "</font><font color="#007700">.</font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">1</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br />print </font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">0</font><font color="#007700">].</font><font color="#DD0000">", "</font><font color="#007700">.</font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">1</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE><P>&#13; 本例将输出：
</P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE CLASS="html">&#60;b&#62;example: &#60;/b&#62;, &#60;div align=left&#62;this is a test&#60;/div&#62;
example: , this is a test</PRE></TD></TR></TABLE><P>&#13; 因此，$out[0] 包含匹配整个模式的字符串，$out[1]
包含一对 HTML 标记之间的字符串。
</P><P></P></DIV>
</P></DD><DT>PREG_SET_ORDER</DT><DD><P>&#13; 对结果排序使 $matches[0] 为第一组匹配项的数组，$matches[1]
为第二组匹配项的数组，以此类推。
<DIV CLASS="informalexample"><A NAME="AEN96017"></A><P></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />preg_match_all </font><font color="#007700">(</font><font color="#DD0000">"|&lt;[^&gt;]+&gt;(.*)&lt;/[^&gt;]+&gt;|U"</font><font color="#007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">"&lt;b&gt;example: &lt;/b&gt;&lt;div align=left&gt;this is a test&lt;/div&gt;"</font><font color="#007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$out</font><font color="#007700">, </font><font color="#0000BB">PREG_SET_ORDER</font><font color="#007700">);<br />print </font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">0</font><font color="#007700">].</font><font color="#DD0000">", "</font><font color="#007700">.</font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">1</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br />print </font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">0</font><font color="#007700">].</font><font color="#DD0000">", "</font><font color="#007700">.</font><font color="#0000BB">$out</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">1</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE><P>&#13; 本例将输出：
</P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE CLASS="html">&#60;b&#62;example: &#60;/b&#62;, example:
&#60;div align=left&#62;this is a test&#60;/div&#62;, this is a test</PRE></TD></TR></TABLE><P></P></DIV>
</P><P>&#13; 本例中，$matches[0] 是第一组匹配结果，$matches[0][0]
包含匹配整个模式的文本，$matches[0][1]
包含匹配第一个子模式的文本，以此类推。同样，$matches[1]
是第二组匹配结果，等等。
</P></DD><DT>PREG_OFFSET_CAPTURE</DT><DD><P>&#13; 如果设定本标记，对每个出现的匹配结果也同时返回其附属的字符串偏移量。注意这改变了返回的数组的值，使其中的每个单元也是一个数组，其中第一项为匹配字符串，第二项为其在
<TT CLASS="parameter"><I>subject</I></TT> 中的偏移量。本标记自
<TT CLASS="literal">PHP 4.3.0</TT> 起可用。
</P></DD></DL></DIV>
</P><P>&#13; 如果没有给出标记，则假定为 <TT CLASS="constant"><B>PREG_PATTERN_ORDER</B></TT>。
</P><P>&#13; 返回整个模式匹配的次数（可能为零），如果出错返回 <TT CLASS="constant"><B>FALSE</B></TT>。
</P><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN96033"></A><P><B>例子 1. 从某文本中取得所有的电话号码</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />preg_match_all </font><font color="#007700">(</font><font color="#DD0000">"/\(?&nbsp;&nbsp;(\d{3})?&nbsp;&nbsp;\)?&nbsp;&nbsp;(?(1)&nbsp;&nbsp;[\-\s] ) \d{3}-\d{4}/x"</font><font color="#007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#DD0000">"Call 555-1212 or 1-800-555-1212"</font><font color="#007700">, </font><font color="#0000BB">$phones</font><font color="#007700">);<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN96037"></A><P><B>例子 2. 搜索匹配的 HTML 标记（greedy）</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br /></font><font color="#FF8000">// \\2 是一个逆向引用的例子，其在 PCRE 中的含义是<br />// 必须匹配正则表达式本身中第二组括号内的内容，本例中<br />// 就是 ([\w]+)。因为字符串在双引号中，所以需要<br />// 多加一个反斜线。<br /></font><font color="#0000BB">$html </font><font color="#007700">= </font><font color="#DD0000">"&lt;b&gt;bold text&lt;/b&gt;&lt;a href=howdy.html&gt;click me&lt;/a&gt;"</font><font color="#007700">;<br /><br /></font><font color="#0000BB">preg_match_all </font><font color="#007700">(</font><font color="#DD0000">"/(&lt;([\w]+)[^&gt;]*&gt;)(.*)(&lt;\/\\2&gt;)/"</font><font color="#007700">, </font><font color="#0000BB">$html</font><font color="#007700">, </font><font color="#0000BB">$matches</font><font color="#007700">);<br /><br />for (</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">; </font><font color="#0000BB">$i</font><font color="#007700">&lt; </font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$matches</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]); </font><font color="#0000BB">$i</font><font color="#007700">++) {<br />&nbsp;&nbsp;echo </font><font color="#DD0000">"matched: "</font><font color="#007700">.</font><font color="#0000BB">$matches</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br />&nbsp;&nbsp;echo </font><font color="#DD0000">"part 1: "</font><font color="#007700">.</font><font color="#0000BB">$matches</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br />&nbsp;&nbsp;echo </font><font color="#DD0000">"part 2: "</font><font color="#007700">.</font><font color="#0000BB">$matches</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"\n"</font><font color="#007700">;<br />&nbsp;&nbsp;echo </font><font color="#DD0000">"part 3: "</font><font color="#007700">.</font><font color="#0000BB">$matches</font><font color="#007700">[</font><font color="#0000BB">4</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"\n\n"</font><font color="#007700">;<br />}<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE><P>&#13; 本例将输出：
</P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE CLASS="html">matched: &#60;b&#62;bold text&#60;/b&#62;
part 1: &#60;b&#62;
part 2: bold text
part 3: &#60;/b&#62;

matched: &#60;a href=howdy.html&#62;click me&#60;/a&#62;
part 1: &#60;a href=howdy.html&#62;
part 2: click me
part 3: &#60;/a&#62;</PRE></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P><P>&#13; 参见 <A HREF="function.preg-match.html"><B CLASS="function">preg_match()</B></A>，<A HREF="function.preg-replace.html"><B CLASS="function">preg_replace()</B></A>
和 <A HREF="function.preg-split.html"><B CLASS="function">preg_split()</B></A>。
</P></DIV><BR></TD><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><DIV CLASS="NAVFOOTER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="function.preg-grep.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="index-2.html" ACCESSKEY="H">起点</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="function.preg-match.html" ACCESSKEY="N">前进</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">preg_grep</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="ref.pcre.html" ACCESSKEY="U">上一级</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">preg_match</TD></TR></TABLE></TD></TR></TABLE></DIV></TD></TR></TABLE>
<p style="text-align:center;"><script type="text/javascript" src="http://www.veryhuo.com/plus/js/manual.js"></script></p>
<div style="display:none;">
<script type="text/javascript" src="/liehuo.net/js/stat.js"></script>
</div>
</body>
</html>
