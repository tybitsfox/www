<HTML><HEAD><TITLE>socket_create_pair</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK REL="HOME" TITLE="PHP 手册" HREF="index-2.html"><LINK REL="UP" TITLE="Socket Functions" HREF="ref.sockets.html"><LINK REL="PREVIOUS" TITLE="socket_create_listen" HREF="function.socket-create-listen.html"><LINK REL="NEXT" TITLE="socket_create" HREF="function.socket-create.html"><META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=gb2312"><LINK REL="stylesheet" HREF="style.css"></HEAD><BODY TOPMARGIN="0" LEFTMARGIN="0" CLASS="refentry" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#840084" ALINK="#0000FF"><TABLE BORDER="0" WIDTH="100%" HEIGHT="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD COLSPAN="3"><DIV CLASS="NAVHEADER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TH COLSPAN="3" ALIGN="center">PHP 手册</TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="bottom"><A HREF="function.socket-create-listen.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="80%" ALIGN="center" VALIGN="bottom"></TD><TD WIDTH="10%" ALIGN="right" VALIGN="bottom"><A HREF="function.socket-create.html" ACCESSKEY="N">前进</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></DIV></TD></TR><TR><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%"><BR><H1><A NAME="function.socket-create-pair"></A>socket_create_pair</H1><DIV CLASS="refnamediv"><A NAME="AEN104081"></A><P> (PHP 4 &#62;= 4.1.0)</P>socket_create_pair&nbsp;--&nbsp;Creates a pair of indistinguishable sockets and stores them in fds. </DIV><DIV CLASS="refsect1"><A NAME="AEN104084"></A><H2>Description</H2>bool <B CLASS="methodname">socket_create_pair</B> ( int domain, int type, int protocol, array &#38;fd)<BR></BR><DIV CLASS="warning"><P></P><TABLE CLASS="warning" BORDER="1" WIDTH="100%"><TR><TD ALIGN="CENTER"><B>警告</B></TD></TR><TR><TD ALIGN="LEFT"><P>本扩展模块是<SPAN CLASS="emphasis"><I CLASS="emphasis">实验性</I></SPAN>的。该模块的行为，包括其函数的名称以及其它任何关于此模块的文档可能会在没有通知的情况下随 PHP 以后的发布而改变。我们提醒您在使用本扩展模块的同时自担风险。
</P></TD></TR></TABLE></DIV><P>&#13; <B CLASS="function">socket_create_pair()</B> creates two connected and indistinguishable sockets, and stores
them in <TT CLASS="parameter"><I>&#38;fd</I></TT>. This function is commonly used in IPC (InterProcess Communication).
</P><P>&#13; The <TT CLASS="parameter"><I>domain</I></TT> parameter specifies the protocol
family to be used by the socket.
</P><DIV CLASS="table"><A NAME="AEN104109"></A><P><B>表格 1. Available address/protocol families</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">Domain</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">Description</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">AF_INET</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; IPv4 Internet based protocols. TCP and UDP are common protocols of
this protocol family. Supported only in windows.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">AF_INET6</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; IPv6 Internet based protocols. TCP and UDP are common protocols of
this protocol family. Support added in <TT CLASS="literal">PHP 5.0.0</TT>.
Supported only in windows.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">AF_UNIX</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Local communication protocol family. High efficiency and low
overhead make it a great form of IPC (Interprocess Communication).
</TD></TR></TBODY></TABLE></DIV><P>&#13; The <TT CLASS="parameter"><I>type</I></TT> parameter selects the type of communication
to be used by the socket.
</P><DIV CLASS="table"><A NAME="AEN104129"></A><P><B>表格 2. Available socket types</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">Type</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">Description</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">SOCK_STREAM</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Provides sequenced, reliable, full-duplex, connection-based byte streams.
An out-of-band data transmission mechanism may be supported.
The TCP protocol is based on this socket type.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">SOCK_DGRAM</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Supports datagrams (connectionless, unreliable messages of a fixed maximum length).
The UDP protocol is based on this socket type.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">SOCK_SEQPACKET</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Provides a sequenced, reliable, two-way connection-based data transmission path for
datagrams of fixed maximum length; a consumer is required to read an
entire packet with each read call.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">SOCK_RAW</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Provides raw network protocol access. This special type of socket
can be used to manually construct any type of protocol. A common use
for this socket type is to perform ICMP requests (like ping,
traceroute, etc).
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">SOCK_RDM</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; Provides a reliable datagram layer that does not guarantee ordering.
This is most likely not implemented on your operating system.
</TD></TR></TBODY></TABLE></DIV><P>&#13; The <TT CLASS="parameter"><I>protocol</I></TT> parameter sets the specific
protocol within the specified <TT CLASS="parameter"><I>domain</I></TT> to be used
when communicating on the returned socket. The proper value can be retrieved by
name by using <A HREF="function.getprotobyname.html"><B CLASS="function">getprotobyname()</B></A>. If
the desired protocol is TCP, or UDP the corresponding constants
<TT CLASS="constant"><B>SOL_TCP</B></TT>, and <TT CLASS="constant"><B>SOL_UDP</B></TT>
can also be used.
</P><DIV CLASS="table"><A NAME="AEN104158"></A><P><B>表格 3. Common protocols</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><THEAD><TR><TH ALIGN="LEFT" VALIGN="MIDDLE">Name</TH><TH ALIGN="LEFT" VALIGN="MIDDLE">Description</TH></TR></THEAD><TBODY><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">icmp</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; The Internet Control Message Protocol is used primarily by gateways
and hosts to report errors in datagram communication. The "ping"
command (present in most modern operating systems) is an example
application of ICMP.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">udp</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; The User Datagram Protocol is a connectionless, unreliable,
protocol with fixed record lengths. Due to these aspects, UDP
requires a minimum amount of protocol overhead.
</TD></TR><TR><TD ALIGN="LEFT" VALIGN="MIDDLE">tcp</TD><TD ALIGN="LEFT" VALIGN="MIDDLE">&#13; The Transmission Control Protocol is a reliable, connection based,
stream oriented, full duplex protocol. TCP guarantees that all data packets
will be received in the order in which they were sent. If any packet is somehow
lost during communication, TCP will automatically retransmit the packet until
the destination host acknowledges that packet. For reliability and performance
reasons, the TCP implementation itself decides the appropriate octet boundaries
of the underlying datagram communication layer. Therefore, TCP applications must
allow for the possibility of partial record transmission.
</TD></TR></TBODY></TABLE></DIV><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN104176"></A><P><B>例子 1. <B CLASS="function">socket_create_pair()</B> example</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />$sockets </font><font color="#007700">= array();<br /></font><font color="#0000BB">$uniqid </font><font color="#007700">= </font><font color="#0000BB">uniqid</font><font color="#007700">(</font><font color="#DD0000">''</font><font color="#007700">);<br />if (</font><font color="#0000BB">file_exists</font><font color="#007700">(</font><font color="#DD0000">"/tmp/$uniqid.sock"</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</font><font color="#DD0000">'Temporary socket already exists.'</font><font color="#007700">);<br />}<br /></font><font color="#FF8000">/* Setup socket pair */<br /></font><font color="#007700">if (!</font><font color="#0000BB">socket_create_pair</font><font color="#007700">(</font><font color="#0000BB">AF_UNIX</font><font color="#007700">, </font><font color="#0000BB">SOCK_STREAM</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">$sockets</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />}<br /></font><font color="#FF8000">/* Send and Recieve Data */<br /></font><font color="#007700">if (!</font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$sockets</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">], </font><font color="#DD0000">"ABCdef123\n"</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#DD0000">"ABCdef123\n"</font><font color="#007700">))) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />}<br />if (!</font><font color="#0000BB">$data </font><font color="#007700">= </font><font color="#0000BB">socket_read</font><font color="#007700">(</font><font color="#0000BB">$sockets</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">], </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#DD0000">"ABCdef123\n"</font><font color="#007700">), </font><font color="#0000BB">PHP_BINARY_READ</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />}<br /></font><font color="#0000BB">var_dump</font><font color="#007700">(</font><font color="#0000BB">$data</font><font color="#007700">);<br /><br /></font><font color="#FF8000">/* Close sockets */<br /></font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$sockets</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]);<br /></font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$sockets</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">]);<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P><P>&#13; <TABLE WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV CLASS="example"><A NAME="AEN104181"></A><P><B>例子 2. <B CLASS="function">socket_create_pair()</B> IPC example</B></P><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><code><font color="#000000">
<font color="#0000BB">&lt;?php<br />$ary </font><font color="#007700">= array();<br /></font><font color="#0000BB">$strone </font><font color="#007700">= </font><font color="#DD0000">'Message From Parent.'</font><font color="#007700">;<br /></font><font color="#0000BB">$strtwo </font><font color="#007700">= </font><font color="#DD0000">'Message From Child.'</font><font color="#007700">;<br />if (!</font><font color="#0000BB">socket_create_pair</font><font color="#007700">(</font><font color="#0000BB">AF_UNIX</font><font color="#007700">, </font><font color="#0000BB">SOCK_STREAM</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">$ary</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />}<br /></font><font color="#0000BB">$pid </font><font color="#007700">= </font><font color="#0000BB">pcntl_fork</font><font color="#007700">();<br />if (</font><font color="#0000BB">$pid </font><font color="#007700">== -</font><font color="#0000BB">1</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">'Could not fork Process.'</font><font color="#007700">;<br />} elseif (</font><font color="#0000BB">$pid</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">/*parent*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;if (!</font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">], </font><font color="#0000BB">$strone</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$strone</font><font color="#007700">))) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">socket_read</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">], </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$strtwo</font><font color="#007700">), </font><font color="#0000BB">PHP_BINARY_READ</font><font color="#007700">) == </font><font color="#0000BB">$strtwo</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"Recieved $strtwo\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />} else {<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">/*child*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">socket_close</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;if (!</font><font color="#0000BB">socket_write</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">], </font><font color="#0000BB">$strtwo</font><font color="#007700">, </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$strtwo</font><font color="#007700">))) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">socket_strerror</font><font color="#007700">(</font><font color="#0000BB">socket_last_error</font><font color="#007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">socket_read</font><font color="#007700">(</font><font color="#0000BB">$ary</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">], </font><font color="#0000BB">strlen</font><font color="#007700">(</font><font color="#0000BB">$strone</font><font color="#007700">), </font><font color="#0000BB">PHP_BINARY_READ</font><font color="#007700">) == </font><font color="#0000BB">$strone</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"Recieved $strone\n"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code></TD></TR></TABLE></DIV></TD></TR></TABLE>
</P></DIV><BR></TD><TD><IMG SRC="spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><DIV CLASS="NAVFOOTER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="function.socket-create-listen.html" ACCESSKEY="P">后退</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="index-2.html" ACCESSKEY="H">起点</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="function.socket-create.html" ACCESSKEY="N">前进</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">socket_create_listen</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="ref.sockets.html" ACCESSKEY="U">上一级</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">socket_create</TD></TR></TABLE></TD></TR></TABLE></DIV></TD></TR></TABLE>
<p style="text-align:center;"><script type="text/javascript" src="http://www.veryhuo.com/plus/js/manual.js"></script></p>
<div style="display:none;">
<script type="text/javascript" src="/liehuo.net/js/stat.js"></script>
</div>
</body>
</html>
