<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Meaty Skeleton - OSDev Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"2cff873e081d975fcfdacad9","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Meaty_Skeleton","wgTitle":"Meaty Skeleton","wgCurRevisionId":28435,"wgRevisionId":28435,"wgArticleId":3448,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages using duplicate arguments in template calls","Pages using deprecated source tags","Articles Written in First Person","Level 1 Tutorials","Tutorials","C"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Meaty_Skeleton","wgRelevantArticleId":3448,"wgIsProbablyEditable":false,
"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgRedirectedFrom":"Sysroot","wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,"watchlist":false,"tagline":false},"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},"wgVector2022PreviewPages":[],"wgMediaViewerOnClick":true,"wgMediaViewerEnabledByDefault":true,"wgInternalRedirectTargetUrl":"/Meaty_Skeleton#System_Root","wgEditSubmitButtonLabelPublish":false};RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","skins.vector.styles.legacy":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready","ext.DarkMode.styles":"ready"};RLPAGEMODULES=["mediawiki.action.view.redirect","site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader","mmv.head","mmv.bootstrap.autostart","ext.DarkMode",
"ext.moderation.notify","ext.moderation.ve","ext.moderation.ajaxhook","ext.moderation.notify.desktop"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});</script>
<link rel="stylesheet" href="https://wiki.osdev.org/load.php?lang=en&amp;modules=ext.DarkMode.styles%7Cext.pygments%7Cext.visualEditor.desktopArticleTarget.noscript%7Cskins.vector.styles.legacy&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://wiki.osdev.org/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://wiki.osdev.org/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.39.7"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="viewport" content="width=1000"/>
<link rel="icon" href="favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="OSDev Wiki (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="api.php?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="OSDev Wiki Atom feed" href="https://wiki.osdev.org/index.php?title=Special:RecentChanges&amp;feed=atom"/>
<link rel="canonical" href="Meaty_Skeleton#System_Root"/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Meaty_Skeleton rootpage-Meaty_Skeleton skin-vector action-view skin-vector-legacy vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice"></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Meaty Skeleton</span></h1>
	<div id="bodyContent" class="vector-body">
		<div id="siteSub" class="noprint">From OSDev Wiki</div>
		<div id="contentSub"><span class="mw-redirectedfrom">(Redirected from <a href="https://wiki.osdev.org/index.php?title=Sysroot&amp;redirect=no" class="mw-redirect" title="Sysroot">Sysroot</a>)</span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="Sysroot#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="Sysroot#searchInput">Jump to search</a>
		<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr"><div class="mw-parser-output"><center>
<table style="border: 1px solid #cfcfbf; margin-top: 25px; margin-bottom: 25px; background-color: #f0f0ff; text-align: center;">
<tbody><tr>
<td>
<p>This page or section refers to its readers or editors using <i>I</i>, <i>my</i>, <i>we</i> or <i>us</i>. It should be <a rel="nofollow" class="external text" href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;action=edit">edited</a> to be in an encyclopedic tone.
</p>
</td></tr></tbody></table>
</center>
<center>
<table style="border: 1px solid #cfcfbf; margin-top: 25px; margin-bottom: 25px; background-color: #f0f0ff; text-align: center;">
<tbody><tr>
<td>
<p><big><b>WAIT! Have you read <a href="Getting_Started" title="Getting Started">Getting Started</a>, <a href="Beginner_Mistakes" title="Beginner Mistakes">Beginner Mistakes</a>, and some of the related <a href="./Category:OS_theory" title="Category:OS theory">OS theory</a>?</b></big>
</p>
</td></tr></tbody></table>
</center><table style="font-size:95%; line-height:1.5em; padding:0.25em; float:right; margin: 0 0 8px 15px; clear:right; border:1px solid #aaaaaa; background:#eee; text-align:center;;"><tbody><tr><th>Difficulty level</th></tr><tr><td><a href="./File:Difficulty_1.png" class="image"><img alt="Difficulty 1.png" src="images/d/d3/Difficulty_1.png" decoding="async" width="46" height="14" data-file-width="46" data-file-height="14" /></a><br />Beginner</td></tr></tbody></table>
<table style="font-size:95%; line-height:1.5em; padding:0.25em; float:right; margin: 0 0 8px 15px; clear: right; border:1px solid #aaaaaa; background:#eee; text-align:center; width:200px; ;"><tbody><tr><th style="background:#ffce7b; padding:0.3em; font-size:1.1em;"><a href="Kernels" class="mw-redirect" title="Kernels">Kernel Designs</a></th></tr><tr><th>Models</th></tr><tr><td><div>
<p><a href="Monolithic_Kernel" title="Monolithic Kernel">Monolithic Kernel</a><br />
<a href="Microkernel" title="Microkernel">Microkernel</a><br />
<a href="Hybrid_Kernel" title="Hybrid Kernel">Hybrid Kernel</a><br />
<a href="Exokernel" title="Exokernel">Exokernel</a><br />
<a href="Nanokernel" class="mw-redirect" title="Nanokernel">Nano/Picokernel</a><br />
<a href="Exokernel#Cache_Kernel" title="Exokernel">Cache Kernel</a><br />
<a href="Exokernel#Virtualizing_Kernel" title="Exokernel">Virtualizing Kernel</a><br />
<a href="Megalithic_Kernel" title="Megalithic Kernel">Megalithic Kernel</a><br />
</p>
</div></td></tr><tr><th>Other Concepts</th></tr><tr><td><div>
<p><a href="Modular_Kernel" title="Modular Kernel">Modular Kernel</a><br />
<a href="Higher_Half_Kernel" title="Higher Half Kernel">Higher Half Kernel</a><br />
<a href="Creating_a_64-bit_kernel" title="Creating a 64-bit kernel">64-bit Kernel</a><br />
</p>
</div></td></tr></tbody></table>
<p>This tutorial continues from <a href="Bare_Bones" title="Bare Bones">Bare Bones</a> and creates a minimal template
operating system in the <a href="Stan_Dard" title="Stan Dard">Stan Dard</a> style suitable for further modification or
as inspiration for your initial operating system version. The <a href="Bare_Bones" title="Bare Bones">Bare Bones</a>
tutorial only gives you the absolutely minimal code to demonstrate how to
correctly cross-compile a kernel, however this is unsuitable as an example
operating system. Additionally, this tutorial implements neccesary ABI features
needed to satisfy the ABI and compiler contracts to prevent possible mysterious
errors.
</p><p>This tutorial also serves as the initial template tutorial on how to
<a href="Creating_a_C_Library" title="Creating a C Library">create your own libc</a> (Standard C Library). The GCC
documentation explicitly states that libgcc requires the freestanding
environment to supply the <tt>memcmp</tt>, <tt>memcpy</tt>, <tt>memmove</tt>,
and <tt>memset</tt> functions, as well as <tt>abort</tt> on some platforms. We
will satisfy this requirement by creating a special kernel C library (libk) that
contains the parts of the user-space libc that are <i>freestanding</i> (doesn't
require any kernel features) as opposed to <i>hosted</i> libc features that need to
do system calls.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Sysroot#Preface"><span class="tocnumber">1</span> <span class="toctext">Preface</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Sysroot#Bare_Bones"><span class="tocnumber">2</span> <span class="toctext">Bare Bones</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="Sysroot#Building_a_Cross-Compiler"><span class="tocnumber">3</span> <span class="toctext">Building a Cross-Compiler</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="Sysroot#Dependencies"><span class="tocnumber">4</span> <span class="toctext">Dependencies</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="Sysroot#Debian-family_Users"><span class="tocnumber">4.1</span> <span class="toctext">Debian-family Users</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="Sysroot#System_Root"><span class="tocnumber">5</span> <span class="toctext">System Root</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="Sysroot#System_Headers"><span class="tocnumber">6</span> <span class="toctext">System Headers</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="Sysroot#Makefile_Design"><span class="tocnumber">7</span> <span class="toctext">Makefile Design</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="Sysroot#Architecture_Directories"><span class="tocnumber">8</span> <span class="toctext">Architecture Directories</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="Sysroot#Kernel_Design"><span class="tocnumber">9</span> <span class="toctext">Kernel Design</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="Sysroot#libc_and_libk_Design"><span class="tocnumber">10</span> <span class="toctext">libc and libk Design</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="Sysroot#Source_Code"><span class="tocnumber">11</span> <span class="toctext">Source Code</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="Sysroot#kernel"><span class="tocnumber">11.1</span> <span class="toctext">kernel</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="Sysroot#kernel/include/kernel/tty.h"><span class="tocnumber">11.1.1</span> <span class="toctext">kernel/include/kernel/tty.h</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="Sysroot#kernel/Makefile"><span class="tocnumber">11.1.2</span> <span class="toctext">kernel/Makefile</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="Sysroot#kernel/kernel/kernel.c"><span class="tocnumber">11.1.3</span> <span class="toctext">kernel/kernel/kernel.c</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="Sysroot#kernel/arch/i386/tty.c"><span class="tocnumber">11.1.4</span> <span class="toctext">kernel/arch/i386/tty.c</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="Sysroot#kernel/arch/i386/crtn.S"><span class="tocnumber">11.1.5</span> <span class="toctext">kernel/arch/i386/crtn.S</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="Sysroot#kernel/arch/i386/vga.h"><span class="tocnumber">11.1.6</span> <span class="toctext">kernel/arch/i386/vga.h</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="Sysroot#kernel/arch/i386/make.config"><span class="tocnumber">11.1.7</span> <span class="toctext">kernel/arch/i386/make.config</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="Sysroot#kernel/arch/i386/crti.S"><span class="tocnumber">11.1.8</span> <span class="toctext">kernel/arch/i386/crti.S</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="Sysroot#kernel/arch/i386/linker.ld"><span class="tocnumber">11.1.9</span> <span class="toctext">kernel/arch/i386/linker.ld</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="Sysroot#kernel/arch/i386/boot.S"><span class="tocnumber">11.1.10</span> <span class="toctext">kernel/arch/i386/boot.S</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="Sysroot#kernel/.gitignore"><span class="tocnumber">11.1.11</span> <span class="toctext">kernel/.gitignore</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="Sysroot#libc_and_libk"><span class="tocnumber">11.2</span> <span class="toctext">libc and libk</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="Sysroot#libc/include/string.h"><span class="tocnumber">11.2.1</span> <span class="toctext">libc/include/string.h</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="Sysroot#libc/include/stdio.h"><span class="tocnumber">11.2.2</span> <span class="toctext">libc/include/stdio.h</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="Sysroot#libc/include/sys/cdefs.h"><span class="tocnumber">11.2.3</span> <span class="toctext">libc/include/sys/cdefs.h</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="Sysroot#libc/include/stdlib.h"><span class="tocnumber">11.2.4</span> <span class="toctext">libc/include/stdlib.h</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="Sysroot#libc/Makefile"><span class="tocnumber">11.2.5</span> <span class="toctext">libc/Makefile</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="Sysroot#libc/stdlib/abort.c"><span class="tocnumber">11.2.6</span> <span class="toctext">libc/stdlib/abort.c</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="Sysroot#libc/string/memmove.c"><span class="tocnumber">11.2.7</span> <span class="toctext">libc/string/memmove.c</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="Sysroot#libc/string/strlen.c"><span class="tocnumber">11.2.8</span> <span class="toctext">libc/string/strlen.c</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="Sysroot#libc/string/memcmp.c"><span class="tocnumber">11.2.9</span> <span class="toctext">libc/string/memcmp.c</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="Sysroot#libc/string/memset.c"><span class="tocnumber">11.2.10</span> <span class="toctext">libc/string/memset.c</span></a></li>
<li class="toclevel-3 tocsection-36"><a href="Sysroot#libc/string/memcpy.c"><span class="tocnumber">11.2.11</span> <span class="toctext">libc/string/memcpy.c</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="Sysroot#libc/stdio/puts.c"><span class="tocnumber">11.2.12</span> <span class="toctext">libc/stdio/puts.c</span></a></li>
<li class="toclevel-3 tocsection-38"><a href="Sysroot#libc/stdio/putchar.c"><span class="tocnumber">11.2.13</span> <span class="toctext">libc/stdio/putchar.c</span></a></li>
<li class="toclevel-3 tocsection-39"><a href="Sysroot#libc/stdio/printf.c"><span class="tocnumber">11.2.14</span> <span class="toctext">libc/stdio/printf.c</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="Sysroot#libc/arch/i386/make.config"><span class="tocnumber">11.2.15</span> <span class="toctext">libc/arch/i386/make.config</span></a></li>
<li class="toclevel-3 tocsection-41"><a href="Sysroot#libc/.gitignore"><span class="tocnumber">11.2.16</span> <span class="toctext">libc/.gitignore</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-42"><a href="Sysroot#Miscellaneous"><span class="tocnumber">11.3</span> <span class="toctext">Miscellaneous</span></a>
<ul>
<li class="toclevel-3 tocsection-43"><a href="Sysroot#build.sh"><span class="tocnumber">11.3.1</span> <span class="toctext">build.sh</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="Sysroot#clean.sh"><span class="tocnumber">11.3.2</span> <span class="toctext">clean.sh</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="Sysroot#config.sh"><span class="tocnumber">11.3.3</span> <span class="toctext">config.sh</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="Sysroot#default-host.sh"><span class="tocnumber">11.3.4</span> <span class="toctext">default-host.sh</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="Sysroot#headers.sh"><span class="tocnumber">11.3.5</span> <span class="toctext">headers.sh</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="Sysroot#iso.sh"><span class="tocnumber">11.3.6</span> <span class="toctext">iso.sh</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="Sysroot#qemu.sh"><span class="tocnumber">11.3.7</span> <span class="toctext">qemu.sh</span></a></li>
<li class="toclevel-3 tocsection-50"><a href="Sysroot#target-triplet-to-arch.sh"><span class="tocnumber">11.3.8</span> <span class="toctext">target-triplet-to-arch.sh</span></a></li>
<li class="toclevel-3 tocsection-51"><a href="Sysroot#.gitignore"><span class="tocnumber">11.3.9</span> <span class="toctext">.gitignore</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-52"><a href="Sysroot#Cross-Compiling_the_Operating_System"><span class="tocnumber">12</span> <span class="toctext">Cross-Compiling the Operating System</span></a></li>
<li class="toclevel-1 tocsection-53"><a href="Sysroot#Troubleshooting"><span class="tocnumber">13</span> <span class="toctext">Troubleshooting</span></a></li>
<li class="toclevel-1 tocsection-54"><a href="Sysroot#Moving_Forward"><span class="tocnumber">14</span> <span class="toctext">Moving Forward</span></a>
<ul>
<li class="toclevel-2 tocsection-55"><a href="Sysroot#Renaming_MyOS_to_YourOS"><span class="tocnumber">14.1</span> <span class="toctext">Renaming MyOS to YourOS</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="Sysroot#Improving_the_Build_System"><span class="tocnumber">14.2</span> <span class="toctext">Improving the Build System</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="Sysroot#Stack_Smash_Protector"><span class="tocnumber">14.3</span> <span class="toctext">Stack Smash Protector</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="Sysroot#Going_Further"><span class="tocnumber">14.4</span> <span class="toctext">Going Further</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="Sysroot#User-Space"><span class="tocnumber">14.5</span> <span class="toctext">User-Space</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-60"><a href="Sysroot#Forum_Posts"><span class="tocnumber">15</span> <span class="toctext">Forum Posts</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Preface">Preface</span></h2>
<p>This tutorial is an example on how you could structure your operating system in
a manner that will continue to serve you well for the foreseeable future. This
serves as both inspiration and as an example for those that wish to something
different, while as a base for the rest. The tutorial does embed a few important
concepts into your operating system such as the existence of a libc, as well as
indirectly other minor Unix and ABI semantics. Adapt what you wish from this
tutorial. Note that the shell script and Make-based build system constructed in
this tutorial is meant for Unix systems. There
is no pressing need to make this portable across all operating systems as this
is just an example.
</p><p>We will name this new example operating system <tt>myos</tt>. This is just a
placeholder and you should replace all occurrences of <tt>myos</tt> with what you
decide to call your operating system.
</p>
<h2><span class="mw-headline" id="Bare_Bones">Bare Bones</span></h2>
<dl><dd><i>Main article:</i> <a href="Bare_Bones" title="Bare Bones">Bare Bones</a></dd></dl>
<p>You are expected to have completed the <a href="Bare_Bones" title="Bare Bones">Bare Bones</a> tutorial before continuing
to this tutorial. It is not strictly neccesary to have completed <a href="Bare_Bones" title="Bare Bones">Bare Bones</a>,
but doing so confirms that your development environment works as well as
explaining a number of core things.
</p><p>You should probably discard the code you got from toying around with
<a href="Bare_Bones" title="Bare Bones">Bare Bones</a> and start over with this tutorial as your basis.
</p>
<h2><span class="mw-headline" id="Building_a_Cross-Compiler">Building a Cross-Compiler</span></h2>
<dl><dd><i>Main article: <a href="GCC_Cross-Compiler" title="GCC Cross-Compiler">GCC Cross-Compiler</a>, <a href="Why_do_I_need_a_Cross_Compiler?" title="Why do I need a Cross Compiler?">Why do I need a Cross Compiler?</a></i></dd></dl>
<p>You <i>must</i> use a <a href="GCC_Cross-Compiler" title="GCC Cross-Compiler">GCC Cross-Compiler</a> in this tutorial as in the
<a href="Bare_Bones" title="Bare Bones">Bare Bones</a> tutorial. You should use the <b>i686-elf</b> target in your
cross-compiler, though any <tt>ix86-elf</tt> target (but no less than i386) will
do fine for our purposes here.
</p><p>You <i>must</i> configure your cross-binutils with the <tt>--with-sysroot</tt> option, otherwise linking will mysteriously fail with the <i>this linker was not configured to use sysroots</i> error message. If you forgot to configure your cross-binutils with that option, you'll have to rebuild it, but you can keep your cross-gcc.
</p>
<h2><span class="mw-headline" id="Dependencies">Dependencies</span></h2>
<p>You will need these dependencies in order to complete this tutorial:
</p>
<ul><li>i686-elf toolchain, as discussed above.</li>
<li>GRUB, for the grub-mkrescue command, along with the appropriate runtime files.</li>
<li>Xorriso, the .iso creation engine used by grub-mkrescue.</li>
<li>GNU make 4.0 or later.</li>
<li>Qemu, optionally for testing the operating system.</li></ul>
<p>This tutorial requires a GNU/Linux system, or a similar enough system. The BSD systems may almost work. OS X is not supported but can possibly be made to work with some changes. Windows is not supported, but Windows environments like Cygwin and Windows Subsystem For Linux (WSL) might work.
</p>
<h3><span class="mw-headline" id="Debian-family_Users">Debian-family Users</span></h3>
<p>Install the i686-elf toolchain as described above and then install the packages <tt>xorriso grub-pc-bin</tt>.
</p>
<h2><span class="mw-headline" id="System_Root">System Root</span></h2>
<p>Normally when you compile programs for your local operating system, the compiler locates development files such as headers and libraries in system directories such as:
</p>
<dl><dd><tt>/usr/include</tt></dd>
<dd><tt>/usr/lib</tt></dd></dl>
<p>These files are of course not usable for your operating system. Instead you want to have your own version of these directories that contains files for your operating system:
</p>
<dl><dd><tt>/home/bwayne/myos/sysroot/usr/include</tt></dd>
<dd><tt>/home/bwayne/myos/sysroot/usr/lib</tt></dd></dl>
<p>The <tt>/home/bwayne/myos/sysroot</tt> directory acts as a fake root directory for your operating system. This is called a system root, or <i>sysroot</i>.
</p><p>You can think of the sysroot as the root directory for your operating system. Your build process will build each component of your operating system (kernel, standard library, programs) and gradually install them into the system root. Ultimately the system root will be a fully functional root filesystem for your operating system, you format a partition and copy the files there, add the appropriate configuration files, configure a bootloader to load the kernel from there, and use your harddisk driver and filesystem driver to read the files from there. The system root is thus a temporary directory that will ultimately become the actual root directory of your operating system.
</p><p>In this example the cross system root is located as <tt>sysroot/</tt>, which is
a directory created by the build scripts and populated by the
<tt>make install</tt> targets. The makefiles will install the system headers
into the <tt>sysroot/usr/include</tt> directory, the system libraries into the
<tt>sysroot/usr/lib</tt> directory and the kernel itself into the
<tt>sysroot/boot</tt> directory.
</p><p>We already use system roots because it will make it smoother to add a user-space when you get that far. This scheme is very convenient when you later <a href="Cross-Porting_Software" title="Cross-Porting Software">Port Third-Party Software by Cross-Compiling It</a>.
</p><p>The <tt>-elf</tt> targets have no user-space and are incapable of having one. We configured the compiler with system root support, so it will look in <tt>${SYSROOT}/usr/lib</tt> as expected. We prevented the compiler from searching for a standard library using the --without-headers option when building <tt>i686-elf-gcc</tt>, so it will <i>not</i> look in <tt>${SYSROOT}/usr/include</tt>. (Once you add a user-space and a libc, you will configure your custom cross-gcc with <tt>--with-sysroot</tt> and it will look in <tt>${SYSROOT}/usr/include</tt>. As a temporary work-around until you get that far, we fix it by passing <tt>-isystem=/usr/include</tt>).
</p><p>You can change the system root directory layout if you wish, but you will have to modify some Binutils and GCC source code and tell them <a href="OS_Specific_Toolchain" title="OS Specific Toolchain">what your operating system is</a>. This is advanced and not worth doing until you add a proper user-space. Note that the cross-linker currently looks in <tt>/lib</tt>, <tt>/usr/lib</tt> and <tt>/usr/local/lib</tt> by default, so you can move files there without changing Binutils. Also note that we use the <tt>-isystem</tt> option for GCC (as it was configured without a system include directory), so you can move that around freely.
</p>
<h2><span class="mw-headline" id="System_Headers">System Headers</span></h2>
<p>The <tt>./headers.sh</tt> script simply installs the headers for your libc and
kernel (system headers) into <tt>sysroot/usr/include</tt>, but doesn't actually
cross-compile your operating system. This is <tt>useful</tt> as it allows you to
provide the compiler a copy of your headers before you actually compile your
system. You will <a href="Hosted_GCC_Cross-Compiler#Sysroot_Headers" title="Hosted GCC Cross-Compiler">need to provide the
standard library headers</a> when you build a <a href="Hosted_GCC_Cross-Compiler" title="Hosted GCC Cross-Compiler">Hosted GCC Cross-Compiler</a> in the 
future that is capable of an user-space.
</p><p>Note how your cross-compiler comes with a number of fully freestanding headers
such as <tt>stddef.h</tt> and <tt>stdint.h</tt>. These headers simply declare
types and macros that are useful. Your kernel standard library will supply a
number of useful functions (such as <tt>strlen</tt>) that doesn't require system
calls and are freestanding except they need an implementation somewhere.
</p>
<h2><span class="mw-headline" id="Makefile_Design">Makefile Design</span></h2>
<p>The makefiles in this example respect the environment variables (such as
<tt>CFLAGS</tt> that tell what default compile options are used to compile C
programs). This lets the user control stuff such as which optimization levels
are used, while a default is used if the user has no opinion. The makefiles also
make sure that particular options are always in CFLAGS. This is done by having
two phases in the makefiles: one that sets a default value and one that adds
mandatory options the project makefile requires:
</p>
<div class="mw-highlight mw-highlight-lang-make mw-content-ltr" dir="ltr"><pre><span></span><span class="c"># Default CFLAGS:</span>
<span class="nv">CFLAGS</span><span class="o">?=</span>-O2 -g

<span class="c"># Add mandatory options to CFLAGS:</span>
<span class="nv">CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span> -Wall -Wextra
</pre></div>
<h2><span class="mw-headline" id="Architecture_Directories">Architecture Directories</span></h2>
<p>The projects in this example (libc and kernel) store all the architecture
dependent source files inside an <tt>arch/</tt> directory with their own
sub-makefile that has special configuration. This cleanly separates the systems
you support and will make it easier to port to other systems in the future.
</p>
<h2><span class="mw-headline" id="Kernel_Design">Kernel Design</span></h2>
<p>We have moved the kernel into its own directory named <tt>kernel/</tt>. It would
perhaps be better to call it something else if your kernel has another name than
your full operating system distribution, though calling it <tt>kernel/</tt>
makes it easier for other hobbyist developers to find the core parts of your new
operating system.
</p><p>The kernel installs its public kernel headers into
<tt>sysroot/usr/include/kernel</tt>. This is useful if you decide to create a
kernel with modules, where modules can then simply include the public headers
from the main kernel.
</p><p>GNU GRUB is used as the bootloader and the kernel uses Multiboot as in the
<a href="Bare_Bones" title="Bare Bones">Bare Bones</a> tutorial.
</p><p>The kernel implements the correct way of <a href="Calling_Global_Constructors" title="Calling Global Constructors">invoking
global constructors</a> (useful for C++ code and C code using
<tt>__attribute__((constructor))</tt>. The bootstrap assembly calls <tt>_init</tt>
which invokes all the global constructors. These are invoked very early in the
boot without any specific ordering. You should only use them to initialize
global variables that could not be initialized at runtime.
</p><p>The special <tt>__is_kernel</tt> macro lets the source code detect whether
it is part of the kernel.
</p>
<h2><span class="mw-headline" id="libc_and_libk_Design">libc and libk Design</span></h2>
<p>The libc and libk are actually two versions of the same library, which is stored
in the directory <tt>libc/</tt>. The standard library is split into two
versions: freestanding and hosted. The difference is that the freestanding
library (libk) doesn't contain any of the code that only works in user-space,
such as system calls. The libk is also built with different compiler options,
just like the kernel isn't built like normal user-space code.
</p><p>You are not required to have a libk. You could just as easily have a regular
libc and a fully seperate minimal project inside the kernel directory. The libk
scheme avoids code duplication, so you don't have to maintain multiple versions
of <tt>strlen</tt> and such.
</p><p>This example doesn't come with a usable libc. It compiles a libc.a that is
entirely useless, except being a skeleton we can build on when we add user-space
in a later tutorial.
</p><p>Each standard function is put inside a file with the same name as the function
inside a directory with the name of the header. For instance, <tt>strlen</tt>
from <tt>string.h</tt> is in <tt>libc/string/strlen.c</tt> and <tt>stat</tt>
from <tt>sys/stat.h</tt> would be in <tt>libc/sys/stat/stat.c</tt>.
</p><p>The standard headers use a BSD-like scheme where <tt>sys/cdefs.h</tt> declares
a bunch of useful preprocessor macros meant for internal use by the standard
library. All the function prototypes are wrapped in
<tt>extern "C" {</tt> and <tt>}</tt> such that C++ code can correctly
link against libc (as libc doesn't use C++ linkage). Note also how the compiler
provides the internal keyword __restrict unconditionally (even in C89) mode,
which is useful for adding the restrict keyword to function prototypes even when
compiling code in pre-C99 or C++ mode.
</p><p>The special <tt>__is_libc</tt> macro lets the source code detect whether
it is part of the libc and <tt>__is_libk</tt> lets the source code detect
whether it's part of the libk binary.
</p><p>This example comes with a small number of standard functions that serve as
examples and serve to satisfy ABI requirements. Note that the <tt>printf</tt>
function included is very minimal and intentionally doesn't handle most common
features.
</p>
<h2><span class="mw-headline" id="Source_Code">Source Code</span></h2>
<p>You can easily download the source code using <a href="Git" title="Git">Git</a> from the <a rel="nofollow" class="external text" href="https://gitlab.com/sortie/meaty-skeleton">Meaty Skeleton Git repository</a>. This is preferable to doing a manual error-prone copy, as you may make a mistake or whitespace may get garbled due to bugs in our syntax highlighting. To clone the git repository, do:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>git clone https://gitlab.com/sortie/meaty-skeleton.git
</pre></div>
<p>Check for differences between the git revision used in this article and what you cloned (empty output means there is no difference):
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>git diff 084d1624bedaa9f9e395f055c6bd99299bd97f58..master
</pre></div>
<p>Operating systems development is about being an expert. Take the time to read the code carefully through and understand it. Please seek further information and help if you don't understand aspects of it. This code is minimal and almost everything is done deliberately, often to pre-emptively solve future problems.
</p>
<h3><span class="mw-headline" id="kernel">kernel</span></h3>
<h4><span id="kernel.2Finclude.2Fkernel.2Ftty.h"></span><span class="mw-headline" id="kernel/include/kernel/tty.h">kernel/include/kernel/tty.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef _KERNEL_TTY_H</span>
<span class="cp">#define _KERNEL_TTY_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_putchar</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_write</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_writestring</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="kernel.2FMakefile"></span><span class="mw-headline" id="kernel/Makefile">kernel/Makefile</span></h4>
<div class="mw-highlight mw-highlight-lang-make mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">DEFAULT_HOST</span><span class="o">!=</span>../default-host.sh
<span class="nv">HOST</span><span class="o">?=</span>DEFAULT_HOST
<span class="nv">HOSTARCH</span><span class="o">!=</span>../target-triplet-to-arch.sh <span class="k">$(</span>HOST<span class="k">)</span>

<span class="nv">CFLAGS</span><span class="o">?=</span>-O2 -g
<span class="nv">CPPFLAGS</span><span class="o">?=</span>
<span class="nv">LDFLAGS</span><span class="o">?=</span>
<span class="nv">LIBS</span><span class="o">?=</span>

<span class="nv">DESTDIR</span><span class="o">?=</span>
<span class="nv">PREFIX</span><span class="o">?=</span>/usr/local
<span class="nv">EXEC_PREFIX</span><span class="o">?=</span><span class="k">$(</span>PREFIX<span class="k">)</span>
<span class="nv">BOOTDIR</span><span class="o">?=</span><span class="k">$(</span>EXEC_PREFIX<span class="k">)</span>/boot
<span class="nv">INCLUDEDIR</span><span class="o">?=</span><span class="k">$(</span>PREFIX<span class="k">)</span>/include

<span class="nv">CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span> -ffreestanding -Wall -Wextra
<span class="nv">CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>CPPFLAGS<span class="k">)</span> -D__is_kernel -Iinclude
<span class="nv">LDFLAGS</span><span class="o">:=</span><span class="k">$(</span>LDFLAGS<span class="k">)</span>
<span class="nv">LIBS</span><span class="o">:=</span><span class="k">$(</span>LIBS<span class="k">)</span> -nostdlib -lk -lgcc

<span class="nv">ARCHDIR</span><span class="o">=</span>arch/<span class="k">$(</span>HOSTARCH<span class="k">)</span>

<span class="cp">include $(ARCHDIR)/make.config</span>

<span class="nv">CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_CFLAGS<span class="k">)</span>
<span class="nv">CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>CPPFLAGS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_CPPFLAGS<span class="k">)</span>
<span class="nv">LDFLAGS</span><span class="o">:=</span><span class="k">$(</span>LDFLAGS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_LDFLAGS<span class="k">)</span>
<span class="nv">LIBS</span><span class="o">:=</span><span class="k">$(</span>LIBS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_LIBS<span class="k">)</span>

<span class="nv">KERNEL_OBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>KERNEL_ARCH_OBJS<span class="k">)</span> <span class="se">\</span>
kernel/kernel.o <span class="se">\</span>

<span class="nv">OBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crti.o <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtbegin.o <span class="se">\</span>
<span class="k">$(</span>KERNEL_OBJS<span class="k">)</span> <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtend.o <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtn.o <span class="se">\</span>

<span class="nv">LINK_LIST</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>LDFLAGS<span class="k">)</span> <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crti.o <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtbegin.o <span class="se">\</span>
<span class="k">$(</span>KERNEL_OBJS<span class="k">)</span> <span class="se">\</span>
<span class="k">$(</span>LIBS<span class="k">)</span> <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtend.o <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/crtn.o <span class="se">\</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span> <span class="n">install</span> <span class="n">install</span>-<span class="n">headers</span> <span class="n">install</span>-<span class="n">kernel</span>
<span class="nf">.SUFFIXES</span><span class="o">:</span> .<span class="n">o</span> .<span class="n">c</span> .<span class="n">S</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">myos</span>.<span class="n">kernel</span>

<span class="nf">myos.kernel</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span> <span class="k">$(</span><span class="nv">ARCHDIR</span><span class="k">)</span>/<span class="n">linker</span>.<span class="n">ld</span>
	<span class="k">$(</span>CC<span class="k">)</span> -T <span class="k">$(</span>ARCHDIR<span class="k">)</span>/linker.ld -o <span class="nv">$@</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>LINK_LIST<span class="k">)</span>
	grub-file --is-x86-multiboot myos.kernel

<span class="nf">$(ARCHDIR)/crtbegin.o $(ARCHDIR)/crtend.o</span><span class="o">:</span>
	<span class="nv">OBJ</span><span class="o">=</span><span class="sb">`</span><span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> -print-file-name<span class="o">=</span><span class="k">$(</span>@F<span class="k">)</span><span class="sb">`</span> <span class="o">&amp;&amp;</span> cp <span class="s2">&quot;</span><span class="nv">$$</span><span class="s2">OBJ&quot;</span> <span class="nv">$@</span>

<span class="nf">.c.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> -std<span class="o">=</span>gnu11 <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>CPPFLAGS<span class="k">)</span>

<span class="nf">.S.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>CPPFLAGS<span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
	rm -f myos.kernel
	rm -f <span class="k">$(</span>OBJS<span class="k">)</span> *.o */*.o */*/*.o
	rm -f <span class="k">$(</span>OBJS:.o<span class="o">=</span>.d<span class="k">)</span> *.d */*.d */*/*.d

<span class="nf">install</span><span class="o">:</span> <span class="n">install</span>-<span class="n">headers</span> <span class="n">install</span>-<span class="n">kernel</span>

<span class="nf">install-headers</span><span class="o">:</span>
	mkdir -p <span class="k">$(</span>DESTDIR<span class="k">)$(</span>INCLUDEDIR<span class="k">)</span>
	cp -R --preserve<span class="o">=</span>timestamps include/. <span class="k">$(</span>DESTDIR<span class="k">)$(</span>INCLUDEDIR<span class="k">)</span>/.

<span class="nf">install-kernel</span><span class="o">:</span> <span class="n">myos</span>.<span class="n">kernel</span>
	mkdir -p <span class="k">$(</span>DESTDIR<span class="k">)$(</span>BOOTDIR<span class="k">)</span>
	cp myos.kernel <span class="k">$(</span>DESTDIR<span class="k">)$(</span>BOOTDIR<span class="k">)</span>

<span class="cp">-include $(OBJS:.o=.d)</span>
</pre></div>
<h4><span id="kernel.2Fkernel.2Fkernel.c"></span><span class="mw-headline" id="kernel/kernel/kernel.c">kernel/kernel/kernel.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;kernel/tty.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">kernel_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_initialize</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, kernel World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="kernel.2Farch.2Fi386.2Ftty.c"></span><span class="mw-headline" id="kernel/arch/i386/tty.c">kernel/arch/i386/tty.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;kernel/tty.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vga.h&quot;</span><span class="cp"></span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">VGA_HEIGHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">uint16_t</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">VGA_MEMORY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="mh">0xB8000</span><span class="p">;</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">terminal_row</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">terminal_column</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">terminal_color</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">uint16_t</span><span class="o">*</span><span class="w"> </span><span class="n">terminal_buffer</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vga_entry_color</span><span class="p">(</span><span class="n">VGA_COLOR_LIGHT_GREY</span><span class="p">,</span><span class="w"> </span><span class="n">VGA_COLOR_BLACK</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VGA_MEMORY</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">VGA_HEIGHT</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">terminal_buffer</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vga_entry</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">terminal_color</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_setcolor</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_putentryat</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_buffer</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vga_entry</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_scroll</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">line</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="k">for</span><span class="p">(</span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0xB8000</span><span class="p">;</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">loop</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">loop</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="o">*</span><span class="p">(</span><span class="n">loop</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_delete_last_line</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="k">for</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xB8000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">VGA_WIDTH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">VGA_HEIGHT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_putchar</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">line</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">uc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="n">terminal_putentryat</span><span class="p">(</span><span class="n">uc</span><span class="p">,</span><span class="w"> </span><span class="n">terminal_color</span><span class="p">,</span><span class="w"> </span><span class="n">terminal_column</span><span class="p">,</span><span class="w"> </span><span class="n">terminal_row</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">terminal_column</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">VGA_WIDTH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">terminal_column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">terminal_row</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">VGA_HEIGHT</span><span class="p">)</span><span class="w"></span>
<span class="w">		</span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">VGA_HEIGHT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">line</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">terminal_scroll</span><span class="p">(</span><span class="n">line</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">terminal_delete_last_line</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">terminal_row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VGA_HEIGHT</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_write</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">		</span><span class="n">terminal_putchar</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">terminal_writestring</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="kernel.2Farch.2Fi386.2Fcrtn.S"></span><span class="mw-headline" id="kernel/arch/i386/crtn.S">kernel/arch/i386/crtn.S</span></h4>
<pre>.section .init
	/* gcc will nicely put the contents of crtend.o's .init section here. */
	popl %ebp
	ret

.section .fini
	/* gcc will nicely put the contents of crtend.o's .fini section here. */
	popl %ebp
	ret
</pre>
<h4><span id="kernel.2Farch.2Fi386.2Fvga.h"></span><span class="mw-headline" id="kernel/arch/i386/vga.h">kernel/arch/i386/vga.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef ARCH_I386_VGA_H</span>
<span class="cp">#define ARCH_I386_VGA_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span><span class="cp"></span>

<span class="k">enum</span><span class="w"> </span><span class="n">vga_color</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_BLACK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_BLUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_GREEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_CYAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_RED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_MAGENTA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_BROWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_GREY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_DARK_GREY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_BLUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_GREEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_CYAN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_RED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_MAGENTA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_LIGHT_BROWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"></span>
<span class="w">	</span><span class="n">VGA_COLOR_WHITE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">vga_entry_color</span><span class="p">(</span><span class="k">enum</span><span class="w"> </span><span class="n">vga_color</span><span class="w"> </span><span class="n">fg</span><span class="p">,</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">vga_color</span><span class="w"> </span><span class="n">bg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">fg</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">bg</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="nf">vga_entry</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">uc</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="n">uc</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="kernel.2Farch.2Fi386.2Fmake.config"></span><span class="mw-headline" id="kernel/arch/i386/make.config">kernel/arch/i386/make.config</span></h4>
<div class="mw-highlight mw-highlight-lang-make mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">KERNEL_ARCH_CFLAGS</span><span class="o">=</span>
<span class="nv">KERNEL_ARCH_CPPFLAGS</span><span class="o">=</span>
<span class="nv">KERNEL_ARCH_LDFLAGS</span><span class="o">=</span>
<span class="nv">KERNEL_ARCH_LIBS</span><span class="o">=</span>

<span class="nv">KERNEL_ARCH_OBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/boot.o <span class="se">\</span>
<span class="k">$(</span>ARCHDIR<span class="k">)</span>/tty.o <span class="se">\</span>
</pre></div>
<h4><span id="kernel.2Farch.2Fi386.2Fcrti.S"></span><span class="mw-headline" id="kernel/arch/i386/crti.S">kernel/arch/i386/crti.S</span></h4>
<pre>.section .init
.global _init
.type _init, @function
_init:
	push %ebp
	movl %esp, %ebp
	/* gcc will nicely put the contents of crtbegin.o's .init section here. */

.section .fini
.global _fini
.type _fini, @function
_fini:
	push %ebp
	movl %esp, %ebp
	/* gcc will nicely put the contents of crtbegin.o's .fini section here. */
</pre>
<h4><span id="kernel.2Farch.2Fi386.2Flinker.ld"></span><span class="mw-headline" id="kernel/arch/i386/linker.ld">kernel/arch/i386/linker.ld</span></h4>
<pre>/* The bootloader will look at this image and start execution at the symbol
   designated at the entry point. */
ENTRY(_start)

/* Tell where the various sections of the object files will be put in the final
   kernel image. */
SECTIONS
{
	/* Begin putting sections at 1 MiB, a conventional place for kernels to be
	   loaded at by the bootloader. */
	. = 1M;

	/* First put the multiboot header, as it is required to be put very early
	   early in the image or the bootloader won't recognize the file format.
	   Next we'll put the .text section. */
	.text BLOCK(4K)&#160;: ALIGN(4K)
	{
		*(.multiboot)
		*(.text)
	}

	/* Read-only data. */
	.rodata BLOCK(4K)&#160;: ALIGN(4K)
	{
		*(.rodata)
	}

	/* Read-write data (initialized) */
	.data BLOCK(4K)&#160;: ALIGN(4K)
	{
		*(.data)
	}

	/* Read-write data (uninitialized) and stack */
	.bss BLOCK(4K)&#160;: ALIGN(4K)
	{
		*(COMMON)
		*(.bss)
	}

	/* The compiler may produce other sections, put them in the proper place in
	   in this file, if you'd like to include them in the final kernel. */
}
</pre>
<h4><span id="kernel.2Farch.2Fi386.2Fboot.S"></span><span class="mw-headline" id="kernel/arch/i386/boot.S">kernel/arch/i386/boot.S</span></h4>
<pre># Declare constants for the multiboot header.
.set ALIGN,    1&lt;&lt;0             # align loaded modules on page boundaries
.set MEMINFO,  1&lt;&lt;1             # provide memory map
.set FLAGS,    ALIGN | MEMINFO  # this is the Multiboot 'flag' field
.set MAGIC,    0x1BADB002       # 'magic number' lets bootloader find the header
.set CHECKSUM, -(MAGIC + FLAGS) # checksum of above, to prove we are multiboot

# Declare a header as in the Multiboot Standard.
.section .multiboot
.align 4
.long MAGIC
.long FLAGS
.long CHECKSUM

# Reserve a stack for the initial thread.
.section .bss
.align 16
stack_bottom:
.skip 16384 # 16 KiB
stack_top:

# The kernel entry point.
.section .text
.global _start
.type _start, @function
_start:
	movl $stack_top, %esp

	# Call the global constructors.
	call _init

	# Transfer control to the main kernel.
	call kernel_main

	# Hang if kernel_main unexpectedly returns.
	cli
1:	hlt
	jmp 1b
.size _start, . - _start
</pre>
<h4><span id="kernel.2F.gitignore"></span><span class="mw-headline" id="kernel/.gitignore">kernel/.gitignore</span></h4>
<pre>*.d
*.kernel
*.o
</pre>
<h3><span class="mw-headline" id="libc_and_libk">libc and libk</span></h3>
<h4><span id="libc.2Finclude.2Fstring.h"></span><span class="mw-headline" id="libc/include/string.h">libc/include/string.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef _STRING_H</span>
<span class="cp">#define _STRING_H 1</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/cdefs.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>

<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">memcmp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memcpy</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">__restrict</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">__restrict</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memmove</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memset</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">);</span><span class="w"></span>
<span class="kt">size_t</span><span class="w"> </span><span class="nf">strlen</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">);</span><span class="w"></span>

<span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="libc.2Finclude.2Fstdio.h"></span><span class="mw-headline" id="libc/include/stdio.h">libc/include/stdio.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef _STDIO_H</span>
<span class="cp">#define _STDIO_H 1</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/cdefs.h&gt;</span><span class="cp"></span>

<span class="cp">#define EOF (-1)</span>

<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">printf</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">__restrict</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">putchar</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">puts</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">);</span><span class="w"></span>

<span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="libc.2Finclude.2Fsys.2Fcdefs.h"></span><span class="mw-headline" id="libc/include/sys/cdefs.h">libc/include/sys/cdefs.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef _SYS_CDEFS_H</span>
<span class="cp">#define _SYS_CDEFS_H 1</span>

<span class="cp">#define __myos_libc 1</span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="libc.2Finclude.2Fstdlib.h"></span><span class="mw-headline" id="libc/include/stdlib.h">libc/include/stdlib.h</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#ifndef _STDLIB_H</span>
<span class="cp">#define _STDLIB_H 1</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/cdefs.h&gt;</span><span class="cp"></span>

<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">__noreturn__</span><span class="p">))</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">abort</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>

<span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>
</pre></div>
<h4><span id="libc.2FMakefile"></span><span class="mw-headline" id="libc/Makefile">libc/Makefile</span></h4>
<div class="mw-highlight mw-highlight-lang-make mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">DEFAULT_HOST</span><span class="o">!=</span>../default-host.sh
<span class="nv">HOST</span><span class="o">?=</span>DEFAULT_HOST
<span class="nv">HOSTARCH</span><span class="o">!=</span>../target-triplet-to-arch.sh <span class="k">$(</span>HOST<span class="k">)</span>

<span class="nv">CFLAGS</span><span class="o">?=</span>-O2 -g
<span class="nv">CPPFLAGS</span><span class="o">?=</span>
<span class="nv">LDFLAGS</span><span class="o">?=</span>
<span class="nv">LIBS</span><span class="o">?=</span>

<span class="nv">DESTDIR</span><span class="o">?=</span>
<span class="nv">PREFIX</span><span class="o">?=</span>/usr/local
<span class="nv">EXEC_PREFIX</span><span class="o">?=</span><span class="k">$(</span>PREFIX<span class="k">)</span>
<span class="nv">INCLUDEDIR</span><span class="o">?=</span><span class="k">$(</span>PREFIX<span class="k">)</span>/include
<span class="nv">LIBDIR</span><span class="o">?=</span><span class="k">$(</span>EXEC_PREFIX<span class="k">)</span>/lib

<span class="nv">CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span> -ffreestanding -Wall -Wextra
<span class="nv">CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>CPPFLAGS<span class="k">)</span> -D__is_libc -Iinclude
<span class="nv">LIBK_CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span>
<span class="nv">LIBK_CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>CPPFLAGS<span class="k">)</span> -D__is_libk

<span class="nv">ARCHDIR</span><span class="o">=</span>arch/<span class="k">$(</span>HOSTARCH<span class="k">)</span>

<span class="cp">include $(ARCHDIR)/make.config</span>

<span class="nv">CFLAGS</span><span class="o">:=</span><span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>ARCH_CFLAGS<span class="k">)</span>
<span class="nv">CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>CPPFLAGS<span class="k">)</span> <span class="k">$(</span>ARCH_CPPFLAGS<span class="k">)</span>
<span class="nv">LIBK_CFLAGS</span><span class="o">:=</span><span class="k">$(</span>LIBK_CFLAGS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_CFLAGS<span class="k">)</span>
<span class="nv">LIBK_CPPFLAGS</span><span class="o">:=</span><span class="k">$(</span>LIBK_CPPFLAGS<span class="k">)</span> <span class="k">$(</span>KERNEL_ARCH_CPPFLAGS<span class="k">)</span>

<span class="nv">FREEOBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>ARCH_FREEOBJS<span class="k">)</span> <span class="se">\</span>
stdio/printf.o <span class="se">\</span>
stdio/putchar.o <span class="se">\</span>
stdio/puts.o <span class="se">\</span>
stdlib/abort.o <span class="se">\</span>
string/memcmp.o <span class="se">\</span>
string/memcpy.o <span class="se">\</span>
string/memmove.o <span class="se">\</span>
string/memset.o <span class="se">\</span>
string/strlen.o <span class="se">\</span>

<span class="nv">HOSTEDOBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>ARCH_HOSTEDOBJS<span class="k">)</span> <span class="se">\</span>

<span class="nv">OBJS</span><span class="o">=</span><span class="se">\</span>
<span class="k">$(</span>FREEOBJS<span class="k">)</span> <span class="se">\</span>
<span class="k">$(</span>HOSTEDOBJS<span class="k">)</span> <span class="se">\</span>

<span class="nv">LIBK_OBJS</span><span class="o">=</span><span class="k">$(</span>FREEOBJS:.o<span class="o">=</span>.libk.o<span class="k">)</span>

<span class="c">#BINARIES=libc.a libk.a # Not ready for libc yet.</span>
<span class="nv">BINARIES</span><span class="o">=</span>libk.a

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span> <span class="n">install</span> <span class="n">install</span>-<span class="n">headers</span> <span class="n">install</span>-<span class="n">libs</span>
<span class="nf">.SUFFIXES</span><span class="o">:</span> .<span class="n">o</span> .<span class="n">libk</span>.<span class="n">o</span> .<span class="n">c</span> .<span class="n">S</span>

<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BINARIES</span><span class="k">)</span>

<span class="nf">libc.a</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
	<span class="k">$(</span>AR<span class="k">)</span> rcs <span class="nv">$@</span> <span class="k">$(</span>OBJS<span class="k">)</span>

<span class="nf">libk.a</span><span class="o">:</span> <span class="k">$(</span><span class="nv">LIBK_OBJS</span><span class="k">)</span>
	<span class="k">$(</span>AR<span class="k">)</span> rcs <span class="nv">$@</span> <span class="k">$(</span>LIBK_OBJS<span class="k">)</span>

<span class="nf">.c.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> -std<span class="o">=</span>gnu11 <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>CPPFLAGS<span class="k">)</span>

<span class="nf">.S.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>CPPFLAGS<span class="k">)</span>

<span class="nf">.c.libk.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> -std<span class="o">=</span>gnu11 <span class="k">$(</span>LIBK_CFLAGS<span class="k">)</span> <span class="k">$(</span>LIBK_CPPFLAGS<span class="k">)</span>

<span class="nf">.S.libk.o</span><span class="o">:</span>
	<span class="k">$(</span>CC<span class="k">)</span> -MD -c $&lt; -o <span class="nv">$@</span> <span class="k">$(</span>LIBK_CFLAGS<span class="k">)</span> <span class="k">$(</span>LIBK_CPPFLAGS<span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
	rm -f <span class="k">$(</span>BINARIES<span class="k">)</span> *.a
	rm -f <span class="k">$(</span>OBJS<span class="k">)</span> <span class="k">$(</span>LIBK_OBJS<span class="k">)</span> *.o */*.o */*/*.o
	rm -f <span class="k">$(</span>OBJS:.o<span class="o">=</span>.d<span class="k">)</span> <span class="k">$(</span>LIBK_OBJS:.o<span class="o">=</span>.d<span class="k">)</span> *.d */*.d */*/*.d

<span class="nf">install</span><span class="o">:</span> <span class="n">install</span>-<span class="n">headers</span> <span class="n">install</span>-<span class="n">libs</span>

<span class="nf">install-headers</span><span class="o">:</span>
	mkdir -p <span class="k">$(</span>DESTDIR<span class="k">)$(</span>INCLUDEDIR<span class="k">)</span>
	cp -R --preserve<span class="o">=</span>timestamps include/. <span class="k">$(</span>DESTDIR<span class="k">)$(</span>INCLUDEDIR<span class="k">)</span>/.

<span class="nf">install-libs</span><span class="o">:</span> <span class="k">$(</span><span class="nv">BINARIES</span><span class="k">)</span>
	mkdir -p <span class="k">$(</span>DESTDIR<span class="k">)$(</span>LIBDIR<span class="k">)</span>
	cp <span class="k">$(</span>BINARIES<span class="k">)</span> <span class="k">$(</span>DESTDIR<span class="k">)$(</span>LIBDIR<span class="k">)</span>

<span class="cp">-include $(OBJS:.o=.d)</span>
<span class="cp">-include $(LIBK_OBJS:.o=.d)</span>
</pre></div>
<h4><span id="libc.2Fstdlib.2Fabort.c"></span><span class="mw-headline" id="libc/stdlib/abort.c">libc/stdlib/abort.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">__noreturn__</span><span class="p">))</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">abort</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="cp">#if defined(__is_libk)</span>
<span class="w">	</span><span class="c1">// TODO: Add proper kernel panic.</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;kernel: panic: abort()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">asm</span><span class="w"> </span><span class="k">volatile</span><span class="p">(</span><span class="s">&quot;hlt&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">	</span><span class="c1">// TODO: Abnormally terminate the process as if by SIGABRT.</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;abort()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="n">__builtin_unreachable</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstring.2Fmemmove.c"></span><span class="mw-headline" id="libc/string/memmove.c">libc/string/memmove.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memmove</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">dstptr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">srcptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">dstptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">srcptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dst</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dstptr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstring.2Fstrlen.c"></span><span class="mw-headline" id="libc/string/strlen.c">libc/string/strlen.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">size_t</span><span class="w"> </span><span class="nf">strlen</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">len</span><span class="p">])</span><span class="w"></span>
<span class="w">		</span><span class="n">len</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstring.2Fmemcmp.c"></span><span class="mw-headline" id="libc/string/memcmp.c">libc/string/memcmp.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">memcmp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">aptr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">bptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">aptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">bptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstring.2Fmemset.c"></span><span class="mw-headline" id="libc/string/memset.c">libc/string/memset.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memset</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">bufptr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">bufptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">		</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">bufptr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstring.2Fmemcpy.c"></span><span class="mw-headline" id="libc/string/memcpy.c">libc/string/memcpy.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">memcpy</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="kr">restrict</span><span class="w"> </span><span class="n">dstptr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="kr">restrict</span><span class="w"> </span><span class="n">srcptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">dstptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">srcptr</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">		</span><span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">dstptr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstdio.2Fputs.c"></span><span class="mw-headline" id="libc/stdio/puts.c">libc/stdio/puts.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">puts</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstdio.2Fputchar.c"></span><span class="mw-headline" id="libc/stdio/putchar.c">libc/stdio/putchar.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cp">#if defined(__is_libk)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;kernel/tty.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">putchar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="cp">#if defined(__is_libk)</span>
<span class="w">	</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">ic</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">terminal_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">	</span><span class="c1">// TODO: Implement stdio and the write system call.</span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">ic</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Fstdio.2Fprintf.c"></span><span class="mw-headline" id="libc/stdio/printf.c">libc/stdio/printf.c</span></h4>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdbool.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdarg.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">putchar</span><span class="p">(</span><span class="n">bytes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">printf</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="kr">restrict</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="kt">va_list</span><span class="w"> </span><span class="n">parameters</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">va_start</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">format</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxrem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">written</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;%&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;%&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;%&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="n">format</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">[</span><span class="n">amount</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">amount</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;%&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="n">amount</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxrem</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="c1">// TODO: Set errno to EOVERFLOW.</span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">))</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">format</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">written</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format_begun_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">format</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">va_arg</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="cm">/* char promotes to int */</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">maxrem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="c1">// TODO: Set errno to EOVERFLOW.</span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">written</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">format</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">va_arg</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxrem</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="c1">// TODO: Set errno to EOVERFLOW.</span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">))</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">written</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format_begun_at</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">format</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">maxrem</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="c1">// TODO: Set errno to EOVERFLOW.</span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">print</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">))</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">written</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">format</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">va_end</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">written</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<h4><span id="libc.2Farch.2Fi386.2Fmake.config"></span><span class="mw-headline" id="libc/arch/i386/make.config">libc/arch/i386/make.config</span></h4>
<div class="mw-highlight mw-highlight-lang-make mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">ARCH_CFLAGS</span><span class="o">=</span>
<span class="nv">ARCH_CPPFLAGS</span><span class="o">=</span>
<span class="nv">KERNEL_ARCH_CFLAGS</span><span class="o">=</span>
<span class="nv">KERNEL_ARCH_CPPFLAGS</span><span class="o">=</span>

<span class="nv">ARCH_FREEOBJS</span><span class="o">=</span><span class="se">\</span>

<span class="nv">ARCH_HOSTEDOBJS</span><span class="o">=</span><span class="se">\</span>
</pre></div>
<h4><span id="libc.2F.gitignore"></span><span class="mw-headline" id="libc/.gitignore">libc/.gitignore</span></h4>
<pre>*.a
*.d
*.o
</pre>
<h3><span class="mw-headline" id="Miscellaneous">Miscellaneous</span></h3>
<p>These files go into the root source directory.
</p>
<h4><span class="mw-headline" id="build.sh">build.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e
. ./headers.sh

<span class="k">for</span> PROJECT <span class="k">in</span> <span class="nv">$PROJECTS</span><span class="p">;</span> <span class="k">do</span>
  <span class="o">(</span><span class="nb">cd</span> <span class="nv">$PROJECT</span> <span class="o">&amp;&amp;</span> <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SYSROOT</span><span class="s2">&quot;</span> <span class="nv">$MAKE</span> install<span class="o">)</span>
<span class="k">done</span>
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x build.sh
</pre></div>
<h4><span class="mw-headline" id="clean.sh">clean.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e
. ./config.sh

<span class="k">for</span> PROJECT <span class="k">in</span> <span class="nv">$PROJECTS</span><span class="p">;</span> <span class="k">do</span>
  <span class="o">(</span><span class="nb">cd</span> <span class="nv">$PROJECT</span> <span class="o">&amp;&amp;</span> <span class="nv">$MAKE</span> clean<span class="o">)</span>
<span class="k">done</span>

rm -rf sysroot
rm -rf isodir
rm -rf myos.iso
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x clean.sh
</pre></div>
<h4><span class="mw-headline" id="config.sh">config.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="nv">SYSTEM_HEADER_PROJECTS</span><span class="o">=</span><span class="s2">&quot;libc kernel&quot;</span>
<span class="nv">PROJECTS</span><span class="o">=</span><span class="s2">&quot;libc kernel&quot;</span>

<span class="nb">export</span> <span class="nv">MAKE</span><span class="o">=</span><span class="si">${</span><span class="nv">MAKE</span><span class="k">:-</span><span class="nv">make</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">HOST</span><span class="o">=</span><span class="si">${</span><span class="nv">HOST</span><span class="k">:-$(</span>./default-host.sh<span class="k">)</span><span class="si">}</span>

<span class="nb">export</span> <span class="nv">AR</span><span class="o">=</span><span class="si">${</span><span class="nv">HOST</span><span class="si">}</span>-ar
<span class="nb">export</span> <span class="nv">AS</span><span class="o">=</span><span class="si">${</span><span class="nv">HOST</span><span class="si">}</span>-as
<span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span><span class="si">${</span><span class="nv">HOST</span><span class="si">}</span>-gcc

<span class="nb">export</span> <span class="nv">PREFIX</span><span class="o">=</span>/usr
<span class="nb">export</span> <span class="nv">EXEC_PREFIX</span><span class="o">=</span><span class="nv">$PREFIX</span>
<span class="nb">export</span> <span class="nv">BOOTDIR</span><span class="o">=</span>/boot
<span class="nb">export</span> <span class="nv">LIBDIR</span><span class="o">=</span><span class="nv">$EXEC_PREFIX</span>/lib
<span class="nb">export</span> <span class="nv">INCLUDEDIR</span><span class="o">=</span><span class="nv">$PREFIX</span>/include

<span class="nb">export</span> <span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-O2 -g&#39;</span>
<span class="nb">export</span> <span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

<span class="c1"># Configure the cross-compiler to use the desired system root.</span>
<span class="nb">export</span> <span class="nv">SYSROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/sysroot&quot;</span>
<span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CC</span><span class="s2"> --sysroot=</span><span class="nv">$SYSROOT</span><span class="s2">&quot;</span>

<span class="c1"># Work around that the -elf gcc targets doesn&#39;t have a system include directory</span>
<span class="c1"># because it was configured with --without-headers rather than --with-sysroot.</span>
<span class="k">if</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$HOST</span><span class="s2">&quot;</span> <span class="p">|</span> grep -Eq -- <span class="s1">&#39;-elf($|-)&#39;</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CC</span><span class="s2"> -isystem=</span><span class="nv">$INCLUDEDIR</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
<h4><span class="mw-headline" id="default-host.sh">default-host.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">echo</span> i686-elf
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x default-host.sh
</pre></div>
<h4><span class="mw-headline" id="headers.sh">headers.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e
. ./config.sh

mkdir -p <span class="s2">&quot;</span><span class="nv">$SYSROOT</span><span class="s2">&quot;</span>

<span class="k">for</span> PROJECT <span class="k">in</span> <span class="nv">$SYSTEM_HEADER_PROJECTS</span><span class="p">;</span> <span class="k">do</span>
  <span class="o">(</span><span class="nb">cd</span> <span class="nv">$PROJECT</span> <span class="o">&amp;&amp;</span> <span class="nv">DESTDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$SYSROOT</span><span class="s2">&quot;</span> <span class="nv">$MAKE</span> install-headers<span class="o">)</span>
<span class="k">done</span>
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x headers.sh
</pre></div>
<h4><span class="mw-headline" id="iso.sh">iso.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e
. ./build.sh

mkdir -p isodir
mkdir -p isodir/boot
mkdir -p isodir/boot/grub

cp sysroot/boot/myos.kernel isodir/boot/myos.kernel
cat &gt; isodir/boot/grub/grub.cfg <span class="s">&lt;&lt; EOF</span>
<span class="s">menuentry &quot;myos&quot; {</span>
<span class="s">	multiboot /boot/myos.kernel</span>
<span class="s">}</span>
<span class="s">EOF</span>
grub-mkrescue -o myos.iso isodir
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x iso.sh
</pre></div>
<h4><span class="mw-headline" id="qemu.sh">qemu.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e
. ./iso.sh

qemu-system-<span class="k">$(</span>./target-triplet-to-arch.sh <span class="nv">$HOST</span><span class="k">)</span> -cdrom myos.iso
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x qemu.sh
</pre></div>
<h4><span class="mw-headline" id="target-triplet-to-arch.sh">target-triplet-to-arch.sh</span></h4>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="k">if</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> grep -Eq <span class="s1">&#39;i[[:digit:]]86-&#39;</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> i386
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> grep -Eo <span class="s1">&#39;^[[:alnum:]_]*&#39;</span>
<span class="k">fi</span>
</pre></div>
<p>You should make this executable script executable by running:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>chmod +x target-triplet-to-arch.sh
</pre></div>
<h4><span class="mw-headline" id=".gitignore">.gitignore</span></h4>
<pre>*.iso
isodir
sysroot
</pre>
<h2><span class="mw-headline" id="Cross-Compiling_the_Operating_System">Cross-Compiling the Operating System</span></h2>
<p>The system is cross-compiled in the same manner as <a href="Bare_Bones" title="Bare Bones">Bare Bones</a>, though with
the complexity of having a system root with the final system and using a libk.
In this example, we elected to use shell scripts to to the top-level build
process, though you could possibly also use a makefile for that or a wholly
different build system. Though, assuming this setup works for you, you can clean
the source tree by invoking:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>./clean.sh
</pre></div>
<p>You can install all the system headers into the system root without relying on
the compiler at all, which will be useful later on when switching to a
<a href="Hosted_GCC_Cross-Compiler" title="Hosted GCC Cross-Compiler">Hosted GCC Cross-Compiler</a>, by invoking:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>./headers.sh
</pre></div>
<p>You can build a bootable cdrom image of the operating system by invoking:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>./iso.sh
</pre></div>
<p>It's probably a good idea to create a quick <i>build-and-then-launch</i> short-cut
like used in this example to run the system in your favorite emulator quickly:
</p>
<div class="mw-highlight mw-highlight-lang-bash mw-content-ltr" dir="ltr"><pre><span></span>./qemu.sh
</pre></div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>If you receive odd errors during the build, you may have made a mistake during manual copying, perhaps missed a file, forgot to make a file executable, or bugs in the highlighting software we use cause unintended whitespace to appear. Perform a git repository clone as described above, and use that code instead, or compare the two directory trees with the <tt>diff(1)</tt> diff command line utility. If you made personal changes to the code, those may be at fault.
</p>
<h2><span class="mw-headline" id="Moving_Forward">Moving Forward</span></h2>
<p>You should adapt this template to your needs. There's a number of things you
should consider doing now:
</p>
<h3><span class="mw-headline" id="Renaming_MyOS_to_YourOS">Renaming MyOS to YourOS</span></h3>
<p>Certainly you wish to name your operating system after your favorite flower,
hometown, boolean value, or whatever marketing told you. Do a search and replace
that replaces <tt>myos</tt> with whatever you wish to call it. Keep in mind that
the name is deliberately lower-case in a few places for technical reasons.
</p>
<h3><span class="mw-headline" id="Improving_the_Build_System">Improving the Build System</span></h3>
<dl><dd><i>Main article:</i> <a href="Hard_Build_System" title="Hard Build System">Hard Build System</a></dd></dl>
<p>It is probably worth improving the build system. For instance, it could be
useful if <tt>build.sh</tt> accepted command-line options, or perhaps if it used
<tt>make</tt>'s important <tt>-j</tt> option for concurrent builds.
</p><p>It's worth considering how contributors will build your operating system. It's an easy trap to fall into thinking you can make super script that does everything. This will end up complex and insufficiently flexible; or it will be flexible and even more complex. It's better to document what the user should do to prepare a cross toolchain and what prerequisite programs to install. This tutorial shows an example hard build system that merely builds the operating system. You can complete it by documenting how to build a cross-compiler and how to use it.
</p>
<h3><span class="mw-headline" id="Stack_Smash_Protector">Stack Smash Protector</span></h3>
<dl><dd><i>Main article:</i> <a href="Stack_Smashing_Protector" title="Stack Smashing Protector">Stack Smashing Protector</a></dd></dl>
<p>Early is not too soon to think about security and robustness. You can take advantage of the optional stack smash protector offered by modern compilers that detect stack buffer overruns rather than behaving unexpectedly (or nothing happening, if unlucky).
</p>
<h3><span class="mw-headline" id="Going_Further">Going Further</span></h3>
<dl><dd><i>Main article:</i> <a href="Going_Further_on_x86" title="Going Further on x86">Going Further on x86</a></dd></dl>
<p>This guide is meant as an overview of what to do, so you have a kernel ready for more features, without actually redesigning it radically when adding them.
</p>
<h3><span class="mw-headline" id="User-Space">User-Space</span></h3>
<p>A later tutorial in this series will extend this template with a proper
user-space and an <a href="OS_Specific_Toolchain" title="OS Specific Toolchain">OS Specific Toolchain</a> that fully utilizes the system root.
</p>
<h2><span class="mw-headline" id="Forum_Posts">Forum Posts</span></h2>
<ul><li><a href="http://forum.osdev.org/viewtopic.php?t=36584" class="extiw" title="topic:36584">A link error found &amp; fixed</a></li></ul>
<!-- 
NewPP limit report
Cached time: 20250211130419
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc]
CPU time usage: 0.283 seconds
Real time usage: 5.806 seconds
Preprocessor visited node count: 855/1000000
Post‐expand include size: 4131/2097152 bytes
Template argument size: 2664/2097152 bytes
Highest expansion depth: 15/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 101655/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00% 5709.350      1 -total
  0.13%    7.138      1 Template:FirstPerson
  0.10%    5.959     22 Template:If
  0.08%    4.481      1 Template:Kernel_designs
  0.08%    4.398     22 Template:Show1
  0.07%    4.135      1 Template:Rating
  0.07%    3.839      1 Template:SmallNavBox
  0.06%    3.443      2 Template:NoteBox
  0.05%    2.690      1 Template:BeginnersWarning
  0.02%    0.936      2 Template:Eq
-->

<!-- Saved in parser cache with key wikidb:pcache:idhash:3448-0!canonical and timestamp 20250211130413 and revision id 28435.
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;oldid=28435#System_Root">https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;oldid=28435#System_Root</a>"</div></div>
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="./Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="https://wiki.osdev.org/index.php?title=Category:Pages_using_duplicate_arguments_in_template_calls&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages using duplicate arguments in template calls (page does not exist)">Pages using duplicate arguments in template calls</a></li><li><a href="https://wiki.osdev.org/index.php?title=Category:Pages_using_deprecated_source_tags&amp;action=edit&amp;redlink=1" class="new" title="Category:Pages using deprecated source tags (page does not exist)">Pages using deprecated source tags</a></li><li><a href="./Category:Articles_Written_in_First_Person" title="Category:Articles Written in First Person">Articles Written in First Person</a></li><li><a href="./Category:Level_1_Tutorials" title="Category:Level 1 Tutorials">Level 1 Tutorials</a></li><li><a href="./Category:Tutorials" title="Category:Tutorials">Tutorials</a></li><li><a href="./Category:C" title="Category:C">C</a></li></ul></div></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		

<nav id="p-personal" class="vector-menu mw-portlet mw-portlet-personal vector-user-menu-legacy" aria-labelledby="p-personal-label" role="navigation"  >
	<h3
		id="p-personal-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Personal tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="pt-login" class="mw-list-item"><a href="https://wiki.osdev.org/index.php?title=Special:UserLogin&amp;returnto=Meaty+Skeleton" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span>Log in</span></a></li><li id="pt-darkmode" class="mw-list-item"><a href="Sysroot#" class="ext-darkmode-link"><span>Dark mode</span></a></li></ul>
		
	</div>
</nav>

		<div id="left-navigation">
			

<nav id="p-namespaces" class="vector-menu mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-namespaces-label" role="navigation"  >
	<h3
		id="p-namespaces-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Namespaces</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="ca-nstab-main" class="selected mw-list-item"><a href="Meaty_Skeleton" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="mw-list-item"><a href="./Talk:Meaty_Skeleton" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li></ul>
		
	</div>
</nav>

			

<nav id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown" aria-labelledby="p-variants-label" role="navigation"  >
	<input type="checkbox"
		id="p-variants-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-variants"
		class="vector-menu-checkbox"
		aria-labelledby="p-variants-label"
	/>
	<label
		id="p-variants-label"
		 aria-label="Change language variant"
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

		</div>
		<div id="right-navigation">
			

<nav id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-views-label" role="navigation"  >
	<h3
		id="p-views-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Views</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="ca-view" class="selected mw-list-item"><a href="Meaty_Skeleton"><span>Read</span></a></li><li id="ca-viewsource" class="mw-list-item"><a href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="mw-list-item"><a href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li></ul>
		
	</div>
</nav>

			

<nav id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown" aria-labelledby="p-cactions-label" role="navigation"  title="More options" >
	<input type="checkbox"
		id="p-cactions-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-cactions"
		class="vector-menu-checkbox"
		aria-labelledby="p-cactions-label"
	/>
	<label
		id="p-cactions-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<div>
			<h3 >
				<label for="searchInput">Search</label>
			</h3>
		<form action="https://wiki.osdev.org/index.php" id="searchform"
			class="vector-search-box-form">
			<div id="simpleSearch"
				class="vector-search-box-inner"
				 data-search-loc="header-navigation">
				<input class="vector-search-box-input"
					 type="search" name="search" placeholder="Search OSDev Wiki" aria-label="Search OSDev Wiki" autocapitalize="sentences" title="Search OSDev Wiki [f]" accesskey="f" id="searchInput"
				>
				<input type="hidden" name="title" value="Special:Search">
				<input id="mw-searchButton"
					 class="searchButton mw-fallbackSearchButton" type="submit" name="fulltext" title="Search the pages for this text" value="Search">
				<input id="searchButton"
					 class="searchButton" type="submit" name="go" title="Go to a page with this exact name if it exists" value="Go">
			</div>
		</form>
	</div>
</div>

		</div>
	</div>
	

<div id="mw-panel">
	<div id="p-logo" role="banner">
		<a class="mw-wiki-logo" href="index.html"
			title="Visit the main page"></a>
	</div>
	

<nav id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation vector-menu-portal portal" aria-labelledby="p-navigation-label" role="navigation"  >
	<h3
		id="p-navigation-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Navigation</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="n-mainpage" class="mw-list-item"><a href="index.html" title="Visit the main page [z]" accesskey="z"><span>Main Page</span></a></li><li id="n-portal" class="mw-list-item"><a href="http://forum.osdev.org/" rel="nofollow" title="About the project, what you can do, where to find things"><span>Forums</span></a></li><li id="n-FAQ" class="mw-list-item"><a href="./Category:FAQ"><span>FAQ</span></a></li><li id="n-OS-Projects" class="mw-list-item"><a href="Projects"><span>OS Projects</span></a></li><li id="n-randompage" class="mw-list-item"><a href="https://wiki.osdev.org/Special:Random" title="Load a random page [x]" accesskey="x"><span>Random page</span></a></li></ul>
		
	</div>
</nav>

	

<nav id="p-about" class="vector-menu mw-portlet mw-portlet-about vector-menu-portal portal" aria-labelledby="p-about-label" role="navigation"  >
	<h3
		id="p-about-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">About</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="n-This-site" class="mw-list-item"><a href="./OSDevWiki:About"><span>This site</span></a></li><li id="n-Joining" class="mw-list-item"><a href="./OSDevWiki:Joining"><span>Joining</span></a></li><li id="n-Editing-help" class="mw-list-item"><a href="./OSDevWiki:Editing"><span>Editing help</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="./Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li></ul>
		
	</div>
</nav>


<nav id="p-tb" class="vector-menu mw-portlet mw-portlet-tb vector-menu-portal portal" aria-labelledby="p-tb-label" role="navigation"  >
	<h3
		id="p-tb-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="t-whatlinkshere" class="mw-list-item"><a href="./Special:WhatLinksHere/Meaty_Skeleton" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="https://wiki.osdev.org/Special:RecentChangesLinked/Meaty_Skeleton" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="./Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink" class="mw-list-item"><a href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;oldid=28435" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;action=info" title="More information about this page"><span>Page information</span></a></li></ul>
		
	</div>
</nav>

	
</div>

</div>

<footer id="footer" class="mw-footer" role="contentinfo" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 2 November 2023, at 12:52.</li>
	<li id="footer-info-0">This page has been accessed 31,880 times.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="./OSDev_Wiki:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="./OSDev_Wiki:About">About OSDev Wiki</a></li>
	<li id="footer-places-disclaimer"><a href="./OSDev_Wiki:General_disclaimer">Disclaimers</a></li>
	<li id="footer-places-mobileview"><a href="https://wiki.osdev.org/index.php?title=Meaty_Skeleton&amp;mobileaction=toggle_view_mobile#System_Root" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"/></a></li>
</ul>

</footer>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.283","walltime":"5.806","ppvisitednodes":{"value":855,"limit":1000000},"postexpandincludesize":{"value":4131,"limit":2097152},"templateargumentsize":{"value":2664,"limit":2097152},"expansiondepth":{"value":15,"limit":100},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":101655,"limit":5000000},"timingprofile":["100.00% 5709.350      1 -total","  0.13%    7.138      1 Template:FirstPerson","  0.10%    5.959     22 Template:If","  0.08%    4.481      1 Template:Kernel_designs","  0.08%    4.398     22 Template:Show1","  0.07%    4.135      1 Template:Rating","  0.07%    3.839      1 Template:SmallNavBox","  0.06%    3.443      2 Template:NoteBox","  0.05%    2.690      1 Template:BeginnersWarning","  0.02%    0.936      2 Template:Eq"]},"cachereport":{"timestamp":"20250211130419","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":118});});</script>
</body>
</html>